{
  "version": 3,
  "sources": ["../../../../node_modules/tslib/tslib.js", "../../src/lib/predefineTinypass.ts", "../../src/lib/commonPolyfill.ts", "../../../../node_modules/tsyringe/dist/esm5/types/lifecycle.js", "../../../../node_modules/tslib/modules/index.js", "../../../../node_modules/tsyringe/dist/esm5/reflection-helpers.js", "../../../../node_modules/tsyringe/dist/esm5/providers/class-provider.js", "../../../../node_modules/tsyringe/dist/esm5/providers/factory-provider.js", "../../../../node_modules/tsyringe/dist/esm5/lazy-helpers.js", "../../../../node_modules/tsyringe/dist/esm5/providers/injection-token.js", "../../../../node_modules/tsyringe/dist/esm5/providers/token-provider.js", "../../../../node_modules/tsyringe/dist/esm5/providers/value-provider.js", "../../../../node_modules/tsyringe/dist/esm5/providers/provider.js", "../../../../node_modules/tsyringe/dist/esm5/registry-base.js", "../../../../node_modules/tsyringe/dist/esm5/registry.js", "../../../../node_modules/tsyringe/dist/esm5/resolution-context.js", "../../../../node_modules/tsyringe/dist/esm5/error-helpers.js", "../../../../node_modules/tsyringe/dist/esm5/types/disposable.js", "../../../../node_modules/tsyringe/dist/esm5/interceptors.js", "../../../../node_modules/tsyringe/dist/esm5/dependency-container.js", "../../../../node_modules/tsyringe/dist/esm5/decorators/inject.js", "../../../../node_modules/tsyringe/dist/esm5/decorators/injectable.js", "../../../../node_modules/tsyringe/dist/esm5/decorators/registry.js", "../../../../node_modules/tsyringe/dist/esm5/decorators/singleton.js", "../../../../node_modules/tsyringe/dist/esm5/factories/instance-caching-factory.js", "../../../../node_modules/tsyringe/dist/esm5/index.js", "../../src/lib/predefine.ts", "../../src/lib/checkTinypass.ts", "../../src/lib/css.ts", "../../src/lib/ajax-jq.js", "../../src/lib/ajax.ts", "../../src/lib/jqUtils.ts", "../../../../node_modules/@piano-sdk/storage/dist/index.js", "../../../../node_modules/@piano-sdk/data-layer/index.js", "../../../../node_modules/@piano-sdk/consent/dist/index.js", "../../src/lib/deprecated.ts", "../../src/lib/consent.ts", "../../src/lib/cookie.ts", "../../src/lib/localStorage.ts", "../../src/lib/versionService.ts", "../../src/lib/itp.ts", "../../src/lib/util.ts", "../../src/lib/frequency-capping/utils.ts", "../../src/lib/frequency-capping/pcfe.constant.ts", "../../src/lib/frequency-capping/pcfe.utils.ts", "../../src/lib/frequency-capping/pcfe.migration.ts", "../../src/lib/frequency-capping/pcfe.ts", "../../src/lib/composerControlPolicy.ts", "../../src/lib/api.ts", "../../src/lib/postmessage.ts", "../../src/lib/eventUtils.ts", "../../src/lib/janrain.ts", "../../src/lib/sha1.ts", "../../src/lib/observer.ts", "../../src/lib/containerUtils.ts", "../../src/lib/log.ts", "../../src/lib/fbpixel.ts", "../../src/lib/clientConfiguration/clientConfiguration.ts", "../../src/lib/googleAnalytics/gaCollectingService.ts", "../../src/lib/googleAnalytics/constants.ts", "../../src/lib/googleAnalytics/gaService.ts", "../../src/lib/googleAnalytics/ga4Service.ts", "../../src/lib/acp.ts", "../../src/lib/analytics.ts", "../../src/lib/logging.ts", "../../src/lib/credit.ts", "../../src/lib/tinypassLogin.ts", "../../src/lib/tinypassAccounts.ts", "../../src/lib/condeUserProvider.ts", "../../src/lib/gigya.ts", "../../src/lib/jwtDecode.ts", "../../src/lib/pianoId/features/url-manager.ts", "../../src/lib/pianoId/features/lang-manager.ts", "../../src/lib/pianoId/features/utils.ts", "../../src/lib/pianoId/features/iframe-builder.ts", "../../src/lib/pianoId/features/msqa/msqa.error.ts", "../../src/lib/pianoId/features/msqa/msqa.ts", "../../src/lib/pianoId/features/self-serve-sessions.ts", "../../src/lib/pianoId/features/token-manager.ts", "../../src/lib/pianoId/features/config-manager.ts", "../../src/lib/pianoId/features/request.manager.ts", "../../src/lib/pianoId/pianoId.ts", "../../src/lib/pianoIdLite.ts", "../../src/lib/user.ts", "../../src/lib/viewportExit.ts", "../../src/lib/template.ts", "../../src/lib/offer.ts", "../../src/lib/myaccount.ts", "../../src/lib/meter.ts", "../../src/lib/fingerprint.ts", "../../src/lib/scrollDepth.ts", "../../src/lib/idle.ts", "../../src/lib/interaction.ts", "../../src/lib/recWidgetService.ts", "../../src/lib/piano.ts", "../../src/lib/pianoEsp.ts", "../../src/lib/swg.ts", "../../src/lib/fbsubscriptions.ts", "../../src/lib/cxense.ts", "../../src/lib/templateInteraction/types.ts", "../../src/lib/templateInteraction/utils.ts", "../../src/lib/templateInteraction/custom-fields.types.ts", "../../src/lib/templateInteraction/custom-fields.util.ts", "../../src/lib/templateInteraction/custom-fields.ts", "../../src/lib/templateInteraction/register.ts", "../../src/lib/templateInteraction/continuation.ts", "../../src/lib/templateInteraction/index.ts", "../../src/lib/experience.ts", "../../src/lib/ifvisible.ts", "../../src/lib/activetimer.ts", "../../src/lib/doubleClickForPublisher.ts", "../../src/lib/applePay.ts", "../../src/lib/goCardlessDropin.ts", "../../src/lib/braintreeGooglePayIntegrationService.ts", "../../src/lib/applePayIntegrationService.ts", "../../src/lib/datatransApplePayIntegrationService.ts", "../../src/lib/stripeApplePayIntegrationService.ts", "../../src/lib/obi3DSChallenge.ts", "../../src/lib/amp.ts", "../../src/lib/performanceMetrics.ts", "../../src/lib/doubleOptIn.ts", "../../src/lib/newscycle.ts", "../../src/lib/captchaV3.ts", "../../src/lib/tinypassErrorHandler.ts", "../../src/lib/main.ts", "../../src/config/sdk-modules.ts", "../../src/lib/tinypass.ts", "../../src/lib/postProcessing.ts"],
  "sourcesContent": ["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global global, define, System, Reflect, Promise */\r\nvar __extends;\r\nvar __assign;\r\nvar __rest;\r\nvar __decorate;\r\nvar __param;\r\nvar __metadata;\r\nvar __awaiter;\r\nvar __generator;\r\nvar __exportStar;\r\nvar __values;\r\nvar __read;\r\nvar __spread;\r\nvar __spreadArrays;\r\nvar __spreadArray;\r\nvar __await;\r\nvar __asyncGenerator;\r\nvar __asyncDelegator;\r\nvar __asyncValues;\r\nvar __makeTemplateObject;\r\nvar __importStar;\r\nvar __importDefault;\r\nvar __classPrivateFieldGet;\r\nvar __classPrivateFieldSet;\r\nvar __classPrivateFieldIn;\r\nvar __createBinding;\r\n(function (factory) {\r\n    var root = typeof global === \"object\" ? global : typeof self === \"object\" ? self : typeof this === \"object\" ? this : {};\r\n    if (typeof define === \"function\" && define.amd) {\r\n        define(\"tslib\", [\"exports\"], function (exports) { factory(createExporter(root, createExporter(exports))); });\r\n    }\r\n    else if (typeof module === \"object\" && typeof module.exports === \"object\") {\r\n        factory(createExporter(root, createExporter(module.exports)));\r\n    }\r\n    else {\r\n        factory(createExporter(root));\r\n    }\r\n    function createExporter(exports, previous) {\r\n        if (exports !== root) {\r\n            if (typeof Object.create === \"function\") {\r\n                Object.defineProperty(exports, \"__esModule\", { value: true });\r\n            }\r\n            else {\r\n                exports.__esModule = true;\r\n            }\r\n        }\r\n        return function (id, v) { return exports[id] = previous ? previous(id, v) : v; };\r\n    }\r\n})\r\n(function (exporter) {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n\r\n    __extends = function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n\r\n    __assign = Object.assign || function (t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n\r\n    __rest = function (s, e) {\r\n        var t = {};\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n            t[p] = s[p];\r\n        if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n            for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n                if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                    t[p[i]] = s[p[i]];\r\n            }\r\n        return t;\r\n    };\r\n\r\n    __decorate = function (decorators, target, key, desc) {\r\n        var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n        if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n        else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n        return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n    };\r\n\r\n    __param = function (paramIndex, decorator) {\r\n        return function (target, key) { decorator(target, key, paramIndex); }\r\n    };\r\n\r\n    __metadata = function (metadataKey, metadataValue) {\r\n        if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n    };\r\n\r\n    __awaiter = function (thisArg, _arguments, P, generator) {\r\n        function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n        return new (P || (P = Promise))(function (resolve, reject) {\r\n            function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n            function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n            function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n            step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n        });\r\n    };\r\n\r\n    __generator = function (thisArg, body) {\r\n        var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n        return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n        function verb(n) { return function (v) { return step([n, v]); }; }\r\n        function step(op) {\r\n            if (f) throw new TypeError(\"Generator is already executing.\");\r\n            while (_) try {\r\n                if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n                if (y = 0, t) op = [op[0] & 2, t.value];\r\n                switch (op[0]) {\r\n                    case 0: case 1: t = op; break;\r\n                    case 4: _.label++; return { value: op[1], done: false };\r\n                    case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                    case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                    default:\r\n                        if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                        if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                        if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                        if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                        if (t[2]) _.ops.pop();\r\n                        _.trys.pop(); continue;\r\n                }\r\n                op = body.call(thisArg, _);\r\n            } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n            if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n        }\r\n    };\r\n\r\n    __exportStar = function(m, o) {\r\n        for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n    };\r\n\r\n    __createBinding = Object.create ? (function(o, m, k, k2) {\r\n        if (k2 === undefined) k2 = k;\r\n        var desc = Object.getOwnPropertyDescriptor(m, k);\r\n        if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n            desc = { enumerable: true, get: function() { return m[k]; } };\r\n        }\r\n        Object.defineProperty(o, k2, desc);\r\n    }) : (function(o, m, k, k2) {\r\n        if (k2 === undefined) k2 = k;\r\n        o[k2] = m[k];\r\n    });\r\n\r\n    __values = function (o) {\r\n        var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n        if (m) return m.call(o);\r\n        if (o && typeof o.length === \"number\") return {\r\n            next: function () {\r\n                if (o && i >= o.length) o = void 0;\r\n                return { value: o && o[i++], done: !o };\r\n            }\r\n        };\r\n        throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n    };\r\n\r\n    __read = function (o, n) {\r\n        var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n        if (!m) return o;\r\n        var i = m.call(o), r, ar = [], e;\r\n        try {\r\n            while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n        }\r\n        catch (error) { e = { error: error }; }\r\n        finally {\r\n            try {\r\n                if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n            }\r\n            finally { if (e) throw e.error; }\r\n        }\r\n        return ar;\r\n    };\r\n\r\n    /** @deprecated */\r\n    __spread = function () {\r\n        for (var ar = [], i = 0; i < arguments.length; i++)\r\n            ar = ar.concat(__read(arguments[i]));\r\n        return ar;\r\n    };\r\n\r\n    /** @deprecated */\r\n    __spreadArrays = function () {\r\n        for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n        for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n            for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n                r[k] = a[j];\r\n        return r;\r\n    };\r\n\r\n    __spreadArray = function (to, from, pack) {\r\n        if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n            if (ar || !(i in from)) {\r\n                if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n                ar[i] = from[i];\r\n            }\r\n        }\r\n        return to.concat(ar || Array.prototype.slice.call(from));\r\n    };\r\n\r\n    __await = function (v) {\r\n        return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n    };\r\n\r\n    __asyncGenerator = function (thisArg, _arguments, generator) {\r\n        if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n        var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n        return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n        function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n        function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n        function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);  }\r\n        function fulfill(value) { resume(\"next\", value); }\r\n        function reject(value) { resume(\"throw\", value); }\r\n        function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n    };\r\n\r\n    __asyncDelegator = function (o) {\r\n        var i, p;\r\n        return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n        function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n    };\r\n\r\n    __asyncValues = function (o) {\r\n        if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n        var m = o[Symbol.asyncIterator], i;\r\n        return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n        function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n        function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n    };\r\n\r\n    __makeTemplateObject = function (cooked, raw) {\r\n        if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n        return cooked;\r\n    };\r\n\r\n    var __setModuleDefault = Object.create ? (function(o, v) {\r\n        Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n    }) : function(o, v) {\r\n        o[\"default\"] = v;\r\n    };\r\n\r\n    __importStar = function (mod) {\r\n        if (mod && mod.__esModule) return mod;\r\n        var result = {};\r\n        if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n        __setModuleDefault(result, mod);\r\n        return result;\r\n    };\r\n\r\n    __importDefault = function (mod) {\r\n        return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n    };\r\n\r\n    __classPrivateFieldGet = function (receiver, state, kind, f) {\r\n        if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n        if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n        return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n    };\r\n\r\n    __classPrivateFieldSet = function (receiver, state, value, kind, f) {\r\n        if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n        if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n        if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n        return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n    };\r\n\r\n    __classPrivateFieldIn = function (state, receiver) {\r\n        if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n        return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n    };\r\n\r\n    exporter(\"__extends\", __extends);\r\n    exporter(\"__assign\", __assign);\r\n    exporter(\"__rest\", __rest);\r\n    exporter(\"__decorate\", __decorate);\r\n    exporter(\"__param\", __param);\r\n    exporter(\"__metadata\", __metadata);\r\n    exporter(\"__awaiter\", __awaiter);\r\n    exporter(\"__generator\", __generator);\r\n    exporter(\"__exportStar\", __exportStar);\r\n    exporter(\"__createBinding\", __createBinding);\r\n    exporter(\"__values\", __values);\r\n    exporter(\"__read\", __read);\r\n    exporter(\"__spread\", __spread);\r\n    exporter(\"__spreadArrays\", __spreadArrays);\r\n    exporter(\"__spreadArray\", __spreadArray);\r\n    exporter(\"__await\", __await);\r\n    exporter(\"__asyncGenerator\", __asyncGenerator);\r\n    exporter(\"__asyncDelegator\", __asyncDelegator);\r\n    exporter(\"__asyncValues\", __asyncValues);\r\n    exporter(\"__makeTemplateObject\", __makeTemplateObject);\r\n    exporter(\"__importStar\", __importStar);\r\n    exporter(\"__importDefault\", __importDefault);\r\n    exporter(\"__classPrivateFieldGet\", __classPrivateFieldGet);\r\n    exporter(\"__classPrivateFieldSet\", __classPrivateFieldSet);\r\n    exporter(\"__classPrivateFieldIn\", __classPrivateFieldIn);\r\n});\r\n", "window.pnFullTPVersion = true;\n", "\n/**\n * Object.assign() polyfill for IE11\n * @see <https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign>\n */\nif (typeof Object.assign != \"function\") {\n  Object.defineProperty(Object, \"assign\", {\n    // @ts-ignore\n    value: function assign(target, varArgs) {\n      \"use strict\";\n      if (target == null) {\n        throw new TypeError(\"Cannot convert undefined or null to object\");\n      }\n      var to = Object(target);\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n        if (nextSource != null) {\n          for (var nextKey in nextSource) {\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    },\n    writable: true,\n    configurable: true\n  });\n}\n\n// https://github.com/abraham/reflection\n// write here the code because of error with \"Reflection is undefined\" on IE11\n\nexport type Decorator = ClassDecorator | MemberDecorator;\nexport type MemberDecorator = <T>(\n  target: Target,\n  propertyKey: PropertyKey,\n  descriptor?: TypedPropertyDescriptor<T>,\n) => TypedPropertyDescriptor<T> | void;\nexport type MetadataKey = string | symbol;\nexport type PropertyKey = string | symbol;\nexport type Target = object | Function;\n\nconst Metadata = new WeakMap();\n\nfunction decorateProperty(\n  decorators: MemberDecorator[],\n  target: Target,\n  propertyKey: PropertyKey,\n  descriptor?: PropertyDescriptor,\n): PropertyDescriptor | undefined {\n  decorators.reverse().forEach((decorator: MemberDecorator) => {\n    descriptor = decorator(target, propertyKey, descriptor) || descriptor;\n  });\n  return descriptor;\n}\n\nfunction decorateConstructor(\n  decorators: ClassDecorator[],\n  target: Function,\n): Function {\n  decorators.reverse().forEach((decorator: ClassDecorator) => {\n    const decorated = decorator(target);\n    if (decorated) {\n      target = decorated;\n    }\n  });\n  return target;\n}\n\nexport function decorate(\n  decorators: ClassDecorator[],\n  target: Function,\n): Function;\nexport function decorate(\n  decorators: MemberDecorator[],\n  target: object,\n  propertyKey?: PropertyKey,\n  attributes?: PropertyDescriptor,\n): PropertyDescriptor | undefined;\nexport function decorate(\n  decorators: Decorator[],\n  target: Target,\n  propertyKey?: PropertyKey,\n  attributes?: PropertyDescriptor,\n): Function | PropertyDescriptor | undefined {\n  if (!Array.isArray(decorators) || decorators.length === 0) {\n    throw new TypeError();\n  }\n\n  if (propertyKey !== undefined) {\n    return decorateProperty(\n      decorators as MemberDecorator[],\n      target,\n      propertyKey,\n      attributes,\n    );\n  }\n\n  if (typeof target === 'function') {\n    return decorateConstructor(decorators as ClassDecorator[], target);\n  }\n\n  return;\n}\n\nfunction getMetadataMap<MetadataValue>(\n  target: Target,\n  propertyKey?: PropertyKey,\n): Map<MetadataKey, MetadataValue> | undefined {\n  return Metadata.get(target) && Metadata.get(target).get(propertyKey);\n}\n\nfunction ordinaryGetOwnMetadata<MetadataValue>(\n  metadataKey: MetadataKey,\n  target: Target,\n  propertyKey?: PropertyKey,\n): MetadataValue | undefined {\n  if (target === undefined) {\n    throw new TypeError();\n  }\n  const metadataMap = getMetadataMap<MetadataValue>(target, propertyKey);\n  return metadataMap && metadataMap.get(metadataKey);\n}\n\nfunction createMetadataMap<MetadataValue>(\n  target: Target,\n  propertyKey?: PropertyKey,\n): Map<MetadataKey, MetadataValue> {\n  const targetMetadata =\n    Metadata.get(target) ||\n    new Map<PropertyKey | undefined, Map<MetadataKey, MetadataValue>>();\n  Metadata.set(target, targetMetadata);\n  const metadataMap =\n    targetMetadata.get(propertyKey) || new Map<MetadataKey, MetadataValue>();\n  targetMetadata.set(propertyKey, metadataMap);\n  return metadataMap;\n}\n\nfunction ordinaryDefineOwnMetadata<MetadataValue>(\n  metadataKey: MetadataKey,\n  metadataValue: MetadataValue,\n  target: Target,\n  propertyKey?: PropertyKey,\n): void {\n  if (propertyKey && !['string', 'symbol'].includes(typeof propertyKey)) {\n    throw new TypeError();\n  }\n\n  (\n    getMetadataMap<MetadataValue>(target, propertyKey) ||\n    createMetadataMap<MetadataValue>(target, propertyKey)\n  ).set(metadataKey, metadataValue);\n}\n\nfunction ordinaryGetMetadata<MetadataValue>(\n  metadataKey: MetadataKey,\n  target: Target,\n  propertyKey?: PropertyKey,\n): MetadataValue | undefined {\n  return ordinaryGetOwnMetadata<MetadataValue>(metadataKey, target, propertyKey)\n    ? ordinaryGetOwnMetadata<MetadataValue>(metadataKey, target, propertyKey)\n    : Object.getPrototypeOf(target)\n      ? ordinaryGetMetadata(\n        metadataKey,\n        Object.getPrototypeOf(target),\n        propertyKey,\n      )\n      : undefined;\n}\n\nexport function metadata<MetadataValue>(\n  metadataKey: MetadataKey,\n  metadataValue: MetadataValue,\n) {\n  return function decorator(target: Target, propertyKey?: PropertyKey): void {\n    ordinaryDefineOwnMetadata<MetadataValue>(\n      metadataKey,\n      metadataValue,\n      target,\n      propertyKey,\n    );\n  };\n}\n\nexport function getMetadata<MetadataValue>(\n  metadataKey: MetadataKey,\n  target: Target,\n  propertyKey?: PropertyKey,\n): MetadataValue | undefined {\n  return ordinaryGetMetadata<MetadataValue>(metadataKey, target, propertyKey);\n}\n\nexport function getOwnMetadata<MetadataValue>(\n  metadataKey: MetadataKey,\n  target: Target,\n  propertyKey?: PropertyKey,\n): MetadataValue | undefined {\n  return ordinaryGetOwnMetadata<MetadataValue>(\n    metadataKey,\n    target,\n    propertyKey,\n  );\n}\n\nexport function hasOwnMetadata(\n  metadataKey: MetadataKey,\n  target: Target,\n  propertyKey?: PropertyKey,\n): boolean {\n  return !!ordinaryGetOwnMetadata(metadataKey, target, propertyKey);\n}\n\nexport function hasMetadata(\n  metadataKey: MetadataKey,\n  target: Target,\n  propertyKey?: PropertyKey,\n): boolean {\n  return !!ordinaryGetMetadata(metadataKey, target, propertyKey);\n}\n\nexport function defineMetadata<MetadataValue>(\n  metadataKey: MetadataKey,\n  metadataValue: MetadataValue,\n  target: Target,\n  propertyKey?: PropertyKey,\n): void {\n  ordinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n}\n\nexport const Reflection = {\n  decorate,\n  defineMetadata,\n  getMetadata,\n  getOwnMetadata,\n  hasMetadata,\n  hasOwnMetadata,\n  metadata,\n};\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  namespace Reflect {\n    let decorate: typeof Reflection.decorate;\n    let defineMetadata: typeof Reflection.defineMetadata;\n    let getMetadata: typeof Reflection.getMetadata;\n    let getOwnMetadata: typeof Reflection.getOwnMetadata;\n    let hasOwnMetadata: typeof Reflection.hasOwnMetadata;\n    let hasMetadata: typeof Reflection.hasMetadata;\n    let metadata: typeof Reflection.metadata;\n  }\n}\n\nwindow.Reflect = window.Reflect || {};\n\nObject.assign(window.Reflect, Reflection);\n", "var Lifecycle;\n(function (Lifecycle) {\n    Lifecycle[Lifecycle[\"Transient\"] = 0] = \"Transient\";\n    Lifecycle[Lifecycle[\"Singleton\"] = 1] = \"Singleton\";\n    Lifecycle[Lifecycle[\"ResolutionScoped\"] = 2] = \"ResolutionScoped\";\n    Lifecycle[Lifecycle[\"ContainerScoped\"] = 3] = \"ContainerScoped\";\n})(Lifecycle || (Lifecycle = {}));\nexport default Lifecycle;\n", "import tslib from '../tslib.js';\r\nconst {\r\n    __extends,\r\n    __assign,\r\n    __rest,\r\n    __decorate,\r\n    __param,\r\n    __metadata,\r\n    __awaiter,\r\n    __generator,\r\n    __exportStar,\r\n    __createBinding,\r\n    __values,\r\n    __read,\r\n    __spread,\r\n    __spreadArrays,\r\n    __spreadArray,\r\n    __await,\r\n    __asyncGenerator,\r\n    __asyncDelegator,\r\n    __asyncValues,\r\n    __makeTemplateObject,\r\n    __importStar,\r\n    __importDefault,\r\n    __classPrivateFieldGet,\r\n    __classPrivateFieldSet,\r\n    __classPrivateFieldIn,\r\n} = tslib;\r\nexport {\r\n    __extends,\r\n    __assign,\r\n    __rest,\r\n    __decorate,\r\n    __param,\r\n    __metadata,\r\n    __awaiter,\r\n    __generator,\r\n    __exportStar,\r\n    __createBinding,\r\n    __values,\r\n    __read,\r\n    __spread,\r\n    __spreadArrays,\r\n    __spreadArray,\r\n    __await,\r\n    __asyncGenerator,\r\n    __asyncDelegator,\r\n    __asyncValues,\r\n    __makeTemplateObject,\r\n    __importStar,\r\n    __importDefault,\r\n    __classPrivateFieldGet,\r\n    __classPrivateFieldSet,\r\n    __classPrivateFieldIn,\r\n};\r\n", "export var INJECTION_TOKEN_METADATA_KEY = \"injectionTokens\";\nexport function getParamInfo(target) {\n    var params = Reflect.getMetadata(\"design:paramtypes\", target) || [];\n    var injectionTokens = Reflect.getOwnMetadata(INJECTION_TOKEN_METADATA_KEY, target) || {};\n    Object.keys(injectionTokens).forEach(function (key) {\n        params[+key] = injectionTokens[key];\n    });\n    return params;\n}\nexport function defineInjectionTokenMetadata(data, transform) {\n    return function (target, _propertyKey, parameterIndex) {\n        var descriptors = Reflect.getOwnMetadata(INJECTION_TOKEN_METADATA_KEY, target) || {};\n        descriptors[parameterIndex] = transform\n            ? {\n                token: data,\n                transform: transform.transformToken,\n                transformArgs: transform.args || []\n            }\n            : data;\n        Reflect.defineMetadata(INJECTION_TOKEN_METADATA_KEY, descriptors, target);\n    };\n}\n", "export function isClassProvider(provider) {\n    return !!provider.useClass;\n}\n", "export function isFactoryProvider(provider) {\n    return !!provider.useFactory;\n}\n", "import { __read, __spread } from \"tslib\";\nvar DelayedConstructor = (function () {\n    function DelayedConstructor(wrap) {\n        this.wrap = wrap;\n        this.reflectMethods = [\n            \"get\",\n            \"getPrototypeOf\",\n            \"setPrototypeOf\",\n            \"getOwnPropertyDescriptor\",\n            \"defineProperty\",\n            \"has\",\n            \"set\",\n            \"deleteProperty\",\n            \"apply\",\n            \"construct\",\n            \"ownKeys\"\n        ];\n    }\n    DelayedConstructor.prototype.createProxy = function (createObject) {\n        var _this = this;\n        var target = {};\n        var init = false;\n        var value;\n        var delayedObject = function () {\n            if (!init) {\n                value = createObject(_this.wrap());\n                init = true;\n            }\n            return value;\n        };\n        return new Proxy(target, this.createHandler(delayedObject));\n    };\n    DelayedConstructor.prototype.createHandler = function (delayedObject) {\n        var handler = {};\n        var install = function (name) {\n            handler[name] = function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i] = arguments[_i];\n                }\n                args[0] = delayedObject();\n                var method = Reflect[name];\n                return method.apply(void 0, __spread(args));\n            };\n        };\n        this.reflectMethods.forEach(install);\n        return handler;\n    };\n    return DelayedConstructor;\n}());\nexport { DelayedConstructor };\nexport function delay(wrappedConstructor) {\n    if (typeof wrappedConstructor === \"undefined\") {\n        throw new Error(\"Attempt to `delay` undefined. Constructor must be wrapped in a callback\");\n    }\n    return new DelayedConstructor(wrappedConstructor);\n}\n", "import { DelayedConstructor } from \"../lazy-helpers\";\nexport function isNormalToken(token) {\n    return typeof token === \"string\" || typeof token === \"symbol\";\n}\nexport function isTokenDescriptor(descriptor) {\n    return (typeof descriptor === \"object\" &&\n        \"token\" in descriptor &&\n        \"multiple\" in descriptor);\n}\nexport function isTransformDescriptor(descriptor) {\n    return (typeof descriptor === \"object\" &&\n        \"token\" in descriptor &&\n        \"transform\" in descriptor);\n}\nexport function isConstructorToken(token) {\n    return typeof token === \"function\" || token instanceof DelayedConstructor;\n}\n", "export function isTokenProvider(provider) {\n    return !!provider.useToken;\n}\n", "export function isValueProvider(provider) {\n    return provider.useValue != undefined;\n}\n", "import { isClassProvider } from \"./class-provider\";\nimport { isValueProvider } from \"./value-provider\";\nimport { isTokenProvider } from \"./token-provider\";\nimport { isFactoryProvider } from \"./factory-provider\";\nexport function isProvider(provider) {\n    return (isClassProvider(provider) ||\n        isValueProvider(provider) ||\n        isTokenProvider(provider) ||\n        isFactoryProvider(provider));\n}\n", "var RegistryBase = (function () {\n    function RegistryBase() {\n        this._registryMap = new Map();\n    }\n    RegistryBase.prototype.entries = function () {\n        return this._registryMap.entries();\n    };\n    RegistryBase.prototype.getAll = function (key) {\n        this.ensure(key);\n        return this._registryMap.get(key);\n    };\n    RegistryBase.prototype.get = function (key) {\n        this.ensure(key);\n        var value = this._registryMap.get(key);\n        return value[value.length - 1] || null;\n    };\n    RegistryBase.prototype.set = function (key, value) {\n        this.ensure(key);\n        this._registryMap.get(key).push(value);\n    };\n    RegistryBase.prototype.setAll = function (key, value) {\n        this._registryMap.set(key, value);\n    };\n    RegistryBase.prototype.has = function (key) {\n        this.ensure(key);\n        return this._registryMap.get(key).length > 0;\n    };\n    RegistryBase.prototype.clear = function () {\n        this._registryMap.clear();\n    };\n    RegistryBase.prototype.ensure = function (key) {\n        if (!this._registryMap.has(key)) {\n            this._registryMap.set(key, []);\n        }\n    };\n    return RegistryBase;\n}());\nexport default RegistryBase;\n", "import { __extends } from \"tslib\";\nimport RegistryBase from \"./registry-base\";\nvar Registry = (function (_super) {\n    __extends(Registry, _super);\n    function Registry() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return Registry;\n}(RegistryBase));\nexport default Registry;\n", "var ResolutionContext = (function () {\n    function ResolutionContext() {\n        this.scopedResolutions = new Map();\n    }\n    return ResolutionContext;\n}());\nexport default ResolutionContext;\n", "import { __read, __spread } from \"tslib\";\nfunction formatDependency(params, idx) {\n    if (params === null) {\n        return \"at position #\" + idx;\n    }\n    var argName = params.split(\",\")[idx].trim();\n    return \"\\\"\" + argName + \"\\\" at position #\" + idx;\n}\nfunction composeErrorMessage(msg, e, indent) {\n    if (indent === void 0) { indent = \"    \"; }\n    return __spread([msg], e.message.split(\"\\n\").map(function (l) { return indent + l; })).join(\"\\n\");\n}\nexport function formatErrorCtor(ctor, paramIdx, error) {\n    var _a = __read(ctor.toString().match(/constructor\\(([\\w, ]+)\\)/) || [], 2), _b = _a[1], params = _b === void 0 ? null : _b;\n    var dep = formatDependency(params, paramIdx);\n    return composeErrorMessage(\"Cannot inject the dependency \" + dep + \" of \\\"\" + ctor.name + \"\\\" constructor. Reason:\", error);\n}\n", "export function isDisposable(value) {\n    if (typeof value.dispose !== \"function\")\n        return false;\n    var disposeFun = value.dispose;\n    if (disposeFun.length > 0) {\n        return false;\n    }\n    return true;\n}\n", "import { __extends } from \"tslib\";\nimport RegistryBase from \"./registry-base\";\nvar PreResolutionInterceptors = (function (_super) {\n    __extends(PreResolutionInterceptors, _super);\n    function PreResolutionInterceptors() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return PreResolutionInterceptors;\n}(RegistryBase));\nexport { PreResolutionInterceptors };\nvar PostResolutionInterceptors = (function (_super) {\n    __extends(PostResolutionInterceptors, _super);\n    function PostResolutionInterceptors() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return PostResolutionInterceptors;\n}(RegistryBase));\nexport { PostResolutionInterceptors };\nvar Interceptors = (function () {\n    function Interceptors() {\n        this.preResolution = new PreResolutionInterceptors();\n        this.postResolution = new PostResolutionInterceptors();\n    }\n    return Interceptors;\n}());\nexport default Interceptors;\n", "import { __awaiter, __generator, __read, __spread, __values } from \"tslib\";\nimport { isClassProvider, isFactoryProvider, isNormalToken, isTokenProvider, isValueProvider } from \"./providers\";\nimport { isProvider } from \"./providers/provider\";\nimport { isConstructorToken, isTokenDescriptor, isTransformDescriptor } from \"./providers/injection-token\";\nimport Registry from \"./registry\";\nimport Lifecycle from \"./types/lifecycle\";\nimport ResolutionContext from \"./resolution-context\";\nimport { formatErrorCtor } from \"./error-helpers\";\nimport { DelayedConstructor } from \"./lazy-helpers\";\nimport { isDisposable } from \"./types/disposable\";\nimport Interceptors from \"./interceptors\";\nexport var typeInfo = new Map();\nvar InternalDependencyContainer = (function () {\n    function InternalDependencyContainer(parent) {\n        this.parent = parent;\n        this._registry = new Registry();\n        this.interceptors = new Interceptors();\n        this.disposed = false;\n        this.disposables = new Set();\n    }\n    InternalDependencyContainer.prototype.register = function (token, providerOrConstructor, options) {\n        if (options === void 0) { options = { lifecycle: Lifecycle.Transient }; }\n        this.ensureNotDisposed();\n        var provider;\n        if (!isProvider(providerOrConstructor)) {\n            provider = { useClass: providerOrConstructor };\n        }\n        else {\n            provider = providerOrConstructor;\n        }\n        if (isTokenProvider(provider)) {\n            var path = [token];\n            var tokenProvider = provider;\n            while (tokenProvider != null) {\n                var currentToken = tokenProvider.useToken;\n                if (path.includes(currentToken)) {\n                    throw new Error(\"Token registration cycle detected! \" + __spread(path, [currentToken]).join(\" -> \"));\n                }\n                path.push(currentToken);\n                var registration = this._registry.get(currentToken);\n                if (registration && isTokenProvider(registration.provider)) {\n                    tokenProvider = registration.provider;\n                }\n                else {\n                    tokenProvider = null;\n                }\n            }\n        }\n        if (options.lifecycle === Lifecycle.Singleton ||\n            options.lifecycle == Lifecycle.ContainerScoped ||\n            options.lifecycle == Lifecycle.ResolutionScoped) {\n            if (isValueProvider(provider) || isFactoryProvider(provider)) {\n                throw new Error(\"Cannot use lifecycle \\\"\" + Lifecycle[options.lifecycle] + \"\\\" with ValueProviders or FactoryProviders\");\n            }\n        }\n        this._registry.set(token, { provider: provider, options: options });\n        return this;\n    };\n    InternalDependencyContainer.prototype.registerType = function (from, to) {\n        this.ensureNotDisposed();\n        if (isNormalToken(to)) {\n            return this.register(from, {\n                useToken: to\n            });\n        }\n        return this.register(from, {\n            useClass: to\n        });\n    };\n    InternalDependencyContainer.prototype.registerInstance = function (token, instance) {\n        this.ensureNotDisposed();\n        return this.register(token, {\n            useValue: instance\n        });\n    };\n    InternalDependencyContainer.prototype.registerSingleton = function (from, to) {\n        this.ensureNotDisposed();\n        if (isNormalToken(from)) {\n            if (isNormalToken(to)) {\n                return this.register(from, {\n                    useToken: to\n                }, { lifecycle: Lifecycle.Singleton });\n            }\n            else if (to) {\n                return this.register(from, {\n                    useClass: to\n                }, { lifecycle: Lifecycle.Singleton });\n            }\n            throw new Error('Cannot register a type name as a singleton without a \"to\" token');\n        }\n        var useClass = from;\n        if (to && !isNormalToken(to)) {\n            useClass = to;\n        }\n        return this.register(from, {\n            useClass: useClass\n        }, { lifecycle: Lifecycle.Singleton });\n    };\n    InternalDependencyContainer.prototype.resolve = function (token, context) {\n        if (context === void 0) { context = new ResolutionContext(); }\n        this.ensureNotDisposed();\n        var registration = this.getRegistration(token);\n        if (!registration && isNormalToken(token)) {\n            throw new Error(\"Attempted to resolve unregistered dependency token: \\\"\" + token.toString() + \"\\\"\");\n        }\n        this.executePreResolutionInterceptor(token, \"Single\");\n        if (registration) {\n            var result = this.resolveRegistration(registration, context);\n            this.executePostResolutionInterceptor(token, result, \"Single\");\n            return result;\n        }\n        if (isConstructorToken(token)) {\n            var result = this.construct(token, context);\n            this.executePostResolutionInterceptor(token, result, \"Single\");\n            return result;\n        }\n        throw new Error(\"Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.\");\n    };\n    InternalDependencyContainer.prototype.executePreResolutionInterceptor = function (token, resolutionType) {\n        var e_1, _a;\n        if (this.interceptors.preResolution.has(token)) {\n            var remainingInterceptors = [];\n            try {\n                for (var _b = __values(this.interceptors.preResolution.getAll(token)), _c = _b.next(); !_c.done; _c = _b.next()) {\n                    var interceptor = _c.value;\n                    if (interceptor.options.frequency != \"Once\") {\n                        remainingInterceptors.push(interceptor);\n                    }\n                    interceptor.callback(token, resolutionType);\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n            this.interceptors.preResolution.setAll(token, remainingInterceptors);\n        }\n    };\n    InternalDependencyContainer.prototype.executePostResolutionInterceptor = function (token, result, resolutionType) {\n        var e_2, _a;\n        if (this.interceptors.postResolution.has(token)) {\n            var remainingInterceptors = [];\n            try {\n                for (var _b = __values(this.interceptors.postResolution.getAll(token)), _c = _b.next(); !_c.done; _c = _b.next()) {\n                    var interceptor = _c.value;\n                    if (interceptor.options.frequency != \"Once\") {\n                        remainingInterceptors.push(interceptor);\n                    }\n                    interceptor.callback(token, result, resolutionType);\n                }\n            }\n            catch (e_2_1) { e_2 = { error: e_2_1 }; }\n            finally {\n                try {\n                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                }\n                finally { if (e_2) throw e_2.error; }\n            }\n            this.interceptors.postResolution.setAll(token, remainingInterceptors);\n        }\n    };\n    InternalDependencyContainer.prototype.resolveRegistration = function (registration, context) {\n        this.ensureNotDisposed();\n        if (registration.options.lifecycle === Lifecycle.ResolutionScoped &&\n            context.scopedResolutions.has(registration)) {\n            return context.scopedResolutions.get(registration);\n        }\n        var isSingleton = registration.options.lifecycle === Lifecycle.Singleton;\n        var isContainerScoped = registration.options.lifecycle === Lifecycle.ContainerScoped;\n        var returnInstance = isSingleton || isContainerScoped;\n        var resolved;\n        if (isValueProvider(registration.provider)) {\n            resolved = registration.provider.useValue;\n        }\n        else if (isTokenProvider(registration.provider)) {\n            resolved = returnInstance\n                ? registration.instance ||\n                    (registration.instance = this.resolve(registration.provider.useToken, context))\n                : this.resolve(registration.provider.useToken, context);\n        }\n        else if (isClassProvider(registration.provider)) {\n            resolved = returnInstance\n                ? registration.instance ||\n                    (registration.instance = this.construct(registration.provider.useClass, context))\n                : this.construct(registration.provider.useClass, context);\n        }\n        else if (isFactoryProvider(registration.provider)) {\n            resolved = registration.provider.useFactory(this);\n        }\n        else {\n            resolved = this.construct(registration.provider, context);\n        }\n        if (registration.options.lifecycle === Lifecycle.ResolutionScoped) {\n            context.scopedResolutions.set(registration, resolved);\n        }\n        return resolved;\n    };\n    InternalDependencyContainer.prototype.resolveAll = function (token, context) {\n        var _this = this;\n        if (context === void 0) { context = new ResolutionContext(); }\n        this.ensureNotDisposed();\n        var registrations = this.getAllRegistrations(token);\n        if (!registrations && isNormalToken(token)) {\n            throw new Error(\"Attempted to resolve unregistered dependency token: \\\"\" + token.toString() + \"\\\"\");\n        }\n        this.executePreResolutionInterceptor(token, \"All\");\n        if (registrations) {\n            var result_1 = registrations.map(function (item) {\n                return _this.resolveRegistration(item, context);\n            });\n            this.executePostResolutionInterceptor(token, result_1, \"All\");\n            return result_1;\n        }\n        var result = [this.construct(token, context)];\n        this.executePostResolutionInterceptor(token, result, \"All\");\n        return result;\n    };\n    InternalDependencyContainer.prototype.isRegistered = function (token, recursive) {\n        if (recursive === void 0) { recursive = false; }\n        this.ensureNotDisposed();\n        return (this._registry.has(token) ||\n            (recursive &&\n                (this.parent || false) &&\n                this.parent.isRegistered(token, true)));\n    };\n    InternalDependencyContainer.prototype.reset = function () {\n        this.ensureNotDisposed();\n        this._registry.clear();\n        this.interceptors.preResolution.clear();\n        this.interceptors.postResolution.clear();\n    };\n    InternalDependencyContainer.prototype.clearInstances = function () {\n        var e_3, _a;\n        this.ensureNotDisposed();\n        try {\n            for (var _b = __values(this._registry.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var _d = __read(_c.value, 2), token = _d[0], registrations = _d[1];\n                this._registry.setAll(token, registrations\n                    .filter(function (registration) { return !isValueProvider(registration.provider); })\n                    .map(function (registration) {\n                    registration.instance = undefined;\n                    return registration;\n                }));\n            }\n        }\n        catch (e_3_1) { e_3 = { error: e_3_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_3) throw e_3.error; }\n        }\n    };\n    InternalDependencyContainer.prototype.createChildContainer = function () {\n        var e_4, _a;\n        this.ensureNotDisposed();\n        var childContainer = new InternalDependencyContainer(this);\n        try {\n            for (var _b = __values(this._registry.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var _d = __read(_c.value, 2), token = _d[0], registrations = _d[1];\n                if (registrations.some(function (_a) {\n                    var options = _a.options;\n                    return options.lifecycle === Lifecycle.ContainerScoped;\n                })) {\n                    childContainer._registry.setAll(token, registrations.map(function (registration) {\n                        if (registration.options.lifecycle === Lifecycle.ContainerScoped) {\n                            return {\n                                provider: registration.provider,\n                                options: registration.options\n                            };\n                        }\n                        return registration;\n                    }));\n                }\n            }\n        }\n        catch (e_4_1) { e_4 = { error: e_4_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_4) throw e_4.error; }\n        }\n        return childContainer;\n    };\n    InternalDependencyContainer.prototype.beforeResolution = function (token, callback, options) {\n        if (options === void 0) { options = { frequency: \"Always\" }; }\n        this.interceptors.preResolution.set(token, {\n            callback: callback,\n            options: options\n        });\n    };\n    InternalDependencyContainer.prototype.afterResolution = function (token, callback, options) {\n        if (options === void 0) { options = { frequency: \"Always\" }; }\n        this.interceptors.postResolution.set(token, {\n            callback: callback,\n            options: options\n        });\n    };\n    InternalDependencyContainer.prototype.dispose = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var promises;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.disposed = true;\n                        promises = [];\n                        this.disposables.forEach(function (disposable) {\n                            var maybePromise = disposable.dispose();\n                            if (maybePromise) {\n                                promises.push(maybePromise);\n                            }\n                        });\n                        return [4, Promise.all(promises)];\n                    case 1:\n                        _a.sent();\n                        return [2];\n                }\n            });\n        });\n    };\n    InternalDependencyContainer.prototype.getRegistration = function (token) {\n        if (this.isRegistered(token)) {\n            return this._registry.get(token);\n        }\n        if (this.parent) {\n            return this.parent.getRegistration(token);\n        }\n        return null;\n    };\n    InternalDependencyContainer.prototype.getAllRegistrations = function (token) {\n        if (this.isRegistered(token)) {\n            return this._registry.getAll(token);\n        }\n        if (this.parent) {\n            return this.parent.getAllRegistrations(token);\n        }\n        return null;\n    };\n    InternalDependencyContainer.prototype.construct = function (ctor, context) {\n        var _this = this;\n        if (ctor instanceof DelayedConstructor) {\n            return ctor.createProxy(function (target) {\n                return _this.resolve(target, context);\n            });\n        }\n        var instance = (function () {\n            var paramInfo = typeInfo.get(ctor);\n            if (!paramInfo || paramInfo.length === 0) {\n                if (ctor.length === 0) {\n                    return new ctor();\n                }\n                else {\n                    throw new Error(\"TypeInfo not known for \\\"\" + ctor.name + \"\\\"\");\n                }\n            }\n            var params = paramInfo.map(_this.resolveParams(context, ctor));\n            return new (ctor.bind.apply(ctor, __spread([void 0], params)))();\n        })();\n        if (isDisposable(instance)) {\n            this.disposables.add(instance);\n        }\n        return instance;\n    };\n    InternalDependencyContainer.prototype.resolveParams = function (context, ctor) {\n        var _this = this;\n        return function (param, idx) {\n            var _a, _b, _c;\n            try {\n                if (isTokenDescriptor(param)) {\n                    if (isTransformDescriptor(param)) {\n                        return param.multiple\n                            ? (_a = _this.resolve(param.transform)).transform.apply(_a, __spread([_this.resolveAll(param.token)], param.transformArgs)) : (_b = _this.resolve(param.transform)).transform.apply(_b, __spread([_this.resolve(param.token, context)], param.transformArgs));\n                    }\n                    else {\n                        return param.multiple\n                            ? _this.resolveAll(param.token)\n                            : _this.resolve(param.token, context);\n                    }\n                }\n                else if (isTransformDescriptor(param)) {\n                    return (_c = _this.resolve(param.transform, context)).transform.apply(_c, __spread([_this.resolve(param.token, context)], param.transformArgs));\n                }\n                return _this.resolve(param, context);\n            }\n            catch (e) {\n                throw new Error(formatErrorCtor(ctor, idx, e));\n            }\n        };\n    };\n    InternalDependencyContainer.prototype.ensureNotDisposed = function () {\n        if (this.disposed) {\n            throw new Error(\"This container has been disposed, you cannot interact with a disposed container\");\n        }\n    };\n    return InternalDependencyContainer;\n}());\nexport var instance = new InternalDependencyContainer();\nexport default instance;\n", "import { defineInjectionTokenMetadata } from \"../reflection-helpers\";\nfunction inject(token) {\n    return defineInjectionTokenMetadata(token);\n}\nexport default inject;\n", "import { getParamInfo } from \"../reflection-helpers\";\nimport { typeInfo } from \"../dependency-container\";\nfunction injectable() {\n    return function (target) {\n        typeInfo.set(target, getParamInfo(target));\n    };\n}\nexport default injectable;\n", "import { __rest } from \"tslib\";\nimport { instance as globalContainer } from \"../dependency-container\";\nfunction registry(registrations) {\n    if (registrations === void 0) { registrations = []; }\n    return function (target) {\n        registrations.forEach(function (_a) {\n            var token = _a.token, options = _a.options, provider = __rest(_a, [\"token\", \"options\"]);\n            return globalContainer.register(token, provider, options);\n        });\n        return target;\n    };\n}\nexport default registry;\n", "import injectable from \"./injectable\";\nimport { instance as globalContainer } from \"../dependency-container\";\nfunction singleton() {\n    return function (target) {\n        injectable()(target);\n        globalContainer.registerSingleton(target);\n    };\n}\nexport default singleton;\n", "export default function instanceCachingFactory(factoryFunc) {\n    var instance;\n    return function (dependencyContainer) {\n        if (instance == undefined) {\n            instance = factoryFunc(dependencyContainer);\n        }\n        return instance;\n    };\n}\n", "if (typeof Reflect === \"undefined\" || !Reflect.getMetadata) {\n    throw new Error(\"tsyringe requires a reflect polyfill. Please add 'import \\\"reflect-metadata\\\"' to the top of your entry point.\");\n}\nexport { Lifecycle } from \"./types\";\nexport * from \"./decorators\";\nexport * from \"./factories\";\nexport * from \"./providers\";\nexport { delay } from \"./lazy-helpers\";\nexport { instance as container } from \"./dependency-container\";\n", "import './commonPolyfill';\nimport {instanceCachingFactory, singleton, injectable, inject, registry, container, DependencyContainer} from 'tsyringe';\n\n// init performance metric\nwindow.pnInitPerformance = performance.now();\n\nif (!window.pnHasPolyfilled) {\n  window.pnHasPolyfilled = false;\n}\nif (!window.pnFullTPVersion) {\n  window.pnFullTPVersion = false;\n}\n\n/*\n * it should be on first place in each bundle\n */\nimport { LoggingInterface } from \"./logging\";\nimport { APIInterface } from './api';\nimport { VersionServiceInterface } from './versionService';\nimport { ITPInterface } from './itp';\nimport { AMPInterface } from './amp';\nimport { UserInterface } from './user';\nimport { JanrainInterface } from \"./janrain\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { PostmessageInterface } from \"./postmessage\";\nimport { TinypassAccountsInterface } from \"./tinypassAccounts\";\nimport { TinypassLoginInterface } from \"./tinypassLogin\";\nimport { ContainerUtilsInterface } from \"./containerUtils\";\nimport { SHA1Interface } from \"./sha1\";\nimport { CondeUserProviderInterface } from \"./condeUserProvider\";\nimport { GigyaInterface } from \"./gigya\";\nimport { PianoIdInterface } from \"./pianoId\";\nimport { OfferInterface } from \"./offer\";\nimport { UtilInterface } from \"./util\";\nimport { ViewportExitInterface } from \"./viewportExit\";\nimport { LogInterface } from \"./log\";\nimport { ObserverInterface } from \"./observer\";\nimport { GaServiceInterface } from \"./googleAnalytics/gaService\";\nimport { PianoIdLiteInterface } from \"./pianoIdLite\";\nimport { IJwtDecode } from \"./jwtDecode\";\nimport { PianoEspInterface } from \"./pianoEsp\";\nimport { RecWidgetServiceInterface } from \"./recWidgetService\";\nimport { TemplateInterface } from \"./template\";\nimport { TinypassErrorHandlerInterface } from \"./tinypassErrorHandler\";\nimport { SwgInterface } from \"./swg\";\nimport { StripeApplePayIntegrationServiceInterface } from \"./stripeApplePayIntegrationService\";\nimport { ScrollDepthInterface } from \"./scrollDepth\";\nimport { PerformanceMetricsInterface } from \"./performanceMetrics\";\nimport { Obi3DSChallengeInterface } from \"./obi3DSChallenge\";\nimport { NewscycleInterface } from \"./newscycle\";\nimport { MeterInterface } from \"./meter\";\nimport { InteractionInterface } from \"./interaction\";\nimport { IdleInterface } from \"./idle\";\nimport { FingerprintInterface } from \"./fingerprint\";\nimport { FbsubscriptionsInterface } from \"./fbsubscriptions\";\nimport { FbpixelInterface } from \"./fbpixel\";\nimport { DoubleOptInInterface } from \"./doubleOptIn\";\nimport { DoubleClickForPublisherInterface } from \"./doubleClickForPublisher\";\nimport { CxenseInterface } from \"./cxense\";\nimport { ApplePayInterface } from \"./applePay\";\nimport { ApplePayIntegrationServiceInterface } from \"./applePayIntegrationService\";\nimport { DatatransApplePayIntegrationServiceInterface } from \"./datatransApplePayIntegrationService\";\nimport { MyaccountInterface } from \"./myaccount\";\nimport { MainInterface } from \"./main\";\nimport { ExperienceInterface } from \"./experience\";\nimport { ActiveTimerInterface } from \"./activetimer\";\nimport { IfVisibleInterface } from \"./ifvisible\";\nimport { TinypassInterface } from \"./tinypass\";\nimport { PianoInterface } from \"./piano\";\nimport { CssInterface } from \"./css\";\nimport { CookieInterface } from \"./cookie\";\nimport { LocalStorageInterface } from \"./localStorage\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { AjaxInterface } from \"./ajax\";\nimport { CaptchaV3Interface } from \"./captchaV3\";\nimport { CreditInterface } from \"./credit\";\nimport { GoCardlessDropinInterface } from \"./goCardlessDropin\";\nimport { ComposeControlPolicy } from \"./composerControlPolicy\";\nimport { ConsentInterface } from \"./consent\";\nimport { AnalyticsInterface } from \"./analytics\";\nimport {Ga4ServiceInterface} from \"./googleAnalytics/ga4Service\";\nimport {GaCollectingServiceInterface} from \"./googleAnalytics/gaCollectingService\";\nimport {AcpInterface} from \"./acp\";\nimport {FrequencyEventInterface} from \"./frequency-capping/pcfe\";\nimport {BraintreeGooglePayInterface} from \"./braintreeGooglePayIntegrationService\";\n\ndeclare global {\n  const pn: PNInterface;\n  const tp: TinypassInterface;\n  // back compatibility\n  const ___tp: Function;\n\n  interface Window {\n    pn: PNInterface;\n    tp: TinypassInterface;\n    // back compatibility\n    ___tp: Function;\n\n    next?: any;\n    blockAdBlock: boolean;\n    opera: string;\n    chrome: string;\n    ApplePaySession: any;\n    GoCardlessDropin: any;\n    _tpm: any;\n    // @ts-ignore\n    visualViewport: any;\n    ga: any;\n    gtag: any;\n    googletag: any;\n    WebKitMutationObserver: any;\n    MozMutationObserver: any;\n    ActiveXObject: any;\n    attachEvent: any;\n    createPopup: any;\n    XDomainRequest: any;\n    msPerformance: any;\n    pnInitPerformance: number;\n    pnHasPolyfilled: boolean;\n    pnFullTPVersion: boolean;\n\n    fbq: any;\n    _fbq: any;\n    FB:any;\n    MSStream: any;\n\n    doNotTrack: any;\n\n    braintree: any;\n    google: any;\n    janrain: any;\n    gigya: any;\n    PianoESPConfig: any;\n    PianoESP: any;\n    SWG: any;\n    Stripe: any;\n    obick: any;\n    cX: any;\n    cXNative: any;\n\n    opr?: unknown; // Opera defines this property\n\n    dataLayer?: any[];\n  }\n  interface Document {\n    documentMode: any;\n  }\n  interface String {\n    toHex(): string;\n  }\n  interface Screen {\n    left: number;\n    top: number;\n    globalStorage: any;\n  }\n  interface Navigator {\n    userLanguage: any;\n    cpuClass: any;\n    browserLanguage: any;\n  }\n}\n\nexport interface PNInterface extends PianoInterface, TinypassInterface {\n  predefinedOptions: PredefinedOptionsInterface;\n\n  css: CssInterface;\n  doubleClickForPublisher: DoubleClickForPublisherInterface;\n  sha1: SHA1Interface;\n  ajax: AjaxInterface;\n  jqUtils: JqUtilsInterface;\n  consent: ConsentInterface;\n  cookie: CookieInterface;\n  localStorage: LocalStorageInterface;\n  util: UtilInterface;\n  frequencyEvent: FrequencyEventInterface;\n  activetimer: ActiveTimerInterface;\n  ifvisible: IfVisibleInterface;\n  cxense: CxenseInterface;\n  fingerprint: FingerprintInterface;\n  interaction: InteractionInterface;\n  fbpixel: FbpixelInterface;\n  analytics: AnalyticsInterface;\n  idle: IdleInterface;\n  viewportExit: ViewportExitInterface;\n  log: LogInterface;\n  logging: LoggingInterface;\n  observer: ObserverInterface;\n  gaCollectingService: GaCollectingServiceInterface;\n  gaService: GaServiceInterface;\n  ga4Service: Ga4ServiceInterface;\n  jwtDecode: IJwtDecode;\n  tinypassErrorHandler: TinypassErrorHandlerInterface;\n  api: APIInterface;\n  eventUtils: EventUtilsInterface;\n  postmessage: PostmessageInterface;\n  applePay: ApplePayInterface;\n  braintreeGooglePayIntegrationService: BraintreeGooglePayInterface;\n  goCardlessDropin: GoCardlessDropinInterface;\n  applePayIntegrationService: ApplePayIntegrationServiceInterface;\n  datatransApplePayIntegrationService: DatatransApplePayIntegrationServiceInterface;\n  performanceMetrics: PerformanceMetricsInterface;\n  obi3DSChallenge: Obi3DSChallengeInterface;\n  scrollDepth: ScrollDepthInterface;\n  stripeApplePayIntegrationService: StripeApplePayIntegrationServiceInterface;\n  template: TemplateInterface;\n  recWidgetService: RecWidgetServiceInterface;\n  pianoEsp: PianoEspInterface;\n  newscycle: NewscycleInterface;\n  meter: MeterInterface;\n  tinypassAccounts: TinypassAccountsInterface;\n  tinypassLogin: TinypassLoginInterface;\n  containerUtils: ContainerUtilsInterface;\n  user: UserInterface;\n  doubleOptIn: DoubleOptInInterface;\n  swg: SwgInterface;\n  offer: OfferInterface;\n  myaccount: MyaccountInterface;\n  fbsubscriptions: FbsubscriptionsInterface;\n  janrain: JanrainInterface;\n  condeUserProvider: CondeUserProviderInterface;\n  gigya: GigyaInterface;\n  pianoId: PianoIdInterface;\n  pianoIdLite: PianoIdLiteInterface;\n  itp: ITPInterface;\n  versionService: VersionServiceInterface;\n  amp: AMPInterface;\n  composerControlPolicy: ComposeControlPolicy;\n  experience: ExperienceInterface;\n  credit: CreditInterface;\n  main: MainInterface;\n  captchaV3: CaptchaV3Interface;\n  acp: AcpInterface;\n\n  singleton: Function;\n  injectable: Function;\n  inject: Function;\n  registry: Function;\n  container: DependencyContainer;\n  instanceCachingFactory: Function;\n  affiliateTokenName: string,\n}\n\nexport interface PredefinedOptionsInterface {\n  somePredefinedOption?: string;\n  somePredefinedCallback?(): void;\n}\n\n// protect against double loading SDK on same page\nif (typeof window.pn !== 'undefined' && typeof window.pn.container !== 'undefined') {\n  throw new Error('Piano SDK is loaded twice on same page. Try to fix that to prevent the message.');\n} else {\n  // const canBrowserProxy = typeof Proxy !== 'undefined';\n  if (!window.pnFullTPVersion && typeof Proxy !== 'undefined') {\n    const commonMockedFunction = function () {\n      return commonProxy;\n    };\n    const commonProxy = new Proxy({}, {\n      get: function(target: {}, p: PropertyKey, receiver: any): any {\n        // isv === isStubVersion\n        if (p === 'isv') {\n          return true;\n        }\n        return commonMockedFunction;\n      },\n      apply: function(target: {}, thisArg: any, argArray?: any): any {\n        return commonProxy;\n      },\n    })\n    container.resolve = new Proxy(container.resolve, {\n      apply: function(target: any, thisArg: any, argArray?: any): any {\n        if (container.isRegistered(argArray[0])) {\n          return Reflect.apply(target, thisArg, argArray);\n        } else {\n          container.register(argArray[0], {\n            useValue: commonProxy\n          });\n          const module = container.resolve(argArray[0]);\n          // @ts-ignore\n          pn[argArray[0]] = module;\n          return module;\n        }\n\n      }\n    });\n  }\n\n  // TODO here we get predefine object, which we get from publisher's integration\n  const predefinedOptions: PredefinedOptionsInterface = (window.pn || {}) as PredefinedOptionsInterface;\n\n  const pn = window.pn = {} as PNInterface;\n\n  pn.container = container;\n  pn.singleton = singleton;\n  pn.injectable = injectable;\n  pn.inject = inject;\n  pn.registry = registry;\n  pn.instanceCachingFactory = instanceCachingFactory;\n\n  pn.predefinedOptions = predefinedOptions;\n\n  container.register('predefinedOptions', {\n    useValue: predefinedOptions\n  });\n}\n", "var needToLoadFullVersion = false;\ntry {\n  // (()=>{})();\n  // class T {}\n  // new T();\n  if (!window.pnHasPolyfilled) {\n    if (typeof Proxy === 'undefined') {\n      throw new Error('The browser cannot Proxy')\n    }\n    new Promise((res) => {\n    });\n    Object.assign({}, {});\n    [''].includes('');\n    if (!Element.prototype.closest) {\n      throw new Error('There is no closest method of a DOM element');\n    }\n  }\n} catch (e) {\n  needToLoadFullVersion = true;\n}\n// var theBrowserCanProxy = true;\n// try {\n//   if (typeof Proxy === 'undefined') {\n//     throw new Error('The browser cannot Proxy')\n//   }\n// } catch (e) {\n//   if (!pn.fullTPVersion) {\n//     // theBrowserCanProxy = false;\n//     error = true;\n//   }\n// }\n\nfunction getSDKDomainName(): string {\n  const scripts: NodeListOf<Element> = document.querySelectorAll('script');\n\n  if (scripts.length) {\n    for (let script of scripts as any) {\n      const sdkDomainName = script?.src?.match(/^.*?(tinypass.com|piano.io)/i);\n\n      if (sdkDomainName) {\n        return sdkDomainName[0];\n      }\n    }\n  }\n\n  return 'https://sandbox.tinypass.com';\n}\n\nif (needToLoadFullVersion) {\n  const domainName = getSDKDomainName();\n  // @ts-ignore\n  delete window.pn;\n  // we should load fullVersion of tinypass.pn.es5.js\n  const a = document.createElement('script');\n  a.type = 'text/javascript';\n  a.async = true;\n  // a.src = `http://test-piano.com:4567/test.es5.js`;\n  a.src = `${domainName}/api/piano.es5.js`;\n  // a.src = `https://cnbc-dev.tinypass.com:8443/api/piano.es5.js`;\n  document.getElementsByTagName('head')[0].appendChild(a);\n  throw new Error('Load full version of piano SDK');\n}\n", "import offerCss from '../styles/offer.css';\n\nexport interface CssInterface {\n  name: string;\n\n  loadOfferCss(): void;\n}\n\nconst css = ((): CssInterface => {\n  const name = 'css';\n\n  const loadOfferCss = (): void => {\n    requireCssFile(offerCss);\n  }\n\n  const requireCssFile = (cssText: string): Promise<any> => {\n    return new Promise((resolve, reject) => {\n      const style = document.createElement('style');\n      style.type = 'text/css';\n      style.innerHTML = cssText;\n      style.onload = resolve;\n      style.onerror = reject;\n      document.getElementsByTagName('head')[0].appendChild(style);\n    });\n  }\n\n  return {\n    name,\n    loadOfferCss\n  }\n})()\n\npn.container.register('css', {\n  useValue: css\n});\npn.css = pn.container.resolve<CssInterface>('css');\n", "'use strict';\n// https://github.com/ForbesLindesay/ajax\n\nvar type = (obj) => {\n  return ({}).toString.call(obj).match(/\\s([a-zA-Z]+)/)[1].toLowerCase();\n};\n// try {\n//   type = require('type-of')\n// } catch (ex) {\n//   hide from browserify\n  // var r = require\n  // type = r('type')\n// }\n\nvar jsonpID = Math.round(10000 * Math.random()),\n  document = window.document,\n  key,\n  name,\n  rscript = /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi,\n  scriptTypeRE = /^(?:text|application)\\/javascript/i,\n  xmlTypeRE = /^(?:text|application)\\/xml/i,\n  jsonType = 'application/json',\n  htmlType = 'text/html',\n  blankRE = /^\\s*$/;\n\n// var ajax = module.exports = function(options){\nvar ajax = function(options){\n  var settings = extend({}, options || {})\n  for (key in ajax.settings) if (settings[key] === undefined) settings[key] = ajax.settings[key]\n\n  ajaxStart(settings)\n\n  if (!settings.crossDomain) settings.crossDomain = /^([\\w-]+:)?\\/\\/([^\\/]+)/.test(settings.url) &&\n    RegExp.$2 != window.location.host\n\n  var dataType = settings.dataType, hasPlaceholder = /=\\?/.test(settings.url)\n  if (dataType == 'jsonp' || hasPlaceholder) {\n    if (!hasPlaceholder) settings.url = appendQuery(settings.url, 'callback=?')\n    return ajax.JSONP(settings)\n  }\n\n  if (!settings.url) settings.url = window.location.toString()\n  serializeData(settings)\n\n  var mime = settings.accepts[dataType],\n    baseHeaders = { },\n    protocol = /^([\\w-]+:)\\/\\//.test(settings.url) ? RegExp.$1 : window.location.protocol,\n    xhr = ajax.settings.xhr(), abortTimeout\n\n  if (!settings.crossDomain) baseHeaders['X-Requested-With'] = 'XMLHttpRequest'\n  if (mime) {\n    baseHeaders['Accept'] = mime\n    if (mime.indexOf(',') > -1) mime = mime.split(',', 2)[0]\n    xhr.overrideMimeType && xhr.overrideMimeType(mime)\n  }\n  if (settings.contentType || (settings.data && settings.type.toUpperCase() != 'GET'))\n    baseHeaders['Content-Type'] = (settings.contentType || 'application/x-www-form-urlencoded')\n  settings.headers = extend(baseHeaders, settings.headers || {})\n\n  var withCredentials = settings.xhrFields && settings.xhrFields.withCredentials\n  if (withCredentials) {\n      xhr.withCredentials = withCredentials;\n  }\n\n  xhr.onreadystatechange = function(){\n    if (xhr.readyState == 4) {\n      clearTimeout(abortTimeout)\n      var result, error = false\n      if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304 || (xhr.status == 0 && protocol == 'file:')) {\n        dataType = dataType || mimeToDataType(xhr.getResponseHeader('content-type'))\n        result = xhr.responseText\n\n        try {\n          if (dataType == 'script')    (1,eval)(result)\n          else if (dataType == 'xml')  result = xhr.responseXML\n          else if (dataType == 'json') result = blankRE.test(result) ? null : JSON.parse(result)\n        } catch (e) { error = e }\n\n        if (error) ajaxError(error, 'parsererror', xhr, settings)\n        else ajaxSuccess(result, xhr, settings)\n      } else {\n        ajaxError(null, 'error', xhr, settings)\n      }\n    }\n  }\n\n  var async = 'async' in settings ? settings.async : true\n  xhr.open(settings.type, settings.url, async)\n\n  for (name in settings.headers) xhr.setRequestHeader(name, settings.headers[name])\n\n  if (ajaxBeforeSend(xhr, settings) === false) {\n    xhr.abort()\n    return false\n  }\n\n  if (settings.timeout > 0) abortTimeout = setTimeout(function(){\n    xhr.onreadystatechange = empty\n    xhr.abort()\n    ajaxError(null, 'timeout', xhr, settings)\n  }, settings.timeout)\n\n  // avoid sending empty string (#319)\n  xhr.send(settings.data ? settings.data : null)\n  return xhr\n}\n\n\n// trigger a custom event and return false if it was cancelled\nfunction triggerAndReturn(context, eventName, data) {\n  //todo: Fire off some events\n  //var event = $.Event(eventName)\n  //$(context).trigger(event, data)\n  return true;//!event.defaultPrevented\n}\n\n// trigger an Ajax \"global\" event\nfunction triggerGlobal(settings, context, eventName, data) {\n  if (settings.global) return triggerAndReturn(context || document, eventName, data)\n}\n\n// Number of active Ajax requests\najax.active = 0\n\nfunction ajaxStart(settings) {\n  if (settings.global && ajax.active++ === 0) triggerGlobal(settings, null, 'ajaxStart')\n}\nfunction ajaxStop(settings) {\n  if (settings.global && !(--ajax.active)) triggerGlobal(settings, null, 'ajaxStop')\n}\n\n// triggers an extra global event \"ajaxBeforeSend\" that's like \"ajaxSend\" but cancelable\nfunction ajaxBeforeSend(xhr, settings) {\n  var context = settings.context\n  if (settings.beforeSend.call(context, xhr, settings) === false ||\n    triggerGlobal(settings, context, 'ajaxBeforeSend', [xhr, settings]) === false)\n    return false\n\n  triggerGlobal(settings, context, 'ajaxSend', [xhr, settings])\n}\nfunction ajaxSuccess(data, xhr, settings) {\n  var context = settings.context, status = 'success'\n  settings.success.call(context, data, status, xhr)\n  triggerGlobal(settings, context, 'ajaxSuccess', [xhr, settings, data])\n  ajaxComplete(status, xhr, settings)\n}\n// type: \"timeout\", \"error\", \"abort\", \"parsererror\"\nfunction ajaxError(error, type, xhr, settings) {\n  var context = settings.context\n  settings.error.call(context, xhr, type, error)\n  triggerGlobal(settings, context, 'ajaxError', [xhr, settings, error])\n  ajaxComplete(type, xhr, settings)\n}\n// status: \"success\", \"notmodified\", \"error\", \"timeout\", \"abort\", \"parsererror\"\nfunction ajaxComplete(status, xhr, settings) {\n  var context = settings.context\n  settings.complete.call(context, xhr, status)\n  triggerGlobal(settings, context, 'ajaxComplete', [xhr, settings])\n  ajaxStop(settings)\n}\n\n// Empty function, used as default callback\nfunction empty() {}\n\najax.JSONP = function(options){\n  if (!('type' in options)) return ajax(options)\n\n  var callbackName = 'jsonp' + (options.cache ? 'Callback' : ++jsonpID),\n    script = document.createElement('script'),\n    abort = function(){\n      //todo: remove script\n      //$(script).remove()\n      if (callbackName in window) window[callbackName] = empty\n      ajaxComplete('abort', xhr, options)\n    },\n    xhr = { abort: abort }, abortTimeout,\n    head = document.getElementsByTagName(\"head\")[0]\n      || document.documentElement\n\n  if (options.error) script.onerror = function() {\n    xhr.abort()\n    options.error()\n  }\n\n  window[callbackName] = function(data){\n    clearTimeout(abortTimeout)\n    //todo: remove script\n    //$(script).remove()\n    delete window[callbackName]\n    ajaxSuccess(data, xhr, options)\n  }\n\n  serializeData(options)\n  script.src = options.url.replace(/=\\?/, '=' + callbackName)\n\n  // Use insertBefore instead of appendChild to circumvent an IE6 bug.\n  // This arises when a base node is used (see jQuery bugs #2709 and #4378).\n  head.insertBefore(script, head.firstChild);\n\n  if (options.timeout > 0) abortTimeout = setTimeout(function(){\n    xhr.abort()\n    ajaxComplete('timeout', xhr, options)\n  }, options.timeout)\n\n  return xhr\n}\n\najax.settings = {\n  // Default type of request\n  type: 'GET',\n  // Callback that is executed before request\n  beforeSend: empty,\n  // Callback that is executed if the request succeeds\n  success: empty,\n  // Callback that is executed the the server drops error\n  error: empty,\n  // Callback that is executed on request complete (both: error and success)\n  complete: empty,\n  // The context for the callbacks\n  context: null,\n  // Whether to trigger \"global\" Ajax events\n  global: true,\n  // Transport\n  xhr: function () {\n    return new window.XMLHttpRequest()\n  },\n  // MIME types mapping\n  accepts: {\n    script: 'text/javascript, application/javascript',\n    json:   jsonType,\n    xml:    'application/xml, text/xml',\n    html:   htmlType,\n    text:   'text/plain'\n  },\n  // Whether the request is to another domain\n  crossDomain: false,\n  // Default timeout\n  timeout: 0\n}\n\nfunction mimeToDataType(mime) {\n  return mime && ( mime == htmlType ? 'html' :\n    mime == jsonType ? 'json' :\n      scriptTypeRE.test(mime) ? 'script' :\n        xmlTypeRE.test(mime) && 'xml' ) || 'text'\n}\n\nfunction appendQuery(url, query) {\n  return (url + '&' + query).replace(/[&?]{1,2}/, '?')\n}\n\n// serialize payload and append it to the URL for GET requests\nfunction serializeData(options) {\n  if (type(options.data) === 'object') options.data = param(options.data)\n  if (options.data && (!options.type || options.type.toUpperCase() == 'GET'))\n    options.url = appendQuery(options.url, options.data)\n}\n\najax.get = function(url, success){ return ajax({ url: url, success: success }) }\n\najax.post = function(url, data, success, dataType){\n  if (type(data) === 'function') dataType = dataType || success, success = data, data = null\n  return ajax({ type: 'POST', url: url, data: data, success: success, dataType: dataType })\n}\n\najax.getJSON = function(url, success){\n  return ajax({ url: url, success: success, dataType: 'json' })\n}\n\nvar escape = encodeURIComponent\n\nfunction serialize(params, obj, traditional, scope){\n  var array = type(obj) === 'array';\n  for (var key in obj) {\n    var value = obj[key];\n\n    if (scope) key = traditional ? scope : scope + '[' + (array ? '' : key) + ']'\n    // handle data in serializeArray() format\n    if (!scope && array) params.add(value.name, value.value)\n    // recurse into nested objects\n    else if (traditional ? (type(value) === 'array') : (type(value) === 'object'))\n      serialize(params, value, traditional, key)\n    else params.add(key, value)\n  }\n}\n\nfunction param(obj, traditional){\n  var params = []\n  params.add = function(k, v){\n    if (v === undefined) {\n      return;\n    }\n    v = v == null ? \"\" : v;\n    this.push(escape(k) + '=' + escape(v)) \n  }\n  serialize(params, obj, traditional)\n  return params.join('&').replace('%20', '+')\n}\n\nfunction extend(target) {\n  var slice = Array.prototype.slice;\n  slice.call(arguments, 1).forEach(function(source) {\n    for (key in source)\n      if (source[key] !== undefined)\n        target[key] = source[key]\n  })\n  return target\n};\n\nvar ajaxJq = ajax;\n\nexport { ajaxJq };\n", "import {ajaxJq} from './ajax-jq.js';\n\nexport interface AjaxInterface {\n  send(url: string, callback: ((resp: any) => void) | null, method: 'POST' | 'GET', data: any, contentType: string, async: boolean): void;\n  request(options: any): any;\n}\n\nconst ajax = ((): AjaxInterface => {\n\n  const send = (url: string, callback: ((resp: any) => void) | null, method: 'POST' | 'GET', data: any, contentType: string, async = true) => {\n    if (async === undefined) {\n      async = true;\n    }\n    const x = new XMLHttpRequest();\n    x.open(method, url, async);\n    x.onreadystatechange = function () {\n      if (x.readyState === 4 && callback) {\n        callback(x.responseText)\n      }\n    };\n    x.setRequestHeader('Content-type', contentType);\n    x.send(data)\n  };\n\n  const request = (options: any): any => {\n    options.dataType = options.dataType || 'json';\n    return ajaxJq(options);\n  }\n\n  return {\n    send,\n    request,\n  }\n})()\n\npn.container.register('ajax', {\n  useValue: ajax\n});\n\npn.ajax = pn.container.resolve<AjaxInterface>('ajax');\n", "// functions from http://youmightnotneedjquery.com/\n\nexport interface JqUtilsInterface {\n  scrollTop(): number;\n  winSize(): {\n    height: number,\n    width: number,\n  };\n  isPlainObject(obj: any): boolean;\n  isEmptyObject(obj: any): boolean;\n  isFunction(func: Function): boolean;\n  inArray(item: any, array: any[]): number;\n  type(obj: any): any;\n  remove(el: HTMLElement): void;\n  empty(el: HTMLElement): void;\n  queryEl(query: string, container?: HTMLElement): HTMLElement | null;\n  qa(query: string): HTMLElement[];\n  filter(query: string, filterFn: Function): NodeListOf<HTMLElement>;\n  addClass(className: string, el: HTMLElement): void;\n  toggleClass(className: string, el: HTMLElement): void;\n  removeClass(className: string, el: HTMLElement): void;\n  getWidth(el: HTMLElement): number;\n  show(el: HTMLElement): void;\n  hide(el: HTMLElement): void;\n  getHeight(el: HTMLElement): number;\n  visible(el: HTMLElement): boolean;\n  append(parent: HTMLElement, el: HTMLElement): void;\n  setAttr(attr: string, val: string, el: Element): void;\n  setAttrs(attrs: Record<string, string>, el: Element): void;\n  getAttr(el: HTMLElement | string | null, attr: string): string | null;\n  ready(fn: Function): void;\n  delegate(parentEl: HTMLElement | Document | Window, elementSelector: string, eventName: string, handler: Function): void;\n  undelegate(parentEl: HTMLElement | Document | Window, elementSelector: string): void;\n  on(element: HTMLElement | Document | Window, eventName: string, callback: Function): void;\n  off(element: any, eventName: string, callback: Function): void;\n  deepExtend(...args: any[]): any;\n  param(obj: any, excludedParams?: { [key: string]: boolean }): string;\n  // jsonpReq(uri: string): Promise<any>;\n}\n\nexport const jqUtils = ((): JqUtilsInterface => {\n\n  const scrollTop = (): number => {\n    return window.pageYOffset || document.documentElement.scrollTop;\n  }\n\n  const winSize = (): {\n    height: number,\n    width: number,\n  } => {\n    const w = window,\n      d = document,\n      e = d.documentElement,\n      g = d.getElementsByTagName('body')[0],\n      x = w.innerWidth || e.clientWidth || g.clientWidth,\n      y=w.innerHeight||e.clientHeight||g.clientHeight;\n\n    return {\n      height: y,\n      width: x,\n    };\n  }\n\n  const isPlainObject = (obj: any): boolean => {\n    return Object.prototype.toString.call(obj) === '[object Object]';\n  }\n\n  const isEmptyObject = (obj: any): boolean => {\n    return Object.keys(obj).length === 0 && obj.constructor === Object;\n  }\n\n  const isFunction = (func: Function): boolean => {\n    return typeof func === 'function';\n  }\n\n  const inArray = (item: any, array: any[]): number => {\n    return array.indexOf(item);\n  }\n\n  const type = (obj: any): any => {\n    return Object.prototype.toString.call(obj).replace(/^\\[object (.+)\\]$/, '$1').toLowerCase();\n  }\n\n  const remove = (el: HTMLElement): void => {\n    el.parentNode?.removeChild(el);\n  }\n\n  const empty = (el: HTMLElement): void => {\n    while(el.firstChild)\n      el.removeChild(el.firstChild);\n  }\n\n  const queryEl = (query: string, container?: HTMLElement): HTMLElement | null => {\n    if (!query) {\n      return null;\n    }\n    return qa(query, container)[0];\n  }\n\n  const qa = (query: string, container?: HTMLElement): HTMLElement[] => {\n    if (!query) {\n      return [];\n    }\n    const parentContainer = (container ? container : document);\n    const splitQuery = query.split(',');\n    let resElements: HTMLElement[] = [];\n    splitQuery.forEach((splQEl) => {\n      const trimmedSplQEl = splQEl.trim();\n      try {\n        resElements = resElements.concat(Array.prototype.slice.call(parentContainer.querySelectorAll(trimmedSplQEl)));\n      } catch(e) {\n        const isComplexSelector = trimmedSplQEl.indexOf(' ') > -1;\n        if (trimmedSplQEl[0] === '.' && !isComplexSelector) {\n          resElements = resElements.concat(Array.prototype.slice.call(parentContainer.getElementsByClassName(trimmedSplQEl.substring(1))));\n        } else if (trimmedSplQEl[0] === '#' && !isComplexSelector) {\n          const fEl = document.getElementById(trimmedSplQEl.substring(1));\n          resElements = resElements.concat((fEl ? [fEl] : []));\n        } else {\n          resElements = resElements.concat(Array.prototype.slice.call(parentContainer.querySelectorAll(trimmedSplQEl)));\n        }\n      }\n\n    })\n    return resElements;\n  }\n\n  const filter = (query: string, filterFn: Function): NodeListOf<HTMLElement> => {\n    // @ts-ignore\n    return Array.prototype.filter.call(document.querySelectorAll(query), filterFn);\n  }\n\n  const addClass = (className: string, el: Element): void => {\n    el.classList.add(className);\n  }\n\n  const toggleClass = (className: string, el: Element): void => {\n    el.classList.toggle(className);\n  }\n\n  const removeClass = (className: string, el: Element): void => {\n    el.classList.remove(className);\n  }\n\n  const getWidth = (el: HTMLElement): number => {\n    const { paddingLeft, paddingRight } = getComputedStyle(el, null);\n    let { width } = el.getBoundingClientRect();\n    width -= parseFloat(paddingLeft) + parseFloat(paddingRight);\n    return width;\n  }\n\n  const show = (el: HTMLElement): void => {\n    el.style.display = 'block';\n  }\n\n  const hide = (el: HTMLElement): void => {\n    el.style.display = 'none';\n  }\n\n  const getHeight = (el: HTMLElement): number => {\n    const { paddingTop, paddingBottom } = getComputedStyle(el, null);\n    let { height } = el.getBoundingClientRect();\n    height -= parseFloat(paddingTop) + parseFloat(paddingBottom);\n    return height;\n  }\n\n  const visible = (el: HTMLElement): boolean => {\n    return !!( el.offsetWidth || el.offsetHeight || el.getClientRects().length );\n  }\n\n  const append = (parent: HTMLElement, el: HTMLElement): void => {\n    parent.appendChild(el);\n  }\n\n  const setAttr = (attr: string, val: string, el: HTMLElement): void => {\n    el.setAttribute(attr, val);\n  }\n\n  const setAttrs = (attrs: Record<string, string>, el: HTMLElement): void => {\n    Object.keys(attrs).forEach((key: string) => {\n      setAttr(key, attrs[key], el);\n    })\n  }\n\n  const getAttr = (el: Element | null | string, attr: string): string | null => {\n    if (typeof el === 'string') {\n      el = queryEl(el);\n    }\n    return el ? el.getAttribute(attr) : null;\n  }\n\n  const ready = (fn: Function): void => {\n    if (document.readyState != 'loading'){\n      fn();\n    } else {\n      document.addEventListener('DOMContentLoaded', () => fn());\n    }\n  }\n\n  let delegateList: any[] = [];\n\n  const delegate = (parentEl: HTMLElement | Document | Window, elementSelector: string, eventName: string, handler: Function): void => {\n    const _handler = (e: any) => {\n      // loop parent nodes from the target to the delegation node\n      // @ts-ignore\n      for (var target = e.target; target && target != this; target = target.parentNode) {\n        const foundIndex = delegateList.findIndex((item: any) => {\n          return (item.parentEl === parentEl && item.elementSelector === elementSelector);\n        })\n        // @ts-ignore\n        if (target.matches && target.matches(elementSelector) && foundIndex >= 0) {\n          handler.call(target, e);\n          break;\n        }\n      }\n    };\n\n    delegateList.push({\n      parentEl, elementSelector, handler: _handler, eventName\n    });\n    parentEl.addEventListener(eventName, _handler, false);\n  }\n\n  const undelegate = (parentEl: HTMLElement | Document | Window, elementSelector: string): void => {\n    delegateList = delegateList.filter((item: any) => {\n      const notMatch = item.parentEl !== parentEl && item.elementSelector !== elementSelector\n      if (!notMatch) {\n        item.parentEl.removeEventListener(item.eventName, item.handler);\n      }\n\n      return notMatch;\n    })\n  }\n\n  const on = (element: HTMLElement | Document | Window, eventName: string, callback: Function): void => {\n    element.addEventListener(eventName, (e: any) => {\n      callback(e)\n    }, false);\n  }\n\n  const off = (element: HTMLElement, eventName: string, callback: Function): void => {\n    // @ts-ignore\n    element.removeEventListener(eventName, callback);\n  }\n\n  const deepExtend = (...args: any[]): any => {\n    const extended: any = {};\n    let i = 0;\n\n    const merge = (obj: any) => {\n      for (const prop in obj) {\n        if (obj.hasOwnProperty(prop)) {\n          if (Object.prototype.toString.call(obj[prop]) === '[object Object]') {\n            extended[prop] = deepExtend(extended[prop], obj[prop]);\n          } else {\n            extended[prop] = obj[prop];\n          }\n        }\n      }\n    };\n\n    for (; i < args.length; i++) {\n      merge(args[i]);\n    }\n\n    return extended;\n  }\n\n  const param = (obj: any, excludedParams?: { [key: string]: boolean }): string => {\n\n    const paramsArr: string[] = [];\n    const buildParam = (field: string, value: any) => {\n      return encodeURIComponent(field) + '=' + encodeURIComponent(\n        (isFunction(value) ? value() : value || value === 0 || value === false ? value : '')\n      )\n    }\n\n    Object.keys(obj).forEach((k) => {\n      if (excludedParams && excludedParams[k]) {\n        return;\n      }\n\n      if (Array.isArray(obj[k])) {\n        obj[k].forEach((fieldVal: any) => {\n          paramsArr.push(buildParam(k, fieldVal))\n        })\n      } else {\n        paramsArr.push(buildParam(k, obj[k]))\n      }\n    })\n\n    return paramsArr.join('&');\n  }\n\n  // const jsonpReq(uri: string): Promise<any> {\n  //   return new Promise(function(resolve, reject) {\n  //     var id = '_' + Math.round(10000 * Math.random());\n  //     var callbackName = 'jsonp_callback_' + id;\n  //     // @ts-ignore\n  //     window[callbackName] = (data: any) => {\n  //       // @ts-ignore\n  //       delete window[callbackName];\n  //       const ele = document.getElementById(id);\n  //       // @ts-ignore\n  //       ele.parentNode.removeChild(ele);\n  //       resolve(data);\n  //     }\n  //\n  //     var src = uri + '&callback=' + callbackName;\n  //     var script = document.createElement('script');\n  //     script.src = src;\n  //     script.id = id;\n  //     script.addEventListener('error', reject);\n  //     (document.getElementsByTagName('head')[0] || document.body || document.documentElement).appendChild(script);\n  //   });\n  // }\n\n  return {\n    scrollTop,\n    winSize,\n    isPlainObject,\n    isEmptyObject,\n    isFunction,\n    inArray,\n    type,\n    remove,\n    empty,\n    queryEl,\n    qa,\n    filter,\n    addClass,\n    toggleClass,\n    removeClass,\n    getWidth,\n    show,\n    hide,\n    getHeight,\n    visible,\n    append,\n    setAttr,\n    setAttrs,\n    getAttr,\n    ready,\n    delegate,\n    undelegate,\n    on,\n    off,\n    deepExtend,\n    param,\n    // jsonpReq(uri: string): Promise<any>;\n  }\n\n});\n\npn.container.register('jqUtils', {\n  useValue: jqUtils()\n});\npn.jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n", "\"use strict\";\nvar randomStr = function randomStr() {\n  var date = new Date().getTime().toString(36);\n  var prefix = Math.round(Math.random() * 2147483647).toString(36);\n  return date + prefix;\n};\nvar byteCount = function byteCount(str) {\n  return encodeURI(str).split(/%(?:u[\\dA-F]{2})?[\\dA-F]{2}|./).length - 1;\n};\nvar expiresToDate = function expiresToDate(expires) {\n  var date = new Date();\n  var increaseDays = function increaseDays(days2) {\n    if (days2) {\n      date.setDate(date.getDate() + days2);\n    }\n  };\n  if (expires instanceof Date) {\n    date = expires;\n  } else if (typeof expires === \"number\") {\n    increaseDays(expires);\n  } else {\n    var _a = expires,\n      days = _a.days,\n      minutes = _a.minutes;\n    increaseDays(days);\n    if (minutes) {\n      date.setMinutes(date.getMinutes() + minutes);\n    }\n  }\n  return date;\n};\nvar decode = function decode(s) {\n  var res = s.replace(/\\+/g, \" \").replace(/^\\s+|\\s+$/g, \"\");\n  try {\n    return decodeURIComponent(res);\n  } catch (e) {\n    return res;\n  }\n};\nvar decodeValue = function decodeValue(s) {\n  if (s.indexOf('\"') === 0) {\n    s = s.slice(1, -1).replace(/\\\\\"/g, '\"').replace(/\\\\\\\\/g, \"\\\\\");\n  }\n  return decode(s);\n};\nvar cookie = function () {\n  var _generateCookieString = function _generateCookieString(name, value, _a) {\n    var _b = _a === void 0 ? {} : _a,\n      path = _b.path,\n      domain = _b.domain,\n      expires = _b.expires,\n      secure = _b.secure,\n      samesite = _b.samesite,\n      raw = _b.raw,\n      priority = _b.priority;\n    return (raw ? name : encodeURIComponent(name)) + \"=\" + (raw ? value : encodeURIComponent(value)) + (expires ? \"; expires=\".concat(expiresToDate(expires).toUTCString()) : \"\") + (path ? \"; path=\".concat(path) : \"\") + (domain ? \"; domain=\".concat(domain) : \"\") + (secure ? \"; secure\" : \"\") + (samesite ? typeof samesite === \"boolean\" ? \"; sameSite\" : \"; sameSite=\".concat(samesite) : \"\") + (priority ? \"; priority=\".concat(priority) : \"\");\n  };\n  var setCookie = function setCookie(name, value, cookieOptions, limitValue) {\n    if (value === void 0 || limitValue !== void 0 && byteCount(value) > limitValue) {\n      return;\n    }\n    document.cookie = _generateCookieString(name, value, cookieOptions);\n  };\n  var parseCookie = function parseCookie(cb) {\n    var allCookies = document.cookie.split(\";\");\n    for (var i = 0; i < allCookies.length; i++) {\n      var _cookie = allCookies[i].split(\"=\");\n      var cookieName = decode(_cookie[0]);\n      var cookieValue = _cookie[1] || \"\";\n      if (cb(cookieName, cookieValue)) {\n        return void 0;\n      }\n    }\n  };\n  function getCookie(name) {\n    var result = null;\n    var cookies = {};\n    parseCookie(function (cookieName, cookieValue) {\n      if (name) {\n        if (cookieName === name) {\n          result = decodeValue(cookieValue);\n          return true;\n        }\n      } else {\n        cookies[cookieName] = decodeValue(cookieValue);\n      }\n    });\n    if (name) {\n      return result;\n    }\n    return cookies;\n  }\n  var getNames = function getNames() {\n    var result = [];\n    parseCookie(function (cookieName) {\n      result.push(cookieName);\n    });\n    return result;\n  };\n  var removeCookie = function removeCookie(name, cookieOptions) {\n    setCookie(name, \"\", Object.assign({}, cookieOptions, {\n      expires: -1\n    }));\n  };\n  var getTopLevelDomain = function () {\n    var testName = \"_cookie_test\";\n    var secure = document.location.protocol === \"https:\";\n    return function (domainExceptions) {\n      if (domainExceptions === void 0) {\n        domainExceptions = [];\n      }\n      var domainParts = window.location.hostname.split(\".\");\n      var testValue = randomStr();\n      var expires = new Date();\n      expires.setSeconds(expires.getSeconds() + 30);\n      for (var i = 0; i < domainParts.length; i++) {\n        try {\n          var candidate = domainParts.slice(-(i + 1)).join(\".\");\n          if (!domainExceptions.includes(candidate)) {\n            setCookie(testName, testValue, {\n              expires: expires,\n              path: \"/\",\n              domain: candidate,\n              secure: secure\n            });\n            var allowed = getCookie(testName) === testValue;\n            removeCookie(testName, {\n              path: \"/\",\n              domain: candidate\n            });\n            if (allowed) {\n              return candidate;\n            }\n          }\n        } catch (e) {}\n      }\n    };\n  }();\n  return {\n    set: setCookie,\n    get: getCookie,\n    getNames: getNames,\n    remove: removeCookie,\n    getTopLevelDomain: getTopLevelDomain,\n    __private__: {\n      _generateCookieString: _generateCookieString\n    }\n  };\n}();\nvar localStorage = function () {\n  var TTL_NAME_ITEMS = \"_ls_ttl\";\n  var _checkTTl = function _checkTTl(ttl) {\n    return ttl ? ttl > Date.now() : true;\n  };\n  var _parseTTLValues = function _parseTTLValues() {\n    try {\n      var value = window.localStorage.getItem(TTL_NAME_ITEMS);\n      if (value) {\n        var obj = JSON.parse(value);\n        return obj;\n      }\n      return null;\n    } catch (e) {\n      return null;\n    }\n  };\n  var _setTTLValues = function _setTTLValues(ttlValues) {\n    try {\n      if (Object.keys(ttlValues).length) {\n        window.localStorage.setItem(TTL_NAME_ITEMS, JSON.stringify(ttlValues));\n      } else {\n        window.localStorage.removeItem(TTL_NAME_ITEMS);\n      }\n    } catch (e) {}\n  };\n  var _saveTTLValues = function _saveTTLValues(name, expires) {\n    var ttlValues = _parseTTLValues();\n    if (expires === void 0) {\n      if (ttlValues === null || ttlValues === void 0 ? void 0 : ttlValues[name]) {\n        delete ttlValues[name];\n        _setTTLValues(ttlValues);\n      }\n      return true;\n    }\n    var expiresTime = expiresToDate(expires).getTime();\n    if (expiresTime > Date.now()) {\n      ttlValues = ttlValues || {};\n      ttlValues[name] = expiresTime.toString(36);\n      _setTTLValues(ttlValues);\n      return true;\n    }\n    return false;\n  };\n  var _checkTTLValues = function _checkTTLValues() {\n    var names = _getNames();\n    var ttls = _parseTTLValues();\n    var ttlsUpdated = {};\n    if (!ttls) {\n      return;\n    }\n    Object.keys(ttls).forEach(function (key) {\n      if (names.includes(key)) {\n        var expire = ttls[key] ? parseInt(ttls[key], 36) : null;\n        if (!_checkTTl(expire)) {\n          try {\n            window.localStorage.removeItem(key);\n          } catch (e) {}\n        } else {\n          ttlsUpdated[key] = ttls[key];\n        }\n      }\n    });\n    if (JSON.stringify(ttls) !== JSON.stringify(ttlsUpdated)) {\n      _setTTLValues(ttlsUpdated);\n    }\n  };\n  var _get = function _get(key) {\n    var _a;\n    _checkTTLValues();\n    try {\n      return (_a = window.localStorage.getItem(key)) !== null && _a !== void 0 ? _a : null;\n    } catch (e) {\n      return null;\n    }\n  };\n  var _getNames = function _getNames() {\n    try {\n      return Object.keys(window.localStorage);\n    } catch (e) {\n      return [];\n    }\n  };\n  var _set = function _set(key, value, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    if (_saveTTLValues(key, options.expires)) {\n      try {\n        window.localStorage.setItem(key, value);\n      } catch (e) {}\n    }\n  };\n  var _remove = function _remove(key) {\n    try {\n      window.localStorage.removeItem(key);\n    } catch (e) {}\n    _checkTTLValues();\n  };\n  _checkTTLValues();\n  return {\n    get: _get,\n    set: _set,\n    getNames: _getNames,\n    remove: _remove,\n    expires: _checkTTLValues,\n    __protected__: {\n      get ttlName() {\n        return TTL_NAME_ITEMS;\n      }\n    }\n  };\n}();\nvar sessionStorage = function () {\n  var _get = function _get(key) {\n    try {\n      return window.sessionStorage.getItem(key);\n    } catch (e) {\n      return null;\n    }\n  };\n  var _set = function _set(key, value) {\n    try {\n      window.sessionStorage.setItem(key, value);\n    } catch (e) {}\n  };\n  var _remove = function _remove(key) {\n    try {\n      window.sessionStorage.removeItem(key);\n    } catch (e) {}\n  };\n  var _getNames = function _getNames() {\n    try {\n      return Object.keys(window.sessionStorage);\n    } catch (e) {\n      return [];\n    }\n  };\n  return {\n    get: _get,\n    set: _set,\n    getNames: _getNames,\n    remove: _remove\n  };\n}();\nexport { cookie, localStorage, sessionStorage };", "/**\n * @license\n * Piano Browser SDK-DataLayer@2.10.1.\n * Copyright 2010-2022 Piano Software Inc.\n */\nimport { cookie } from '@piano-sdk/storage';\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\n\nvar createBaseParam = function (defaultValue, cookieName) {\r\n    if (cookieName === void 0) { cookieName = '_pctx'; }\r\n    return ({\r\n        cookieName: cookieName,\r\n        readonly: false,\r\n        init: function (valueFromCookie) { var _a; return (_a = valueFromCookie !== null && valueFromCookie !== void 0 ? valueFromCookie : defaultValue) !== null && _a !== void 0 ? _a : null; },\r\n        refresh: function (prevValue) { return prevValue; },\r\n        update: function (prevValue) { return prevValue; },\r\n        set: function (newValue) { return newValue; },\r\n        get: function (value) { return value; }\r\n    });\r\n};\r\nvar createStaticParam = function (defaultValue) { return (__assign(__assign({}, createBaseParam(defaultValue)), { cookieName: null })); };\n\nvar userState = createBaseParam('anon');\n\nvar keys = function (v) { return (v ? Object.keys(v) : []); };\r\nvar isArray = function (v) { return Array.isArray(v); };\r\nvar isEmpty = function (val) { return val === null || val === undefined; };\r\nvar isNotEmpty = function (val) { return !isEmpty(val); };\r\nvar isObject = function (val) { return typeof val === 'object'; };\r\nvar isString = function (val) { return typeof val === 'string'; };\r\nvar isNumber = function (val) { return typeof val === 'number'; };\n\n/**\r\n * cx.js backwards compatible function.\r\n * @returns {string} - random string compatible with cx.js library.\r\n */\r\nvar randomStringCxCompatible = function () {\r\n    var randomString = new Date().getTime().toString(36);\r\n    while (randomString.length < 16) {\r\n        randomString += Math.round(Math.random() * 2147483647).toString(36);\r\n    }\r\n    return randomString.substr(0, 16);\r\n};\n\nvar filterObjectValues = function (obj, filter) {\r\n    if (!obj) {\r\n        return obj;\r\n    }\r\n    // Else add to the map\r\n    return keys(obj)\r\n        .filter(function (k) { return filter(obj[k]); })\r\n        .reduce(function (a, k) {\r\n        var _a;\r\n        return (__assign(__assign({}, a), (_a = {}, _a[k] = obj[k], _a)));\r\n    }, {});\r\n};\r\nvar combineCookieConfig = function (params, cookieWrappers) { return ({\r\n    fields: keys(params).reduce(function (res, paramName) {\r\n        var cookieName = params[paramName].cookieName;\r\n        if (cookieName !== null) {\r\n            res[paramName] = cookieName;\r\n        }\r\n        return res;\r\n    }, {}),\r\n    cookieByName: cookieWrappers\r\n}); };\r\nvar stringSet = function () {\r\n    var data = {};\r\n    return {\r\n        add: function (value) {\r\n            data[value] = true;\r\n        },\r\n        values: function () {\r\n            return keys(data);\r\n        }\r\n    };\r\n};\r\nvar validateObj = function (obj, mapFilter) {\r\n    if (!isObject(obj)) {\r\n        return obj;\r\n    }\r\n    return keys(obj).reduce(function (r, k) {\r\n        var val = obj[k];\r\n        var validate = mapFilter[k];\r\n        var value = validate && validate(val);\r\n        if (value !== undefined) {\r\n            r[k] = value;\r\n        }\r\n        return r;\r\n    }, {});\r\n};\r\nvar toBoolean = function (val) { return val === 'true' || val === true; };\r\nvar memo = function (fn, checkDeps) {\r\n    var prevDeps = NaN;\r\n    var prevValue = NaN;\r\n    var prevRes;\r\n    return function (a) {\r\n        var curDeps = checkDeps === null || checkDeps === void 0 ? void 0 : checkDeps();\r\n        if (a !== prevValue || prevDeps !== curDeps) {\r\n            prevDeps = curDeps;\r\n            prevValue = a;\r\n            prevRes = fn(a);\r\n        }\r\n        return prevRes;\r\n    };\r\n};\r\nvar onMemo = function (fn) {\r\n    var prevRes;\r\n    return function (onChange) {\r\n        var res = fn();\r\n        if (res !== prevRes) {\r\n            prevRes = res;\r\n            onChange(res);\r\n        }\r\n    };\r\n};\r\nvar tryFn = function (resolve, reject) {\r\n    try {\r\n        return resolve();\r\n    }\r\n    catch (e) {\r\n        return reject ? tryFn(reject) : null;\r\n    }\r\n};\r\nvar parseJSON = function (data, useBase64) {\r\n    if (useBase64 === void 0) { useBase64 = false; }\r\n    return (tryFn(function () { return JSON.parse(data); }, function () { return (useBase64 ? JSON.parse(window.atob(data)) : null); }) || null);\r\n};\r\nvar toJSON = function (data, useBase64) {\r\n    if (useBase64 === void 0) { useBase64 = false; }\r\n    var str = JSON.stringify(data);\r\n    return tryFn(function () { return (useBase64 ? window.btoa(str) : str); }) || str;\r\n};\r\nvar shallowEqual = function (obj, obj2) {\r\n    if (obj === obj2) {\r\n        return true;\r\n    }\r\n    if (!obj || !obj2) {\r\n        return null;\r\n    }\r\n    var keys1 = keys(obj);\r\n    var keys2 = keys(obj2);\r\n    if (keys1.length !== keys2.length) {\r\n        return false;\r\n    }\r\n    return !keys1.some(function (key) {\r\n        var val1 = obj[key];\r\n        var val2 = obj2[key];\r\n        return val1 !== val2;\r\n    });\r\n};\n\nvar removeCxUsers = function (allUsers) {\r\n    return filterObjectValues(allUsers, function (val) { return (val === null || val === void 0 ? void 0 : val.type) !== 'CX'; });\r\n};\r\nvar users = __assign(__assign({}, createBaseParam(null)), { init: function (valueFromCookie) { return removeCxUsers(valueFromCookie || null); }, refresh: removeCxUsers, set: function (value, prev) {\r\n        // if new value is a null then rewrite this parameter\r\n        if (value === null) {\r\n            return null;\r\n        }\r\n        // Else add to the map\r\n        return filterObjectValues(__assign(__assign({}, prev), value), function (val) { return val !== null; });\r\n    } });\n\nvar GLOBAL_CONFIG_NAME = 'pdl';\r\n// @ts-ignore\r\nvar getGlobalConfig$1 = function () { return window[GLOBAL_CONFIG_NAME] || {}; };\n\nvar generateInitProtectedValue$1 = function (_prev, changeConfig) {\r\n    changeConfig({\r\n        protect: true // protect rewriting after init (page loading)\r\n    });\r\n    return getGlobalConfig$1().pageViewId || randomStringCxCompatible();\r\n};\r\nvar generateAnewProtectedValue = function (_prev, changeConfig) {\r\n    changeConfig({\r\n        protect: true // protect rewriting after init (page loading)\r\n    });\r\n    return randomStringCxCompatible();\r\n};\r\nvar pageViewId = __assign(__assign({}, createStaticParam()), { init: generateInitProtectedValue$1, refresh: generateAnewProtectedValue, update: generateAnewProtectedValue, set: function (value, _prevValue, changeConfig) {\r\n        changeConfig({\r\n            protect: true // protect rewriting after change\r\n        });\r\n        return value;\r\n    } });\n\nvar RESERVED_PRODUCT = 'DL';\r\nvar PRODUCTS_LIST = ['PA', 'DMP', 'COMPOSER', 'ID', 'VX', 'ESP', 'SOCIAL_FLOW', RESERVED_PRODUCT];\r\nvar PRODUCTS = PRODUCTS_LIST.map(function (name, id) { return ({\r\n    name: name,\r\n    id: id\r\n}); });\r\nvar PRODUCTS_MAP = PRODUCTS.reduce(function (res, _a, index) {\r\n    var _b;\r\n    var name = _a.name;\r\n    return (__assign(__assign({}, res), (_b = {}, _b[name] = index, _b[name.toLowerCase()] = index, _b)));\r\n}, {});\r\n// support legacy value\r\nPRODUCTS_MAP['social flow'] = PRODUCTS_MAP.SOCIAL_FLOW;\r\nPRODUCTS_MAP['Social Flow'] = PRODUCTS_MAP.SOCIAL_FLOW;\r\nvar getPdlProductNames = function () { var _a; return (_a = validateConsentMemo(getGlobalConfig$1().consent)) === null || _a === void 0 ? void 0 : _a.products; };\r\nvar onChangePdlProducts = onMemo(getPdlProductNames);\r\nvar getProducts = (function () {\r\n    var result = PRODUCTS;\r\n    return function () {\r\n        onChangePdlProducts(function (config) {\r\n            if (config) {\r\n                result = PRODUCTS.filter(function (product) {\r\n                    return config.includes(product.name) || product.name === RESERVED_PRODUCT;\r\n                });\r\n            }\r\n            else {\r\n                result = PRODUCTS;\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n})();\r\nvar filterByProduct = function (value, prevValue, updateConfig) {\r\n    var newData = getProducts().reduce(function (res, product) {\r\n        var pid = product.id;\r\n        res[pid] = updateConfig(value === null || value === void 0 ? void 0 : value[pid], prevValue === null || prevValue === void 0 ? void 0 : prevValue[pid], pid);\r\n        return res;\r\n    }, {});\r\n    if (shallowEqual(newData, prevValue)) {\r\n        return prevValue;\r\n    }\r\n    return newData;\r\n};\r\nvar getPid = function (key) {\r\n    var pid = Number(key);\r\n    if (Number.isNaN(pid)) {\r\n        var product = PRODUCTS_MAP[key.toLowerCase()];\r\n        return product !== null && product !== void 0 ? product : null;\r\n    }\r\n    return pid < PRODUCTS.length ? pid : null;\r\n};\r\nvar fillProductNameReduce = function (dataObj, reduce) {\r\n    return keys(dataObj).reduce(function (res, productId) {\r\n        var productName = PRODUCTS[Number(productId)].name;\r\n        var value = dataObj[productId];\r\n        res[productName] = reduce ? reduce(value, productName) : value;\r\n        return res;\r\n    }, {});\r\n};\n\nvar OPT_IN_MODE = 'opt-in';\r\nvar ESSENTIAL_MODE = 'essential';\r\nvar OPT_OUT_MODE = 'opt-out';\r\nvar CUSTOM_MODE = 'custom';\r\nvar modeListBase = [OPT_IN_MODE, ESSENTIAL_MODE, OPT_OUT_MODE];\r\nvar modesList = modeListBase.concat(CUSTOM_MODE);\r\nvar modeIdMap = modesList.reduce(function (res, mode, index) {\r\n    var _a;\r\n    return (__assign(__assign({}, res), (_a = {}, _a[index] = mode, _a)));\r\n}, {});\r\nvar priorityList = [OPT_IN_MODE, CUSTOM_MODE, ESSENTIAL_MODE, OPT_OUT_MODE];\r\nvar getStrictMode = function (mode1, mode2) {\r\n    var index1 = priorityList.indexOf(mode1);\r\n    var index2 = priorityList.indexOf(mode2);\r\n    return priorityList[Math.max(index1, index2)];\r\n};\r\nvar isConsentMode = function (mode) { return modesList.includes(mode); };\r\nvar isConsentBaseMode = function (mode) { return modeListBase.includes(mode); };\n\nvar purposeByProduct = {\r\n    AD: ['DMP', 'SOCIAL_FLOW'],\r\n    CP: ['COMPOSER'],\r\n    AM: ['PA'],\r\n    PR: ['ESP', 'VX', 'ID'],\r\n    DL: ['DL']\r\n};\r\nvar initialPurposeMap = keys(purposeByProduct).reduce(function (res, purpose) {\r\n    purposeByProduct[purpose].forEach(function (product) {\r\n        var productId = PRODUCTS_MAP[product];\r\n        res[productId] = purpose;\r\n    });\r\n    return res;\r\n}, {});\r\nvar onChangeConfigPurpose = onMemo(function () { var _a; return (_a = validateConsentMemo(getGlobalConfig$1().consent)) === null || _a === void 0 ? void 0 : _a.defaultPurposes; });\r\nvar getDefaultPurposes = (function () {\r\n    var result = __assign({}, initialPurposeMap);\r\n    return function () {\r\n        onChangeConfigPurpose(function (defaultPurpose) {\r\n            result = __assign({}, initialPurposeMap);\r\n            if (defaultPurpose) {\r\n                keys(defaultPurpose).forEach(function (productName) {\r\n                    var _a;\r\n                    var productId = PRODUCTS_MAP[productName];\r\n                    result[productId] = (_a = defaultPurpose[productName]) === null || _a === void 0 ? void 0 : _a.substring(0, 32);\r\n                });\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n})();\r\nvar filterByProductPurposes = function (value, prevValue) {\r\n    return filterByProduct(value, prevValue, function (config, prevConfig, pid) { return config || prevConfig || getDefaultPurposes()[pid]; });\r\n};\r\nvar convertToPurposes = function (val) {\r\n    return keys(val).reduce(function (res, key) {\r\n        var pid = getPid(key);\r\n        var purpose = toPurpose(val[key]);\r\n        if (pid === null) {\r\n            return res;\r\n        }\r\n        if (purpose === RESERVED_PURPOSE || pid === PRODUCTS_MAP[RESERVED_PRODUCT]) {\r\n            return res;\r\n        }\r\n        if (purpose) {\r\n            res[pid] = purpose;\r\n        }\r\n        return res;\r\n    }, {});\r\n};\r\nvar purposes = __assign(__assign({}, createBaseParam(null, '_pprv')), { init: function (valueFromCookie) {\r\n        return isRequireConsentV2() ? filterByProductPurposes(valueFromCookie || null, null) : null;\r\n    }, set: function (val, prevVal) {\r\n        if (!isRequireConsentV2()) {\r\n            return null;\r\n        }\r\n        if (val === null || val === undefined) {\r\n            return prevVal;\r\n        }\r\n        return filterByProductPurposes(convertToPurposes(val), prevVal);\r\n    } });\n\nvar getGlobalConfigModifiers = function () { return getGlobalConfig$1().consent_modifiers || null; };\r\nvar getRequireConsent = function () { return !!getGlobalConfig$1().requireConsent; };\r\nvar isRequireConsentV2 = function () { return getGlobalConfig$1().requireConsent === 'v2'; };\r\nvar isInvalidCustomMode = function (mode, product) { var _a; return mode === CUSTOM_MODE && !((_a = getGlobalConfigModifiers()) === null || _a === void 0 ? void 0 : _a[product]); };\r\nvar RESERVED_PURPOSE = 'DL';\r\nvar purposesMap = [\r\n    'AD',\r\n    'AM',\r\n    'CP',\r\n    'PR',\r\n    RESERVED_PURPOSE\r\n].reduce(function (res, i) {\r\n    var _a;\r\n    return (__assign(__assign({}, res), (_a = {}, _a[i] = i, _a[i.toLowerCase()] = i, _a)));\r\n}, {});\r\nvar toBasePurpose = function (purpose) { return purposesMap[(purpose === null || purpose === void 0 ? void 0 : purpose.toLowerCase()) || ''] || null; };\r\nvar toPurpose = function (purpose) {\r\n    return toBasePurpose(purpose) || (purpose === null || purpose === void 0 ? void 0 : purpose.substring(0, 32));\r\n};\r\nvar productsString = function (products, single, plural) {\r\n    return \"\".concat(products.join(', '), \" \").concat(products.length > 1 ? plural : single);\r\n};\r\nvar consentV2IsDisabled = 'Consent v2 is disabled';\r\nvar errorDlReserved = 'the \"DL\" purpose is reserved';\r\nvar errorDlProductReserved = function (purpose) { return \"\\\"\".concat(purpose, \"\\\" can not be applied for the dl product\"); };\r\nvar modeIsUnknown = function (mode) { return \"\".concat(mode, \" is unknown consent mode\"); };\r\nvar productsDoesntHaveModifier = function (products) {\r\n    return productsString(products, 'does', 'do') + \"n't have modifier in the pdl. Custom mode can't be applied\";\r\n};\r\nvar unknownPurpose = \"Unknown purpose. Provide a product or define within pdl config\";\r\nvar unknownProducts = function (products) {\r\n    return 'Custom purpose: ' + productsString(products, 'is', 'are') + ' unknown';\r\n};\r\nfunction setExtendedConsent(purposes, consent, modeOrType, mode, products) {\r\n    var error = function (msg) { return ({\r\n        error: msg\r\n    }); };\r\n    var getConsentsByProducts = function (modeLocal, purposeLocal, productsLocal) {\r\n        var invalidProducts = [];\r\n        if (!isConsentMode(modeLocal)) {\r\n            return error(modeIsUnknown(modeLocal));\r\n        }\r\n        var newConsent = getProducts().reduce(function (res, _a) {\r\n            var id = _a.id, name = _a.name;\r\n            if (!purposeLocal || (purposes === null || purposes === void 0 ? void 0 : purposes[id]) === purposeLocal || (productsLocal === null || productsLocal === void 0 ? void 0 : productsLocal.includes(id))) {\r\n                if (isInvalidCustomMode(modeLocal, name)) {\r\n                    invalidProducts.push(name);\r\n                }\r\n                else {\r\n                    res[id] = { mode: modeLocal };\r\n                }\r\n            }\r\n            return res;\r\n        }, {});\r\n        if (invalidProducts.length) {\r\n            return error(productsDoesntHaveModifier(invalidProducts));\r\n        }\r\n        if (!Object.keys(newConsent).length) {\r\n            return null;\r\n        }\r\n        return {\r\n            consent: newConsent\r\n        };\r\n    };\r\n    var setAllModes = function (modeLocal) { return getConsentsByProducts(modeLocal); };\r\n    var setByPurpose = function (modeLocal, purposeRaw) {\r\n        var purpose = toPurpose(purposeRaw);\r\n        if (!purposesMap[purpose] && !Object.values(purposes || {}).includes(purpose)) {\r\n            return error(unknownPurpose);\r\n        }\r\n        return getConsentsByProducts(modeLocal, purpose);\r\n    };\r\n    var setByPurposeAndProduct = function (modelLocal, purposeRaw, productsRaw) {\r\n        var purpose = toPurpose(purposeRaw);\r\n        var productArrayRaw = isArray(productsRaw) ? productsRaw : [productsRaw];\r\n        var pids = productArrayRaw.map(getPid).filter(isNotEmpty);\r\n        if (!pids.length) {\r\n            if (!toBasePurpose(purposeRaw)) {\r\n                return error(unknownProducts(productArrayRaw));\r\n            }\r\n            return setByPurpose(modelLocal, purposeRaw);\r\n        }\r\n        if (purpose !== RESERVED_PURPOSE && pids.includes(PRODUCTS_MAP.DL)) {\r\n            return {\r\n                error: errorDlProductReserved(purpose)\r\n            };\r\n        }\r\n        if (purpose === RESERVED_PURPOSE && pids.some(function (product) { return product !== PRODUCTS_MAP.DL; })) {\r\n            return error(errorDlReserved);\r\n        }\r\n        var consentResult = getConsentsByProducts(modelLocal, purpose, pids);\r\n        if (consentResult === null || consentResult === void 0 ? void 0 : consentResult.error) {\r\n            return consentResult;\r\n        }\r\n        var newPurposes = pids.reduce(function (res, productId) {\r\n            res[productId] = purpose;\r\n            return res;\r\n        }, {});\r\n        return {\r\n            consent: (consentResult === null || consentResult === void 0 ? void 0 : consentResult.consent) || null,\r\n            purposes: newPurposes\r\n        };\r\n    };\r\n    if (!isRequireConsentV2()) {\r\n        return error(consentV2IsDisabled);\r\n    }\r\n    if (products) {\r\n        return setByPurposeAndProduct(mode, modeOrType, products);\r\n    }\r\n    else if (mode) {\r\n        return setByPurpose(mode, modeOrType);\r\n    }\r\n    else {\r\n        return setAllModes(modeOrType);\r\n    }\r\n}\r\nvar getExtendedConsent = function (consent, purposes) {\r\n    if (!consent) {\r\n        return null;\r\n    }\r\n    var purposesLocal = purposes || initialPurposeMap;\r\n    var purposesNames = fillProductNameReduce(purposesLocal);\r\n    return getProducts().reduce(function (res, _a) {\r\n        var _b;\r\n        var productName = _a.name;\r\n        var purpose = purposesNames[productName];\r\n        var productMode = ((_b = consent[productName]) === null || _b === void 0 ? void 0 : _b.mode) || OPT_IN_MODE;\r\n        if (!res[purpose]) {\r\n            res[purpose] = {\r\n                mode: productMode,\r\n                products: [productName]\r\n            };\r\n        }\r\n        else {\r\n            res[purpose].mode = getStrictMode(res[purpose].mode, productMode);\r\n            res[purpose].products.push(productName);\r\n        }\r\n        return res;\r\n    }, {});\r\n};\r\nvar getNotAcquiredConsent = function () {\r\n    return isRequireConsentV2()\r\n        ? keys(purposeByProduct).reduce(function (res, purpose) {\r\n            res[purpose] = {\r\n                mode: 'not-acquired',\r\n                products: purposeByProduct[purpose]\r\n            };\r\n            return res;\r\n        }, {})\r\n        : null;\r\n};\n\nvar actions = ['include', 'exclude', 'obfuscate'];\r\nvar validateBrowserId = function (val) {\r\n    var length = val && val.length;\r\n    return length === 16 || length === 36 ? val : null;\r\n};\r\nvar oneOf = function (name, value) { return \"\\\"\".concat(name, \"\\\" should be one of \").concat(value.join(', ')); };\r\n// tslint:disable-next-line no-empty\r\nvar emptyFn = function () { };\r\nvar addPrefix = function (prefix, log) {\r\n    return function (val) {\r\n        return log(prefix + val);\r\n    };\r\n};\r\nvar toProduct = function (product, log) {\r\n    if (log === void 0) { log = emptyFn; }\r\n    var index = PRODUCTS_MAP[product.toLowerCase()];\r\n    if (index !== undefined) {\r\n        return PRODUCTS[index].name;\r\n    }\r\n    log(\"\\\"\".concat(product, \"\\\" is not found\"));\r\n    return null;\r\n};\r\nvar toMode = function (mode) {\r\n    return isConsentBaseMode(mode) ? mode : null;\r\n};\r\nvar validateModifier = function (modifier, log) {\r\n    if (log === void 0) { log = emptyFn; }\r\n    var source = modifier.source;\r\n    var newPatches = modifier.patches || [];\r\n    if (!toMode(source)) {\r\n        log(oneOf('source', modeListBase));\r\n        source = OPT_IN_MODE;\r\n    }\r\n    if (!isArray(newPatches)) {\r\n        log('\"patches\" should be an array');\r\n        newPatches = [];\r\n    }\r\n    newPatches = newPatches.reduce(function (res, patch, i) {\r\n        if (!isObject(patch) || isArray(patch)) {\r\n            log(\"patch[\".concat(i, \"]: should be type of {action, item, with?}\"));\r\n            return res;\r\n        }\r\n        var action = patch.action, item = patch.item;\r\n        if (!actions.includes(action)) {\r\n            log(\"patch[\".concat(i, \"]: \") + oneOf('action', actions));\r\n            return res;\r\n        }\r\n        if (!item || !isObject(item) || !item.key || !item.type) {\r\n            log(\"patch[\".concat(i, \"]: \\\"item\\\" should be type of {key, type}\"));\r\n            return res;\r\n        }\r\n        res.push(patch);\r\n        return res;\r\n    }, []);\r\n    return {\r\n        source: source,\r\n        patches: newPatches\r\n    };\r\n};\r\nvar validateConsent$1 = function (consent, log) {\r\n    if (log === void 0) { log = emptyFn; }\r\n    if (!consent) {\r\n        return null;\r\n    }\r\n    var result = {};\r\n    if (consent.products) {\r\n        if (!isArray(consent.products)) {\r\n            log('consent.products: should be an array');\r\n        }\r\n        else {\r\n            result.products = consent.products.reduce(function (res, product) {\r\n                var validProduct = toProduct(product, addPrefix('consent.products: ', log));\r\n                if (validProduct) {\r\n                    res.push(validProduct);\r\n                }\r\n                return res;\r\n            }, []);\r\n        }\r\n    }\r\n    if (consent.defaultPreset) {\r\n        result.defaultPreset = keys(consent.defaultPreset).reduce(function (res, productKey) {\r\n            var product = toProduct(productKey, addPrefix('consent.defaultPreset: ', log));\r\n            var mode = toMode(consent.defaultPreset[productKey]);\r\n            if (!mode) {\r\n                log('consent.defaultPreset: ' + oneOf(productKey, modeListBase));\r\n            }\r\n            if (product && mode) {\r\n                res[product] = mode;\r\n            }\r\n            return res;\r\n        }, {});\r\n    }\r\n    var purposes = consent.defaultPurposes;\r\n    if (purposes) {\r\n        result.defaultPurposes = keys(purposes).reduce(function (res, productKey) {\r\n            var purposeLog = addPrefix('consent.defaultPurposes: ', log);\r\n            var product = toProduct(productKey, purposeLog);\r\n            var rawPurpose = purposes[productKey];\r\n            var purpose = toPurpose(rawPurpose);\r\n            if (purpose === RESERVED_PURPOSE || product === RESERVED_PRODUCT) {\r\n                purposeLog(\"\\\"\".concat(productKey, \": \").concat(rawPurpose, \"\\\" - invalid config\"));\r\n            }\r\n            else if (product && purpose) {\r\n                res[product] = purpose;\r\n            }\r\n            return res;\r\n        }, {});\r\n    }\r\n    return result;\r\n};\r\nvar validateConsentMemo = memo(validateConsent$1);\r\nvar validateMigration = function (migration, log) {\r\n    if (log === void 0) { log = emptyFn; }\r\n    return keys(migration || {}).reduce(function (res, propName) {\r\n        var data = migration === null || migration === void 0 ? void 0 : migration[propName];\r\n        var product = toProduct((data === null || data === void 0 ? void 0 : data.source) || '', log);\r\n        res[propName] = __assign(__assign({}, data), { source: product });\r\n        return res;\r\n    }, {});\r\n};\n\nvar generateInitProtectedValue = function (_cookieInitValue, changeConfig) {\r\n    changeConfig({\r\n        protect: true // protect rewriting after init (page loading)\r\n    });\r\n    // Get the value from cookie. If there is no data, then generate a new random string\r\n    return validateBrowserId(getGlobalConfig$1().browserId || null) || _cookieInitValue || randomStringCxCompatible();\r\n};\r\nvar browserId = __assign(__assign({}, createBaseParam(null, '_pcid')), { init: generateInitProtectedValue, \r\n    // Need to update value - generate a new value\r\n    update: function (_prev, changeConfig) {\r\n        changeConfig({\r\n            protect: true\r\n        });\r\n        return randomStringCxCompatible();\r\n    }, \r\n    // Need to set a specific value\r\n    set: function (value, _prev, changeConfig) {\r\n        changeConfig({\r\n            protect: true\r\n        });\r\n        return value;\r\n    } });\n\n// opt-in - 0\r\n// essential - 1\r\n// opt-out - 2\r\n// custom - 3\r\n/*!\r\n| \\#  | name/product                                                              | PA        | DMP     | COMPOSER  | ID        | VX        | ESP     | Social Flow |\r\n| --- | -------------------------------------------------------------------------- | --------- | ------- | --------- | --------- | --------- | ------- | ----------- |\r\n| 0   | Default (not consent selected)                                             | opt-in    | opt-in  | opt-in    | opt-in    | opt-in    | opt-in  | opt-in      |\r\n| 1   | Audience measurement                                                       | opt-in    | opt-in  | opt-out   | opt-out   | opt-out   | opt-out | opt-out     |\r\n| 2   | Audience measurement (Exempted)                                            | essential | opt-out | opt-out   | opt-out   | opt-out   | opt-out | opt-out     |\r\n| 3   | Content performance measurement                                            | opt-in    | opt-out | opt-in    | opt-out   | opt-out   | opt-out | opt-in      |\r\n| 4   | Content performance measurement (Exempted)                                 | essential | opt-out | opt-out   | opt-out   | opt-out   | opt-out | essential   |\r\n| 5   | Personalized content profile creation                                      | opt-out   | opt-in  | opt-in    | opt-out   | opt-out   | opt-out | opt-out     |\r\n| 6   | Personalized ads profile creation                                          | opt-out   | opt-in  | opt-out   | opt-out   | opt-out   | opt-out | opt-out     |\r\n| 7   | Ads performance measurement                                                | opt-out   | opt-out | opt-out   | opt-out   | opt-out   | opt-out | opt-in      |\r\n| 8   | User experience personalization (registration, subscription, newsletter)   | opt-out   | opt-out | opt-in    | opt-in    | opt-in    | opt-in  | opt-out     |\r\n| 9   | Subscription (Exempted)                                                    | opt-out   | opt-out | essential | opt-out   | essential | opt-out | opt-out     |\r\n| 10  | Registration (Exempted)                                                    | opt-out   | opt-out | essential | essential | opt-out   | opt-out | opt-out     |\r\n*/\r\nvar PRESETS_TABLE = [\r\n    [0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 2, 2, 2, 2, 2, 0],\r\n    [1, 2, 2, 2, 2, 2, 2, 1],\r\n    [0, 2, 0, 2, 2, 2, 0, 0],\r\n    [1, 2, 2, 2, 2, 2, 1, 1],\r\n    [2, 0, 0, 2, 2, 2, 2, 0],\r\n    [2, 0, 2, 2, 2, 2, 2, 0],\r\n    [2, 2, 2, 2, 2, 2, 0, 2],\r\n    [2, 2, 0, 0, 0, 0, 2, 0],\r\n    [2, 2, 1, 2, 1, 2, 2, 1],\r\n    [2, 2, 1, 1, 2, 2, 2, 1] // 10\r\n];\r\nvar convertIndexModes = function (modes) {\r\n    return modes.reduce(function (res, modeIndex, productId) {\r\n        var _a;\r\n        return (__assign(__assign({}, res), (_a = {}, _a[productId] = { mode: modeIdMap[modeIndex] }, _a)));\r\n    }, {});\r\n};\r\nvar PRESETS = PRESETS_TABLE.map(function (modes, id) { return ({\r\n    id: id,\r\n    preset: convertIndexModes(modes)\r\n}); });\r\nvar onChangeConfigPresets = onMemo(function () { var _a; return (_a = validateConsentMemo(getGlobalConfig$1().consent)) === null || _a === void 0 ? void 0 : _a.defaultPreset; });\r\nvar getPresets = (function () {\r\n    var result = PRESETS;\r\n    return function () {\r\n        onChangeConfigPresets(function (defaultPreset) {\r\n            result = PRESETS.slice();\r\n            if (defaultPreset) {\r\n                result[0] = {\r\n                    id: 0,\r\n                    preset: __assign({}, result[0].preset)\r\n                };\r\n                keys(defaultPreset).forEach(function (name) {\r\n                    var mode = defaultPreset[name];\r\n                    var productId = PRODUCTS_MAP[name];\r\n                    result[0].preset[productId] = { mode: mode };\r\n                });\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n})();\r\nvar getDefaultPreset = function () { return getPresets()[0].preset; };\r\nvar getCalculatedPreset = function (presetIndexes) {\r\n    var currentPreset = null;\r\n    presetIndexes.forEach(function (presetIndex) {\r\n        var preset = PRESETS_TABLE[presetIndex];\r\n        if (!currentPreset && preset) {\r\n            currentPreset = preset;\r\n            return;\r\n        }\r\n        if (!currentPreset || !preset) {\r\n            return;\r\n        }\r\n        currentPreset = currentPreset.map(function (indexMode, productIndex) {\r\n            return Math.min(indexMode, preset[productIndex]);\r\n        });\r\n    });\r\n    return currentPreset && convertIndexModes(currentPreset);\r\n};\n\n// @ts-ignore\r\nvar convertToConsent = function (val) {\r\n    return keys(val).reduce(function (res, key) {\r\n        var config = val[key];\r\n        var pid = getPid(key);\r\n        if (pid === null) {\r\n            return res;\r\n        }\r\n        var mode = isConsentMode(config.mode) ? config.mode : null;\r\n        if (mode) {\r\n            if (!res) {\r\n                res = {};\r\n            }\r\n            res[pid] = { mode: mode };\r\n        }\r\n        return res;\r\n    }, null);\r\n};\r\nvar filterByProductConsent = function (value, prevValue) {\r\n    return filterByProduct(value, prevValue, function (config, prevConfig, pid) {\r\n        var mode = (config === null || config === void 0 ? void 0 : config.mode) || (prevConfig === null || prevConfig === void 0 ? void 0 : prevConfig.mode) || getDefaultPreset()[pid].mode;\r\n        if (mode !== (prevConfig === null || prevConfig === void 0 ? void 0 : prevConfig.mode)) {\r\n            return {\r\n                mode: mode\r\n            };\r\n        }\r\n        return prevConfig;\r\n    });\r\n};\r\nvar consent = __assign(__assign({}, createBaseParam(null, '_pprv')), { init: function (valueFromCookie) {\r\n        return getRequireConsent() && valueFromCookie ? filterByProductConsent(valueFromCookie, null) : null;\r\n    }, set: function (val, prevVal) {\r\n        var _a;\r\n        if (!getRequireConsent()) {\r\n            return null;\r\n        }\r\n        if (val === null || val === undefined) {\r\n            return prevVal;\r\n        }\r\n        var newConsent;\r\n        if (isNumber(val)) {\r\n            // deprecated value\r\n            newConsent = ((_a = getPresets()[val]) === null || _a === void 0 ? void 0 : _a.preset) || null;\r\n        }\r\n        else if (isArray(val)) {\r\n            // deprecated value\r\n            newConsent = getCalculatedPreset(val);\r\n        }\r\n        else {\r\n            newConsent = convertToConsent(val);\r\n        }\r\n        return newConsent ? filterByProductConsent(newConsent, prevVal) : prevVal;\r\n    }, get: memo(function (value) {\r\n        return value &&\r\n            fillProductNameReduce(value, function (config, productName) {\r\n                var _a;\r\n                var newConfig = __assign({}, config);\r\n                if (newConfig.mode === CUSTOM_MODE) {\r\n                    newConfig.modifier = ((_a = getGlobalConfigModifiers()) === null || _a === void 0 ? void 0 : _a[productName]) || null;\r\n                }\r\n                return newConfig;\r\n            });\r\n    }, function () { return getGlobalConfigModifiers(); }) });\r\nvar consentPresets = __assign(__assign({}, createStaticParam()), { init: getPresets, set: getPresets });\r\nvar products = __assign(__assign({}, createStaticParam()), { init: getProducts, set: getProducts });\r\nvar consentModifiers = __assign(__assign({}, createStaticParam(null)), { readonly: true, set: function () { return null; }, \r\n    // @ts-ignore\r\n    get: getGlobalConfigModifiers });\n\nvar toDate = function (val) {\r\n    var timeStamp = Number(val);\r\n    if (!Number.isNaN(timeStamp)) {\r\n        return timeStamp;\r\n    }\r\n    return String(val);\r\n};\r\nvar toArrayString = function (val) {\r\n    return isArray(val) ? val : val.split(',').map(function (s) { return s.trim().replace(/^['\"](.+)['\"]$/, '$1'); });\r\n};\r\nvar asIs = function (val) { return val; };\r\nvar Validators = {\r\n    id: asIs,\r\n    type: asIs,\r\n    zone: asIs,\r\n    createdAt: toDate,\r\n    modifiedAt: toDate,\r\n    authors: toArrayString,\r\n    section: asIs,\r\n    tags: toArrayString,\r\n    keywords: toArrayString,\r\n    title: asIs,\r\n    description: asIs,\r\n    isNative: toBoolean\r\n};\r\nvar isAll = function (take) { return take === 'all'; };\r\nvar isFirst = function (take) { return take === 'first'; };\r\nvar isLast = function (take) { return take === 'last'; };\r\nfunction query(selector, take) {\r\n    if (selector === void 0) { selector = 'meta'; }\r\n    if (isFirst(take)) {\r\n        return document.querySelector(selector);\r\n    }\r\n    var els = document.querySelectorAll(selector);\r\n    return isLast(take) ? els[els.length - 1] : Array.from(els);\r\n}\r\nvar queryMetasMemo = (function () {\r\n    var res = null;\r\n    var refresh = function () {\r\n        res = query() || null;\r\n        if (res) {\r\n            setTimeout(function () {\r\n                res = null;\r\n            }, 0);\r\n        }\r\n    };\r\n    return {\r\n        refresh: refresh,\r\n        find: function (attrs, hasContent) {\r\n            if (hasContent === void 0) { hasContent = false; }\r\n            return res\r\n                ? res.reduce(function (obj, el) {\r\n                    for (var _i = 0, attrs_1 = attrs; _i < attrs_1.length; _i++) {\r\n                        var attr = attrs_1[_i];\r\n                        var name_1 = ((attr === 'name' ? el.name : el.getAttribute(attr)) || '').trim().toLowerCase();\r\n                        var content = el.content;\r\n                        if (!name_1 || (hasContent && !content)) {\r\n                            continue;\r\n                        }\r\n                        if (!obj[name_1]) {\r\n                            obj[name_1] = [];\r\n                        }\r\n                        obj[name_1].push(el);\r\n                        break;\r\n                    }\r\n                    return obj;\r\n                }, {})\r\n                : null;\r\n        }\r\n    };\r\n})();\r\nvar readMetaValue = function (config) {\r\n    var metaContent = function (meta) { return meta.content; };\r\n    var getContent = config.getContent || metaContent;\r\n    var readSpecificSelector = function () {\r\n        var el = query(config.selector, config.take || 'first');\r\n        return (el && getContent(el)) || null;\r\n    };\r\n    var readFromMeta = function () {\r\n        var metas = queryMetasMemo.find(config.attr || ['name'], config.hasContent);\r\n        var names = config.names || [];\r\n        var single = !isAll(config.take);\r\n        var last = isLast(config.take);\r\n        if (!metas) {\r\n            return null;\r\n        }\r\n        var _loop_1 = function (name_2) {\r\n            var result = [];\r\n            var elements = metas[name_2];\r\n            if (elements) {\r\n                if (single) {\r\n                    var index = last ? elements.length - 1 : 0;\r\n                    var meta = elements[index];\r\n                    return { value: getContent(meta) || '' };\r\n                }\r\n                elements.forEach(function (el) {\r\n                    result = result.concat(getContent(el) || '');\r\n                });\r\n            }\r\n            if (result.length) {\r\n                return { value: result };\r\n            }\r\n        };\r\n        for (var _i = 0, names_1 = names; _i < names_1.length; _i++) {\r\n            var name_2 = names_1[_i];\r\n            var state_1 = _loop_1(name_2);\r\n            if (typeof state_1 === \"object\")\r\n                return state_1.value;\r\n        }\r\n        return null;\r\n    };\r\n    return (config.selector ? readSpecificSelector() : readFromMeta());\r\n};\r\nvar readMetaValues = function (configs) {\r\n    for (var _i = 0, configs_1 = configs; _i < configs_1.length; _i++) {\r\n        var conf = configs_1[_i];\r\n        var val = readMetaValue(conf);\r\n        if (val) {\r\n            return val;\r\n        }\r\n    }\r\n};\r\nvar append = function (data, name, config) {\r\n    var validate = Validators[name];\r\n    var exist = Boolean(data[name]);\r\n    var readValue = typeof config === 'function' ? config : function () { return (isArray(config) ? readMetaValues(config) : readMetaValue(config)); };\r\n    if (!exist && validate) {\r\n        var value = readValue();\r\n        var validatedValue = value && validate(value);\r\n        if (validatedValue) {\r\n            data[name] = validatedValue;\r\n        }\r\n    }\r\n};\n\n// <meta property=\"\" content=\"\">\r\nvar property = function (val) { return ({\r\n    attr: ['property'],\r\n    names: [val]\r\n}); };\r\nvar name = function (val) { return ({\r\n    names: [val]\r\n}); };\r\nvar appendLegacyComposer = function (prevValue) {\r\n    // og:description & og:title will be parsed from crawler\r\n    // 'keywords' & 'news_keywords' will be parsed from crawler\r\n    append(prevValue, 'type', property('og:type'));\r\n    append(prevValue, 'section', name('section'));\r\n    append(prevValue, 'id', name('id'));\r\n    append(prevValue, 'authors', name('author'));\r\n};\n\nfunction isArticle(ldJsonPart) {\r\n    return ldJsonPart && isString(ldJsonPart['@type']) && ldJsonPart['@type'].includes('Article');\r\n}\r\nfunction findArticle(parsedLdJson) {\r\n    if (isArray(parsedLdJson)) {\r\n        return parsedLdJson.find(function (part) { return isArticle(part); }) || {};\r\n    }\r\n    return {};\r\n}\r\nfunction readLdJson() {\r\n    var ldJsonElements = document.querySelectorAll('script[type=\"application/ld+json\"]');\r\n    if (ldJsonElements) {\r\n        var parsedLdJsons = Array.from(ldJsonElements).flatMap(function (element) { return parseJSON(element.innerHTML); });\r\n        return findArticle(parsedLdJsons);\r\n    }\r\n    return {};\r\n}\n\nvar monthNames = {\r\n    januar: '01',\r\n    january: '01',\r\n    jan: '01',\r\n    februar: '02',\r\n    february: '02',\r\n    feb: '02',\r\n    mars: '03',\r\n    march: '03',\r\n    mar: '03',\r\n    april: '04',\r\n    apr: '04',\r\n    mai: '05',\r\n    may: '05',\r\n    juni: '06',\r\n    june: '06',\r\n    jun: '06',\r\n    juli: '07',\r\n    july: '07',\r\n    jul: '07',\r\n    august: '08',\r\n    aug: '08',\r\n    september: '09',\r\n    sept: '09',\r\n    sep: '09',\r\n    oktober: '10',\r\n    october: '10',\r\n    okt: '10',\r\n    oct: '10',\r\n    november: '11',\r\n    nov: '11',\r\n    desember: '12',\r\n    december: '12',\r\n    dec: '12',\r\n    des: '12'\r\n};\r\nvar dateFormatRegex = function (input) {\r\n    var format = input\r\n        .replace(/DAY/g, '(0?[1-9]|[12][0-9]|3[01])')\r\n        .replace(/MONTHLONG/g, '(' + keys(monthNames).join('|') + ')')\r\n        .replace(/MONTH/g, '(0?[1-9]|1[012])')\r\n        .replace(/YEAR2/g, '([0-9][0-9])')\r\n        .replace(/YEAR/g, '(197[1-9]|19[8-9][0-9]|20[0-9][0-9])')\r\n        .replace(/TIME/g, '([0-9][0-9]):([0-9][0-9]):([0-9][0-9])(?:\\\\.[0-9][0-9][0-9])?([zZ]|[+-][0-9][0-9](?::?[0-9][0-9])?)?');\r\n    var order = input.replace(/.*?([YMD])(EAR|ONTH|AY).*?/g, '$1').substring(0, 3); // \"YMD\", \"DMY\" or \"MDY\".\r\n    return [new RegExp(format), order];\r\n};\r\nvar dateFormats = (function () {\r\n    return [\r\n        '\\\\bDAY\\\\.MONTH\\\\.YEAR\\\\b',\r\n        '\\\\bDAY\\\\.?\\\\s{0,3}MONTHLONG\\\\.?\\\\s{1,3}YEAR\\\\b',\r\n        '\\\\bYEAR-MONTH-DAY(?:[tT]|\\\\b)',\r\n        '\\\\bMONTHLONG\\\\.?\\\\s{0,3}DAY(?:st|nd|rd|th)?,?\\\\s{1,3}YEAR\\\\b',\r\n        '\\\\bDAY(?:st|nd|rd|th|\\\\.)?\\\\s{0,3}MONTHLONG\\\\.?,?\\\\s{1,3}YEAR\\\\b',\r\n        '\\\\bYEAR[/\u5E74]MONTH[/\u6708]DAY(?=\\\\b|\u65E5)',\r\n        '\\\\bDAY\\\\.MONTH\\\\.YEAR2\\\\b',\r\n        '\\\\bDAY/MONTH/YEAR\\\\b'\r\n    ].map(dateFormatRegex);\r\n})();\r\nvar dateTimeRegex = dateFormatRegex('YEAR-MONTH-DAY[tT]TIME')[0];\r\nvar int = function (val) { return (val && parseInt(val, 10)) || 0; };\r\nfunction dateToISO(year, month, day, hour, minute, second, zone) {\r\n    var then = new Date(Date.UTC(int(year), int(month) - 1, int(day), int(hour), int(minute), int(second)));\r\n    var zoneMatch = (zone || '').match(/^([+-][0-9][0-9])(?::?([0-9][0-9])?)$/);\r\n    if (zoneMatch) {\r\n        then = new Date(then.getTime() - Number(zoneMatch[1]) * 3600000 - (Number(zoneMatch[2]) || 0) * 60000);\r\n    }\r\n    var msPerDay = 1000 * 24 * 60 * 60;\r\n    var diff = Date.now() - then.getTime();\r\n    return diff > 0 || -diff < 2 * msPerDay ? then.toISOString() : null;\r\n}\r\nfunction anyDateToISODate(date) {\r\n    date = date.toLowerCase();\r\n    var fullMatch = date.match(dateTimeRegex);\r\n    if (fullMatch) {\r\n        return dateToISO(fullMatch[1], fullMatch[2], fullMatch[3], fullMatch[4], fullMatch[5], fullMatch[6], fullMatch[7]);\r\n    }\r\n    for (var _i = 0, dateFormats_1 = dateFormats; _i < dateFormats_1.length; _i++) {\r\n        var format = dateFormats_1[_i];\r\n        var match = date.match(format[0]);\r\n        if (match) {\r\n            match =\r\n                format[1] === 'DMY'\r\n                    ? ['', match[3], match[2], match[1]]\r\n                    : format[1] === 'MDY'\r\n                        ? ['', match[3], match[1], match[2]]\r\n                        : match;\r\n            var year = match[1].length === 2 ? (int(match[1]) < 60 ? '20' : '19') + match[1] : match[1];\r\n            var month = match[2].length <= 2 ? match[2] : monthNames[match[2]];\r\n            return dateToISO(year, month, match[3]);\r\n        }\r\n    }\r\n}\n\nvar clearContent = function (str) {\r\n    return str\r\n        .replace(/<\\/?[^>?]*\\/?>/g, ' ')\r\n        .replace(/\\s+/g, ' ')\r\n        .trim();\r\n};\r\nfunction authorNormalization(author) {\r\n    if (author === void 0) { author = ''; }\r\n    return clearContent(author.replace(/,(?=\\s*(jr|sr)(\\.?)\\b)/g, ' '));\r\n}\r\nfunction splitAuthors(authors) {\r\n    if (authors === void 0) { authors = ''; }\r\n    var parsedAuthors = authors\r\n        .replace(/\\n+/, ';')\r\n        .replace(/(\\<|&lt;)br(\\>|&gt;)/, ';')\r\n        .replace(/\\b(and|und|og)\\b/g, ';');\r\n    return authorNormalization(parsedAuthors).split(/[,;]/);\r\n}\r\nvar getContentAuthors = function (el) {\r\n    var separator = el.getAttribute('data-separator');\r\n    var content = el.content;\r\n    return separator ? authorNormalization(content).split(separator) : splitAuthors(content);\r\n};\n\nvar takeLast = function (config) { return (__assign(__assign({}, config), { take: 'last' })); };\r\nvar hasContentAndLast = function (config) { return (__assign(__assign({}, config), { take: 'last', hasContent: true, getContent: function (el) { return clearContent(el.content || ''); } })); };\r\n// cxenseinternal-publishtime\r\nvar publishTimeConfig = [\r\n    takeLast({\r\n        attr: ['name', 'property', 'itemprop'],\r\n        names: [\r\n            'cxenseparse:publishtime',\r\n            'cxenseparse:recs:publishtime',\r\n            'article:published_time',\r\n            'date',\r\n            'dc.date',\r\n            'dc.date.created',\r\n            'dc.terms.issued',\r\n            'pub_date',\r\n            'article.published',\r\n            'datepublished',\r\n            'og:article:published_time'\r\n        ]\r\n    }),\r\n    takeLast({\r\n        selector: 'time.published[datetime],time[pubdate][datetime]',\r\n        getContent: function (el) { return el.getAttribute('datetime'); }\r\n    }),\r\n    takeLast({\r\n        selector: 'time[itemprop=\"datePublished\"][datetime]',\r\n        getContent: function (el) { return el.getAttribute('datetime'); }\r\n    })\r\n];\r\n// cxenseinternal-modifiedtime\r\nvar modifiedTimeConfig = [\r\n    takeLast({\r\n        attr: ['name', 'property', 'itemprop'],\r\n        names: ['article:modified_time', 'datemodified']\r\n    }),\r\n    takeLast({\r\n        selector: 'time[itemprop=\"dateModified\"][datetime]',\r\n        getContent: function (el) { return el.getAttribute('datetime'); }\r\n    })\r\n];\r\n// cxenseinternal-author\r\nvar authorConfig = [\r\n    {\r\n        attr: ['property', 'name'],\r\n        names: [\r\n            // combine the data from all attributes\r\n            'cxenseparse:author',\r\n            'og:article:author',\r\n            'article:author',\r\n            'og:book:author',\r\n            'book:author',\r\n            'author',\r\n            'dc.creator',\r\n            'article.author'\r\n        ],\r\n        take: 'all',\r\n        getContent: getContentAuthors\r\n    }\r\n];\r\n// cxenseinternal-keywords\r\nvar keywordsConfig = [\r\n    hasContentAndLast({\r\n        names: ['cxenseparse:keywords']\r\n    }),\r\n    hasContentAndLast({\r\n        attr: ['property', 'name'],\r\n        names: ['news_keywords']\r\n    }),\r\n    hasContentAndLast({\r\n        names: ['keywords']\r\n    })\r\n];\r\n// cxenseinternal-description\r\nvar descriptionConfig = [\r\n    hasContentAndLast({\r\n        names: ['cxenseparse:description']\r\n    }),\r\n    hasContentAndLast({\r\n        attr: ['property'],\r\n        names: ['og:description']\r\n    }),\r\n    hasContentAndLast({\r\n        names: ['description']\r\n    })\r\n];\r\n// cxenseinternal-title\r\nvar internalTitle = [\r\n    {\r\n        names: ['cxenseparse:title']\r\n    },\r\n    takeLast({\r\n        attr: ['property', 'name'],\r\n        names: ['og:title']\r\n    })\r\n];\r\nvar appendLdJsonCrawler = function (data) {\r\n    var maybeArticle = readLdJson();\r\n    if (isArticle(maybeArticle)) {\r\n        append(data, 'createdAt', function () {\r\n            var datePublished = maybeArticle.datePublished;\r\n            return datePublished ? anyDateToISODate(datePublished.toLowerCase()) : null;\r\n        });\r\n        append(data, 'modifiedAt', function () {\r\n            var dateModified = maybeArticle.dateModified;\r\n            return dateModified ? anyDateToISODate(dateModified.toLowerCase()) : null;\r\n        });\r\n        append(data, 'authors', function () {\r\n            var author = maybeArticle.author;\r\n            return author ? (isArray(author) ? author.map(function (a) { return a.name; }).join(', ') : author.name) : null;\r\n        });\r\n        append(data, 'keywords', function () {\r\n            var keywords = maybeArticle.keywords;\r\n            return isString(keywords) && keywords.length <= 1024 ? keywords : null;\r\n        });\r\n        append(data, 'title', function () { return maybeArticle.headline; });\r\n        append(data, 'description', function () { return maybeArticle.description; });\r\n    }\r\n};\r\nvar appendLegacyCrawler = function (data) {\r\n    append(data, 'createdAt', function () {\r\n        var publishTime = readMetaValues(publishTimeConfig);\r\n        return publishTime ? anyDateToISODate(publishTime.toLowerCase()) : null;\r\n    });\r\n    append(data, 'modifiedAt', function () {\r\n        var modifiedTime = readMetaValues(modifiedTimeConfig);\r\n        return modifiedTime ? anyDateToISODate(modifiedTime.toLowerCase()) : null;\r\n    });\r\n    append(data, 'authors', authorConfig);\r\n    append(data, 'keywords', function () {\r\n        var keywords = readMetaValues(keywordsConfig); // check length 1024\r\n        return keywords && keywords.length <= 1024 ? keywords : null;\r\n    });\r\n    append(data, 'title', internalTitle);\r\n    append(data, 'description', descriptionConfig);\r\n};\n\n// read <meta property=\"content:*\" content=\"*\">\r\nvar readMetaElements = function () {\r\n    var data = Array.from(document.querySelectorAll('meta[property^=content]')).reduce(function (res, meta) {\r\n        var _a;\r\n        var type = (_a = meta === null || meta === void 0 ? void 0 : meta.getAttribute('property')) === null || _a === void 0 ? void 0 : _a.split(':').pop();\r\n        var validate = Validators[type];\r\n        if (validate && meta) {\r\n            res[type] = validate((meta === null || meta === void 0 ? void 0 : meta.getAttribute('content')) || '');\r\n        }\r\n        return res;\r\n    }, {});\r\n    queryMetasMemo.refresh();\r\n    appendLegacyComposer(data);\r\n    appendLdJsonCrawler(data);\r\n    appendLegacyCrawler(data);\r\n    return data;\r\n};\r\nvar content = __assign(__assign({}, createStaticParam(null)), { init: function () { return readMetaElements(); }, refresh: function (prevValue) {\r\n        var newValue = readMetaElements();\r\n        if (prevValue === null || prevValue === void 0 ? void 0 : prevValue._fixed_) {\r\n            prevValue === null || prevValue === void 0 ? void 0 : prevValue._fixed_.forEach(function (fieldName) {\r\n                delete newValue[fieldName];\r\n            });\r\n        }\r\n        return __assign(__assign({}, prevValue), newValue);\r\n    }, set: function (value, prevValue) {\r\n        if (value === null) {\r\n            return {};\r\n        }\r\n        var fixedSet = new Set(prevValue && prevValue._fixed_);\r\n        var proceedValue = function (filter, forEachCb) {\r\n            keys(filterObjectValues(value, filter)).forEach(forEachCb);\r\n        };\r\n        proceedValue(isNotEmpty, function (val) {\r\n            fixedSet.add(val);\r\n        });\r\n        proceedValue(isEmpty, function (val) {\r\n            fixedSet.delete(val);\r\n        });\r\n        return filterObjectValues(__assign(__assign(__assign({}, prevValue), value), { _fixed_: Array.from(fixedSet.values()) }), isNotEmpty);\r\n    }, get: memo(function (value) {\r\n        var getValue = __assign({}, value);\r\n        delete getValue._fixed_;\r\n        return value && getValue;\r\n    }) });\n\nvar userSegments = __assign(__assign({}, createBaseParam(null, '_pcus')), { init: function (valueFromCookie) {\r\n        if (valueFromCookie === void 0) { valueFromCookie = null; }\r\n        return valueFromCookie && filterObjectValues(valueFromCookie, function (val) { return isObject(val) && isArray(val.segments); });\r\n    } });\n\nvar PropertiesMap = {\r\n    pageViewId: pageViewId,\r\n    browserId: browserId,\r\n    users: users,\r\n    userStatus: userState,\r\n    siteId: createBaseParam(),\r\n    consent: consent,\r\n    consentPresets: consentPresets,\r\n    products: products,\r\n    consentModifiers: consentModifiers,\r\n    purposes: purposes,\r\n    content: content,\r\n    userSegments: userSegments\r\n};\n\nvar domainExceptions = ['pantheon.io', 'go-vip.net', 'go-vip.co'];\r\nvar DEFAULT_COOKIE_OPTIONS = {\r\n    path: '/',\r\n    expires: 395,\r\n    samesite: 'lax',\r\n    secure: window.location.protocol === 'https:',\r\n    domain: cookie.getTopLevelDomain(domainExceptions)\r\n};\n\nvar createDateByExpires = function (expires) {\r\n    var date = new Date();\r\n    if (expires instanceof Date) {\r\n        date = expires;\r\n    }\r\n    else if (typeof expires === 'number') {\r\n        date.setDate(date.getDate() + expires);\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n    return date;\r\n};\r\nvar dateToString = function (date) { return date.getTime().toString(36); };\r\nvar stringToDate = function (date) { return (date ? tryFn(function () { return new Date(parseInt(date, 36)); }) : null); };\r\nvar expirationName = '_t';\r\nvar initFixedUtils = function (rawData, _a) {\r\n    var encode = _a.encode, decode = _a.decode;\r\n    var fixedMode = false;\r\n    var fixedExpirationDate = null;\r\n    var fixedCreationDate = null;\r\n    var _onChangeCb = null;\r\n    (function () {\r\n        var _a;\r\n        var expiration = (_a = decode(rawData || '')) === null || _a === void 0 ? void 0 : _a[expirationName];\r\n        if (expiration) {\r\n            var splitData = expiration.split('|');\r\n            // for backward compatibility, the first value is expiration\r\n            fixedExpirationDate = stringToDate(splitData[0]);\r\n            fixedCreationDate = stringToDate(splitData[1]);\r\n            fixedMode = !!fixedExpirationDate;\r\n        }\r\n    })();\r\n    var getFixedExpiration = function (options) {\r\n        fixedExpirationDate = fixedExpirationDate || createDateByExpires(options.expires);\r\n        return fixedExpirationDate;\r\n    };\r\n    var getFixedCreation = function () {\r\n        fixedCreationDate = fixedCreationDate || new Date();\r\n        return fixedCreationDate;\r\n    };\r\n    var encodeData = function (data, options) {\r\n        if (fixedMode) {\r\n            fixedExpirationDate = getFixedExpiration(options);\r\n            if (fixedExpirationDate) {\r\n                data[expirationName] = dateToString(fixedExpirationDate) + '|' + dateToString(getFixedCreation());\r\n            }\r\n        }\r\n        else {\r\n            delete data[expirationName];\r\n        }\r\n        return encode(data);\r\n    };\r\n    var decodeData = function (data) {\r\n        var result = decode(data);\r\n        if (result === null || result === void 0 ? void 0 : result[expirationName]) {\r\n            delete result[expirationName];\r\n        }\r\n        return result;\r\n    };\r\n    var bindOptions = function (options) {\r\n        if (fixedMode) {\r\n            fixedExpirationDate = getFixedExpiration(options);\r\n            if (fixedExpirationDate) {\r\n                return __assign(__assign({}, options), { expires: fixedExpirationDate });\r\n            }\r\n        }\r\n        return options;\r\n    };\r\n    return {\r\n        get fixedAt() {\r\n            return fixedMode ? [fixedCreationDate, fixedExpirationDate] : null;\r\n        },\r\n        onChange: function (cb) {\r\n            _onChangeCb = cb;\r\n        },\r\n        setMode: function (val) {\r\n            var prevFixedMode = fixedMode;\r\n            fixedMode = val;\r\n            if (fixedMode !== prevFixedMode) {\r\n                fixedExpirationDate = null;\r\n                fixedCreationDate = null;\r\n                _onChangeCb === null || _onChangeCb === void 0 ? void 0 : _onChangeCb(fixedMode);\r\n            }\r\n        },\r\n        bindOptions: bindOptions,\r\n        decode: decodeData,\r\n        encode: encodeData\r\n    };\r\n};\n\nvar ESSENTIAL_CONFIG = 'essential';\r\nvar OPTIONAL_CONFIG = 'optional';\r\nvar MANDATORY_CONFIG = 'mandatory';\n\nvar createCookieEncoder = function (cookieName, consent, useBase64) {\r\n    if (consent === void 0) { consent = OPTIONAL_CONFIG; }\r\n    if (useBase64 === void 0) { useBase64 = false; }\r\n    return ({\r\n        cookieName: cookieName,\r\n        consent: consent,\r\n        encode: function (data) { return toJSON(data, useBase64); },\r\n        decode: function (data) { return parseJSON(data, true); }\r\n    });\r\n};\r\nvar createCookieWrapper = function (encoder) {\r\n    var cookieName = encoder.cookieName, consent = encoder.consent;\r\n    var cookieInitialData = cookie.get(cookieName);\r\n    var cookieEnabled = !!cookieInitialData;\r\n    var cookieCreated = cookieEnabled;\r\n    var fixedUtils = initFixedUtils(cookieInitialData, encoder);\r\n    var expirationIsUpdated = !!fixedUtils.fixedAt;\r\n    var lazy = cookieEnabled;\r\n    var obfuscatedValue = null;\r\n    var boundedCookieOptions = __assign({}, DEFAULT_COOKIE_OPTIONS);\r\n    var cachedData = null;\r\n    var isEnabled = function () { return cookieEnabled && lazy; };\r\n    var setCookie = function (options) {\r\n        var newOptions = getOptions(options);\r\n        var cookieString = obfuscatedValue || (cachedData ? fixedUtils.encode(cachedData, newOptions) : '');\r\n        // recheck cookie if no value\r\n        // rare case\r\n        if (!cookieString) {\r\n            var raw = cookie.get(cookieName);\r\n            var decodedData = fixedUtils.decode(raw || '');\r\n            cookieString = decodedData ? fixedUtils.encode(decodedData, newOptions) : '';\r\n        }\r\n        if (cookieString) {\r\n            expirationIsUpdated = true;\r\n            cookie.set(cookieName, cookieString, fixedUtils.bindOptions(newOptions));\r\n            cookieCreated = true;\r\n        }\r\n    };\r\n    var getOptions = function (options) { return (__assign(__assign({}, boundedCookieOptions), filterObjectValues(options || {}, isNotEmpty))); };\r\n    var get = function () {\r\n        return fixedUtils.decode(cookie.get(cookieName) || '');\r\n    };\r\n    var set = function (value, options) {\r\n        cachedData = value;\r\n        if (!isEnabled()) {\r\n            return;\r\n        }\r\n        setCookie(options);\r\n    };\r\n    var remove = function (options) {\r\n        if (!isEnabled()) {\r\n            return;\r\n        }\r\n        if (cookieCreated) {\r\n            cookie.remove(cookieName, getOptions(options));\r\n        }\r\n        cookieCreated = false;\r\n    };\r\n    var checkAndCreateCookie = function (enable, lazyActive) {\r\n        var nowEnabled = enable && lazyActive;\r\n        // turn on\r\n        if (!isEnabled() && nowEnabled) {\r\n            setCookie();\r\n        }\r\n        // turn off\r\n        if (isEnabled() && !nowEnabled) {\r\n            remove();\r\n        }\r\n        // just update expiration\r\n        if (isEnabled() && nowEnabled && !expirationIsUpdated) {\r\n            setCookie();\r\n        }\r\n        // save\r\n        cookieEnabled = enable;\r\n        lazy = lazyActive;\r\n    };\r\n    var lazyAction = function () {\r\n        checkAndCreateCookie(cookieEnabled, true);\r\n    };\r\n    var setCookieOptions = function (options) {\r\n        boundedCookieOptions = getOptions(options);\r\n        if (isEnabled()) {\r\n            setCookie();\r\n        }\r\n    };\r\n    var setCookieEnabled = function (enabled, _obfuscatedValue) {\r\n        if (_obfuscatedValue === void 0) { _obfuscatedValue = null; }\r\n        obfuscatedValue = enabled ? _obfuscatedValue : null;\r\n        checkAndCreateCookie(enabled, lazy);\r\n    };\r\n    var setFixedMode = function (val) {\r\n        fixedUtils.setMode(val);\r\n    };\r\n    fixedUtils.onChange(function () {\r\n        if (isEnabled()) {\r\n            expirationIsUpdated = false;\r\n            setCookie();\r\n        }\r\n    });\r\n    return {\r\n        get cookieName() {\r\n            return cookieName;\r\n        },\r\n        get cookieEnabled() {\r\n            return isEnabled();\r\n        },\r\n        get fixedAt() {\r\n            return fixedUtils.fixedAt;\r\n        },\r\n        get consent() {\r\n            return consent;\r\n        },\r\n        set: set,\r\n        get: get,\r\n        remove: remove,\r\n        setCookieOptions: setCookieOptions,\r\n        setCookieEnabled: setCookieEnabled,\r\n        lazyActive: lazyAction,\r\n        setFixedMode: setFixedMode\r\n    };\r\n};\r\nvar createCookieWrappers = function (cookieEncoders) {\r\n    return keys(cookieEncoders).reduce(function (res, cookieName) {\r\n        res[cookieName] = createCookieWrapper(cookieEncoders[cookieName]);\r\n        return res;\r\n    }, {});\r\n};\n\n// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.4\n// private property\n/* tslint:disable */\nvar f = String.fromCharCode;\nvar keyStrUriSafe = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$';\nvar baseReverseDic = {};\n\nfunction _compress(uncompressed, bitsPerChar, getCharFromInt) {\n  if (uncompressed == null) return '';\n  var i,\n    value,\n    context_dictionary = {},\n    context_dictionaryToCreate = {},\n    context_c = '',\n    context_wc = '',\n    context_w = '',\n    context_enlargeIn = 2, // Compensate for the first entry which should not count\n    context_dictSize = 3,\n    context_numBits = 2,\n    context_data = [],\n    context_data_val = 0,\n    context_data_position = 0,\n    ii;\n\n  for (ii = 0; ii < uncompressed.length; ii += 1) {\n    context_c = uncompressed.charAt(ii);\n    if (!Object.prototype.hasOwnProperty.call(context_dictionary, context_c)) {\n      context_dictionary[context_c] = context_dictSize++;\n      context_dictionaryToCreate[context_c] = true;\n    }\n\n    context_wc = context_w + context_c;\n    if (Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)) {\n      context_w = context_wc;\n    } else {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\n        if (context_w.charCodeAt(0) < 256) {\n          for (i = 0; i < context_numBits; i++) {\n            context_data_val = context_data_val << 1;\n            if (context_data_position == bitsPerChar - 1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i = 0; i < 8; i++) {\n            context_data_val = (context_data_val << 1) | (value & 1);\n            if (context_data_position == bitsPerChar - 1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i = 0; i < context_numBits; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar - 1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i = 0; i < 16; i++) {\n            context_data_val = (context_data_val << 1) | (value & 1);\n            if (context_data_position == bitsPerChar - 1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i = 0; i < context_numBits; i++) {\n          context_data_val = (context_data_val << 1) | (value & 1);\n          if (context_data_position == bitsPerChar - 1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n      // Add wc to the dictionary.\n      context_dictionary[context_wc] = context_dictSize++;\n      context_w = String(context_c);\n    }\n  }\n\n  // Output the code for w.\n  if (context_w !== '') {\n    if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate, context_w)) {\n      if (context_w.charCodeAt(0) < 256) {\n        for (i = 0; i < context_numBits; i++) {\n          context_data_val = context_data_val << 1;\n          if (context_data_position == bitsPerChar - 1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n        }\n        value = context_w.charCodeAt(0);\n        for (i = 0; i < 8; i++) {\n          context_data_val = (context_data_val << 1) | (value & 1);\n          if (context_data_position == bitsPerChar - 1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n      } else {\n        value = 1;\n        for (i = 0; i < context_numBits; i++) {\n          context_data_val = (context_data_val << 1) | value;\n          if (context_data_position == bitsPerChar - 1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = 0;\n        }\n        value = context_w.charCodeAt(0);\n        for (i = 0; i < 16; i++) {\n          context_data_val = (context_data_val << 1) | (value & 1);\n          if (context_data_position == bitsPerChar - 1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n      delete context_dictionaryToCreate[context_w];\n    } else {\n      value = context_dictionary[context_w];\n      for (i = 0; i < context_numBits; i++) {\n        context_data_val = (context_data_val << 1) | (value & 1);\n        if (context_data_position == bitsPerChar - 1) {\n          context_data_position = 0;\n          context_data.push(getCharFromInt(context_data_val));\n          context_data_val = 0;\n        } else {\n          context_data_position++;\n        }\n        value = value >> 1;\n      }\n    }\n    context_enlargeIn--;\n    if (context_enlargeIn == 0) {\n      context_enlargeIn = Math.pow(2, context_numBits);\n      context_numBits++;\n    }\n  }\n\n  // Mark the end of the stream\n  value = 2;\n  for (i = 0; i < context_numBits; i++) {\n    context_data_val = (context_data_val << 1) | (value & 1);\n    if (context_data_position == bitsPerChar - 1) {\n      context_data_position = 0;\n      context_data.push(getCharFromInt(context_data_val));\n      context_data_val = 0;\n    } else {\n      context_data_position++;\n    }\n    value = value >> 1;\n  }\n\n  // Flush the last char\n  while (true) {\n    context_data_val = context_data_val << 1;\n    if (context_data_position == bitsPerChar - 1) {\n      context_data.push(getCharFromInt(context_data_val));\n      break;\n    } else context_data_position++;\n  }\n  return context_data.join('');\n}\n\nfunction _decompress(length, resetValue, getNextValue) {\n  var dictionary = [],\n    enlargeIn = 4,\n    dictSize = 4,\n    numBits = 3,\n    entry = '',\n    result = [],\n    i,\n    w,\n    bits,\n    resb,\n    maxpower,\n    power,\n    c,\n    data = { val: getNextValue(0), position: resetValue, index: 1 };\n\n  for (i = 0; i < 3; i += 1) {\n    dictionary[i] = i;\n  }\n\n  bits = 0;\n  maxpower = Math.pow(2, 2);\n  power = 1;\n  while (power != maxpower) {\n    resb = data.val & data.position;\n    data.position >>= 1;\n    if (data.position == 0) {\n      data.position = resetValue;\n      data.val = getNextValue(data.index++);\n    }\n    bits |= (resb > 0 ? 1 : 0) * power;\n    power <<= 1;\n  }\n\n  switch ((bits)) {\n    case 0:\n      bits = 0;\n      maxpower = Math.pow(2, 8);\n      power = 1;\n      while (power != maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb > 0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n      c = f(bits);\n      break;\n    case 1:\n      bits = 0;\n      maxpower = Math.pow(2, 16);\n      power = 1;\n      while (power != maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb > 0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n      c = f(bits);\n      break;\n    case 2:\n      return '';\n  }\n  dictionary[3] = c;\n  w = c;\n  result.push(c);\n  while (true) {\n    if (data.index > length) {\n      return '';\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2, numBits);\n    power = 1;\n    while (power != maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb > 0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch ((c = bits)) {\n      case 0:\n        bits = 0;\n        maxpower = Math.pow(2, 8);\n        power = 1;\n        while (power != maxpower) {\n          resb = data.val & data.position;\n          data.position >>= 1;\n          if (data.position == 0) {\n            data.position = resetValue;\n            data.val = getNextValue(data.index++);\n          }\n          bits |= (resb > 0 ? 1 : 0) * power;\n          power <<= 1;\n        }\n\n        dictionary[dictSize++] = f(bits);\n        c = dictSize - 1;\n        enlargeIn--;\n        break;\n      case 1:\n        bits = 0;\n        maxpower = Math.pow(2, 16);\n        power = 1;\n        while (power != maxpower) {\n          resb = data.val & data.position;\n          data.position >>= 1;\n          if (data.position == 0) {\n            data.position = resetValue;\n            data.val = getNextValue(data.index++);\n          }\n          bits |= (resb > 0 ? 1 : 0) * power;\n          power <<= 1;\n        }\n        dictionary[dictSize++] = f(bits);\n        c = dictSize - 1;\n        enlargeIn--;\n        break;\n      case 2:\n        return result.join('');\n    }\n\n    if (enlargeIn == 0) {\n      enlargeIn = Math.pow(2, numBits);\n      numBits++;\n    }\n\n    if (dictionary[c]) {\n      entry = dictionary[c];\n    } else {\n      if (c === dictSize) {\n        entry = w + w.charAt(0);\n      } else {\n        return null;\n      }\n    }\n    result.push(entry);\n\n    // Add w+entry[0] to the dictionary.\n    dictionary[dictSize++] = w + entry.charAt(0);\n    enlargeIn--;\n\n    w = entry;\n\n    if (enlargeIn == 0) {\n      enlargeIn = Math.pow(2, numBits);\n      numBits++;\n    }\n  }\n}\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i = 0; i < alphabet.length; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\n//compress into a string that is already URI encoded\nfunction compressToEncodedURIComponent(input) {\n  if (input == null) return '';\n  return _compress(input, 6, function (a) {\n    return keyStrUriSafe.charAt(a);\n  });\n}\n\n//decompress from an output of compressToEncodedURIComponent\nfunction decompressFromEncodedURIComponent(input) {\n  if (input == null) return '';\n  if (input == '') return null;\n  input = input.replace(/ /g, '+');\n  return _decompress(input.length, 32, function (index) {\n    return getBaseValue(keyStrUriSafe, input.charAt(index));\n  });\n}\n\nvar ECompressType;\r\n(function (ECompressType) {\r\n    ECompressType[\"URI\"] = \"URI\";\r\n})(ECompressType || (ECompressType = {}));\r\nvar CompressFuncByType = {\r\n    URI: {\r\n        prefix: '{u}',\r\n        compress: compressToEncodedURIComponent,\r\n        decompress: decompressFromEncodedURIComponent\r\n    }\r\n};\r\nvar CompressFuncByPrefix = keys(CompressFuncByType).reduce(function (res, key) {\r\n    res[CompressFuncByType[key].prefix] = CompressFuncByType[key];\r\n    return res;\r\n}, {});\r\nvar compress = function (data, type) {\r\n    if (type === void 0) { type = ECompressType.URI; }\r\n    var inputString = JSON.stringify(data);\r\n    var compressString = CompressFuncByType[type].compress(inputString);\r\n    return CompressFuncByType[type].prefix + compressString;\r\n};\r\nvar decompress = function (data) {\r\n    var prefix = data.slice(0, 3);\r\n    var decompressString = data.slice(3);\r\n    if (!CompressFuncByPrefix[prefix]) {\r\n        return null;\r\n    }\r\n    var decompressedString = CompressFuncByPrefix[prefix].decompress(decompressString);\r\n    if (!decompressedString) {\r\n        return null;\r\n    }\r\n    try {\r\n        return JSON.parse(decompressedString);\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n};\n\n// closed encoded cookie\r\nvar _pctx = {\r\n    cookieName: '_pctx',\r\n    consent: MANDATORY_CONFIG,\r\n    encode: compress,\r\n    decode: function (dataString) {\r\n        var data = decompress(dataString || '');\r\n        if (!isObject(data)) {\r\n            return null;\r\n        }\r\n        return data;\r\n    }\r\n};\n\nvar useJSONPprv = function () { var _a, _b; return !!((_b = (_a = getGlobalConfig$1().cookies) === null || _a === void 0 ? void 0 : _a._pprv) === null || _b === void 0 ? void 0 : _b.jsonOnly); };\r\nvar createCookieEncoders = function () { return ({\r\n    _pprv: createCookieEncoder('_pprv', MANDATORY_CONFIG, !useJSONPprv()),\r\n    _pcid: createCookieEncoder('_pcid', ESSENTIAL_CONFIG),\r\n    _pcus: createCookieEncoder('_pcus', OPTIONAL_CONFIG, true),\r\n    _pctx: _pctx\r\n}); };\r\nvar cookieEncoders = createCookieEncoders();\r\nvar cookieWrappers = createCookieWrappers(cookieEncoders);\n\nvar createCookieAssociation = function () {\r\n    var fields = null;\r\n    var cookieByName = null;\r\n    var registerConfig = function (config) {\r\n        fields = __assign(__assign({}, config.fields), fields);\r\n        cookieByName = __assign(__assign({}, config.cookieByName), cookieByName);\r\n        return cookieByName;\r\n    };\r\n    var get = function () {\r\n        var result = {};\r\n        if (cookieByName) {\r\n            keys(cookieByName).forEach(function (key) {\r\n                result = __assign(__assign({}, result), cookieByName[key].get());\r\n            });\r\n        }\r\n        return result;\r\n    };\r\n    var set = function (data, prevData) {\r\n        if (prevData === void 0) { prevData = null; }\r\n        var groupedData = {};\r\n        // separate data by cookie name\r\n        keys(data).forEach(function (fieldName) {\r\n            var fieldValue = data[fieldName];\r\n            var cookieWrapperName = fields === null || fields === void 0 ? void 0 : fields[fieldName];\r\n            if (cookieWrapperName) {\r\n                if (!groupedData[cookieWrapperName]) {\r\n                    groupedData[cookieWrapperName] = {\r\n                        wrapper: cookieByName === null || cookieByName === void 0 ? void 0 : cookieByName[cookieWrapperName],\r\n                        data: {},\r\n                        update: false,\r\n                        remove: true\r\n                    };\r\n                }\r\n                groupedData[cookieWrapperName].data[fieldName] = fieldValue;\r\n                groupedData[cookieWrapperName].remove = groupedData[cookieWrapperName].remove && fieldValue === null;\r\n                if (!prevData || (!groupedData[cookieWrapperName].update && fieldValue !== prevData[fieldName])) {\r\n                    groupedData[cookieWrapperName].update = true;\r\n                }\r\n            }\r\n        });\r\n        keys(groupedData).forEach(function (key) {\r\n            var _a = groupedData[key], wrapper = _a.wrapper, update = _a.update, remove = _a.remove;\r\n            if (remove) {\r\n                wrapper.remove();\r\n            }\r\n            if (update && !remove) {\r\n                wrapper.set(groupedData[key].data);\r\n            }\r\n        });\r\n    };\r\n    return {\r\n        register: registerConfig,\r\n        get wrappers() {\r\n            return cookieByName;\r\n        },\r\n        get: get,\r\n        set: set\r\n    };\r\n};\n\n// define global object in window to communicate\r\nvar CONNECTION_NAME_OBJ = '__pctx_connection__';\r\nvar KEY = 'uvm42pas28m';\n\nvar emptyObjectData = {};\r\nvar getConnection = function () {\r\n    var cookieAssociation = createCookieAssociation();\r\n    var initCookieData = {};\r\n    var cachedData = null;\r\n    var connections = new Map();\r\n    var protectedKeys = new Map();\r\n    var updateListeners = [];\r\n    var addListener = function (key, cb) {\r\n        updateListeners.push([key, cb]);\r\n    };\r\n    var removeListener = function (key) {\r\n        updateListeners = updateListeners.filter(function (item) { return item[0] !== key; });\r\n    };\r\n    var updateData = function (_, data) {\r\n        var rejectedData = {};\r\n        var newData = {};\r\n        keys(data).forEach(function (key) {\r\n            if (protectedKeys.has(key)) {\r\n                rejectedData[key] = (cachedData === null || cachedData === void 0 ? void 0 : cachedData[key]) || null;\r\n            }\r\n            else {\r\n                newData[key] = data[key];\r\n            }\r\n        });\r\n        var oldCachedData = cachedData || initCookieData;\r\n        var newCachedData = __assign(__assign({}, cachedData), newData);\r\n        if (!shallowEqual(newCachedData, oldCachedData)) {\r\n            cookieAssociation.set(newCachedData, oldCachedData);\r\n            cachedData = newCachedData;\r\n            updateListeners.forEach(function (_a) {\r\n                var cb = _a[1];\r\n                return cb(newData);\r\n            });\r\n        }\r\n        return keys(rejectedData).length > 0 ? rejectedData : null;\r\n    };\r\n    var setProtection = function (connectKey, data, force) {\r\n        if (force === void 0) { force = false; }\r\n        var rejectKeys = [];\r\n        keys(data).forEach(function (key) {\r\n            var value = data[key];\r\n            var actionIsPermitted = !protectedKeys.has(key) || protectedKeys.get(key) === connectKey || force;\r\n            if (value && actionIsPermitted) {\r\n                protectedKeys.set(key, connectKey);\r\n            }\r\n            else if (!value && actionIsPermitted) {\r\n                protectedKeys.delete(key);\r\n            }\r\n            else {\r\n                rejectKeys.push(key);\r\n            }\r\n        });\r\n        return rejectKeys.length > 0 ? rejectKeys : null;\r\n    };\r\n    return function (name, currentCookieConfig) {\r\n        var connectionKey = randomStringCxCompatible();\r\n        connections.set(connectionKey, name);\r\n        if (currentCookieConfig) {\r\n            cookieAssociation.register(currentCookieConfig);\r\n        }\r\n        initCookieData = __assign(__assign({}, cookieAssociation.get()), initCookieData);\r\n        return {\r\n            getInitCookieData: function () { return initCookieData; },\r\n            getCachedData: function () { return cachedData || emptyObjectData; },\r\n            setProtectionData: function (value) {\r\n                return setProtection(connectionKey, value);\r\n            },\r\n            setProtectionDataUnsafe: function (value) {\r\n                return setProtection(connectionKey, value, true);\r\n            },\r\n            updateData: function (data) {\r\n                return updateData(connectionKey, data);\r\n            },\r\n            onUpdateData: function (cb) {\r\n                addListener(connectionKey, cb);\r\n            },\r\n            terminate: function () {\r\n                removeListener(connectionKey);\r\n                connections.delete(connectionKey);\r\n            },\r\n            // TODO to support legacy version\r\n            setCookieOptions: function () { return null; },\r\n            // TODO to support legacy version\r\n            setCookieEnabled: function () { return null; },\r\n            get registeredCookiesWrapper() {\r\n                return cookieAssociation.wrappers;\r\n            }\r\n        };\r\n    };\r\n};\r\n// define global object in window to communicate\r\nvar GENERATE_NEW_CONNECTION = 'mrlqf5trgho';\r\nvar createConnectFn = function (configurable) {\r\n    if (configurable === void 0) { configurable = false; }\r\n    return function (name, cookiesMap) {\r\n        var connection = getConnection();\r\n        // @ts-ignore\r\n        try {\r\n            // Protect from redefine and reading func\r\n            Object.defineProperty(window, CONNECTION_NAME_OBJ, {\r\n                configurable: configurable,\r\n                set: function (cb) {\r\n                    var key = cb();\r\n                    if (key === KEY) {\r\n                        cb(connection);\r\n                        // TODO Warning! Use this key only for testing and debug\r\n                    }\r\n                    else if (key === GENERATE_NEW_CONNECTION) {\r\n                        connection = getConnection();\r\n                    }\r\n                }\r\n            });\r\n            // tslint:disable-next-line no-empty\r\n        }\r\n        catch (e) { }\r\n        // Get common connect function\r\n        // @ts-ignore\r\n        window[CONNECTION_NAME_OBJ] = function (val) {\r\n            if (val) {\r\n                connection = val;\r\n            }\r\n            return KEY;\r\n        };\r\n        return connection(name, cookiesMap);\r\n    };\r\n};\r\nvar connect = createConnectFn();\n\nvar isMask = function (str) { return str.includes('*'); };\r\nvar createMask = function (name, value) { return [\r\n    new RegExp('^' + name.replace(/\\*/g, '.*') + '$'),\r\n    value\r\n]; };\r\nvar itemsToMask = function (items) {\r\n    return keys(items)\r\n        .filter(isMask)\r\n        .map(function (i) { return createMask(i, items[i]); });\r\n};\r\nvar getByMask = function (name, masks) {\r\n    for (var _i = 0, masks_1 = masks; _i < masks_1.length; _i++) {\r\n        var mask = masks_1[_i];\r\n        if (mask[0].test(name)) {\r\n            return mask[1];\r\n        }\r\n    }\r\n    return null;\r\n};\n\nvar getConsentModifier = function (itemType, modifierNoStrict, log) {\r\n    var modifier = modifierNoStrict && validateModifier(modifierNoStrict, log);\r\n    if (!modifier) {\r\n        return null;\r\n    }\r\n    var masks = [];\r\n    var keys = {};\r\n    for (var _i = 0, _a = modifier.patches; _i < _a.length; _i++) {\r\n        var patch = _a[_i];\r\n        var action = patch.action, _b = patch.with, data = _b === void 0 ? null : _b, item = patch.item;\r\n        if (item.type === itemType) {\r\n            var modifierResult = {\r\n                action: action,\r\n                data: data\r\n            };\r\n            keys[item.key] = modifierResult;\r\n            if (isMask(item.key)) {\r\n                masks.push(createMask(item.key, modifierResult));\r\n            }\r\n        }\r\n    }\r\n    var _getModifier = function (name) { return keys[name] || getByMask(name, masks); };\r\n    return {\r\n        source: modifier.source,\r\n        getModifier: _getModifier\r\n    };\r\n};\r\nvar checkMode = function (mode, config) {\r\n    switch (mode) {\r\n        case OPT_IN_MODE:\r\n            return true;\r\n        case ESSENTIAL_MODE:\r\n            return config === ESSENTIAL_CONFIG || config === MANDATORY_CONFIG;\r\n        case OPT_OUT_MODE:\r\n            return config === MANDATORY_CONFIG;\r\n        default:\r\n            // TODO util debug console\r\n            return true;\r\n    }\r\n};\r\nvar checkAction = function (action) {\r\n    switch (action) {\r\n        case 'include':\r\n            return true;\r\n        case 'exclude':\r\n            return false;\r\n        case 'obfuscate':\r\n            return true;\r\n    }\r\n};\r\nvar getData = function (action, data) { return (action === 'obfuscate' ? data : null); };\r\nvar checkProductDisabled = function (productName) {\r\n    if (productName && productName !== RESERVED_PRODUCT) {\r\n        var pdlProducts = getPdlProductNames();\r\n        return !!(pdlProducts && !pdlProducts.includes(productName));\r\n    }\r\n    return false;\r\n};\r\nvar createCheckConsentWrapper = function (config) {\r\n    var productName = config.product || null;\r\n    var items = Object.assign({}, config.items);\r\n    var masks = itemsToMask(items);\r\n    var getConfigByName = function (name) { return items[name] || getByMask(name, masks) || OPTIONAL_CONFIG; };\r\n    function checkConsent(name, consentValue) {\r\n        var requireConsent = getGlobalConfig$1().requireConsent;\r\n        var isSingle = !isArray(name);\r\n        var names = isSingle ? [name] : name;\r\n        var result = (function () {\r\n            var getDefaultResult = function () {\r\n                return names.map(function (cName) { return ({\r\n                    name: cName,\r\n                    allowed: !requireConsent || checkProductDisabled(productName),\r\n                }); });\r\n            };\r\n            var consent = consentValue || config.getConsent();\r\n            if (!consent) {\r\n                return getDefaultResult();\r\n            }\r\n            if (consent.mode === CUSTOM_MODE) {\r\n                var consentModifier_1 = getConsentModifier(config.type, consent.modifier, config.log);\r\n                if (!consentModifier_1) {\r\n                    return getDefaultResult();\r\n                }\r\n                var source_1 = consentModifier_1.source;\r\n                return names.map(function (itemName) {\r\n                    var modifier = consentModifier_1.getModifier(itemName);\r\n                    var data = getData(modifier === null || modifier === void 0 ? void 0 : modifier.action, modifier === null || modifier === void 0 ? void 0 : modifier.data);\r\n                    var item = {\r\n                        name: itemName,\r\n                        allowed: (modifier === null || modifier === void 0 ? void 0 : modifier.action) ? checkAction(modifier.action) : checkMode(source_1, getConfigByName(itemName))\r\n                    };\r\n                    if (data !== null) {\r\n                        item.data = data;\r\n                    }\r\n                    return item;\r\n                });\r\n            }\r\n            return names.map(function (i) { return ({\r\n                name: i,\r\n                allowed: checkMode(consent.mode, getConfigByName(i))\r\n            }); });\r\n        })();\r\n        return isSingle ? result[0] : result;\r\n    }\r\n    return checkConsent;\r\n};\n\nvar checkConsent$1 = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    createCheckConsentWrapper: createCheckConsentWrapper,\n    createMask: createMask,\n    getByMask: getByMask,\n    isMask: isMask,\n    itemsToMask: itemsToMask\n});\n\n// simple local storage reader\r\n// Full version: @sdk-piano/storage\r\nvar localStorageGet = function (name) {\r\n    var getItem = function (key) { return tryFn(function () { return window.localStorage.getItem(key); }); };\r\n    var value = getItem(name);\r\n    var ttl = tryFn(function () { return parseInt(parseJSON(getItem('_ls_ttl'))[name], 36); });\r\n    return ttl && ttl <= Date.now() ? null : value;\r\n};\n\nvar getMigrationValue = (function () {\r\n    var cookies = {\r\n        pa_vid: function (data) { return validateBrowserId(parseJSON(data || '', true) || data); },\r\n        atuserid: function (data) { var _a; return validateBrowserId(((_a = parseJSON(data || '', true)) === null || _a === void 0 ? void 0 : _a.val) || ''); }\r\n    };\r\n    return function (names) {\r\n        var _loop_1 = function (name_1) {\r\n            try {\r\n                var data = (function () {\r\n                    if (name_1.ls) {\r\n                        return localStorageGet(name_1.ls) || null;\r\n                    }\r\n                    var raw = cookie.get(name_1);\r\n                    return cookies[name_1] && raw ? cookies[name_1](raw) : raw;\r\n                })();\r\n                if (data) {\r\n                    return { value: data };\r\n                }\r\n                // tslint:disable-next-line no-empty\r\n            }\r\n            catch (e) { }\r\n        };\r\n        for (var _i = 0, names_1 = names; _i < names_1.length; _i++) {\r\n            var name_1 = names_1[_i];\r\n            var state_1 = _loop_1(name_1);\r\n            if (typeof state_1 === \"object\")\r\n                return state_1.value;\r\n        }\r\n        return null;\r\n    };\r\n})();\r\nvar migrationMaps = {\r\n    PA: {\r\n        browserId: ['pa_vid', 'atuserid']\r\n    }\r\n};\r\nvar migrate = function (_private) {\r\n    var _a;\r\n    var migrationData = __assign({}, validateMigration((_a = getGlobalConfig$1()) === null || _a === void 0 ? void 0 : _a.migration));\r\n    keys(migrationData).forEach(function (propName) {\r\n        var _a, _b;\r\n        var param = _private.params.get(propName);\r\n        var product = (_a = migrationData[propName]) === null || _a === void 0 ? void 0 : _a.source;\r\n        var configs = (product && ((_b = migrationMaps[product]) === null || _b === void 0 ? void 0 : _b[propName])) || [];\r\n        if (param && configs.length) {\r\n            var fromGlobalConfig = getGlobalConfig$1()[propName];\r\n            var migrationValue = getMigrationValue(configs);\r\n            if (migrationValue && !fromGlobalConfig) {\r\n                param.readonly = false;\r\n                _private.updateValues(propName, migrationValue, true); // force update from migrated value\r\n                param.readonly = true; // prohibit overwriting value\r\n            }\r\n        }\r\n    });\r\n};\n\nvar PREFIX = '@@Data-layer/';\r\nvar UPDATE_VALUE = PREFIX + 'update_value';\r\nvar REFRESH_VALUE = PREFIX + 'refresh_value';\r\nvar REFRESH_LOCKED_KEY = PREFIX + 'refresh_locked_key';\r\nvar getGlobalConfig = function () {\r\n    // @ts-ignore\r\n    var config = __assign({}, window[GLOBAL_CONFIG_NAME]);\r\n    var validateCookieOption = function (cookieOptions) {\r\n        return validateObj(cookieOptions, {\r\n            path: String,\r\n            domain: String,\r\n            secure: toBoolean,\r\n            expires: function (val) { return (val instanceof Date ? val : Number(val)); },\r\n            samesite: function (val) {\r\n                if (isString(val)) {\r\n                    return val;\r\n                }\r\n                return toBoolean(val);\r\n            }\r\n        });\r\n    };\r\n    if (config === null || config === void 0 ? void 0 : config.cookies) {\r\n        config.cookies = keys(config.cookies).reduce(function (res, cookieName) {\r\n            res[cookieName] = validateCookieOption(config.cookies[cookieName]);\r\n            return res;\r\n        }, {});\r\n    }\r\n    if (config === null || config === void 0 ? void 0 : config.cookieDefault) {\r\n        config.cookieDefault = validateCookieOption(config.cookieDefault);\r\n    }\r\n    return config;\r\n};\r\nvar DataLayer = function (paramsArgs, cookiesArgs, onInit) {\r\n    var cookieConfig = combineCookieConfig(paramsArgs, cookiesArgs);\r\n    var syncConnection = connect('data-layer', cookieConfig);\r\n    // Local cached values. They always sync with cookies and other Storages\r\n    var cachedValue;\r\n    var ready = false;\r\n    var listenersByNames = new Map();\r\n    var listenersCommon = new Set();\r\n    var params = new Map();\r\n    var getConnection = function () {\r\n        if (!syncConnection) {\r\n            throw new Error(\"DataLayer can't be connected\");\r\n        }\r\n        return syncConnection;\r\n    };\r\n    var getCookieWrappers = function (cb) {\r\n        var cookieWrappers = getConnection().registeredCookiesWrapper;\r\n        if (cookieWrappers) {\r\n            cb(cookieWrappers);\r\n        }\r\n    };\r\n    var setCookieEnabled = function (cookiesEnabled) {\r\n        getCookieWrappers(function (cookieWrappers) {\r\n            var cookieNames = keys(cookiesEnabled);\r\n            if (cookieNames.length) {\r\n                cookieNames.forEach(function (cookieName) {\r\n                    var wrapper = cookieWrappers[cookieName];\r\n                    if (wrapper) {\r\n                        wrapper.setCookieEnabled(cookiesEnabled[cookieName]);\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                keys(cookieWrappers).forEach(function (key) {\r\n                    cookieWrappers[key].setCookieEnabled(cookiesEnabled);\r\n                });\r\n            }\r\n        });\r\n    };\r\n    var resolveCookieLazyAction = function (cookieNames) {\r\n        getCookieWrappers(function (cookieWrappers) {\r\n            cookieNames.forEach(function (cookieName) {\r\n                var wrapper = cookieWrappers[cookieName];\r\n                if (wrapper) {\r\n                    wrapper.lazyActive();\r\n                }\r\n            });\r\n        });\r\n    };\r\n    var getCookieConfig = function () {\r\n        var result = null;\r\n        getCookieWrappers(function (cookieWrappers) {\r\n            result = keys(cookieWrappers).reduce(function (res, key) {\r\n                var enabled = cookieWrappers[key].cookieEnabled;\r\n                var fixedAt = cookieWrappers[key].fixedAt || null;\r\n                var cookieName = cookieWrappers[key].cookieName;\r\n                res[cookieName] = enabled\r\n                    ? {\r\n                        enabled: enabled,\r\n                        fixedAt: fixedAt\r\n                    }\r\n                    : null;\r\n                return res;\r\n            }, {});\r\n        });\r\n        return result;\r\n    };\r\n    // Init global options\r\n    var initConfig = function (config) {\r\n        var globalConfig = __assign(__assign({}, config), getGlobalConfig());\r\n        var cookieOptions = globalConfig.cookieDefault;\r\n        // set cookie options on each cookie wrapper\r\n        getCookieWrappers(function (cookieWrappers) {\r\n            keys(cookieWrappers).forEach(function (key) {\r\n                var _a, _b, _c, _d;\r\n                var cookieName = cookieWrappers[key].cookieName;\r\n                var options = (_a = globalConfig.cookies) === null || _a === void 0 ? void 0 : _a[cookieName];\r\n                var fixedMode = ((_b = globalConfig.cookies) === null || _b === void 0 ? void 0 : _b.storageMode) === 'fixed';\r\n                (_d = (_c = cookieWrappers[key]).setFixedMode) === null || _d === void 0 ? void 0 : _d.call(_c, fixedMode); // backwards compatibility with DL2.5.1\r\n                if (cookieOptions || options) {\r\n                    cookieWrappers[key].setCookieOptions(__assign(__assign({}, cookieOptions), options));\r\n                }\r\n            });\r\n        });\r\n    };\r\n    var createConfigParameters = function () {\r\n        var configs = {};\r\n        var getValuesByPropName = function (propName) {\r\n            return keys(configs).reduce(function (res, key) {\r\n                var config = configs[key];\r\n                if (config[propName] !== undefined) {\r\n                    res[key] = config[propName];\r\n                }\r\n                return res;\r\n            }, {});\r\n        };\r\n        var updateProtection = function () {\r\n            var values = getValuesByPropName('protect');\r\n            if (keys(values).length > 0) {\r\n                getConnection().setProtectionData(values);\r\n            }\r\n        };\r\n        var updateProtectionUnsafe = function () {\r\n            var values = getValuesByPropName('protectUnsafe');\r\n            if (keys(values).length > 0) {\r\n                getConnection().setProtectionDataUnsafe(values);\r\n            }\r\n        };\r\n        return {\r\n            add: function (key, config) {\r\n                configs[key] = config;\r\n            },\r\n            call: function () {\r\n                updateProtection();\r\n                updateProtectionUnsafe();\r\n            }\r\n        };\r\n    };\r\n    var normalizeCachedValue = function (cachedValues, cb) {\r\n        return keys(cachedValues).reduce(function (result, paramName) {\r\n            var param = params.get(paramName);\r\n            var value = cachedValues[paramName];\r\n            if (param) {\r\n                result[paramName] = cb ? cb(param, value) : param.get(value);\r\n            }\r\n            return result;\r\n        }, {});\r\n    };\r\n    var _getPrivateContext = function () { return ({\r\n        params: params,\r\n        getConnection: getConnection,\r\n        addChangeListener: addChangeListener,\r\n        get: get,\r\n        updateValues: updateValues\r\n    }); };\r\n    var init = function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        if (ready) {\r\n            return;\r\n        }\r\n        if (!syncConnection) {\r\n            syncConnection = connect('data-layer', cookieConfig);\r\n        }\r\n        initConfig(options);\r\n        ready = true;\r\n        keys(paramsArgs).forEach(function (key) {\r\n            var param = paramsArgs[key];\r\n            listenersByNames.set(key, new Set());\r\n            params.set(key, param);\r\n        });\r\n        var needToUpdateCookie = false;\r\n        var initCookieData = getConnection().getInitCookieData();\r\n        var cachedData = getConnection().getCachedData();\r\n        var configToChange = createConfigParameters();\r\n        var initData = keys(paramsArgs).reduce(function (res, key) {\r\n            var _key = key;\r\n            var param = paramsArgs[key];\r\n            res[key] =\r\n                (cachedData === null || cachedData === void 0 ? void 0 : cachedData[_key]) ||\r\n                    param.init(initCookieData === null || initCookieData === void 0 ? void 0 : initCookieData[_key], function (config) {\r\n                        configToChange.add(_key, config);\r\n                    });\r\n            if (!(cachedData === null || cachedData === void 0 ? void 0 : cachedData[_key])) {\r\n                needToUpdateCookie = true;\r\n            }\r\n            return res;\r\n        }, {});\r\n        cachedValue = initData;\r\n        // In the case of different versions, syncConnection may not have some data, so we must initialize them and save\r\n        if (needToUpdateCookie) {\r\n            getConnection().updateData(initData);\r\n        }\r\n        configToChange.call();\r\n        getConnection().onUpdateData(function (data) { return onUpdateData(data); });\r\n        onInit === null || onInit === void 0 ? void 0 : onInit(_getPrivateContext());\r\n    };\r\n    var onUpdateData = function (data) {\r\n        var cachedValueWasUpdated = false;\r\n        keys(data).forEach(function (key) {\r\n            var _a;\r\n            var _key = key;\r\n            var param = params.get(_key);\r\n            if (param) {\r\n                var value_1 = data[_key];\r\n                var prevValue = cachedValue[_key];\r\n                if (prevValue !== value_1) {\r\n                    cachedValue[_key] = value_1;\r\n                    cachedValueWasUpdated = true;\r\n                    // todo set logs in debug mode\r\n                    (_a = listenersByNames.get(_key)) === null || _a === void 0 ? void 0 : _a.forEach(function (cb) { return cb(param.get(value_1)); });\r\n                }\r\n            }\r\n        });\r\n        if (cachedValueWasUpdated) {\r\n            listenersCommon.forEach(function (cb) { return cb(normalizeCachedValue(cachedValue)); });\r\n        }\r\n    };\r\n    var updateValues = function (arg1, arg2, force) {\r\n        var _a;\r\n        if (force === void 0) { force = false; }\r\n        var data = arg1;\r\n        var cookiesActions = stringSet();\r\n        if (isString(arg1)) {\r\n            data = (_a = {}, _a[arg1] = arg2, _a);\r\n        }\r\n        var configsToResetProtection = createConfigParameters();\r\n        var configsToChange = createConfigParameters();\r\n        data = keys(data).reduce(function (res, key) {\r\n            var value = data[key];\r\n            var param = params.get(key);\r\n            var keyString = key;\r\n            if (param === null || param === void 0 ? void 0 : param.readonly) {\r\n                return res;\r\n            }\r\n            if (param && param.cookieName) {\r\n                cookiesActions.add(param.cookieName);\r\n            }\r\n            if (!param || value === cachedValue[key]) {\r\n                return res;\r\n            }\r\n            if (value === REFRESH_VALUE) {\r\n                res[key] = param.refresh(cachedValue[key], function (config) {\r\n                    // change parameter config after updating\r\n                    configsToChange.add(keyString, config);\r\n                });\r\n                // If value was updated\r\n                if (res[key] !== cachedValue[key]) {\r\n                    // So we need to reset protection for parameter\r\n                    configsToResetProtection.add(keyString, { protectUnsafe: false });\r\n                }\r\n                return res;\r\n            }\r\n            if (value === UPDATE_VALUE) {\r\n                res[key] = param.update(cachedValue[key], function (config) {\r\n                    configsToChange.add(keyString, config);\r\n                });\r\n                return res;\r\n            }\r\n            res[key] = param.set(value, cachedValue[key], function (config) {\r\n                configsToChange.add(keyString, config);\r\n            });\r\n            return res;\r\n        }, {});\r\n        resolveCookieLazyAction(cookiesActions.values());\r\n        // reset protection\r\n        configsToResetProtection.call();\r\n        var rejectedData = getConnection().updateData(data);\r\n        if (rejectedData && force) {\r\n            // reset protection for rejected data\r\n            var unprotectKeys = keys(rejectedData).reduce(function (res, key) {\r\n                var _a;\r\n                return (__assign(__assign({}, res), (_a = {}, _a[key] = false, _a)));\r\n            }, {});\r\n            getConnection().setProtectionDataUnsafe(unprotectKeys);\r\n            getConnection().updateData(data);\r\n        }\r\n        // Update configs of params\r\n        configsToChange.call();\r\n        return rejectedData && normalizeCachedValue(rejectedData);\r\n    };\r\n    function get(arg1) {\r\n        var _a;\r\n        var cookiesActions = stringSet();\r\n        var isSingleValue = isString(arg1);\r\n        var result;\r\n        // all data\r\n        if (arg1 === undefined) {\r\n            result = cachedValue;\r\n        }\r\n        else if (isSingleValue) {\r\n            result = (_a = {}, _a[arg1] = cachedValue[arg1], _a);\r\n        }\r\n        else {\r\n            // specific values\r\n            result = arg1.reduce(function (res, key) {\r\n                if (params.has(key)) {\r\n                    res[key] = cachedValue[key];\r\n                }\r\n                return res;\r\n            }, {});\r\n        }\r\n        result = normalizeCachedValue(result, function (param, value) {\r\n            if (param.cookieName) {\r\n                cookiesActions.add(param.cookieName);\r\n            }\r\n            return param.get(value);\r\n        });\r\n        resolveCookieLazyAction(cookiesActions.values());\r\n        return isSingleValue ? result[arg1] : result;\r\n    }\r\n    function set(arg1, arg2) {\r\n        return updateValues(arg1, arg2, false);\r\n    }\r\n    function setUnsafe(arg1, arg2) {\r\n        updateValues(arg1, arg2, true);\r\n    }\r\n    var updateSafeUnsafe = function (arg1, unsafe) {\r\n        if (unsafe === void 0) { unsafe = false; }\r\n        var names = arg1;\r\n        if (!isArray(arg1)) {\r\n            names = [arg1];\r\n        }\r\n        return updateValues(names.reduce(function (res, name) {\r\n            res[name] = UPDATE_VALUE;\r\n            return res;\r\n        }, {}), undefined, unsafe);\r\n    };\r\n    var update = function (arg1) {\r\n        return updateSafeUnsafe(arg1);\r\n    };\r\n    var updateUnsafe = function (arg1) {\r\n        return updateSafeUnsafe(arg1, true);\r\n    };\r\n    var protectPrivate = function (arg1, arg2, force) {\r\n        var _a;\r\n        if (force === void 0) { force = false; }\r\n        var protectMethod = force ? getConnection().setProtectionDataUnsafe : getConnection().setProtectionData;\r\n        var values = arg1;\r\n        if (isString(arg1)) {\r\n            values = (_a = {}, _a[arg1] = arg2, _a);\r\n        }\r\n        // @ts-ignore\r\n        return protectMethod(values);\r\n    };\r\n    function protect(arg1, arg2) {\r\n        return protectPrivate(arg1, arg2);\r\n    }\r\n    function protectUnsafe(arg1, arg2) {\r\n        return protectPrivate(arg1, arg2, true);\r\n    }\r\n    function addChangeListener(arg1, arg2) {\r\n        var _a;\r\n        if (isString(arg1)) {\r\n            (_a = listenersByNames.get(arg1)) === null || _a === void 0 ? void 0 : _a.add(arg2);\r\n            return;\r\n        }\r\n        listenersCommon.add(arg1);\r\n    }\r\n    var removeChangeListener = function (cb) {\r\n        listenersCommon.delete(cb);\r\n        listenersByNames.forEach(function (listeners) { return listeners.delete(cb); });\r\n    };\r\n    var refresh = function () {\r\n        var _a;\r\n        if (getConnection().setProtectionData((_a = {},\r\n            _a[REFRESH_LOCKED_KEY] = true,\r\n            _a))) {\r\n            return false;\r\n        }\r\n        var paramKeys = [];\r\n        params.forEach(function (_v, key) { return paramKeys.push(key); });\r\n        var refreshData = paramKeys.reduce(function (res, key) {\r\n            res[key] = REFRESH_VALUE;\r\n            return res;\r\n        }, {});\r\n        updateValues(refreshData);\r\n        return true;\r\n    };\r\n    var terminate = function () {\r\n        syncConnection === null || syncConnection === void 0 ? void 0 : syncConnection.terminate();\r\n        listenersByNames.clear();\r\n        listenersCommon.clear();\r\n        syncConnection = null;\r\n        ready = false;\r\n        cachedValue = {};\r\n    };\r\n    var updateMigration = function () {\r\n        if (ready) {\r\n            // @ts-ignore\r\n            migrate(_getPrivateContext());\r\n        }\r\n    };\r\n    function setConsent(arg1, arg2, arg3) {\r\n        // @ts-ignore\r\n        var consent = get('consent');\r\n        // @ts-ignore\r\n        var purposes = get('purposes');\r\n        var result = setExtendedConsent(purposes, consent, arg1, arg2, arg3);\r\n        if (!result) {\r\n            return null;\r\n        }\r\n        if (result.error) {\r\n            return result.error;\r\n        }\r\n        set({\r\n            // @ts-ignore\r\n            consent: result.consent,\r\n            purposes: result.purposes\r\n        });\r\n        return null;\r\n    }\r\n    var getConsent = function () {\r\n        // @ts-ignore\r\n        var _a = get(['consent', 'purposes']), consent = _a.consent, purposes = _a.purposes;\r\n        return getExtendedConsent(consent, purposes);\r\n    };\r\n    return {\r\n        init: init,\r\n        set: set,\r\n        get: get,\r\n        update: update,\r\n        refresh: refresh,\r\n        protect: protect,\r\n        addChangeListener: addChangeListener,\r\n        removeChangeListener: removeChangeListener,\r\n        terminate: terminate,\r\n        updateMigration: updateMigration,\r\n        get isReady() {\r\n            return ready;\r\n        },\r\n        utils: {\r\n            validateModifier: validateModifier,\r\n            validateConsent: validateConsent$1,\r\n            checkConsent: checkConsent$1,\r\n            setConsent: setConsent,\r\n            getConsent: getConsent,\r\n            notAcquiredConsent: getNotAcquiredConsent(),\r\n            compressLz: compressToEncodedURIComponent,\r\n            decompressLz: decompressFromEncodedURIComponent\r\n        },\r\n        get cookies() {\r\n            return getCookieConfig();\r\n        },\r\n        // deprecated methods\r\n        get cookieEnabled() {\r\n            return getCookieConfig();\r\n        },\r\n        setUnsafe: setUnsafe,\r\n        protectUnsafe: protectUnsafe,\r\n        updateUnsafe: updateUnsafe,\r\n        setCookieEnabled: setCookieEnabled\r\n    };\r\n};\n\nvar isPAConsentOnly = function (con) {\r\n    var _a, _b;\r\n    var conf = getGlobalConfig$1();\r\n    var products = ((_a = conf.consent) === null || _a === void 0 ? void 0 : _a.products) || [];\r\n    var paOnly = products.length === 1 && products[0] === 'PA';\r\n    var isOptOut = ((_b = con === null || con === void 0 ? void 0 : con.PA) === null || _b === void 0 ? void 0 : _b.mode) === 'opt-out';\r\n    return !!conf.requireConsent && paOnly && isOptOut;\r\n};\r\nvar getCookieProhibition = function (con) {\r\n    var prohibitForPaProducts = isPAConsentOnly(con);\r\n    return {\r\n        _pprv: !getGlobalConfig$1().requireConsent,\r\n        _pctx: prohibitForPaProducts,\r\n        _pcid: prohibitForPaProducts,\r\n        _pcus: prohibitForPaProducts\r\n    };\r\n};\r\nvar checkConsent = function (_private) {\r\n    var _a;\r\n    var items = keys(cookieEncoders).reduce(function (res, cookieName) {\r\n        res[cookieName] = cookieEncoders[cookieName].consent;\r\n        return res;\r\n    }, {});\r\n    var getConsent = function (data) { var _a; return data || ((_a = _private.get('consent')) === null || _a === void 0 ? void 0 : _a.DL) || null; };\r\n    var check = createCheckConsentWrapper({\r\n        items: items,\r\n        type: 'cookie',\r\n        getConsent: getConsent\r\n    });\r\n    var prevValueDlConsent = getConsent();\r\n    var prevValuePAConsent = ((_a = _private.get('consent')) === null || _a === void 0 ? void 0 : _a.PA) || null;\r\n    var checkCookieWrappers = function (con, allConsents) {\r\n        var _a;\r\n        var prohibition = getCookieProhibition(allConsents);\r\n        var cookieWrapperMap = (_a = _private.getConnection()) === null || _a === void 0 ? void 0 : _a.registeredCookiesWrapper;\r\n        if (cookieWrapperMap) {\r\n            var names = keys(cookieWrapperMap).map(function (key) { return cookieWrapperMap[key].cookieName; });\r\n            check(names, con).forEach(function (_a) {\r\n                var name = _a.name, allowed = _a.allowed, data = _a.data;\r\n                var cookieName = name;\r\n                var cookieAllowed = allowed && !prohibition[cookieName];\r\n                cookieWrapperMap[cookieName].setCookieEnabled(cookieAllowed, data || null);\r\n            });\r\n        }\r\n    };\r\n    _private.addChangeListener('consent', function (data) {\r\n        var newDLValue = (data === null || data === void 0 ? void 0 : data.DL) || null;\r\n        var newPAValue = (data === null || data === void 0 ? void 0 : data.PA) || null;\r\n        if ((prevValueDlConsent === null || prevValueDlConsent === void 0 ? void 0 : prevValueDlConsent.mode) !== (newDLValue === null || newDLValue === void 0 ? void 0 : newDLValue.mode) || (prevValuePAConsent === null || prevValuePAConsent === void 0 ? void 0 : prevValuePAConsent.mode) !== (newPAValue === null || newPAValue === void 0 ? void 0 : newPAValue.mode)) {\r\n            prevValueDlConsent = newDLValue;\r\n            prevValuePAConsent = newPAValue;\r\n            checkCookieWrappers(newDLValue, data);\r\n        }\r\n    });\r\n    checkCookieWrappers(prevValueDlConsent, _private.get('consent'));\r\n};\n\nvar log = function (product, mode, type) {\r\n    var prefix = type === 1 ? 'can not be' : 'was';\r\n    // tslint:disable-next-line\r\n    console.warn(\"[DL]: Consent v2: the \\\"\".concat(product, \"\\\" has a conflicted consent mode, \") + \"mode \".concat(prefix, \" changed to \\\"\").concat(mode, \"\\\"\"));\r\n};\r\nvar validateConsent = function (_private) {\r\n    var timer = null;\r\n    var customInvalidProducts = {};\r\n    var validate = function (consent) {\r\n        var currentConsent = getExtendedConsent(consent, _private.get('purposes'));\r\n        if (currentConsent && consent) {\r\n            var needUpdate_1 = false;\r\n            var newConsent = keys(currentConsent).reduce(function (res, key) {\r\n                var newMode = currentConsent[key].mode;\r\n                currentConsent[key].products.forEach(function (productName) {\r\n                    var _a;\r\n                    if (newMode !== ((_a = consent[productName]) === null || _a === void 0 ? void 0 : _a.mode)) {\r\n                        if (isInvalidCustomMode(newMode, productName)) {\r\n                            if (!customInvalidProducts[productName]) {\r\n                                customInvalidProducts[productName] = true;\r\n                                log(productName, newMode, 1);\r\n                            }\r\n                        }\r\n                        else {\r\n                            res[productName] = { mode: newMode };\r\n                            needUpdate_1 = true;\r\n                            log(productName, newMode, 2);\r\n                        }\r\n                    }\r\n                });\r\n                return res;\r\n            }, {});\r\n            if (needUpdate_1) {\r\n                _private.updateValues({ consent: newConsent });\r\n            }\r\n        }\r\n    };\r\n    _private.addChangeListener('consent', function (consent) {\r\n        if (isRequireConsentV2()) {\r\n            if (timer) {\r\n                clearTimeout(timer);\r\n                timer = null;\r\n            }\r\n            timer = setTimeout(function () {\r\n                validate(consent);\r\n                timer = null;\r\n            }, 200);\r\n        }\r\n    });\r\n    if (isRequireConsentV2()) {\r\n        validate(_private.get('consent'));\r\n    }\r\n};\n\nvar onDataLayerInit = function (_private) {\r\n    checkConsent(_private);\r\n    migrate(_private);\r\n    validateConsent(_private);\r\n};\n\nvar dataLayer = DataLayer(PropertiesMap, cookieWrappers, onDataLayerInit);\n\nexport { dataLayer, dataLayer as default };\n", "\"use strict\";\nimport { localStorage } from \"@piano-sdk/storage\";\nvar createConsentWrapper = function createConsentWrapper(config) {\n  return function () {\n    var consent2 = config.dataLayer.get(\"consent\");\n    return consent2 && consent2[config.productName] || null;\n  };\n};\nvar onDlChangeConsent = function onDlChangeConsent(config, cb) {\n  var prevValue = null;\n  var _onChangeHandler = function _onChangeHandler(data) {\n    var consent2 = (data === null || data === void 0 ? void 0 : data[config.productName]) || null;\n    if (consent2 !== prevValue) {\n      prevValue = consent2;\n      cb(consent2);\n    }\n  };\n  config.dataLayer.addChangeListener(\"consent\", _onChangeHandler);\n  return function () {\n    config.dataLayer.removeChangeListener(_onChangeHandler);\n  };\n};\nvar createCheckConsentWrapper = function createCheckConsentWrapper(dataLayer, config) {\n  return dataLayer.utils.checkConsent.createCheckConsentWrapper(config);\n};\nvar itemsToNames = function itemsToNames(dataLayer, items, getNames) {\n  var utils = dataLayer.utils.checkConsent;\n  var masks = utils.itemsToMask(items);\n  var keys = Object.keys(items).filter(function (key) {\n    return !utils.isMask(key);\n  });\n  return getNames().filter(function (name) {\n    return keys.includes(name) || utils.getByMask(name, masks);\n  });\n};\nvar createBaseConsentStorage = function createBaseConsentStorage(storage2, itemType, config) {\n  var getConsent = createConsentWrapper(config);\n  var checkProperty = createCheckConsentWrapper(config.dataLayer, {\n    items: config.items,\n    type: itemType,\n    getConsent: getConsent,\n    product: config.productName\n  });\n  var _init = function _init() {\n    var removeOnInit = config.checkConsentOnInit === void 0 ? config.enableAutoRemove : false;\n    if (config.enableAutoRemove) {\n      onDlChangeConsent(config, onChangeConsentMode);\n    }\n    if (removeOnInit) {\n      onChangeConsentMode(getConsent());\n    }\n  };\n  var onChangeConsentMode = function onChangeConsentMode(consent2) {\n    var _a;\n    (_a = checkProperty(itemsToNames(config.dataLayer, config.items, storage2.getNames), consent2)) === null || _a === void 0 ? void 0 : _a.forEach(function (item) {\n      if (!item.allowed) {\n        storage2.remove(item.name);\n      } else if (item.data) {\n        storage2.set(item.name, item.data);\n      }\n    });\n  };\n  var set = function set(name, value, options) {\n    var _a;\n    var consent2 = checkProperty(name);\n    if (consent2 === null || consent2 === void 0 ? void 0 : consent2.allowed) {\n      var newValue = (_a = consent2.data) !== null && _a !== void 0 ? _a : value;\n      var args = options ? [name, newValue, options] : [name, newValue];\n      storage2.set.apply(null, args);\n    }\n  };\n  _init();\n  return Object.assign({}, storage2, {\n    set: set,\n    check: checkProperty\n  });\n};\nvar createTTLChecker = function createTTLChecker(dataLayer) {\n  var name = localStorage.__protected__.ttlName;\n  var config = {\n    dataLayer: dataLayer,\n    productName: \"DL\"\n  };\n  var check = function () {\n    var _a;\n    var checker = createCheckConsentWrapper(config.dataLayer, {\n      items: (_a = {}, _a[name] = \"mandatory\", _a),\n      type: \"localStorage\",\n      getConsent: createConsentWrapper(config),\n      product: config.productName\n    });\n    return function () {\n      var result = checker(name);\n      return result.allowed && !result.data;\n    };\n  }();\n  var allowed = true;\n  var updateMemoValue = function updateMemoValue() {\n    allowed = check();\n    if (!allowed) {\n      localStorage.remove(name);\n    }\n  };\n  onDlChangeConsent(config, updateMemoValue);\n  updateMemoValue();\n  return function () {\n    return allowed;\n  };\n};\nvar createLocalStorage = function createLocalStorage(config) {\n  var checkTTL = createTTLChecker(config.dataLayer);\n  var lsConsent = createBaseConsentStorage(localStorage, \"localStorage\", config);\n  var set = function set(name, value, options) {\n    var newOptions = options;\n    if ((options === null || options === void 0 ? void 0 : options.expires) && !checkTTL()) {\n      newOptions = Object.assign({}, options);\n      delete newOptions.expires;\n    }\n    return lsConsent.set(name, value, newOptions);\n  };\n  return Object.assign({}, lsConsent, {\n    set: set\n  });\n};\nimport { cookie } from \"@piano-sdk/storage\";\nvar ITEM_TYPE = \"cookie\";\nvar createCookie = function createCookie(config) {\n  var consentUtils = config.dataLayer.utils.checkConsent;\n  var getConsent = createConsentWrapper(config);\n  var cookieOptionsByCookie = {};\n  var cookieOptionsByMasks = [];\n  var items = {};\n  var cookieOptions = {};\n  (function () {\n    Object.keys(config.items).forEach(function (itemName) {\n      var option = config.items[itemName];\n      if (option.type) {\n        var _a = option,\n          type = _a.type,\n          domain = _a.domain,\n          path = _a.path;\n        var options = {};\n        items[itemName] = type;\n        if (domain) {\n          options.domain = domain;\n        }\n        if (path) {\n          options.path = path;\n        }\n        if (consentUtils.isMask(itemName)) {\n          cookieOptionsByMasks.push(consentUtils.createMask(itemName, options));\n        } else {\n          cookieOptionsByCookie[itemName] = options;\n        }\n      } else {\n        items[itemName] = option;\n      }\n    });\n  })();\n  var checkProperty = createCheckConsentWrapper(config.dataLayer, {\n    items: items,\n    type: ITEM_TYPE,\n    getConsent: getConsent,\n    product: config.productName\n  });\n  var _init = function _init() {\n    var removeOnInit = !!(config.checkConsentOnInit === void 0 ? config.enableAutoRemove : false);\n    if (config.enableAutoRemove) {\n      cookieOptions = config.enableAutoRemove;\n      onDlChangeConsent(config, onChangeConsentMode);\n    }\n    if (removeOnInit) {\n      onChangeConsentMode(getConsent());\n    }\n  };\n  var onChangeConsentMode = function onChangeConsentMode(consent2) {\n    var _a;\n    (_a = checkProperty(itemsToNames(config.dataLayer, items, cookie.getNames), consent2)) === null || _a === void 0 ? void 0 : _a.forEach(function (item) {\n      var getOptions = function getOptions() {\n        return cookieOptionsByCookie[item.name] || consentUtils.getByMask(item.name, cookieOptionsByMasks) || cookieOptions;\n      };\n      if (!item.allowed) {\n        cookie.remove(item.name, getOptions());\n      } else if (item.data) {\n        cookie.set(item.name, item.data, getOptions());\n      }\n    });\n  };\n  _init();\n  var set = function set(name, value, options, limitValue) {\n    var _a;\n    var consent2 = checkProperty(name);\n    if (consent2 === null || consent2 === void 0 ? void 0 : consent2.allowed) {\n      cookie.set(name, (_a = consent2.data) !== null && _a !== void 0 ? _a : value, options, limitValue);\n    }\n  };\n  return Object.assign({}, cookie, {\n    check: checkProperty,\n    set: set\n  });\n};\nimport { sessionStorage } from \"@piano-sdk/storage\";\nvar createSessionStorage = function createSessionStorage(config) {\n  return createBaseConsentStorage(sessionStorage, \"sessionStorage\", config);\n};\nvar createBasePropertyWrapper = function createBasePropertyWrapper(itemType, config) {\n  return {\n    check: createCheckConsentWrapper(config.dataLayer, {\n      items: config.items,\n      type: itemType,\n      getConsent: createConsentWrapper(config),\n      product: config.productName\n    })\n  };\n};\nvar createProperty = function createProperty(config) {\n  return createBasePropertyWrapper(\"property\", config);\n};\nvar createEvent = function createEvent(config) {\n  return createBasePropertyWrapper(\"event\", config);\n};\nimport * as storage from \"@piano-sdk/storage\";\nvar consent = {\n  createLocalStorage: createLocalStorage,\n  createProperty: createProperty,\n  createCookie: createCookie,\n  createSessionStorage: createSessionStorage,\n  createEvent: createEvent\n};\nexport { consent, storage };", "export type DeprecatedMethods<T extends Record<string, Function>> = {\n  [K in keyof T]: T[K] & { skipLog: T[K] };\n}\n\nexport const deprecatedMethods = <T extends Record<string, any>>(obj: T, prefix = ''): DeprecatedMethods<T> => {\n  function deprecated<T extends Function & {skipLog: Function }>(fn: T, methodName = 'Method'): T {\n    const resultFn = function() {\n      pn?.util?.debug(`${methodName} is deprecated`);\n      // @ts-ignore\n      return fn.apply(this, arguments);\n    } as unknown as T;\n\n    resultFn.skipLog = fn;\n    return resultFn;\n  }\n  return Object.entries(obj).reduce((res, [key, fn]: [keyof T, any]) => {\n    res[key] = deprecated(fn, prefix + String(key));\n\n    return res;\n  }, {} as T);\n};\n", "import { dataLayer } from '@piano-sdk/data-layer';\nimport {\n  consent as consentSdk,\n  ICookieConsent,\n  ILocalStorageConsent,\n  IPropertyInterface,\n  ISessionStorageConsent,\n  storage,\n  StorageConfig,\n} from '@piano-sdk/consent';\n\nimport {\n  TAppConsentConfig,\n  TConsentConfigString,\n  TConsentExtendedGet,\n  TConsentMode,\n  TConsentModifier, TConsentModifiers, TConsentV2, TConsentV2NotAcquired,\n  TProduct,\n  TProductNames,\n  TPurposeMap,\n  TPurposeType,\n} from \"@piano-sdk/data-layer/properties/consent/types\";\nimport { CookieConsentConfig } from \"@piano-sdk/consent/dist/consent/cookie\";\nimport { IDataLayerConfig } from \"@piano-sdk/data-layer/types/types\";\nimport { deprecatedMethods, DeprecatedMethods } from \"./deprecated\";\n\ntype CurrentProducts = Extract<TProductNames, 'COMPOSER' | 'VX' | 'DMP' | 'ID'>;\nexport type ConsentProductNames = Lowercase<CurrentProducts>;\ntype Config<T> = Omit<T, 'productName' | 'dataLayer'>;\n\ntype ProductConsentConfig = {\n  cookie: Config<CookieConsentConfig>;\n  localStorage: Config<StorageConfig>;\n  sessionStorage?: Config<StorageConfig>;\n  property?: Config<StorageConfig>,\n  event?: Config<StorageConfig>,\n}\n\ntype ConsentConfig = {\n  [x in CurrentProducts]: ProductConsentConfig\n};\n\ntype ConsentStorageByProducts = {\n  [x in ConsentProductNames]: {\n    cookie: ICookieConsent,\n    localStorage: ILocalStorageConsent,\n    sessionStorage?: ISessionStorageConsent,\n    property?: IPropertyInterface,\n    event?: IPropertyInterface,\n  } | null;\n}\n\ntype AsyncCallFn = (products: Readonly<ConsentStorageByProducts>) => void;\n\ntype ConsentInterfaceDeprecated = DeprecatedMethods<{\n  setByPreset(preset: number): void;\n\n  setByPreset(presets: number[]): void;\n\n  set(preset: number): void; // the same as setByPreset\n  set(presets: number[]): void;\n  set(consent: TConsentConfigString): void;\n  set(productName: TProductNames, consent: TAppConsentConfig): void;\n}>;\n\ntype ExtendParams<T extends Record<string, any>> = T & {\n  consent_modes?: any,\n  consent_purposes?: any\n}\n\ninterface ConsentInterfaceMain extends Readonly<ConsentStorageByProducts> {\n\n  get(): TConsentExtendedGet | null;\n\n  get(product: TProductNames): TConsentExtendedGet[TProductNames] | null;\n\n  setByPurpose(purpose: TPurposeType | string, mode: TConsentMode): void;\n\n  setByPurpose(purpose: TPurposeType | string, mode: TConsentMode, product: TProductNames): void;\n\n  getByPurpose(): TConsentV2 | null;\n\n  setAllPurposes(mode: TConsentMode): void;\n\n  __protected__: {\n    getVersion: () => 1 | 2 | null;\n    addConsentsToParams<T extends Record<string, any>>(params: ExtendParams<T>): ExtendParams<T>;\n    init(): void;\n    getConsentConfig(): ConsentConfig | null;\n    async(cb: AsyncCallFn): void;\n  }\n}\n\nexport type ConsentInterface = ConsentInterfaceMain & ConsentInterfaceDeprecated;\n\nconst isIpAddress = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(location.hostname);\nconst tld = storage.cookie.getTopLevelDomain();\n\nconst CONSENT_CONFIG: ConsentConfig = {\n  COMPOSER: {\n    cookie: {\n      items: {\n        '__tbc': \"mandatory\",\n        'xbc': \"mandatory\",\n        '__tac': 'mandatory',\n        '__tae': 'mandatory',\n        '__pls': { type: 'mandatory', domain: tld, path: '/' },\n        '__pls_*': { type: 'mandatory', domain: tld, path: '/' },\n        '_pc_*': { type: 'mandatory', domain: '', path: '/' },\n        '_pcfe': 'optional',\n        '_pcus': 'optional',\n        '_pcer': { type: 'essential', domain: tld, path: '/' },\n        '_pnpd': 'optional', // piano notification permission denied\n      },\n    },\n    localStorage: {\n      items: {\n        '__pnml': 'mandatory',\n        // to support legacy behavior of customers\n        // pls don't remove this parameters\n        '__tp-customVariables': 'essential',\n        '__tp-customVariables-expiration': 'essential', // this parameter should have the same value as __tp-customVariables\n      },\n      enableAutoRemove: true,\n    }\n  },\n  VX: {\n    cookie: {\n      items: {\n        '__ut_*': \"mandatory\",\n        '__ut': \"mandatory\",\n        '__pvi': \"optional\",\n        '__pat': 'optional',\n        '__pnahc': 'mandatory',\n        'glt_*': 'optional',\n        '__utg_*': 'optional',\n        '__gom': 'optional',\n        'tpcc_*': { type: 'optional', domain: isIpAddress ? '' : tld, path: '/' },\n      },\n    },\n    localStorage: {\n      items: {\n        '__tp-gaAccount': 'optional',\n        '__tp-trackOnlyAids': 'optional',\n        '__tp-metricsGAAccount': 'optional',\n        '__tp-exrs': 'optional',\n        'tp__unprocessedCookies': 'optional',\n        // TODO These can be removed after week after release\n        'tp__unprocessed\u0421ookies': 'optional',\n        '__tp-gaAccount-expiration': 'optional',\n        '__tp-trackOnlyAids-expiration': 'optional',\n        '__tp-metricsGAAccount-expiration': 'optional',\n        '__tp-exrs-expiration': 'optional',\n      },\n      enableAutoRemove: true,\n    }\n  },\n  DMP: {\n    cookie: {\n      items: {\n        'cX_P': 'essential',\n      },\n      enableAutoRemove: {\n        domain: tld,\n        path: '/',\n      },\n    },\n    localStorage: {\n      items: {\n        '_cX_P': 'essential',\n      },\n      enableAutoRemove: true,\n    }\n  },\n  ID: {\n    cookie: {\n      items: {\n        '__utp': 'mandatory',\n        '__utp_*': 'mandatory',\n        '__pid': 'mandatory',\n        '__pil': 'essential',\n        '__idr': 'essential',\n        '__eea': 'essential',\n        'piano-id-initial-gm-sso-shown-*': 'mandatory',\n      }\n    },\n    localStorage: {\n      items: {\n        'pnid-tc-string': 'optional'\n      },\n      enableAutoRemove: true,\n    }\n  },\n};\n\nconst CUSTOM_MODE: TConsentMode = 'custom';\nconst consentModes: TConsentMode[] = ['opt-in', 'essential', 'opt-out', CUSTOM_MODE];\nconst consentProducts: TProductNames[] = ['PA', 'DMP', 'COMPOSER', 'ID', 'VX', 'ESP', 'SOCIAL_FLOW', 'DL']\nconst consentProductMap: Record<string, TProduct> = consentProducts.reduce((res, val, index) => ({\n    ...res,\n    [val.toLowerCase()]: {\n      name: val,\n      id: index,\n    }\n  }), {} as Record<string, TProduct>);\nconsentProductMap['social flow'] = consentProductMap.SOCIAL_FLOW;\nconst getConsentModeId = (mode: TConsentMode): number => consentModes.indexOf(mode);\nconst toProduct = (product: string): TProduct | null => consentProductMap[product.toLowerCase()] || null;\nconst notAcquiredMode = 4;\n\n//@ts-ignore\nconst getPdl = (): IDataLayerConfig | null => window.pdl || null;\nconst getConsentModifiers = (): TConsentModifiers | null => getPdl()?.consent_modifiers || null;\nconst isConsentEnabled = () => !!getPdl()?.requireConsent;\nconst isConsentV2Enabled = () => getPdl()?.requireConsent === 'v2';\nconst isConsentV1Enabled = () => isConsentEnabled() && !isConsentV2Enabled();\nconst getVersionConsent = () => isConsentEnabled() ? (isConsentV2Enabled() ? 2 : 1): null;\n\nconst checkConsentV2 = (): boolean => {\n  if (isConsentV1Enabled()) {\n    console.error('Consent v2 is disabled. To use the feature set pdl.requireConsent = \"v2\"');\n    return false;\n  }\n  return true;\n}\nconst checkConsentV1 = (): boolean => {\n  if (isConsentV2Enabled()) {\n    console.error('Consent v2 is enabled. To change consent use tp.consent.setByPurpose or tp.consent.setAllPurposes');\n    return false;\n  }\n  return true;\n}\n\nconst defaultPurposeByProduct: Record<string, string> = Object.entries({\n    AD: ['DMP', 'SOCIAL_FLOW'],\n    CP: ['COMPOSER'],\n    AM: ['PA'],\n    PR: ['ESP', 'VX', 'ID'],\n    DL: ['DL']\n  }).reduce((res, [purpose, products]) => {\n    products.forEach(product => {\n      res[toProduct(product)!.id] = purpose;\n    });\n    return res;\n  }, {} as Record<string, string>);\n\nconst createConsentParameters = (\n  allProducts: TProduct[],\n) => {\n  let modes: Record<string, number> = allProducts.reduce((res, {id}) => ({\n    ...res,\n    [id]: notAcquiredMode,\n  }), {} as Record<TProductNames, number>);\n  let purposes: Record<string, string> = dataLayer.get('purposes') || {};\n\n  return {\n    addConsent: (productName: TProductNames, mode: TConsentMode) => {\n      const productId = toProduct(productName)!.id;\n\n      modes[productId] = getConsentModeId(mode);\n    },\n    addPurpose: (productName: TProductNames, purpose: string) => {\n      purposes[toProduct(productName)!.id] = purpose;\n    },\n    toModeParamString: () => {\n      return JSON.stringify(modes);\n    },\n    toPurposeParamString: () => {\n      return Object.entries(purposes).some(([id, purpose]) => purpose !== defaultPurposeByProduct[id])\n        ? JSON.stringify(purposes)\n        : null;\n    }\n  }\n}\n\nexport const consent = ((): ConsentInterface => {\n  let ready = false;\n  let callQueue: AsyncCallFn[] = [];\n\n  const products: ConsentStorageByProducts = {\n    composer: null,\n    vx: null,\n    dmp: null,\n    id: null,\n  };\n  // deprecated\n  const setByPreset = (presets: number | number[]) => {\n    if (checkConsentV1()) {\n      dataLayer.set('consent', presets);\n    }\n  };\n\n  // deprecated\n  function set(preset: number): void;\n  function set(presets: number[]): void;\n  function set(consent: TConsentConfigString): void;\n  function set(productName: TProductNames, consent: TAppConsentConfig): void;\n  function set(arg1: TProductNames | TConsentConfigString | number | number[], arg2?: TAppConsentConfig) {\n    if (checkConsentV1()) {\n      if (typeof arg1 === 'string') {\n        dataLayer.set('consent', {[arg1 as TProductNames]: arg2 as TAppConsentConfig});\n      } else {\n        dataLayer.set('consent', arg1);\n      }\n    }\n  }\n\n  function get(): TConsentExtendedGet | null;\n  function get(product?: TProductNames): TConsentExtendedGet[TProductNames] | null;\n  function get(product?: TProductNames) {\n    const extendedConsent = dataLayer.get('consent');\n\n    if (!product || !extendedConsent) {\n      return extendedConsent;\n    }\n\n    return extendedConsent[product];\n  }\n\n  function setByPurpose(purpose: TPurposeType | string, mode: TConsentMode, products?: TProductNames | TProductNames[]): void {\n    if (!checkConsentV2()) {\n      return;\n    }\n    if (!mode) {\n      pn.util.error('consent.setByPurpose: mode is required');\n      return;\n    }\n    const result = dataLayer.utils.setConsent(purpose, mode, products);\n\n    if (result) {\n      pn.util.error('consent.setByPurpose: [DL]: ' + result);\n    }\n  }\n\n  function setAllPurposes(mode: TConsentMode): void {\n    if (!checkConsentV2()) {\n      return;\n    }\n    const result = dataLayer.utils.setConsent(mode);\n\n    if (result) {\n      pn.util.error('consent.setAllPurpose: [DL]: ' + result);\n    }\n  }\n\n  function getByPurpose(): TConsentV2 | null {\n    return dataLayer.utils.getConsent();\n  }\n\n  const addConsentsToParams = <T extends Record<string, any>>(params: ExtendParams<T>): ExtendParams<T> => {\n    // Simplify consent for BE param\n    // {\n    //    <id product>: <id mode>\n    // }\n    const products = dataLayer.get('products');\n    const consentExtended = getVersionConsent() === 2 ? dataLayer.utils.getConsent() : null;\n    const consentV1 = getVersionConsent() === 1 ? dataLayer.get('consent') : null;\n    const consentRequire = !!getPdl()?.requireConsent;\n\n    if ((!consentExtended || !consentV1) && !consentRequire) {\n      return params;\n    }\n\n    const consentParameters = createConsentParameters(products!);\n\n    if (consentV1) {\n      (Object.keys(consentV1)).forEach((product) => {\n        consentParameters.addConsent(product as TProductNames, consentV1[product as TProductNames]!.mode);\n      });\n    }\n    if (consentExtended) {\n      (Object.keys(consentExtended)).forEach((purpose) => {\n        const { mode, products } = consentExtended[purpose];\n\n        products.forEach((product) => {\n          consentParameters.addConsent(product, mode);\n          consentParameters.addPurpose(product, purpose);\n        })\n      });\n    }\n\n    const consentModesParam = consentParameters.toModeParamString();\n    const consentPurposesParam = consentParameters.toPurposeParamString();\n\n    if (consentModesParam) {\n      params['consent_modes'] = consentModesParam;\n    }\n\n    if (consentPurposesParam) {\n      params['consent_purposes'] = consentPurposesParam;\n    }\n\n    return params;\n  }\n\n  const _callAsyncFn = (cb: AsyncCallFn) => {\n    cb(products);\n  }\n\n  const init = () => {\n    // check consent modifiers\n    const createLog = (product: TProductNames) => pn.debug ? (value: string) => {\n        pn.util?.debug(`[PDL validation]: consent_modifier: ${product} - ${value}`);\n    } : undefined;\n    const consentLog = pn.debug ? (value: string) => {\n      pn.util?.debug('[PDL validation]: ' + value);\n    } : undefined;\n    const pdl = getPdl();\n    const modifiers = getConsentModifiers();\n\n    if (modifiers) {\n      (Object.keys(modifiers) as TProductNames[]).forEach(key => {\n        const modifier = modifiers![key];\n        const productName = toProduct(key)?.name;\n        if (productName) {\n          delete modifiers![key];\n          modifiers![productName] = modifier;\n        }\n      });\n      dataLayer.get('products')?.forEach(({name: productName}) => {\n        if (modifiers[productName]) {\n          const log = createLog(productName);\n          modifiers[productName] = dataLayer.utils.validateModifier(\n            modifiers[productName] as TConsentModifier,\n            log,\n          ) as TConsentModifier;\n        }\n      });\n    }\n    if (pdl?.consent) {\n      pdl.consent = dataLayer.utils.validateConsent(pdl.consent, consentLog) || pdl.consent;\n    }\n\n    const autoRemoveCookieOptions = {\n      domain: pn.cookieDomain || storage.cookie.getTopLevelDomain(),\n      path: pn.cookiePath || '/',\n    };\n\n    Object.entries(CONSENT_CONFIG).forEach(([key, config]) => {\n      const productName = key as TProductNames;\n      const productNameLS = productName.toLowerCase() as ConsentProductNames;\n      const commonConfig = {\n        dataLayer,\n        productName\n      };\n\n      products[productNameLS] = {\n        cookie: consentSdk.createCookie({\n          ...commonConfig,\n          ...config.cookie,\n          enableAutoRemove: config.cookie.enableAutoRemove ?? autoRemoveCookieOptions,\n        }),\n        localStorage: consentSdk.createLocalStorage({\n          ...commonConfig,\n          ...config.localStorage,\n        }),\n      }\n    });\n\n    callQueue.forEach(_callAsyncFn);\n    callQueue = [];\n    ready = true;\n  }\n\n  const getConsentConfig = () => pn.debug ? CONSENT_CONFIG : null;\n\n  const async = (cb: AsyncCallFn) => {\n    if (ready) {\n      _callAsyncFn(cb);\n    } else {\n      callQueue.push(cb);\n    }\n  }\n\n  const deprecatedMethod = (deprecatedMethods({\n    setByPreset,\n    set,\n    get,\n  }, 'tp.consent.'));\n\n  return {\n    // don't use '...' to assign objects, this leads to bug\n    // that get vx is not defined\n    setByPreset: deprecatedMethod.setByPreset,\n    set: deprecatedMethod.set,\n    get: deprecatedMethod.get,\n    setByPurpose,\n    setAllPurposes,\n    getByPurpose,\n    get composer() {\n      return products.composer;\n    },\n    get vx() {\n      return products.vx;\n    },\n    get dmp() {\n      return products.dmp;\n    },\n    get id() {\n      return products.id\n    },\n    __protected__: {\n      getVersion: getVersionConsent,\n      addConsentsToParams,\n      init,\n      getConsentConfig,\n      async\n    }\n  }\n});\n\npn.container.register('consent', {\n  useValue: consent()\n});\npn.consent = pn.container.resolve<ConsentInterface>('consent');\n", "import { storage } from \"@piano-sdk/consent\";\nimport {TCookieOptions} from \"@piano-sdk/storage\";\n\nexport interface CookieInterface {\n  name: string;\n  raw: boolean;\n\n  set(key: string, value: string, options?: TCookieOptions): void;\n\n  get(key: string): string | undefined;\n\n  remove(key: string, options?: TCookieOptions): void;\n}\n\nconst cookie = ((): CookieInterface => {\n  const name = 'cookie';\n  let raw = false;\n\n  const set = (key: string, value: string, options?: TCookieOptions) => {\n    const cookieOptions = raw ? {...options, raw} : options;\n    storage.cookie.set(key, value, cookieOptions);\n  }\n\n  // to support legacy behaviour need to return undefined instead of null or empty string\n  const get = (key: string): string | undefined => {\n    return storage.cookie.get(key) || undefined;\n  }\n\n  const remove = (key: string, options?: TCookieOptions) => {\n    if (storage.cookie.get(key) !== null) {\n      // Must not alter options, thus extending a fresh object...\n      storage.cookie.remove(key, options);\n      return true;\n    }\n    return false;\n  }\n\n  return {\n    name,\n    raw,\n\n    set,\n    get,\n    remove,\n  }\n\n})();\n\npn.container.register('cookie', {\n  useValue: cookie\n});\npn.cookie = pn.container.resolve<CookieInterface>('cookie');\n", "import { storage } from '@piano-sdk/consent';\n\nexport interface LocalStorageInterface {\n  get(keyName: string): any;\n\n  set(keyName: string, value: string | number): void;\n\n  remove(keyName: string): void;\n}\n\nconst localStorage = ((): LocalStorageInterface => {\n  // TO support old legacy local-storage.js logic\n  const getLocalStorage = () => {\n    try {\n      return window.localStorage;\n    } catch (error) {\n      return null;\n    }\n  }\n\n  const browserLocalStorage = getLocalStorage();\n\n  if (!window.name) {\n    //@ts-ignore\n    window.name = Math.floor(Math.random() * 100000000);\n  }\n\n  const get = (keyName: string): any => {\n    if (!browserLocalStorage || typeof browserLocalStorage.getItem !== 'function') {\n      return;\n    }\n\n    const value = storage.localStorage.get(keyName);\n\n    try {\n      return JSON.parse(value);\n    } catch(e) {\n      return value;\n    }\n  }\n  const set = (keyName: string, value: string | number): void => {\n    if (!browserLocalStorage || typeof browserLocalStorage.getItem !== 'function') {\n      return;\n    }\n\n    storage.localStorage.set(keyName, JSON.stringify(value));\n  }\n  const remove = (keyName: string): void => {\n    if (!browserLocalStorage || typeof browserLocalStorage.getItem !== 'function') {\n      return;\n    }\n\n    storage.localStorage.remove(keyName);\n  }\n\n  return {\n    get,\n    set,\n    remove,\n  }\n\n})();\n\npn.container.register('localStorage', {\n  useValue: localStorage\n});\npn.localStorage = pn.container.resolve<LocalStorageInterface>('localStorage');\n", "declare const TP_VERSION: string;\n\nexport interface VersionServiceInterface {\n  name: string;\n  getTinypassVersion: Function;\n}\n\nconst versionService = ((): VersionServiceInterface => {\n\n  const name = \"versionService\";\n\n  // the variable is modified in packages/sdk-core/esbuild/common/config.js\n  // replaced with node env variable\n  const ENV_TP_VERSION = TP_VERSION;\n\n  const getTinypassVersion = () => {\n    return ENV_TP_VERSION;\n  }\n\n  const init = () => {\n    (<any>window).__tpVersion = getTinypassVersion();\n  }\n\n  init();\n\n  return {\n    name,\n    getTinypassVersion,\n  }\n})();\n\npn.container.register('versionService', {\n  useValue: versionService\n});\npn.versionService = pn.container.resolve<VersionServiceInterface>('versionService');\n", "import { AjaxInterface } from './ajax';\nimport { LocalStorageInterface } from \"./localStorage\";\nimport { ConsentInterface } from \"./consent\";\nimport {UtilInterface} from \"./util\";\n\nexport interface ITPInterface {\n  name: string;\n  init: Function;\n  synchronizeCookie: Function;\n}\n\ninterface ICookiePropsToSend {\n  maxAge?: number;\n  expires?: Date;\n  value: string;\n}\n\nconst itp = ((container = pn.container): ITPInterface => {\n  const ajax = container.resolve<AjaxInterface>('ajax');\n  const localStorage =\n    container.resolve<LocalStorageInterface>('localStorage');\n  const consent = container.resolve<ConsentInterface>('consent');\n  const name = 'itp';\n  const secondsInHour = 3600;\n  const delay = 2500;\n\n  const cookiesTempStoreKey = 'tp__unprocessedCookies';\n\n  let timeout: any;\n  let cookiesToSend: { [cookieName: string]: ICookiePropsToSend } = {};\n\n  // TODO this is a legacy value with incorrect name. Pls remove it after a few months\n  (() => {\n    const cookiesTempStoreKeyLegacy = 'tp__unprocessed\u0421ookies';\n    const unprocessedCookiesLegacy = localStorage.get(cookiesTempStoreKeyLegacy);\n    if (unprocessedCookiesLegacy) {\n      localStorage.remove(cookiesTempStoreKeyLegacy);\n      if (!localStorage.get(cookiesTempStoreKey)) {\n        localStorage.set(cookiesTempStoreKey, unprocessedCookiesLegacy); // save legacy value with new name\n      }\n    }\n  })();\n\n  function init() {\n    if (!pn.cloudflareWorkerUrl || !pn.util.isSafariOrUiWebView()) return;\n    restoreUnprocessedCookies();\n    if (Object.keys(cookiesToSend).length > 0) {\n      sendCookiesWithDelay();\n    }\n  }\n\n  function synchronizeCookie(\n    cookieName: string,\n    cookieValue: string,\n    maxHoursOrExpDate: number | Date | undefined\n  ) {\n    if (!pn.cloudflareWorkerUrl || !pn.util.isSafariOrUiWebView()) return;\n\n    restoreUnprocessedCookies();\n    addCookiesToSend(cookieName, cookieValue, maxHoursOrExpDate);\n    storeUnprocessedCookies();\n\n    sendCookiesWithDelay();\n  }\n\n  function sendCookiesWithDelay() {\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n\n    timeout = setTimeout(function () {\n      ajax.request({\n        url: pn.cloudflareWorkerUrl + '?maxAge=2628000',\n        type: 'POST',\n        data: JSON.stringify(cookiesToSend),\n        crossDomain: true,\n        xhrFields: {\n          withCredentials: true\n        },\n        success: function () {\n          cookiesToSend = {};\n          removeProcessedCookiesFromStore();\n        },\n        error: function (request: any, textStatus: string) {\n          console.error(textStatus);\n        }\n      });\n    }, delay);\n  }\n\n  function addCookiesToSend(cookieName: string, cookieValue: string, maxHoursOrExpDate: number | Date | undefined): void {\n    cookiesToSend[cookieName] = {\n      value: cookieValue\n    };\n\n    if (!maxHoursOrExpDate) return;\n\n    if (maxHoursOrExpDate instanceof Date) {\n      cookiesToSend[cookieName].expires = maxHoursOrExpDate;\n    } else {\n      cookiesToSend[cookieName].maxAge = maxHoursOrExpDate * secondsInHour;\n    }\n  }\n\n  function restoreUnprocessedCookies(): void {\n    try {\n      const unprocessedCookies = localStorage.get(cookiesTempStoreKey) as {\n        [cookieName: string]: ICookiePropsToSend;\n      };\n      if (unprocessedCookies) {\n        Object.keys(unprocessedCookies).forEach(function (cookieName) {\n          cookiesToSend[cookieName] = unprocessedCookies[cookieName];\n        });\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  function storeUnprocessedCookies() {\n    const product = consent[\"vx\"];\n    if (product !== null) {\n      product.localStorage.set(cookiesTempStoreKey, JSON.stringify(cookiesToSend));\n    }\n  }\n\n  function removeProcessedCookiesFromStore() {\n    localStorage.remove(cookiesTempStoreKey);\n  }\n\n  return {\n    name,\n    init,\n    synchronizeCookie,\n  }\n})();\n\npn.container.register('itp', {\n  useValue: itp\n});\npn.itp = pn.container.resolve<ITPInterface>('itp');\n", "import { VersionServiceInterface } from \"./versionService\";\nimport { ITPInterface } from \"./itp\";\nimport { CookieInterface } from \"./cookie\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { dataLayer } from \"@piano-sdk/data-layer\";\nimport { TPropertiesGet, TPropertiesSet } from '@piano-sdk/data-layer/properties';\nimport { ConsentInterface, ConsentProductNames } from \"./consent\";\nimport { ICookieConsent, storage } from '@piano-sdk/consent';\nimport { LocalStorageOptions, TCookieOptions } from \"@piano-sdk/storage\";\nimport { TConsentV2, TConsentV2NotAcquired } from '@piano-sdk/data-layer/properties/consent/types';\n\nexport interface UtilInterface {\n  name: string;\n  ADBLOCKER_STATUS: any;\n\n  __private__: {\n    getAdjustedCookieExpiration(preferableExpiration?: number | Date): any;\n  },\n  __protected__: {\n    deleteTLDCookieForSpecificDomains(name: string, cookieDomain: string, cookiePath?: string): void;\n    documentReady(fn: Function): void;\n    getCookie(cookieName: string): any;\n    setCookie(cookieName: string, cookieValue: any, options?: any): void;\n    setCookieConsent(productName: ConsentProductNames, cookieName: string, cookieValue: any, options?: TCookieOptions): void;\n    getLocalStorageItem(key: string): string | number | null;\n    hasLocalStorage(): boolean;\n    randomStringCxCompatible(): string;\n    setLocalStorageItem(\n      consentProduct: ConsentProductNames,\n      key: string,\n      value: any,\n      expires?: LocalStorageOptions['expires'],\n      usePrefix?: boolean,\n    ): void;\n    removeLocalStorageItem(key: string): void;\n    cameFromFbSubscriptions(): boolean;\n    logRemoveTokens(payload: { uid?: string, actions: string }): void;\n    waitAllPromises(promises: any[]): any;\n    isInteger(value: number): void;\n    racePromise(promises: any[]): any;\n    isCxenseBot(): boolean;\n    isHttpsProtocol(): boolean;\n    isApplePayAllowed(): boolean;\n    isDevEndpoint(): boolean;\n    setVxUsersToDataLayer(users: TPropertiesSet['users'] | null): void;\n  },\n\n  toJSON(data: any, useBase64?: boolean): string;\n  parseJSON(data: string, useBase64?: boolean): any;\n  addScript(src: string, onload: any): void;\n  isScriptAdded(src: string): boolean;\n\n  fromUnderscoreToCamelCase(string: string): string;\n\n  randomString: Function;\n  log(val1: any, val2?: any, val3?: any): void;\n  debug(val1: any, val2?: any, val3?: any, val4?: any, val5?: any, val6?: any, val7?: any, val8?: any): void;\n  error(val1: any, val2?: any, val3?: any): void;\n\n  findCookieByName(regex: RegExp | string): string | null;\n\n  findCookiesByName: Function;\n\n  removeVoucherCodeFromUrl(url: string): string;\n\n  removeSharedAccountCodeFromUrl(url: string): string;\n\n  deleteCookie: Function;\n  mapArrayIndex: Function;\n  getScroll: Function;\n  getPageSize: Function;\n  getViewport: Function;\n  center: Function;\n  centerScreen: Function;\n\n  getQueryParamByName(name: string): string;\n\n  hasQueryParamByName: Function;\n  removeQueryParamByName: Function;\n\n  setAccessTokenListCookie(accessTokenList?: any, userToken?: string, skipLogging?: boolean): void;\n\n  setTpccCookies: Function;\n  getCampaigns: Function;\n  getCustomCookies: Function;\n  getAdblockStatus: Function;\n  getAdblockerStatusReason: Function;\n  getAdblockerHistoryCookieInfo: Function;\n  waitCall: Function;\n  startCall: Function;\n  doneCall: Function;\n  hasCall: Function;\n\n  debounce(func: Function, wait: number, immediate?: boolean): Function;\n\n  throttle: Function;\n  profile<T extends Function>(func: T): T & { __invokeCount: number, invokeCount: number };\n  setTbcCookieFromResponse: Function;\n  setTacCookieFromResponse: Function;\n  setXbcCookieFromResponse: Function;\n  getTbcCookie: Function;\n  getPcidCookie: Function;\n  getTacCookie: Function;\n  getAidSpecifiedName(cookieName: string): string;\n\n  getUserTokenCookie(): string | null;\n\n  getPushListsCookie: Function;\n  setPushListsCookie: Function;\n  setAppTimezoneOffsetFromResponse: Function;\n  setAppTimezoneOffset: Function;\n  getAppTimezoneOffset: Function;\n  getBrowserTimezoneOffset: Function;\n  str2timestamp: Function;\n  getPossibleCookieDomains(domain?: string): (string | undefined)[];\n  isMobileTabletIOs: Function;\n  isIphone: Function;\n  getIphoneVersion: () => number | null;\n  isIphone17OrHigher: Function;\n  isIOS: Function;\n  isIOsUiWebView: Function;\n  isSafariOrIOsUiWebView: Function;\n  isSafariOrUiWebView: Function;\n  isFBOrInstWebView: Function;\n  isEdge: () => boolean;\n  isAndroid: Function;\n  isSafari: Function;\n  isIE: Function;\n  isChrome: () => boolean;\n  isCriOS: Function;\n  isRelativeUrl: Function;\n  prepareUrlParameter: Function;\n  getReferrer: Function;\n  getHostname: Function;\n  extractCookieDomain: (href: string) => string | null;\n  setCurrentDomainFromResponse: Function;\n  getCurrentDomainFromCookie: Function;\n  setUserSegments: Function;\n  getPageViewContext: () => {\n    pageTitle: string,\n    url: string,\n    referrerUrl: string,\n    pageViewId: string | null,\n    author?: string,\n    created?: number,\n    section?: string,\n    tags?: string[],\n    contentType?: string,\n  };\n  getBrowserId: () => string | null;\n  isBot: Function;\n\n  getAffiliateToken(name: string): string;\n\n  removeAffiliateToken(): void;\n  asUint8Array(content: string): Uint8Array;\n  getCookieConsents(): TConsentV2 | TConsentV2NotAcquired | null;\n  getUserSegments():  TPropertiesGet['userSegments'] | null;\n  getUserSegmentsString(): string;\n  getUserState():  TPropertiesGet['userStatus'] | null;\n  requireJsFile(src: string): Promise<any>;\n}\n\nexport const util = ((container = pn.container): UtilInterface => {\n\n  const jqUtils = container.resolve<JqUtilsInterface>('jqUtils');\n  const cookie = container.resolve<CookieInterface>('cookie');\n  const versionService = container.resolve<VersionServiceInterface>('versionService');\n  const itp = container.resolve<ITPInterface>('itp');\n  const consent = container.resolve<ConsentInterface>('consent');\n\n  const name = 'util';\n\n  let appTimezoneOffset: number;\n\n  let globalAffiliateToken: string = '';\n\n  const ADBLOCKER_STATUS = {\n    ENABLED_AFTER_DISABLED: -2,\n    NOT_DETECTED: -1,\n    DISABLED: 0,\n    ENABLED: 1\n  };\n\n  if (typeof ('testString'.toHex) === 'undefined') {\n    Object.defineProperty(String.prototype, 'toHex', {\n      enumerable: false,\n      value: function () {\n        var hex = '';\n        for (var i = 0; i < this.length; ++i) {\n          hex += '' + this.charCodeAt(i).toString(16);\n        }\n        return hex;\n      }\n    });\n  }\n\n  /**\n   * Gets a random string\n   * @param length The length of the string\n   * @returns {string} The random string\n   * @const\n   */\n  /**\n   * Returns a random string of length\n   */\n  const randomString = (length: number): string => {\n    if (!length) {\n      length = 5;\n    }\n\n    var text = '';\n    var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n    if (window.crypto && window.crypto.getRandomValues && typeof Uint32Array === 'function') {\n      var values = new Uint32Array(length);\n      window.crypto.getRandomValues(values);\n      for (var i = 0; i < length; i++) {\n        text += possible.charAt(values[i] % possible.length);\n      }\n    } else {\n      for (var i = 0; i < length; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n      }\n    }\n\n    return text;\n  };\n\n  /**\n   * Deletes a cookie by name\n   */\n  const deleteCookie = (name: string, cookieDomain?: string, cookiePath?: string): void => {\n    var options: any = { path: '/', expires: 0 };\n    if (typeof cookieDomain !== 'undefined') {\n      options.domain = cookieDomain;\n    }\n    if (typeof cookiePath !== 'undefined') {\n      options.path = cookiePath;\n    }\n    cookie.remove(name, options);\n  };\n\n  const deleteTLDCookieForSpecificDomains = (name: string, cookieDomain: string, cookiePath?: string): void => {\n    // delete abril's cookies on TLD (TPWEBAPP-18226)\n    if (cookieDomain.indexOf('abril.com.br') !== -1) {\n      deleteCookie(name, '.abril.com.br', cookiePath);\n    }\n    if (cookieDomain.indexOf('scotsman.com') !== -1) {\n      deleteCookie(name, '.scotsman.com', cookiePath);\n    }\n  }\n\n  /**\n   * Finds the first match cookie value for a regex\n   */\n  /**\n   * Finds a cookie by name.\n   * @param name This can be either a string or a new RegExp object.\n   * @returns {*} The cookie value, or null\n   */\n  const findCookieByName = (regex: RegExp | string): string | null => {\n    if (document.cookie.length === 0) {\n      return null;\n    }\n\n    if (regex instanceof RegExp) {\n      var cookies = document.cookie.split(';');\n      for (var i = 0; i < cookies.length; i++) {\n        var equalsPosition = cookies[i].indexOf('=');\n        if (equalsPosition !== -1) {\n          var cn = cookies[i].substr(0, equalsPosition).trim();\n          var cookieValRegExp;\n\n          if (regex.test(cn)) {\n            cookieValRegExp = cookies[i].substr(equalsPosition + 1).trim();\n            try {\n              return decodeURIComponent(cookieValRegExp);\n            } catch (e) {\n              debug('Could not uri-decode cookie \"' + regex.toString() + '\"', e);\n            }\n            return cookieValRegExp;\n          }\n        }\n      }\n    } else {\n      var value = '; ' + document.cookie;\n      var parts = value.split('; ' + regex + '=');\n      if (parts.length >= 2) {\n        var cookieVal = parts.pop()?.split(';').shift();\n        if (typeof cookieVal === 'undefined') {\n          return null;\n        }\n        try {\n          return decodeURIComponent(cookieVal);\n        } catch (e) {\n          debug('Could not uri-decode cookie \"' + regex + '\"', e);\n        }\n        return cookieVal;\n      }\n    }\n\n    return null;\n  }\n\n  const findCookiesByName = (regex: RegExp | string) => {\n    if (document.cookie.length === 0) {\n      return [];\n    }\n    var result = [];\n    var cookies = document.cookie.split(';');\n    for (var i = 0; i < cookies.length; i++) {\n      var equalsPosition = cookies[i].indexOf('=');\n      if (equalsPosition !== -1) {\n        var cn = cookies[i].substr(0, equalsPosition).trim();\n\n        var cookieVal;\n\n        if (regex instanceof RegExp && regex.test(cn)) {\n          cookieVal = cookies[i].substr(equalsPosition + 1).replace(/^\\s+|\\s+$/g, '');\n          try {\n            cookieVal = decodeURIComponent(cookieVal);\n          } catch (e) {\n            debug('Could not uri-decode cookie \"' + regex.toString() + '\"', e);\n          }\n          result.push({ name: cn, value: cookieVal });\n        } else if (cn === regex) {\n          cookieVal = cookies[i].substr(equalsPosition + 1).replace(/^\\s+|\\s+$/g, '');\n          try {\n            cookieVal = decodeURIComponent(cookieVal);\n          } catch (e) {\n            debug('Could not uri-decode cookie \"' + regex + '\"', e);\n          }\n          result.push({ name: cn, value: cookieVal });\n        }\n      }\n    }\n    return result;\n  };\n\n  /**\n   * Logs a message, but only if tp.debug = true;\n   */\n  function debug(...args: any[]): void {\n    if (pn.debug === true) {\n      // log.apply(null, args);\n      // @ts-ignore\n      log(...args);\n    }\n  };\n\n  /**\n   * Similar to log, except that it prints a stacktrace if the browser supports it\n   */\n  function error(...args: any[]) {\n    // log.apply(null, args);\n    log(...args);\n    var error;\n    if (typeof (arguments[0]) === 'string') {\n      error = new Error(arguments[0]);\n    } else {\n      error = new Error();\n    }\n    if (error.stack) {\n      log(error.stack);\n    }\n  };\n\n  /**\n   * Logs a message to the browser's console. Mimics console.debug(arg1, arg2, ...);\n   */\n  function log(...args: any[]) {\n    if (!window.console) {\n      return;\n    }\n    if (!window.console.log) {\n      return;\n    }\n    if (!window.console.log.apply) {\n      return;\n    }\n    if (!window.console.log.apply.call) {\n      return;\n    }\n\n    if (typeof (window.console) !== 'undefined' && typeof (window.console.log) !== 'undefined') {\n      var newArgs = ['TP:'];\n      try {\n        for (var i = 0; i < args.length; i++) {\n          newArgs.push(args[i]);\n        }\n      } catch (e) {\n        newArgs = args;\n      }\n      if (isBot()) {\n        newArgs = buildSeleniumLogMessage(newArgs);\n      }\n\n      // @ts-ignore\n      (typeof window.console.log === 'object' ? window.console.log.apply.call(this, console, newArgs) : console.log.apply(console, newArgs));\n    }\n  };\n\n  /**\n   * Gets the browser scroll depth\n   */\n  const getScroll = () => {\n    var a: any = 0;\n    window.pageYOffset ? a = window.pageYOffset : (a = document.documentElement || document.body.parentNode, a = 'number' === typeof a.scrollTop ? a.scrollTop : document.body.scrollTop);\n    return a;\n  }\n\n  const buildSeleniumLogMessage = (args: string[]) => {\n    // selenium log. It can show only first argument\n    var seleniumMessage = '';\n    try {\n      for (var i = 0; i < args.length; i++) {\n        try {\n          seleniumMessage += JSON.stringify(args[i]) + ', ';\n\n        } catch (e) {\n          seleniumMessage += '' + e;\n        }\n      }\n      return [seleniumMessage];\n    } catch (e) {\n      return args;\n    }\n  }\n\n  const isInteger = (value: number): boolean => {\n    return typeof value === 'number' &&\n      isFinite(value) &&\n      Math.floor(value) === value;\n  };\n\n  /**\n   * Gets the full browser pagesize, including off screen areas\n   */\n  const getPageSize = () => {\n    var width, height;\n    width = Math.max(document.documentElement.clientWidth, document.body.scrollWidth, document.documentElement.scrollWidth, document.body.offsetWidth, document.documentElement.offsetWidth);\n    height = Math.max(document.documentElement.clientHeight, document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight);\n    return { x: width, y: height };\n  };\n\n  /**\n   * Returns the dimensions of the current viewport, as adjusted for resizing\n   * and/or pages that are longer or wider than the current browser.\n   */\n  const getViewport = () => {\n    var a, b;\n    'CSS1Compat' === document.compatMode ? (a = document.documentElement.clientWidth, b = document.documentElement.clientHeight) : (a = document.body.clientWidth, b = document.body.clientHeight);\n    return { x: a, y: b };\n  }\n\n  /**\n   * Calculates the x,y necessary to center a div in the current viewport, helpful\n   * when positioning modals that need to stay in the center of the screen.\n   */\n  const center = (width: number, height: number) => {\n    var scrollY = getScroll();\n    var d = getViewport();\n    d = { x: d.x / 2 - width / 2, y: (d.y / 2 - height / 2) + scrollY };\n    d.x = Math.max(0, d.x);\n    d.y = Math.max(10, d.y);\n    return d;\n  };\n\n  const centerScreen = (width: number, height: number) => {\n    width = width || 0;\n    height = height || 0;\n\n    // @ts-ignore\n    var dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screen.left;\n    // @ts-ignore\n    var dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screen.top;\n\n    const winSize = jqUtils.winSize();\n\n    var screenWidth = winSize.width || document.documentElement.clientWidth || window.screen.width;\n    var screenHeight = winSize.height || document.documentElement.clientHeight || window.screen.height;\n\n    var left = (screenWidth / 2) - (width / 2) + dualScreenLeft;\n    var top = (screenHeight / 2) - (height / 2) + dualScreenTop;\n\n    return { left: left, top: top };\n  };\n\n  const hasQueryParamByName = (name: string) => {\n    var qd: any = {};\n    location.search.substr(1).split('&').forEach(function (item) {\n      var s = item.split('='), k = s[0], v = s[1] && decodeURIComponent(s[1]);\n      (k in qd) ? qd[k].push(v) : qd[k] = [v];\n    });\n    return qd.hasOwnProperty(name);\n  };\n\n  /**\n   * Extracts a GET parameter from a URL, e.g. this method would return \"about\" if\n   * the URL in the browser were http://tinypass.com/?page=about\n   */\n  const getQueryParamByName = (name: string): string => {\n    name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n    var regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)'),\n      results = regex.exec(location.search);\n    return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n  };\n\n  const removeURLParameter = (url: string, parameters: string[] | string) => {\n    var hash;\n    var hashParts = url.split('#');\n    var urlparts = hashParts[0].split('?');\n    if (hashParts.length >= 2) {\n      hash = hashParts[1];\n    }\n    parameters = Array.isArray(parameters) ? parameters : [parameters];\n\n    if (urlparts.length >= 2) {\n\n      var pars = urlparts[1].split(/[&;]/g);\n      for (let j = 0; j < parameters.length; j++) {\n        var prefix = encodeURIComponent(parameters[j]) + '=';\n        for (var i = pars.length; i-- > 0;) {\n          if (pars[i].lastIndexOf(prefix, 0) !== -1) {\n            pars.splice(i, 1);\n          }\n        }\n      }\n\n      url = urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : '');\n      return hash ? url + '#' + hash : url;\n    } else {\n      return url;\n    }\n  };\n\n  // nextjs framework\n  const isNextJsRouter = () => {\n    return typeof window.next === 'object' && typeof window.next.router === 'object';\n  };\n\n  const replaceUrl = (urlFunction: (url: string) => string) => {\n    const url = urlFunction(location.href);\n    if (history && typeof history.replaceState === 'function') {\n      const historyState = isNextJsRouter() ?\n        {\n          url: urlFunction(history.state.url || ''),\n          as: urlFunction(history.state.as || ''),\n          options: history.state.options\n        } :\n        history.state;\n      history.replaceState(historyState, document.title, url);\n    } else {\n      location.href = url;\n    }\n  }\n\n  const removeQueryParamByName = (name: string | string[]) => {\n    replaceUrl(url => removeURLParameter(url, name));\n  };\n\n  const setAccessTokenListCookie = (accessTokenList: any, userToken: string, skipLogging: boolean): void => {\n    //We still want to set an empty token_list.\n    //Setting an empty token list is good because the __tac can be empty\n    //when a user logs in but doesn't have any access.\n    var __ut = getAidSpecifiedName('__ut');\n    if (accessTokenList && jqUtils.type(accessTokenList.value) === 'string') {\n      // the __tac and __tae cookies are set for 730 days\n      // the __tae cookie contains the time when the __tac was set\n      var expireDate = new Date();\n      const domain = undefined;\n      var options: TCookieOptions = {\n        domain,\n        path: '/',\n        expires: 730,\n        secure: true\n      };\n      if (accessTokenList.cookie_domain && accessTokenList.cookie_domain !== 'localhost' && (jqUtils.inArray(accessTokenList.cookie_domain, getPossibleCookieDomains()) >= 0)) {\n        options.domain = accessTokenList.cookie_domain;\n      }\n      if (pn.cookieDomain) {\n        options.domain = pn.cookieDomain;\n      }\n      if (pn.cookiePath) {\n        options.path = pn.cookiePath;\n      }\n\n      const domains = getPossibleCookieDomains();\n      for (let i in domains) {\n        deleteCookie('__tac', domains[i]);\n        deleteCookie('__tae', domains[i]);\n        // deleteCookie('__eea', domains[i]);\n        deleteCookie(__ut, domains[i]);\n      }\n\n      if (accessTokenList.value) {\n        setCookieConsent('composer', '__tac', accessTokenList.value, options);\n      }\n\n      setCookieConsent('composer', '__tae', expireDate.getTime(), options);\n      setCookieConsent(\"vx\", __ut, userToken, options);\n      if (userToken === '' && !skipLogging) {\n        logImplicitLogout(accessTokenList);\n      }\n    } else {\n      var domains = getPossibleCookieDomains();\n      domains.push(undefined);\n      if (pn.cookieDomain) {\n        domains.push(pn.cookieDomain);\n      }\n\n      if (pn.cookiePath) {\n        for (let i in domains) {\n          deleteCookie('__tac', domains[i], pn.cookiePath);\n          deleteCookie('__tae', domains[i], pn.cookiePath);\n          deleteCookie('__eea', domains[i], pn.cookiePath);\n          deleteCookie(__ut, domains[i], pn.cookiePath);\n        }\n      }\n\n      for (let i in domains) {\n        deleteCookie('__tac', domains[i]);\n        deleteCookie('__tae', domains[i]);\n        deleteCookie('__eea', domains[i]);\n        deleteCookie(__ut, domains[i]);\n      }\n      if (!skipLogging) {\n        logImplicitLogout(accessTokenList);\n      }\n    }\n  };\n\n  const setCurrentDomainFromResponse = (data: any) => {\n    if (data && typeof (data.browser) !== 'undefined' && typeof (data.browser.cookie_domain) !== 'undefined') {\n      doneCall('domainIsReceived', data.browser.cookie_domain);\n    }\n    if (data && data.tbc && data.tbc.cookie_domain) {\n      doneCall('domainIsReceived', data.tbc.cookie_domain);\n    }\n  };\n\n  const getCurrentDomainFromCookie = (cookieName: string, useBase64: boolean = false) => {\n    try {\n      return parseJSON(getCookie(cookieName), useBase64).domain;\n    } catch (e) {\n      startCall('domainIsReceived');\n    }\n  };\n\n  const updateCookieValueFromResponse = (\n    cookieName: '__tbc' | '__tac' | '__tae',\n    cookieValue: any,\n    domain?: string,\n  ) => {\n    const options: any = {\n      path: '/',\n      expires: 730,\n      ...(domain && { domain })\n    };\n    const domains = getPossibleCookieDomains();\n    for (let i in domains) {\n      deleteCookie(cookieName, domains[i]);\n    }\n\n    if (options.domain) {\n      deleteTLDCookieForSpecificDomains(cookieName, options.domain);\n    }\n    if (pn.cookieDomain || pn.cookiePath) {\n      options.domain = pn.cookieDomain ? pn.cookieDomain : options.domain;\n      deleteCookie(cookieName, options.domain, options.path); // delete cookie on subdomain (in case of duplicated cookie on subdomain and top level domain)\n\n      options.path = pn.cookiePath ? pn.cookiePath : options.path;\n      deleteCookie(cookieName, options.domain, options.path); // delete cookie on subdomain (in case of duplicated cookie on subdomain and top level domain)\n    }\n\n    deleteCookie(cookieName); // delete cookie on subdomain (in case of duplicated cookie on subdomain and top level domain)\n    setCookieConsent('composer', cookieName, cookieValue, options);\n  };\n\n  const setTbcCookieFromResponse = (json: any) => {\n    if (json && json.browser && typeof (json.browser.tbc) !== 'undefined') {\n      updateCookieValueFromResponse('__tbc', json.browser.tbc, json.browser.cookie_domain);\n    }\n    if (json && json.tbc && json.tbc.cookie_value) {\n      updateCookieValueFromResponse('__tbc', json.tbc.cookie_value, json.tbc.cookie_domain);\n    }\n\n  };\n\n  const setTacCookieFromResponse = (json: any) => {\n    const taeValue = new Date().getTime();\n    const prevValue = getTacCookie();\n\n    const updateCookieValue = (value: any, domain: string): void => {\n      if (!value || value === prevValue) {\n        return;\n      }\n\n      updateCookieValueFromResponse('__tac', value, domain);\n      updateCookieValueFromResponse('__tae', taeValue, domain);\n    }\n\n    if (json.browser) {\n      updateCookieValue(json.browser.tac, json.browser.cookie_domain);\n    }\n    if (json.tac) {\n      updateCookieValue(json.tac.cookie_value, json.tac.cookie_domain);\n    }\n\n  };\n\n  const setXbcCookieFromResponse = (data: any) => {\n    const XB_COOKIE = 'xbc';\n    if (data.xbc && data.xbc.cookie_value) {\n      var options: any = {\n        path: '/',\n        expires: 730\n      };\n\n      if (data.xbc.cookie_domain && data.xbc.cookie_domain !== 'localhost') {\n        options.domain = data.xbc.cookie_domain;\n\n        deleteTLDCookieForSpecificDomains(XB_COOKIE, data.xbc.cookie_domain);\n      }\n\n      if (pn.cookieDomain || pn.cookiePath) {\n\n        const domains = getPossibleCookieDomains();\n        for (let i in domains) {\n          deleteCookie(XB_COOKIE, domains[i]);\n        }\n\n        options.domain = pn.cookieDomain ? pn.cookieDomain : options.domain;\n\n        deleteTLDCookieForSpecificDomains(XB_COOKIE, options.domain, options.path);\n\n        options.path = pn.cookiePath ? pn.cookiePath : options.path;\n        deleteTLDCookieForSpecificDomains(XB_COOKIE, options.domain, options.path);\n      }\n\n      deleteCookie(XB_COOKIE); // delete cookie on subdomain (in case of duplicated cookie on subdomain and top level domain)\n      setCookieConsent('composer', XB_COOKIE, data.xbc.cookie_value, options);\n    }\n  }\n\n  const getTbcCookie = () => {\n    return getCookie('__tbc');\n  };\n\n  const getPcidCookie = () => {\n    return getCookie('_pcid');\n  }\n\n  const getTopLevelDomain = () => storage.cookie.getTopLevelDomain();\n\n  const setTpccCookies = () => {\n    var tpcc = getQueryParamByName('tpcc');\n    if (tpcc) {\n      var d = new Date();\n      var campaignCodeDate = JSON.stringify({\n        date: d.getTime()\n      });\n\n      var baseDomain = getTopLevelDomain();\n\n      if (/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(location.hostname)) {\n        baseDomain = '';\n      }\n\n      if (!baseDomain) {\n        baseDomain = '';\n      }\n\n      setCookieConsent(\"vx\", 'tpcc_' + tpcc, campaignCodeDate, { path: '/', expires: 90, domain: baseDomain });\n    }\n  };\n\n  const getAidSpecifiedName = (name: string): string => {\n    if (pn.useAidSpecifiedCookies && pn.aid) {\n      return name + '_' + pn.aid;\n    }\n    return name;\n  }\n\n  const getUserTokenCookie = (): string | null => {\n    var cookieName = getAidSpecifiedName('__ut');\n    var ut = findCookieByName(cookieName);\n    if (typeof (ut) !== 'undefined' && ut && ut.length >= 0) {\n      return ut;\n    } else {\n      return null\n    }\n  }\n\n  const getPushListsCookie = () => {\n    var cookieName = getAidSpecifiedName('__pls');\n    var pushListSubscriptions;\n\n    const jsonStr = findCookieByName(cookieName);\n\n    if (jsonStr) {\n      try {\n        pushListSubscriptions = JSON.parse(jsonStr);\n        if (pushListSubscriptions && !Array.isArray(pushListSubscriptions)) {\n          throw new Error('Push list subscriptions must be an array');\n        }\n      } catch (e) {\n        debug('Can\\'t get push list subscriptions', e);\n      }\n    }\n\n    return pushListSubscriptions;\n  }\n\n  const setPushListsCookie = (pushListId: string) => {\n    if (!pushListId) {\n      return;\n    }\n\n    var cookieName = getAidSpecifiedName('__pls');\n    var pushListSubscriptions = getPushListsCookie() || [];\n\n    if (pushListSubscriptions.indexOf(pushListId) > -1) {\n      return;\n    }\n\n    pushListSubscriptions.push(pushListId);\n\n    deleteCookie(cookieName);\n    setCookieConsent(\n      \"composer\",\n      cookieName,\n      JSON.stringify(pushListSubscriptions),\n      { path: '/', expires: 730, domain: getTopLevelDomain() }\n    );\n  }\n\n  /**\n   * return inversed browser timezone offset in minutes\n   * @returns {number}\n   * @const\n   */\n  const getBrowserTimezoneOffset = () => {\n    return -Math.round((new Date()).getTimezoneOffset());\n  }\n\n  /**\n   * return app timezone offset in milliseconds\n   * if not presented, return UTC timezone (0)\n   * @returns {number}\n   * @const\n   */\n  const getAppTimezoneOffset = (): number => {\n    if (appTimezoneOffset === undefined || appTimezoneOffset === null) {\n      // @ts-ignore\n      appTimezoneOffset = getCookie('__pat');\n    }\n    return appTimezoneOffset || 0;\n  }\n\n  /**\n   * set app timezone offset (in milliseconds)\n   * and store in cookies\n   * @param offsetInMillis\n   * @const\n   */\n  const setAppTimezoneOffset = (offsetInMillis: number) => {\n    appTimezoneOffset = offsetInMillis;\n    var baseDomain = getTopLevelDomain();\n    setCookieConsent(\"vx\", '__pat', appTimezoneOffset, { path: '/', expires: 30, domain: baseDomain });\n  }\n\n  const setAppTimezoneOffsetFromResponse = (json: any) => {\n    if (json && json.browser && json.browser.app_timezone_offset !== undefined) {\n      setAppTimezoneOffset(json.browser.app_timezone_offset);\n    } else if (json && json.timezone_offset !== undefined) {\n      setAppTimezoneOffset(json.timezone_offset);\n    }\n  }\n\n  const getCampaigns = (params: any): void => {\n    const campaignsCookies = findCookiesByName(/^tpcc_.+/);\n    const tpccQueryParam = getQueryParamByName('tpcc');\n    const currentTPCCCookieName = `tpcc_${tpccQueryParam}`;\n    let foundCurrentTPCCInCookies = false;\n\n    campaignsCookies.forEach((cookie: any) => {\n      params[cookie.name] = cookie.value;\n      if (tpccQueryParam && cookie.name === currentTPCCCookieName) {\n        foundCurrentTPCCInCookies = true;\n      }\n    });\n\n    if (tpccQueryParam && !foundCurrentTPCCInCookies) {\n      params[currentTPCCCookieName] = JSON.stringify({\n        date: Date.now()\n      });\n    }\n  }\n\n  const getCustomCookies = () => {\n    var result: any = {};\n    var customCookies = findCookiesByName(/^_pc_.+/);\n\n    customCookies.forEach((cookie: any) => {\n      result[decodeURIComponent(cookie.name)] = cookie.value;\n    });\n\n    return result;\n  }\n\n  const getPossibleCookieDomains = (): (string | undefined)[] => {\n    var domains = [];\n    domains.push(document.domain);\n    var domainPartials = document.domain?.split('.') || [];\n    while (domainPartials.length >= 2) {\n      domains.push('.' + domainPartials.join('.'));\n      domainPartials.shift();\n    }\n    return domains;\n  }\n\n  const readAdblockerCookie = (cookieName: string) => {\n    var cookieValue = getCookie(cookieName);\n\n    if (jqUtils.type(cookieValue) === 'boolean' || (jqUtils.type(cookieValue) === 'string' && cookieValue.length)) {\n      // @ts-ignore\n      return (cookieValue === true || cookieValue === 'true') ? ADBLOCKER_STATUS.ENABLED : ADBLOCKER_STATUS.DISABLED;\n    } else {\n      return ADBLOCKER_STATUS.NOT_DETECTED;\n    }\n  }\n\n  const getAdblockerHistoryCookieInfo = () => {\n    // __pnahc - piano adblocker history cookie\n    var cookieValue = getCookie('__pnahc');\n    var isFirst = false;\n    if (typeof cookieValue === 'undefined') {\n      // we don't need to set __phanc cookie here\n      cookieValue = '0';\n      isFirst = true;\n    }\n\n    return {\n      cookieValue: parseInt(cookieValue, 10),\n      isFirst: isFirst\n    };\n  }\n\n  const saveAdblockerHistoryCookieInfo = (__pnahc: number, newStatus: number) => {\n    __pnahc = __pnahc << 1;\n    if (newStatus === ADBLOCKER_STATUS.ENABLED) {\n      __pnahc = __pnahc | (1 << 0);\n    } else {\n      __pnahc = __pnahc & ~(1 << 0);\n    }\n\n    if (newStatus !== ADBLOCKER_STATUS.NOT_DETECTED) {\n      setCookieConsent(\"vx\", '__pnahc', __pnahc + '', { path: '/', expires: 90 });\n    }\n  }\n\n  const isAdblockHappend = (cookieValue: number) => {\n    var _previousBit = (cookieValue >> 0) & 1;\n    return _previousBit === 1;\n  }\n\n  const getAdblockStatus = () => {\n    var adblockerStatus = ADBLOCKER_STATUS.NOT_DETECTED;\n    var _pnahcCookieInfo = getAdblockerHistoryCookieInfo();\n\n    if (pn.adblockerCookieName) {\n      adblockerStatus = readAdblockerCookie(pn.adblockerCookieName);\n    }\n\n    if (adblockerStatus === ADBLOCKER_STATUS.NOT_DETECTED) {\n      adblockerStatus = readAdblockerCookie('__pac');\n    }\n\n    if (adblockerStatus === ADBLOCKER_STATUS.NOT_DETECTED) {\n      adblockerStatus = readAdblockerCookie('__adblocker');\n    }\n\n    saveAdblockerHistoryCookieInfo(_pnahcCookieInfo.cookieValue, adblockerStatus);\n\n    if (adblockerStatus === ADBLOCKER_STATUS.ENABLED) {\n      if (!_pnahcCookieInfo.isFirst) {\n        if (!isAdblockHappend(_pnahcCookieInfo.cookieValue)) {\n          adblockerStatus = ADBLOCKER_STATUS.ENABLED_AFTER_DISABLED;\n        }\n      }\n    }\n\n    return adblockerStatus;\n  }\n\n  const getAdblockerStatusReason = () => {\n    var _reason = '';\n    if (typeof window.blockAdBlock !== 'undefined') {\n      _reason = '1';\n    } else {\n      _reason = '0';\n    }\n\n    return _reason;\n  }\n\n  const calls: any = {};\n\n  const hasCall = (callName: string): boolean => {\n    return !!calls[callName];\n  }\n\n  const waitCall = (callName: string, callback: Function) => {\n    if (!calls[callName]) {\n      callback();\n    } else {\n      calls[callName].waiters.push(callback);\n    }\n  }\n\n  const startCall = (callName: string) => {\n    if (!calls[callName]) {\n      calls[callName] = {\n        counter: 1,\n        waiters: []\n      };\n    } else {\n      calls[callName].counter++;\n    }\n  }\n\n  const doneCall = (callName: string, args: any[]) => {\n    if (calls[callName]) {\n      calls[callName].counter--;\n      if (calls[callName].counter <= 0) {\n        var waiters: any[] = [];\n        calls[callName].waiters.forEach((f: any) => {\n          waiters.push(f);\n        });\n        delete calls[callName];\n\n        waiters.forEach((f) => {\n          f(args !== undefined ? args : {});\n        });\n      }\n    }\n  }\n\n  /**\n   * Converts a string into seconds since epoch, e.g. tp.str2timestamp('December 12, 2015 04:00:00');\n   * @param str The string to convert to seconds since epoch\n   * @returns {*}\n   */\n  const str2timestamp = (str: string) => {\n    if (typeof (str) === 'undefined' || str.length === 0) {\n      return;\n    }\n\n    if (typeof (str) !== 'string') {\n      str = '' + str;\n    }\n\n    str = str.trim();\n\n    // already a unix timestamp\n    if (str.match(/^[0-9]{0,10}$/)) {\n      // TODO: fix this before january 19th, 2038 at 03:14:08 UTC\n      return parseInt(str);\n    }\n\n    // most likely a javascript Date timestamp that is in milliseconds\n    if (str.match(/^[0-9]{13,}$/)) {\n      return parseInt(str) / 1000;\n    }\n\n    var ts = Date.parse(str);\n    if (ts) {\n      return ts / 1000;\n    }\n\n    // fix 00:XX AM|PM & 00:XX:XX AM|PM\n    str = str.replace(/00:([0-9]{2}(:[0-9]{2})?\\s*[AP]M)/i, '12:$1').replace(/([0-9]{2})([AP|M])/i, '$1 $2');\n\n    // remove any \"on, at, @, or -\" from the date\n    str = str.replace(/\\s*(at|@|\\-|on|\\|)\\s*/gi, ' ');\n\n    str = str.replace(/\\s*(mon(day)?|tue(s?day)?|wed(nesday)?|thu((rs)?day)?|fri(day)?|sat(urday)?|sun(day)?)\\s*/gi, '');\n\n    str = str.replace(/([0-9]{1,2})(st|nd|rd|th)/, '$1');\n\n    // replace bad time zone\n    if (str.match(/\\s+ET$/)) {\n      var d = new Date();\n      if (d.getTimezoneOffset() === 240) {\n        str = str.replace(/\\s+ET$/, ' EDT');\n      } else {\n        str = str.replace(/\\s+ET$/, ' EST');\n      }\n    }\n\n    str = str.trim();\n\n    ts = Date.parse(str);\n    if (ts) {\n      return ts / 1000;\n    }\n\n    // jan/3/2001\n    var m = str.match(/!^([a-z]+)[-/ ]([0-9]+)[-/ ]([0-9]+)(.*)$!i/);\n    if (m) {\n      str = m[2] + ' ' + m[1] + ' ' + m[3] + m[4];\n    } else if (m = str.match(/!^([0-9]+)[-/ ]([a-z]+)[-/ ]([0-9]+)(.*)$!i/)) {\n      // 3/jan/2008\n      str = m[1] + ' ' + m[2] + ' ' + m[3] + m[4];\n    }\n\n    ts = Date.parse(str);\n    if (ts) {\n      return ts / 1000;\n    }\n  }\n\n  const isMobileTabletIOs = () => {\n    var ua = getUserAgent();\n    return /iPad|iPhone|iPod/.test(ua) && !window.MSStream;\n  }\n\n  const isIphone = () => {\n    var ua = getUserAgent();\n    return /iPhone/.test(ua) && !window.MSStream;\n  }\n\n  const getIphoneVersion = (): number | null => {\n    const ua = getUserAgent();\n    const iPhoneInfo = ua.match(/iPhone OS (\\d{2})/);\n\n    if (iPhoneInfo) {\n      const [ match, currentVersion ] = iPhoneInfo;\n      return currentVersion ? Number(currentVersion) : null;\n    }\n\n    return null\n  }\n  const isIphone17OrHigher = () => {\n    const iPhoneVersion = getIphoneVersion();\n\n    if (iPhoneVersion) {\n      return iPhoneVersion >= 17;\n    }\n\n    return false;\n  }\n\n  const isIOS = () => {\n    var ua = getUserAgent();\n    return /iPad|iPhone|iPod/.test(ua) && !(window as any).MSStream;\n  }\n\n  const isIOsUiWebView = () => {\n    var ua = getUserAgent();\n    return /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(ua);\n  }\n\n  const isSafariOrIOsUiWebView = () => {\n    var ua = getUserAgent();\n    return /(iPhone|iPod|iPad).*AppleWebKit/i.test(ua);\n  }\n\n  const isSafariOrUiWebView = () => {\n    var ua = getUserAgent();\n    return /(Macintosh|iPhone|iPod|iPad)(?!.*Chrome)(?!.*Firefox)(?!.*Opera)(?!.*MSIE)(?!.*Trident)(.*AppleWebKit|.*Safari)/i.test(ua);\n  }\n\n  const isChrome = () => {\n    var isChromium = window.chrome;\n    var winNav = window.navigator;\n    var vendorName = winNav.vendor;\n    var isOpera = typeof window.opr !== \"undefined\";\n    var isIEedge = winNav.userAgent.indexOf(\"Edg\") > -1;\n    var isIOSChrome = winNav.userAgent.match(\"CriOS\");\n\n    if (isIOSChrome) {\n      // is Google Chrome on IOS\n      return false;\n    } else {\n      return isChromium !== null && typeof isChromium !== \"undefined\" && vendorName === \"Google Inc.\" && isOpera === false && isIEedge === false\n    }\n  }\n\n  const isFBOrInstWebView = () => {\n    var ua = getUserAgent();\n    return (ua.indexOf('FBAN') > -1) || (ua.indexOf('FBAV') > -1) || (ua.indexOf('Instagram') > -1);\n  }\n\n  const isAndroid = () => {\n    var ua = getUserAgent();\n    return /(android)/i.test(ua);\n  }\n\n  const isCxenseBot = (): boolean => {\n    var ua = getUserAgent();\n    return /(cxensebot)/i.test(ua);\n  }\n\n  const isEdge = (): boolean => /Edg(e?)/i.test(getUserAgent());\n\n  const getUserAgent = () => {\n    return navigator.userAgent || navigator.vendor || window.opera;\n  }\n\n  const isDevEndpoint = (): boolean => {\n    return versionService.getTinypassVersion().indexOf('SNAPSHOT') >= 0;\n  }\n\n  const isApplePayAllowed = (): boolean => {\n    var canApplePayMakePayments = false;\n    try {\n      canApplePayMakePayments = isSafari() && window.ApplePaySession && window.ApplePaySession.canMakePayments();\n    } catch (e) {\n      log('ApplePay error', e);\n    }\n\n    if (isDevEndpoint()) {\n      return canApplePayMakePayments;\n    } else {\n      return isHttpsProtocol() && canApplePayMakePayments;\n    }\n  }\n\n  const isHttpsProtocol = (): boolean => {\n    return document.location.protocol === 'https:';\n  }\n\n  const splitOnce = (fragment: string, delimiter: string) => {\n    var result = [];\n\n    var index = fragment.indexOf(delimiter);\n    if (index === -1) {\n      result.push(fragment);\n    } else {\n      result.push(fragment.substr(0, index));\n      result.push(fragment.substr(index + 1));\n    }\n\n    return result;\n  }\n\n  const splitUrl = (url: string) => {\n    var queryStringDelimiterIndex = url.indexOf('?');\n    var hashDelimiterIndex = url.indexOf('#');\n\n    var hasHash = false;\n    if (hashDelimiterIndex !== -1) {\n      hasHash = true;\n    }\n\n    var hasQueryString = false;\n    if (queryStringDelimiterIndex !== -1) {\n      hasQueryString = true;\n    }\n\n    if (hasHash && hasQueryString && hashDelimiterIndex < queryStringDelimiterIndex) {\n      // e.g. http://example.com#url=http://publisher.com?q=query\n      hasQueryString = false;\n    }\n\n    var schemeDomainAndPath;\n    var queryString: string = '';\n    var hash: string = '';\n\n    if (hasQueryString) {\n      var splitPartsByQueryString = splitOnce(url, '?');\n\n      schemeDomainAndPath = splitPartsByQueryString[0];\n\n      if (hasHash) {\n        var splitPartsByHash = splitOnce(splitPartsByQueryString[1], '#');\n\n        queryString = splitPartsByHash[0];\n        hash = splitPartsByHash[1];\n      } else {\n        queryString = splitPartsByQueryString[1];\n      }\n    } else {\n      if (hasHash) {\n        var splitPartsByHashWithoutQueryString = splitOnce(url, '#');\n\n        schemeDomainAndPath = splitPartsByHashWithoutQueryString[0];\n        hash = splitPartsByHashWithoutQueryString[1];\n      } else {\n        schemeDomainAndPath = url;\n      }\n    }\n\n    return {\n      schemeDomainAndPath: schemeDomainAndPath,\n      queryString: queryString,\n      hash: hash,\n      hasQueryString: hasQueryString,\n      hasHash: hasHash\n    };\n  }\n\n  const prepareQueryStringParameter = (queryParameter: string) => {\n    var splitPartsByQueryParameterValueDelimiter = splitOnce(queryParameter, '=');\n\n    var queryParameterName;\n    var queryParameterValue;\n\n    if (typeof queryParameter !== 'undefined') {\n      queryParameterName = splitPartsByQueryParameterValueDelimiter[0];\n      queryParameterValue = splitPartsByQueryParameterValueDelimiter[1];\n    }\n\n    var result = '';\n\n    if (typeof queryParameterName !== 'undefined') {\n      result += encodeURIComponent(decodeURIComponent(queryParameterName));\n    }\n\n    if (typeof queryParameterValue !== 'undefined') {\n      result += '=' + encodeURIComponent(decodeURIComponent(queryParameterValue));\n    }\n\n    return result;\n  }\n\n  const prepareQueryString = (queryString: string) => {\n    var preparedQueryString = '';\n    if (typeof queryString !== 'undefined') {\n      var splitPartsByParameterDelimiter = queryString.split('&');\n      for (var qpIndex = 0; qpIndex < splitPartsByParameterDelimiter.length; qpIndex++) {\n        if (qpIndex > 0) {\n          preparedQueryString += '&';\n        }\n\n        preparedQueryString += prepareQueryStringParameter(splitPartsByParameterDelimiter[qpIndex]);\n      }\n    }\n\n    return preparedQueryString;\n  }\n\n  const prepareUrlParameter = (url: string) => {\n    if (!url) {\n      return '';\n    }\n\n    // Trim spaces from the left side of the url\n    url = url.replace(/^((%20)|\\s)+/, '');\n\n    var splitResult = splitUrl(url);\n\n    var resultUrl = encodeURI(decodeURI(splitResult.schemeDomainAndPath));\n\n    if (splitResult.hasQueryString) {\n      resultUrl += '?' + prepareQueryString(splitResult.queryString);\n    }\n\n    if (splitResult.hasHash) {\n      resultUrl += '#' + encodeURIComponent(decodeURIComponent(splitResult.hash));\n    }\n\n    return resultUrl;\n  }\n\n  const ipPartIsValid = (part: string) => {\n    var ipPart: any = parseInt(part, 10);\n    return !(isNaN(parseFloat(ipPart)) || ipPart < 0 || ipPart > 255);\n  }\n\n  const isValidInet4Address = (hostname: string) => {\n    var partsOfIp = hostname.split('.');\n    var domainIsIp = true;\n    if (partsOfIp.length === 4) {\n      if (\n        !ipPartIsValid(partsOfIp[0]) ||\n        !ipPartIsValid(partsOfIp[1]) ||\n        !ipPartIsValid(partsOfIp[2]) ||\n        !ipPartIsValid(partsOfIp[3])\n      ) {\n        domainIsIp = false;\n      }\n    } else {\n      domainIsIp = false;\n    }\n\n    return domainIsIp;\n  }\n\n  const getHostname = (origin: string) => {\n    var linkElement = document.createElement('a');\n    var pattern = /^https?:\\/\\//i;\n    //if origin hasn't 'http://', ie returns empty hostname\n    linkElement.href = pattern.test(origin) ? origin : 'http://' + origin;\n    var hostname = linkElement.hostname;\n    if (hostname.indexOf('www.') === 0) {\n      hostname = hostname.replace('www.', '');\n    }\n    return hostname;\n  }\n\n  function debounce(func: Function, wait: number, immediate?: boolean): Function {\n    var timeout: any;\n    return function () {\n      // @ts-ignore\n      var context: any = this;\n      var args = Array.prototype.slice.call(arguments);\n      var later = function () {\n        timeout = null;\n        if (!immediate) {\n          func.apply(context, args);\n        }\n      };\n      var callNow = immediate && !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n      if (callNow) {\n        func.apply(context, args);\n      }\n    };\n  }\n\n  function throttle(func: Function, ms: number) {\n\n    var isThrottled = false;\n    let savedArgs: any;\n    let savedThis: any;\n\n    function wrapper() {\n\n      if (isThrottled) {\n        savedArgs = arguments;\n        // @ts-ignore\n        savedThis = this;\n        return;\n      }\n\n      // @ts-ignore\n      func.apply(this, arguments);\n\n      isThrottled = true;\n\n      setTimeout(function () {\n        isThrottled = false;\n        if (savedArgs) {\n          wrapper.apply(savedThis, savedArgs);\n          savedArgs = savedThis = null;\n        }\n      }, ms);\n    }\n\n    return wrapper;\n  }\n\n  function profile<T extends Function>(func: T): T & { __invokeCount: number, invokeCount: number } {\n    Object.defineProperty(wrapper, '__invokeCount', {\n      writable: true,\n      value: 0,\n    });\n    Object.defineProperty(wrapper, 'invokeCount', {\n      get: function () {\n        return this.__invokeCount;\n      }\n    });\n    function wrapper() {\n      // @ts-ignore\n      wrapper.__invokeCount++;\n      // @ts-ignore\n      return func.apply(this, arguments);\n    }\n    // @ts-ignore\n    return wrapper;\n  }\n\n  function isSafari() {\n    const userAgent = getUserAgent();\n    const match = userAgent.match(/Version.+Safari/);\n    return match !== null;\n  }\n\n  const isIE = () => {\n    var oldIE = (navigator && navigator.appVersion || '').indexOf('MSIE') !== -1;\n    // var browser = $.browser || {};\n    var userAgent = (navigator && navigator.userAgent || '');\n    var IE11 = userAgent.indexOf('Trident/') > 0\n    return oldIE || IE11;\n  }\n\n  const isCriOS = () => {\n    return (navigator && navigator.userAgent || '').indexOf('CriOS') !== -1;\n  }\n\n  const isRelativeUrl = (url: string): boolean => {\n    return /^\\/(?:\\w+|\\.{1,2}\\/\\w+)/.test(url)\n  }\n\n  const removeParamFromUrl = (url: string, paramName: string): string => {\n    //If voucher_code was found from start in the url\n    //Like: http://example.com?voucher_code=42B6GGW\n\n    //If shared_account_code was found from start in the url\n    //Like: http://example.com?shared_account_code=42B6GGW\n\n    if (new RegExp('\\\\?' + paramName, 'gi').test(url)) {\n      //Url contains any param after voucher_code\n      //Like: http://example.com?voucher_code=42B6GGW&anyparam=anyvalue\n      //Like: http://example.com?shared_account_code=42B6GGW&anyparam=anyvalue\n      //We shouldn't cut '?' symbol from the beginning\n      if (url.split('&').length > 1) {\n        return url.replace(new RegExp(paramName + '[^&]+&?', 'gi'), '');\n      } else {\n        return url.replace(new RegExp('\\\\?' + paramName + '[^&]+&?', 'gi'), '');\n      }\n\n    }\n\n    if (new RegExp('\\\\&' + paramName, 'gi').test(url)) {\n      return url.replace(new RegExp('\\\\&' + paramName + '[^&]+', 'gi'), '');\n    }\n\n    return url;\n  }\n\n  const extractCookieDomain = (href: string) => {\n    if (href && href.length && href[0] === '.') {\n      return href;\n    }\n    var url = href || window.location.href;\n    var hostname = getHostname(url);\n\n    if (isValidInet4Address(hostname)) {\n      return hostname;\n    }\n\n    if (hostname === 'localhost') {\n      return null;\n    }\n\n    return '.' + hostname;\n  }\n\n  const logImplicitLogout = (accessTokenList: string[]) => {\n    try {\n      const error = new Error();\n      sendLog({\n        trace: reduceStack(error.stack, 6),\n        desc: 'clearing __tp cookie',\n        accessTokenList,\n      })\n    } catch (e) { };\n  }\n\n  const logRemoveTokens = (payload: { uid?: string, actions: string; }): void => {\n    sendLog({\n      uid: payload.uid ?? 'n',\n      desc: 'clearing __utp cookie',\n      actions: payload.actions ?? 'n'\n    });\n  }\n\n  const sendLog = (data: Record<string, unknown>) => {\n    try {\n      const userProvider = pn.user.getProvider();\n      const log = JSON.stringify([{\n        aid: pn.aid,\n        up: userProvider.getName(),\n        url: window.location.href,\n        t: (new Date()).getTime(),\n        v: versionService.getTinypassVersion(),\n        tags: ['sdk'],\n        ...data,\n      }]);\n      pn.api.callApi('/anon/error/log', { log_message: log });\n    } catch (e) {\n    }\n  }\n\n  function documentReady(fn: Function): void {\n    var completed = function () {\n      document.removeEventListener('DOMContentLoaded', completed);\n      window.removeEventListener('load', completed);\n      fn();\n    };\n\n    // @ts-ignore\n    if (document.readyState === 'complete' || (document.readyState !== 'loading' && !document.documentElement.doScroll)) {\n      window.setTimeout(fn);\n    } else {\n      document.addEventListener('DOMContentLoaded', completed);\n      window.addEventListener('load', completed);\n    }\n  }\n\n  /**\n   * Gets cookie expiration based on preferable expiration and maximum expiration time (if set).\n   * @param preferableExpiration expiration in days (\"number\") or expiration date (\"Date\" object)\n   * @returns {*}\n   * @const\n   */\n  const getAdjustedCookieExpiration = (preferableExpiration?: number | Date): any => {\n    if (!preferableExpiration) {\n      preferableExpiration = 730;\n    }\n\n    var maxCookieExpirationInDays = pn.getMaxCookieExpirationInDays();\n    if (maxCookieExpirationInDays !== null) {\n      var expirationDate;\n      if (typeof preferableExpiration === 'number') {\n        expirationDate = new Date();\n        expirationDate.setDate(expirationDate.getDate() + preferableExpiration);\n      } else {\n        expirationDate = preferableExpiration;\n      }\n\n      var maxCookieExpirationDate = new Date();\n      maxCookieExpirationDate.setDate(maxCookieExpirationDate.getDate() + maxCookieExpirationInDays);\n\n      if (expirationDate > maxCookieExpirationDate) {\n        return maxCookieExpirationInDays;\n      }\n    }\n\n    return preferableExpiration;\n  }\n\n  const getCookie = (cookieName: string): string => {\n    return cookie.get(cookieName) as string;\n  }\n\n  const setCookieConsent = (\n    consentProduct: ConsentProductNames,\n    cookieName: string,\n    cookieValue: any,\n    options?: TCookieOptions,\n  ) => {\n    if (!consent[consentProduct]) {\n      debug('CONSENT ERROR: Consent module was not initiliazed');\n    }\n\n    setCookie(cookieName, cookieValue, options, consent[consentProduct]?.cookie.set || cookie.set);\n  }\n\n  const setCookie = (\n    cookieName: string,\n    cookieValue: any,\n    options?: any,\n    cookieSetFn: CookieInterface['set'] | ICookieConsent['set'] = cookie.set\n  ): void => {\n    options = options || {};\n    if (pn.aid === '11C6aYHwtb') {\n      options.samesite = 'none';\n      options.secure = true;\n    } else {\n      options.samesite = 'lax';\n    }\n\n    if (options.expires) {\n      options.expires = getAdjustedCookieExpiration(options.expires);\n    }\n\n    cookieSetFn(cookieName, cookieValue, options);\n\n    if (typeof itp.synchronizeCookie !== 'undefined') {\n      itp.synchronizeCookie(cookieName, cookieValue, options.expires);\n    }\n  }\n\n  const LOCAL_STORAGE_PREFIX = '__tp-';\n  // const LOCAL_STORAGE_EXPERATION_SUFFIX = '-expiration';\n\n  const getCurrentTimestamp = () => {\n    return Math.floor((new Date().getTime()) / 1000);\n  }\n\n  const hasLocalStorage = (): boolean => {\n    try {\n      return typeof window.localStorage === 'object' && typeof window.localStorage.getItem === 'function';\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * cx.js backwards compatible function.\n   * @returns {string} - random string compatible with cx.js library.\n   */\n  const randomStringCxCompatible = (): string => {\n    var randomString = (new Date().getTime()).toString(36);\n    while (randomString.length < 16) {\n      randomString += Math.round(Math.random() * 2147483647).toString(36);\n    }\n    return randomString.substr(0, 16);\n  }\n\n  const LOCAL_STORAGE_EXPERATION_SUFFIX = '-expiration';\n\n  const getLocalStorageItem = (key: string): string | number | null => {\n    const keyName = LOCAL_STORAGE_PREFIX + key;\n    const value = storage.localStorage.get(keyName);\n\n    // TODO to support legacy expirations in local storage\n    // TODO can be deleted after a week after release\n    var expirationValue = storage.localStorage.get(keyName + LOCAL_STORAGE_EXPERATION_SUFFIX);\n\n    if (expirationValue && expirationValue < getCurrentTimestamp()) {\n      storage.localStorage.remove(keyName);\n      storage.localStorage.remove(keyName + LOCAL_STORAGE_EXPERATION_SUFFIX);\n      return null;\n    }\n\n    return value;\n  }\n\n  // time in days\n  const setLocalStorageItem = (\n    consentProduct: ConsentProductNames,\n    key: string,\n    value: any,\n    expires?: LocalStorageOptions['expires'],\n    usePrefix = true\n  ): void => {\n    const keyName = (usePrefix ? LOCAL_STORAGE_PREFIX : '') + key;\n    const product = consent[consentProduct];\n\n    if (product) {\n      product.localStorage.set(keyName, value, { expires });\n    } else {\n      error(\"There is no such initiated consentProduct ->\", consentProduct);\n    }\n  }\n\n  const removeLocalStorageItem = (key: string): void => {\n    const keyName = LOCAL_STORAGE_PREFIX + key;\n    storage.localStorage.remove(keyName);\n  }\n\n  const cameFromFbSubscriptions = (): boolean => {\n    var redirectUri = getQueryParamByName('redirect_uri');\n    return redirectUri.indexOf('https://www.facebook.com/subscriptions/account-linking/confirm/') === 0;\n  }\n\n  const waitAllPromises = (promises: any[]): any => {\n    return Promise.all(promises);\n  }\n\n  const racePromise = (promises: any[]): any => {\n    return Promise.race(promises);\n  }\n\n  const isBot = (): boolean => {\n    var documentDetectionKeys = [\n      '__webdriver_evaluate',\n      '__selenium_evaluate',\n      '__webdriver_script_function',\n      '__webdriver_script_func',\n      '__webdriver_script_fn',\n      '__fxdriver_evaluate',\n      '__driver_unwrapped',\n      '__webdriver_unwrapped',\n      '__driver_evaluate',\n      '__selenium_unwrapped',\n      '__fxdriver_unwrapped'\n    ];\n\n    var windowDetectionKeys = [\n      '_phantom',\n      '__nightmare',\n      '_selenium',\n      'callPhantom',\n      'callSelenium',\n      '_Selenium_IDE_Recorder'\n    ];\n\n    for (var windowDetectionKey in windowDetectionKeys) {\n      var windowDetectionKeyValue = windowDetectionKeys[windowDetectionKey];\n      // @ts-ignore\n      if (window[windowDetectionKeyValue]) {\n        return true;\n      }\n    }\n\n    for (var documentDetectionKey in documentDetectionKeys) {\n      var documentDetectionKeyValue = documentDetectionKeys[documentDetectionKey];\n      // @ts-ignore\n      if (window.document[documentDetectionKeyValue]) {\n        return true;\n      }\n    }\n\n    for (var documentKey in window.document) {\n      // @ts-ignore\n      if (documentKey.match(/\\$[a-z]dc_/) && window.document[documentKey]['cache_']) {\n        return true;\n      }\n    }\n\n    if (window.external && window.external.toString && window.external.toString() && (window.external.toString().indexOf('Sequentum') !== -1)) {\n      return true;\n    }\n\n    if (window.document.documentElement.getAttribute('selenium')) {\n      return true;\n    }\n    if (window.document.documentElement.getAttribute('webdriver')) {\n      return true;\n    }\n    if (window.document.documentElement.getAttribute('driver')) {\n      return true;\n    }\n\n    return false;\n  }\n\n  const addScript = (src: string, onload: any): void => {\n    var a = document.createElement('script');\n    var b = document.getElementsByTagName('script')[0];\n    b.parentNode?.insertBefore(a, b);\n\n    a.type = 'text/javascript';\n    a.async = true;\n    a.onload = onload;\n    a.src = src;\n  }\n\n  const isScriptAdded = (src: string) => {\n    const scripts = document.getElementsByTagName('script');\n    for (let i = 0, k = scripts.length; i < k; i++) {\n      if (scripts[i].src.indexOf(src) > -1) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Returns camelCase text\n   * @param string - any underscore style text\n   */\n  const fromUnderscoreToCamelCase = (string: string): string => {\n    return string.slice().replace(/_[a-z]/g, function (g) {\n      return g.replace('_', '').toUpperCase();\n    });\n  }\n\n  const removeVoucherCodeFromUrl = (url: string): string => {\n    return removeParamFromUrl(url, 'voucher_code');\n  }\n\n  const removeSharedAccountCodeFromUrl = (url: string): string => {\n    return removeParamFromUrl(url, 'shared_account_code');\n  }\n\n  const mapArrayIndex = (element: any, index: number): number => {\n    return index;\n  }\n\n  const getTacCookie = () => {\n    return getCookie('__tac');\n  }\n  const getReferrer = () => {\n    return document.referrer;\n  }\n\n  const getAffiliateToken = (name: string) => {\n    const hash = window.location.hash.slice(1);\n\n    if (hash) {\n      const [paramName, tokenValue] = hash.split('=');\n\n      if ((paramName && tokenValue) && paramName === name) {\n        replaceUrl(url => url.split('#')[0]);\n        globalAffiliateToken = tokenValue;\n      }\n    }\n\n    return globalAffiliateToken;\n  }\n\n  const removeAffiliateToken = () => {\n    globalAffiliateToken = '';\n  }\n\n  const reduceStack = (stack: string | undefined, size: number): string | undefined => {\n    return stack && stack.split('\\n')\n      .filter((item, index) => index > 1 && index < (size + 1))\n      .map((i) => i.trim())\n      .join('');\n  }\n\n  /**\n   * Only one VX user can be saved. The other users should be deleted\n   */\n  const setVxUsersToDataLayer = (users?: TPropertiesSet['users']) => {\n    const dlUsers = dataLayer.get('users');\n    let needUpdate = false;\n    const filteredUsers: TPropertiesSet['users'] = dlUsers\n      ? Object.keys(dlUsers).reduce((res, key) => {\n        if (dlUsers[key]?.type === 'VX') {\n          needUpdate = true;\n          res[key] = null;\n        }\n        return res;\n      }, {} as (typeof dlUsers))\n      : {};\n\n    if (dlUsers && needUpdate || users) {\n      dataLayer.set('users', {\n        ...filteredUsers,\n        ...users\n      })\n    }\n  }\n\n  const tryFn = <V>(resolve: () => V, reject?: () => any): V | null => {\n    try {\n      return resolve();\n    } catch (e) {\n      return reject ? tryFn(reject) : null;\n    }\n  }\n\n  /**\n   * Parsing from JSON with decoding useBase64 if necessary\n   */\n  const parseJSON = (data: string, useBase64: boolean = false): any | null => {\n    return tryFn(\n      () => JSON.parse(data),\n      () => useBase64 ? JSON.parse(window.atob(data)) : null\n    ) || null;\n  }\n\n  /**\n   * Stringify data to JSON with encode to base64 if necessary\n   */\n  const toJSON = (data: any, useBase64: boolean = false): string => {\n    const str = JSON.stringify(data);\n\n    return tryFn(\n      () => useBase64 ? window.btoa(str) : str\n    ) || str;\n  }\n  /**\n   * Store userSegments from execution to the dl\n   * @param eventExecutionContext\n   */\n  const setUserSegments = (eventExecutionContext: any): void => {\n    const executeSegments: Record<string, {\n      segments: string[],\n      [x: string]: any\n    }> = eventExecutionContext.userSegments || {};\n\n    const validated = Object.keys(executeSegments).reduce((res, key) => {\n      const segments = executeSegments[key].segments;\n      if (Array.isArray(segments) && segments.length) {\n        res[key] = {\n          segments: executeSegments[key].segments\n        };\n      }\n\n      return res;\n    }, {} as NonNullable<TPropertiesSet['userSegments']>);\n\n    dataLayer.set('userSegments', Object.keys(validated).length ? validated : null);\n  }\n\n  /**\n   * Get pageview context data\n   * @param content\n   */\n\n  const getPageViewContext = (): ReturnType<UtilInterface['getPageViewContext']> => {\n    const content = dataLayer.isReady && dataLayer.get('content') || {};\n    let created: number | undefined = content.createdAt ? new Date(content.createdAt).getTime() : 0;\n    if (!created || isNaN(created)) {\n      created = undefined;\n    }\n\n    return {\n      pageTitle: content.title || window.document.title,\n      referrerUrl: prepareUrlParameter(getReferrer() || window.document.referrer),\n      url: prepareUrlParameter(window.location.href),\n      pageViewId: dataLayer.isReady && dataLayer.get('pageViewId') || null,\n      author: (content.authors || []).join(','),\n      created,\n      section: content.section,\n      tags: content.tags,\n      contentType: content.type || '',\n    }\n  }\n\n  const getBrowserId = (): string | null => {\n    return dataLayer.isReady ? dataLayer.get('browserId') : null;\n  }\n\n  const asUint8Array = (content: string): Uint8Array => {\n    let uint8Array = new Uint8Array(content.length);\n    let contentChars = content.split('');\n    for (let i = 0; i < content.length; i++) {\n      uint8Array[i] = contentChars[i].charCodeAt(0)\n    }\n    return uint8Array;\n  }\n\n  const getCookieConsents = (): TConsentV2 | TConsentV2NotAcquired | null => {\n    return dataLayer.utils.getConsent() || dataLayer.utils.notAcquiredConsent;\n  }\n\n  const getUserSegments = (): TPropertiesGet['userSegments'] | null => {\n    return dataLayer.isReady ? dataLayer.get('userSegments') : null;\n  }\n\n  const getUserSegmentsString = (): string => {\n    return JSON.stringify(getUserSegments());\n  }\n\n  const getUserState = (): TPropertiesGet['userStatus'] | null => {\n    return dataLayer.isReady ? dataLayer.get('userStatus') : null;\n  }\n\n  const requireJsFile = (jsFileSrc: string): Promise<any> => {\n    return new Promise((resolve, reject) => {\n      const a = document.createElement(\"script\");\n      a.onload = resolve;\n      a.onerror = resolve;\n      a.type = \"text/javascript\";\n      a.charset = \"utf-8\";\n      a.async = true;\n      a.src = jsFileSrc;\n      document.getElementsByTagName(\"head\")[0].appendChild(a);\n    });\n  }\n\n  return {\n    name,\n    __private__: {\n      getAdjustedCookieExpiration,\n    },\n    __protected__: {\n      deleteTLDCookieForSpecificDomains,\n      documentReady,\n      getCookie,\n      setCookieConsent,\n      setCookie,\n      getLocalStorageItem,\n      hasLocalStorage,\n      randomStringCxCompatible,\n      setLocalStorageItem,\n      removeLocalStorageItem,\n      cameFromFbSubscriptions,\n      logRemoveTokens,\n      waitAllPromises,\n      isInteger,\n      racePromise,\n      isCxenseBot,\n      isHttpsProtocol,\n      isApplePayAllowed,\n      isDevEndpoint,\n      setVxUsersToDataLayer,\n    },\n    toJSON,\n    parseJSON,\n    addScript,\n    isScriptAdded,\n    /**\n     * Returns camelCase text\n     * @param string - any underscore style text\n     */\n    fromUnderscoreToCamelCase,\n    /**\n     * Returns a random string of length\n     */\n    randomString,\n    /**\n     * Logs a message to the browser's console. Mimics console.debug(arg1, arg2, ...);\n     */\n    log,\n    /**\n     * Logs a message, but only if tp.debug = true;\n     */\n    debug,\n    /**\n     * Similar to log, except that it prints a stacktrace if the browser supports it\n     */\n    error,\n    /**\n     * Finds a cookie by name.\n     * @param name This can be either a string or a new RegExp object.\n     * @returns {*} The cookie value, or null\n     */\n    findCookieByName,\n\n    findCookiesByName,\n\n    removeVoucherCodeFromUrl,\n\n    removeSharedAccountCodeFromUrl,\n    /**\n     * Deletes a cookie by name\n     */\n    deleteCookie,\n    mapArrayIndex,\n    /**\n     * Gets the browser scroll depth\n     */\n    getScroll,\n    /**\n     * Gets the full browser pagesize, including off screen areas\n     */\n    getPageSize,\n    /**\n     * Returns the dimensions of the current viewport, as adjusted for resizing\n     * and/or pages that are longer or wider than the current browser.\n     */\n    getViewport,\n    /**\n     * Calculates the x,y necessary to center a div in the current viewport, helpful\n     * when positioning modals that need to stay in the center of the screen.\n     */\n    center,\n    centerScreen,\n    /**\n     * Extracts a GET parameter from a URL, e.g. this method would return \"about\" if\n     * the URL in the browser were http://tinypass.com/?page=about\n     */\n    getQueryParamByName,\n\n    hasQueryParamByName,\n\n    removeQueryParamByName,\n\n    setAccessTokenListCookie,\n    setTpccCookies,\n    getCampaigns,\n    getCustomCookies,\n    ADBLOCKER_STATUS: ADBLOCKER_STATUS,\n    getAdblockStatus,\n    getAdblockerStatusReason,\n    getAdblockerHistoryCookieInfo,\n    waitCall,\n    startCall,\n    doneCall,\n    hasCall,\n    debounce,\n    throttle,\n    profile,\n    setTbcCookieFromResponse,\n    setTacCookieFromResponse,\n    setXbcCookieFromResponse,\n    getTbcCookie,\n    getPcidCookie,\n    getTacCookie,\n    getAidSpecifiedName,\n    getUserTokenCookie,\n    getPushListsCookie,\n    setPushListsCookie,\n    setAppTimezoneOffsetFromResponse,\n\n    setAppTimezoneOffset,\n    getAppTimezoneOffset,\n    getBrowserTimezoneOffset,\n    str2timestamp,\n    getPossibleCookieDomains,\n    isMobileTabletIOs,\n    isIphone,\n    getIphoneVersion,\n    isIphone17OrHigher,\n    isIOS,\n    isIOsUiWebView,\n    isSafariOrIOsUiWebView,\n    isSafariOrUiWebView,\n    isFBOrInstWebView,\n    isChrome,\n    isAndroid,\n    isSafari,\n    isIE,\n    isCriOS,\n    isEdge,\n    isRelativeUrl,\n    prepareUrlParameter,\n    getReferrer,\n    getHostname,\n    extractCookieDomain,\n    setCurrentDomainFromResponse,\n    getCurrentDomainFromCookie,\n    isBot,\n    getAffiliateToken,\n    removeAffiliateToken,\n    asUint8Array,\n    setUserSegments,\n    getPageViewContext,\n    getBrowserId,\n    getCookieConsents,\n    getUserSegments,\n    getUserSegmentsString,\n    getUserState,\n    requireJsFile,\n  }\n});\n\npn.container.register('util', {\n  useValue: util()\n});\npn.util = pn.container.resolve<UtilInterface>('util');\n", "const compatibleHash = (data: string): number => {\n    let hash: number = 0;\n    for (let i = 0; i < data.length; i++) {\n        const chr = data.charCodeAt(i);\n        hash = ((hash << 5) - hash) + chr;\n        hash |= 0;\n    }\n    return hash;\n}\n\nexport const hashId = (str: string): string => compatibleHash(str).toString(36);\n\nexport const checkSum = (data: string, salt: string): string => {\n    return (compatibleHash(data) ^ compatibleHash(salt)).toString(36);\n}\n\nexport const nowInMinutes = (): number => Math.floor(Date.now() / 60000);\n", "import {storage} from \"@piano-sdk/consent\";\n\nexport const COOKIE_NAME = '_pcfe';\nexport const COOKIE_EXPIRATION = 90;\nexport const DATA_PREFIX = '{kjfx}';\nexport const MAX_WINDOW_SIZE_IN_MINUTES = 129600;\nexport const MAX_EVENTS_PER_EVENT_TYPE = 30;\nexport const MAX_BUCKETS_PER_COOKIE = 12;\nexport const PCFE_VERSION = '1';\nexport const TOP_LEVEL_DOMAIN = storage.cookie.getTopLevelDomain();\n", "import dataLayer from '@piano-sdk/data-layer';\n\n// k -- constant\n// j -- stays for JSON\n// f -- url-frielndly lz4 compression\n// x -- storage strategy, constant\nimport {checkSum, hashId as getHashId, nowInMinutes} from \"./utils\";\nimport {\n    DATA_PREFIX,\n    MAX_BUCKETS_PER_COOKIE,\n    MAX_EVENTS_PER_EVENT_TYPE,\n    MAX_WINDOW_SIZE_IN_MINUTES, PCFE_VERSION\n} from \"./pcfe.constant\";\n\nconst PREFIX_REG_EXP = /{[a-z0-9-]{1,7}}/g;\n\n/**\n * Encodes frequency data.\n *\n * @param {String} data -- frequency data to decode, expected to be a valid json object;\n * @returns url-friendly compressed string representation of frequency data.\n */\nexport type PcfeData = {\n    originStamp: number;\n    events: Record<string, {\n        timeOffsetsByType: Record<number, number[]>\n    }>;\n    v?: string;\n}\n\ntype EncodedData = {\n    os: string,\n    e: {\n        [x in string]: {\n            to: Record<string, string>\n        }\n    },\n    v?: string;\n}\nexport const encode = (data: PcfeData, aid: string): string => {\n    const encodedData: EncodedData = {\n        os: '',\n        e: {},\n        v: PCFE_VERSION,\n    };\n    const events: EncodedData['e'] = {};\n    encodedData.os = data.originStamp.toString(36);\n\n    for (const [hashId, value] of Object.entries(data.events)) {\n        const timeOffsetsByType = {};\n        for (const [eventType, offsets] of Object.entries(value.timeOffsetsByType)) {\n            Object.assign(\n                timeOffsetsByType,\n                {[eventType]: (<number[]>offsets).map(v => v.toString(36)).join(',')}\n            );\n        }\n        events[hashId] = {to: timeOffsetsByType};\n    }\n\n    encodedData.e = events;\n    const encodedJson = JSON.stringify(encodedData);\n    const uncompressedSize = encodedJson.length.toString(36); // we use 1-byte alhpabet only, so it is fine\n    const compressedJson = dataLayer.utils.compressLz(encodedJson);\n    // prefix is required for the backend to know how to interpet in a future-proof way\n    return `${DATA_PREFIX}{${uncompressedSize}}{${checkSum(compressedJson, aid)}}${compressedJson}`\n}\n\n/**\n * Decodes frequency data.\n *\n * @param {String} data -- frequency data to decode, expected to be stored in cookies,\n *  compressed by lz4 with 6bit per char encoding scheme [url-friendly];\n * @param {String} aid\n * @param {Function} debug\n * @returns runtime representation of frequency data.\n */\nexport const decode = (data: string, aid: string, debug: (msg: string) => void): PcfeData | null => {\n    // verify prefix\n    const prefixes = data.match(PREFIX_REG_EXP) || [];\n    if (prefixes.length != 3 || prefixes[0] !== DATA_PREFIX) {\n        throw new Error('Malformed input, invalid headers');\n    }\n    for (const prefix of prefixes) {\n        data = data.replace(prefix, '');\n    }\n\n    const uncompressedSize = Number.parseInt(prefixes[1].replace(/[{}]/g, ''), 36);\n\n    const actualCheckSum = checkSum(data, aid);\n    const expectedChecmSum = prefixes[2].replace(/[{}]/g, '');\n    debug(`${expectedChecmSum} : ${actualCheckSum}`);\n    if (actualCheckSum != expectedChecmSum) {\n        throw new Error('Malformed input, invalid checksum header');\n    }\n\n    const decodedData: PcfeData = {\n        originStamp: 0,\n        events: {},\n        v: undefined,\n    };\n    const events: PcfeData['events'] = {};\n    const eventArrays = [];\n    const decompressed: string | null = dataLayer.utils.decompressLz(data);\n    let parsedData: EncodedData;\n\n    if (!decompressed) {\n        throw new Error('Malformed input, cann\\'t be decoded');\n    }\n\n    if (decompressed!.length != uncompressedSize) {\n        throw new Error('Malformed input, invalid size header');\n    }\n    try {\n        parsedData = JSON.parse(decompressed)\n    } catch(e) {\n        throw new Error('Malformed input, invalid format');\n    }\n\n    let originStamp = Number.parseInt(parsedData.os, 36);\n    let gsOffset = 0; // global smallest offset\n    const now = nowInMinutes();\n    const originRebaseRequired = (now - originStamp) > MAX_WINDOW_SIZE_IN_MINUTES;\n    let hasEvents = false;\n    debug(`origin stamps: ${originStamp}, now: ${now}, rebase required: ${originRebaseRequired}`);\n\n    // parse data, remove old events, find new origin\n    for (const [hashId, value] of Object.entries(parsedData.e)) {\n        const timeOffsetsByType = {};\n        let hasOffsets = false;\n\n        for (const [eventType, offsets] of Object.entries(value.to)) {\n            let globalOffset = originStamp;\n            const timeOffsets = new Int32Array(MAX_EVENTS_PER_EVENT_TYPE);\n            let i = 0;\n            let accumulatedOffset = 0;\n\n            for (const offset of offsets.split(',')) {\n                if (i >= MAX_EVENTS_PER_EVENT_TYPE) {\n                    break;\n                }\n\n                const offsetInt = Number.parseInt(offset, 36);\n                globalOffset += offsetInt;\n                const eventAge = now - globalOffset;\n\n                if (eventAge > MAX_WINDOW_SIZE_IN_MINUTES || eventAge < 0) {\n                    debug(`${hashId}:${eventType}:${offsetInt} event age is ${eventAge}, drop`);\n                    accumulatedOffset += offsetInt;\n                    // continue; - drop events beyond 90 days\n                } else {\n                    if (originRebaseRequired && i == 0 && (offsetInt < gsOffset || gsOffset == 0)) {\n                        gsOffset = offsetInt + accumulatedOffset;\n                    }\n                    debug(`${hashId}:${eventType}:${offsetInt} event age is ${eventAge}, keep`);\n                    timeOffsets[i] = offsetInt + accumulatedOffset;\n                    accumulatedOffset = 0;\n                    i++;\n                }\n            }\n\n            const arr = Array.from(timeOffsets.subarray(0, i));\n            if (arr.length > 0) {\n                hasOffsets = true;\n                eventArrays.push(arr); // keep ref for fast lookup\n                Object.assign(timeOffsetsByType, { [eventType]: arr });\n            }\n        }\n        if (hasOffsets) {\n            hasEvents = true;\n            events[hashId] = {timeOffsetsByType: timeOffsetsByType};\n        }\n    }\n\n    if (originRebaseRequired) {\n        for (const arr of eventArrays) {\n            arr[0] = arr[0] - gsOffset;\n        }\n        originStamp = originStamp + gsOffset;\n        debug(`originStamp after rebase is ${originStamp}, used global smallest offset is ${gsOffset}`);\n    }\n\n    if (!hasEvents) {\n        return null;\n    }\n\n    decodedData['originStamp'] = originStamp;\n    decodedData['events'] = events;\n    decodedData['v'] = parsedData.v;\n    return decodedData;\n}\n\nconst FrequencyEventTypeMap = {\n    close_click: 1,\n    visible_impression: 2,\n} as const;\nconst validEventTypeValues = Object.values(FrequencyEventTypeMap);\n\ntype FrequencyEventTypeName = keyof typeof FrequencyEventTypeMap;\ntype FrequencyEventTypeValue = typeof FrequencyEventTypeMap[FrequencyEventTypeName];\n\nconst stringToFrequencyEventType = (eventType: string): number => {\n    const typeNumber = parseInt(eventType, 10);\n\n    if (!isNaN(typeNumber)) {\n        return typeNumber;\n    }\n\n    return FrequencyEventTypeMap[eventType as FrequencyEventTypeName] || 0;\n}\n\nconst isValidFrequencyEventType = (eventType: number): boolean =>\n  validEventTypeValues.includes(eventType as FrequencyEventTypeValue);\n\n/**\n * The only  method to excplicitly alter frequency data in a type-safe way. It is automatically\n *  calculates event timestamp at the invocation time and appends to the right hash bucket\n *  based on `experienceActionId`. If passed `data` is null (e.g. no data yet), then a fresh\n *  object will be generated.\n *\n * @param {String | null} data -- encoded frequency data to add to;\n * @param {String} experienceActionId -- experience action id;\n * @param {Number | String} eventTypeRaw -- unique event type, enum;\n * @param {String} aid -- application id;\n * @param {Function} debug\n * @returns {Boolean} -- altered or fresh encoded frequency data to be stored.\n */\nexport const appendEvent = (\n    data: string | null,\n    experienceActionId: string,\n    eventTypeRaw: string | number,\n    aid: string,\n    debug: (msg: string) => void,\n    ) => {\n    let eventType: number = eventTypeRaw as number;\n    if (typeof eventTypeRaw !== 'number') {\n        eventType = stringToFrequencyEventType(eventTypeRaw);\n    }\n    if (!isValidFrequencyEventType(eventType)) {\n        debug(`eventType: \"${eventTypeRaw}\" is unknown`);\n        return '';\n    }\n    const hashId = getHashId(experienceActionId);\n    // decode ensures data actuality by doing cleanup and origin rebase\n    let runtimeData: PcfeData | null = null;\n\n    try {\n        runtimeData = data ? decode(data, aid, debug) : null;\n    } catch (e: any) {\n        debug('Decode Error: ' + e.message);\n    }\n\n    if (runtimeData === null) {\n        return encode({\n            originStamp: nowInMinutes(),\n            events: {\n                [hashId]: {\n                    timeOffsetsByType: {\n                        [eventType]: [0]\n                    }\n                },\n            }\n        },\n            aid);\n    }\n\n    const bucket = runtimeData.events[hashId]?.timeOffsetsByType[eventType] || null;\n\n    if (bucket == null) {\n        if (Object.keys(runtimeData.events).length >= MAX_BUCKETS_PER_COOKIE) {\n            console.warn(\n                `${MAX_BUCKETS_PER_COOKIE} is max frequency actions count, events from ${experienceActionId} won't be recorded`);\n            return encode(runtimeData, aid);\n        }\n\n        runtimeData.events[hashId] = {\n            ...runtimeData.events[hashId],\n            timeOffsetsByType: {\n                ...runtimeData.events[hashId]?.timeOffsetsByType,\n                [eventType]: [(nowInMinutes() - runtimeData.originStamp)]\n            }\n        };\n        return encode(runtimeData, aid);\n    }\n\n    const offsetSum = bucket.reduce((acc, x) => acc + x, 0);\n    if (bucket.length >= MAX_EVENTS_PER_EVENT_TYPE) { // eviction path\n        const shiftedOffset = bucket.shift() || 0;\n        bucket[0] += shiftedOffset;\n    }\n    const offset = nowInMinutes() - runtimeData.originStamp - offsetSum;\n    bucket.push(offset < 0 ? 0 : offset);\n\n    return encode(runtimeData, aid);\n}\n", "import {decode, PcfeData} from \"./pcfe.utils\";\nimport {\n  COOKIE_NAME,\n  MAX_BUCKETS_PER_COOKIE,\n  MAX_EVENTS_PER_EVENT_TYPE,\n  TOP_LEVEL_DOMAIN\n} from \"./pcfe.constant\";\nimport { storage } from \"@piano-sdk/consent\";\nconst getAid = (): string => pn.aid;\n\nconst breakForEach = <T>(arr: Array<T>, cb: (value: T) => boolean): boolean => {\n  for (let i = 0; i < arr.length; i++) {\n    if (!cb(arr[i])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nconst readAllPcfeCookies = (): string[] => {\n  const decode = (s: string): string => {\n    const res = s.replace(/\\+/g, ' ').replace(/^\\s+|\\s+$/g, '');\n\n    try {\n      return decodeURIComponent(res);\n    } catch (e) {\n      return res;\n    }\n  };\n\n  return document.cookie.split(';')\n      .map(i => {\n        const [name, value] = i.split('=');\n\n        return decode(name) === COOKIE_NAME ? decode(value) : null;\n      })\n      .filter(i => !!i) as string[];\n};\n\nconst getAllPossiblePaths = () => {\n  return location.pathname\n    .replace(/\\/[^\\/]+$/, '')\n    .split('/')\n    .map(i => i.trim())\n    .filter(i => !!i)\n    .reduce((res, path, index) => {\n      if (!index) {\n        res.push(`/${path}`)\n      } else {\n        res.push(`${res[res.length - 1]}/${path}`);\n      }\n      return res;\n    }, ['/'])\n    .reverse();\n}\n\nconst convertTimeOffsetList = (\n  data: PcfeData,\n  cb: (offsetList: number[], eventType: number, hashId: string) => number[] | void\n): PcfeData => {\n  const result: PcfeData = {\n    ...data,\n    events: {...data.events},\n  };\n  Object.entries(data.events).forEach(([hashId, events]) => {\n    Object.entries(events.timeOffsetsByType).forEach(([eventTypeRaw, offsetList]) => {\n      const eventType = eventTypeRaw as unknown as number;\n      const newOffsetList = cb(offsetList.slice(), eventType, hashId);\n\n      if (newOffsetList) {\n        result.events[hashId] = {\n          timeOffsetsByType: {\n            ...result.events[hashId].timeOffsetsByType,\n            [eventType]: newOffsetList\n          }\n        };\n      }\n    })\n  });\n\n  return result;\n}\nconst offsetToAbsoluteTime = (data: PcfeData): PcfeData => {\n  let accOffset = data.originStamp;\n  const result = convertTimeOffsetList(data, (offsetList) => offsetList.map(offset => {\n    accOffset += offset;\n    return accOffset;\n  }));\n  result.originStamp = 0;\n\n  return result;\n}\n\nconst absoluteToOffsetTime = (data: PcfeData): PcfeData => {\n  let originTimeStamp: number = Infinity;\n  let currentOriginTimeStamp: number = 0;\n\n  // validate max events and calculate originTimeStamp\n  const sortedData = convertTimeOffsetList(data, (offsetList) => {\n    const resultList = offsetList.sort((a, b) => a - b);\n\n    if (resultList.length > MAX_EVENTS_PER_EVENT_TYPE) {\n      const cutLength = resultList.length - MAX_EVENTS_PER_EVENT_TYPE;\n\n      resultList.splice(0, cutLength);\n    }\n\n    originTimeStamp = Math.min(originTimeStamp, resultList[0]);\n\n    return resultList;\n  });\n\n  currentOriginTimeStamp = originTimeStamp;\n  // convert absolute time to offset time\n  const result = convertTimeOffsetList(sortedData, offsetList => {\n    return offsetList.map(offset => {\n      const result = offset - currentOriginTimeStamp;\n\n      currentOriginTimeStamp = offset;\n\n      return result;\n    });\n  });\n\n  result.originStamp = originTimeStamp;\n\n  return result;\n}\n\nexport const migration = (\n  domains: (string | undefined)[],\n  debugFn: (msg: string) => void\n): PcfeData | null => {\n  if (tp.cookieDomain && tp.cookiePath) {\n    return null;\n  }\n\n  const expires = new Date();\n  expires.setSeconds(expires.getSeconds() + 30);\n  const options = {\n    expires,\n    domain: tp.cookieDomain || TOP_LEVEL_DOMAIN,\n    path: tp.cookiePath || '/',\n  }\n\n  const allRawValues = readAllPcfeCookies();\n  const cacheDecodedValues = new Map<string, PcfeData | null>();\n\n  let possiblePaths = ['', ...getAllPossiblePaths()];\n  let possibleDomains = ['', ...domains.slice(0, domains.length)];\n  let priorityValue: PcfeData | null = null;\n\n  if (tp.cookiePath) {\n    possiblePaths = possiblePaths.filter(path => !path || (path.length - tp.cookiePath!.length) >= -1);\n  }\n\n  if (tp.cookieDomain) {\n    possibleDomains = possibleDomains.filter(domain => !domain || (domain.length - tp.cookieDomain!.length) >= -1);\n  }\n\n  breakForEach(possibleDomains, currentDomain => breakForEach(possiblePaths,\n    currentPath => {\n      options.domain = currentDomain;\n      options.path = currentPath;\n\n      debugFn(`remove cookie: ${JSON.stringify(options)}`)\n      storage.cookie.remove(COOKIE_NAME, options);\n      const currentValue = storage.cookie.get(COOKIE_NAME);\n\n      if (!currentValue) {\n        return false; // break removing\n      }\n\n      if (currentValue) {\n        let decoded = cacheDecodedValues.get(currentValue) || null;\n\n        if (!cacheDecodedValues.has(currentValue)) {\n          try {\n            decoded = decode(currentValue, getAid(), debugFn);\n            cacheDecodedValues.set(currentValue, decoded);\n          } catch (e) {\n          }\n        }\n        if (decoded?.v) {\n          priorityValue = offsetToAbsoluteTime(decoded);\n          return false;  // break removing\n        }\n      }\n\n      return true;\n    })\n  );\n\n  const restValues = readAllPcfeCookies();\n  const valuesToMerge = allRawValues.slice(0, allRawValues.length - restValues.length);\n  const deprecatedValues: PcfeData[] = [];\n\n  valuesToMerge.forEach(rawValue => {\n    if (cacheDecodedValues.has(rawValue)) {\n      deprecatedValues.push(offsetToAbsoluteTime(cacheDecodedValues.get(rawValue)!))\n    }\n\n    try {\n      const decoded = decode(rawValue, getAid(), debugFn);\n\n      if (decoded) {\n        deprecatedValues.push(offsetToAbsoluteTime(decoded));\n      }\n    } catch(e) {}\n  });\n\n  if (!deprecatedValues.length || deprecatedValues.length === 1 && !priorityValue) {\n    return null;\n  }\n\n  deprecatedValues.forEach(currentData => {\n    if (!priorityValue) {\n      priorityValue = currentData;\n      return;\n    }\n\n    convertTimeOffsetList(currentData, (\n      offsetList, eventType, hashId) => {\n      const priorityActionBucket = priorityValue!.events[hashId];\n\n      if (!priorityActionBucket) {\n        if (Object.keys(priorityValue!.events).length >= MAX_BUCKETS_PER_COOKIE) {\n          debugFn(`Frequency action with hashId \"${hashId}\" was skipped when merging legacy values`);\n          return;\n        }\n\n        priorityValue!.events[hashId] = currentData.events[hashId];\n        return;\n      }\n\n      const currentBucket = priorityActionBucket.timeOffsetsByType[eventType];\n\n      if (!currentBucket) {\n        priorityActionBucket.timeOffsetsByType[eventType] = offsetList;\n      } else {\n        debugFn(`Frequency action with hashId \"${hashId}\" and eventType \"${eventType}\" was skipped when merging legacy values`);\n        return;\n      }\n    });\n  });\n\n  return absoluteToOffsetTime(priorityValue!);\n}\n", "import {util, UtilInterface} from \"../util\";\nimport {appendEvent, decode, encode, PcfeData} from \"./pcfe.utils\";\nimport {TCookieOptions} from \"@piano-sdk/storage\";\nimport {storage} from \"@piano-sdk/consent\";\nimport {migration} from \"./pcfe.migration\";\nimport {COOKIE_EXPIRATION, COOKIE_NAME, PCFE_VERSION, TOP_LEVEL_DOMAIN} from \"./pcfe.constant\";\nexport interface FrequencyEventInterface {\n    __protected__: {\n        applyToParams: <T extends {[x in string]: any } & {\n            frequency?: string;\n        }>(params: T) => T,\n        registerEvent: (data: any) => void;\n    }\n}\n\ntype FrequencyEventCB = (params: {\n     event_type: number,\n     experience_Id: string,\n     experience_action_Id: string,\n }) => void;\n\nconst PianoFrequencyEvent = 'piano_frequency_event' as const;\nconst onGlobalPianoFrequencyEvent = (onEvent: (msg: Parameters<FrequencyEventCB>[number]) => void) => {\n    window.addEventListener('message', (msg: MessageEvent<string>) => {\n        try {\n            const data = JSON.parse(msg.data);\n\n            if (data?.event_name === PianoFrequencyEvent) {\n                onEvent(data as Parameters<FrequencyEventCB>[number]);\n            }\n        } catch (e) {}\n    });\n};\n\nconst registerFrequencyCb = (() => {\n    let rootRegisterCBInted = false;\n    let eventsList: Record<string, Record<string, FrequencyEventCB>> = {};\n    const onEvent = (params: Parameters<FrequencyEventCB>[number]) => {\n        const { experience_Id, experience_action_Id } = params;\n        const cb = eventsList[experience_Id]?.[experience_action_Id];\n        if (cb) {\n            cb(params)\n        }\n    }\n\n    const rootRegister = (expId: string, moduleId: string, cb: FrequencyEventCB) => {\n        if (!rootRegisterCBInted) {\n            pn.offer.registerCallback(PianoFrequencyEvent, onEvent);\n            pn.template.registerCallback(PianoFrequencyEvent, onEvent);\n            onGlobalPianoFrequencyEvent(onEvent);\n        }\n        rootRegisterCBInted = true;\n        if (!eventsList[expId]) {\n            eventsList[expId] = {};\n        }\n        eventsList[expId][moduleId] = cb;\n    }\n\n\n    return {\n        on: rootRegister,\n        off: () => eventsList = {},\n    }\n})();\n\nconst frequencyEvent = (container = pn.container): FrequencyEventInterface => {\n    const utils = container.resolve<UtilInterface>('util');\n    const options: TCookieOptions = {\n        expires: COOKIE_EXPIRATION,\n        domain: TOP_LEVEL_DOMAIN,\n        path: '/',\n    }\n\n    const debugFn = (msg: string): void => {\n        utils.debug(`PCFE: ` + msg);\n    };\n    const getAid = (): string => pn.aid;\n    const getFromCookie = () => utils.__protected__.getCookie(COOKIE_NAME);\n    const setToCookie = (value?: string | null) => {\n        if (!value) {\n            return;\n        }\n        if (pn.cookieDomain) {\n            options.domain = pn.cookieDomain;\n        }\n        if (pn.cookiePath) {\n            options.path = pn.cookiePath;\n        }\n        utils.__protected__.setCookieConsent('composer', COOKIE_NAME, value, options)\n    }\n    const removeCookie = () => {\n        if (pn.cookieDomain) {\n            options.domain = pn.cookieDomain;\n        }\n        if (pn.cookiePath) {\n            options.path = pn.cookiePath;\n        }\n        utils.deleteCookie(COOKIE_NAME, options.domain, options.path);\n    }\n\n    const get = () => {\n        const rawCookieValue = getFromCookie();\n\n        if (!rawCookieValue) {\n            return null;\n        }\n\n        let decodedValue: PcfeData | null = null;\n\n        try {\n            decodedValue = decode(rawCookieValue, getAid(), debugFn);\n            if (decodedValue && !decodedValue.v) {\n                debugFn('migrate pcfe value');\n                decodedValue = migration(utils.getPossibleCookieDomains(), debugFn) || decodedValue;\n                decodedValue.v = PCFE_VERSION;\n            }\n        } catch (e: any) {\n            // corrupted data\n            debugFn('Decode Error: ' + e.message);\n            removeCookie();\n            return null;\n        }\n\n        // no event detected\n        if (!decodedValue) {\n            removeCookie();\n\n            return null;\n        }\n\n        const encodedValue = encode(decodedValue, getAid());\n\n        setToCookie(encodedValue);\n        return encodedValue;\n    }\n\n    const applyToParams = <T extends {[x in string]: any } & {\n        frequency?: string;\n    }>(params: T): T => {\n        const data = get();\n        if (data) {\n            params['frequency'] = data;\n        }\n\n        return params;\n    }\n\n    const registerEvent = (data: any) => {\n        registerFrequencyCb.off();\n        data.result.events.forEach((event: any) => {\n            if (event.eventExecutionContext?.frequency?.track) {\n                const expId = event.eventExecutionContext?.experienceId || 'noId';\n                const moduleId = event.eventModuleParams?.moduleId || 'noId';\n\n                registerFrequencyCb.on(expId, moduleId, (params) => {\n                    const newAppendedValue = appendEvent(getFromCookie(), params.experience_action_Id, params.event_type, getAid(), debugFn);\n\n                    setToCookie(newAppendedValue);\n                });\n            }\n        });\n    }\n\n    return {\n        __protected__: {\n            applyToParams,\n            registerEvent,\n        }\n    }\n}\n\npn.container.register('frequencyEvent', {\n    useValue: frequencyEvent()\n});\npn.frequencyEvent = pn.container.resolve<FrequencyEventInterface>('frequencyEvent');\n\n", "import { LocalStorageInterface } from \"./localStorage\";\n\nexport interface ComposeControlPolicy {\n  readonly denyFbia: boolean;\n  readonly denyWeb: boolean;\n  readonly denyAll: boolean;\n  readonly denyTI: boolean;\n  __private__: {\n    setPolicyByRequest(xhr: XMLHttpRequest): void;\n    checkLS(): void;\n  }\n}\n\nconst LS_KEY = 'composer-control-policy';\nconst HEADER_NAME = 'composer-request-control-policy';\nconst TTL = 15; // minutes;\n\nconst NameListPolicy = ['deny-fbia', 'deny-web', 'deny-all', 'deny-template-interaction'] as const;\ntype Names = typeof NameListPolicy[number];\n\ntype ControlPolicyExpire = {\n  [X in Names]?: number\n}\n\nconst generateTTl = (ttl = TTL): number => {\n  return Math.ceil(Date.now() / 1000) + ttl * 60;\n}\n\nconst isDeny = (ttl?: number) => !ttl ? false : Math.ceil(Date.now() / 1000) <= ttl;\n\nconst anyToPolicy = (value: any): ControlPolicyExpire => {\n  let result: ControlPolicyExpire = {};\n  let json = value;\n\n  if (value) {\n    if (typeof value !== 'object') {\n      try {\n        json = JSON.parse(value);\n      } catch (e) {\n      }\n    }\n\n    result = NameListPolicy.reduce((res, prop) => {\n      if (json[prop]) {\n        res[prop] = json[prop];\n      }\n\n      return res;\n    }, {} as ControlPolicyExpire)\n  }\n\n  return result;\n}\n\nconst checkExpires = (value: ControlPolicyExpire) => {\n  let needToUpdate = false;\n  const newValue = (Object.keys(value) as Names[]).reduce((res, prop) => {\n    if (isDeny(value[prop])) {\n      res[prop] = value[prop]\n    } else {\n      needToUpdate = true;\n    }\n\n    return res;\n  }, {} as ControlPolicyExpire);\n\n  return {\n    needToRemove: !Object.keys(newValue).length,\n    needToUpdate,\n    newValue,\n  }\n}\n\nexport const composerControlPolicy = ((container = pn.container): ComposeControlPolicy => {\n  const localStorage = container.resolve<LocalStorageInterface>('localStorage');\n  let cachedValue: ControlPolicyExpire = anyToPolicy(localStorage.get(LS_KEY));\n\n  const checkLS = (): void => {\n    cachedValue = anyToPolicy(localStorage.get(LS_KEY));\n  }\n\n  const localStorageCheckTTl = (setValue?: ControlPolicyExpire) => {\n    const { needToUpdate, needToRemove, newValue } = checkExpires(cachedValue);\n\n    cachedValue = {\n      ...newValue,\n      ...setValue,\n    };\n    if (needToUpdate || setValue) {\n      localStorage.set(LS_KEY, JSON.stringify(cachedValue));\n    }\n    if (!setValue && needToRemove) {\n      localStorage.remove(LS_KEY);\n    }\n  }\n\n  localStorageCheckTTl();\n\n  const getFlag = (name: Names): boolean => {\n    localStorageCheckTTl();\n    return !!cachedValue['deny-all'] || !!cachedValue[name];\n  }\n\n  const setPolicyByRequest = (req: XMLHttpRequest): void => {\n    if (req.getAllResponseHeaders().includes(HEADER_NAME)) {\n      const name = req.getResponseHeader(HEADER_NAME);\n\n      if (name) {\n        localStorageCheckTTl({[name]: generateTTl()})\n      }\n    }\n  }\n\n  return {\n    get denyFbia() { return getFlag('deny-fbia')},\n    get denyWeb() { return getFlag('deny-web')},\n    get denyAll() { return getFlag('deny-all')},\n    get denyTI() { return getFlag('deny-template-interaction')},\n    __private__: {\n      setPolicyByRequest,\n      checkLS\n    }\n  }\n});\n\npn.container.register('composerControlPolicy', {\n  useValue: composerControlPolicy()\n});\npn.composerControlPolicy = pn.container.resolve<ComposeControlPolicy>('composerControlPolicy');\n", "import { UtilInterface } from \"./util\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { AjaxInterface } from \"./ajax\";\nimport { UserProviderType } from \"./user\";\n\nexport interface APIInterface {\n  name: string;\n\n  callApi(method: string, params: any, callback?: Function, endpoint?: string, sync?: boolean, httpMethod?: string): void;\n\n  getEndpoint(): string;\n\n  getCallParams(params: any, userProvider?: UserProviderType): void;\n}\n\nconst api = ((): APIInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const ajax = pn.container.resolve<AjaxInterface>('ajax');\n\n  const name = 'api';\n\n  // to prevent circular dependency, we have to create a mock user provider\n  let umc: string;\n  const tpAccessTokenV2 = util.findCookieByName(/__TP_*/);\n\n  if (typeof (window._tpm) !== 'undefined' && typeof (window._tpm['paywallID']) !== 'undefined') {\n    const paywallID = window._tpm['paywallID'];\n    umc = util.__protected__.getCookie('umc_' + paywallID);\n  }\n\n  const getEndpoint = (): string => {\n    return pn.getApiEndpoint();\n  }\n\n  const getCallParams = (params: any, userProvider?: UserProviderType): void => {\n    const tac = util.__protected__.getCookie('__tac');\n\n    if (typeof (params) === 'undefined' || !params) {\n      params = {};\n    }\n\n    params['aid'] = pn.aid;\n\n    if (umc) {\n      params['umc'] = umc;\n    }\n\n    if (tpAccessTokenV2) {\n      params['tp_access_token_v2'] = tpAccessTokenV2;\n    }\n\n    if (tac) {\n      params['tac'] = tac;\n    }\n\n    if (!params['user_provider'] && userProvider && !userProvider.isv) {\n      params['user_provider'] = userProvider.getName();\n    }\n\n    if ((typeof (params['user_token']) === 'undefined' || !params['user_token']) && userProvider && !userProvider.isv) {\n      params['user_token'] = typeof userProvider.getToken() === 'string' ? userProvider.getToken() : '';\n    }\n\n    const affiliateToken = util.getAffiliateToken(pn.affiliateTokenName);\n    if (affiliateToken) {\n      params['affiliate_token'] = affiliateToken;\n    }\n  };\n\n  const getAccessEndpointMockResponse = (method: string) => {\n    var ACCESS_LIST_METHOD = '/access/list';\n    var ACCESS_CHECK_METHOD = '/access/check';\n    var USER_ACCESS_LIST_METHOD = '/user/access/list';\n    var USER_ACCESS_CHECK_METHOD = '/user/access/check.jwt';\n\n    var isAccessMethod =\n      method === ACCESS_LIST_METHOD ||\n      method === ACCESS_CHECK_METHOD ||\n      method === USER_ACCESS_LIST_METHOD ||\n      method === USER_ACCESS_CHECK_METHOD;\n\n    if (!isAccessMethod) {\n      return null;\n    }\n\n    var currentTimestamp = Math.floor(new Date().getTime() / 1000);\n\n    var accessListMockResponse = {\n      code: 0,\n      count: 0,\n      data: [],\n      limit: 0,\n      offset: 0,\n      total: 0,\n      ts: currentTimestamp\n    };\n\n    var accessCheckMockResponse = {\n      'code': 0,\n      'ts': 1548942314,\n      'access': {\n        'access_id': null,\n        'parent_access_id': null,\n        'granted': false,\n        'resource': null,\n        'user': null,\n        'expire_date': currentTimestamp\n      }\n    };\n\n    var accessUserkMockResponse = {\n      'code': 403,\n      'ts': currentTimestamp,\n      'message': 'User doesn\\'t have permission to call this method',\n    };\n\n    if (method === ACCESS_LIST_METHOD) {\n      return accessListMockResponse;\n    }\n\n    if (method === ACCESS_CHECK_METHOD) {\n      return accessCheckMockResponse;\n    }\n\n    return accessUserkMockResponse;\n  };\n\n  const checkDoubleOptIn = (method: string) => {\n    var ACCESS_CHECK_METHOD = '/access/check';\n\n    if (!pn.isDoubleOptInCheckOnAccessCheckEnabled) {\n      return;\n    }\n\n    if (method === ACCESS_CHECK_METHOD) {\n      pn.doubleOptIn.check();\n    }\n  };\n\n  function callApi(method: string, params: any, callback: Function, endpoint: string | undefined, sync: boolean | undefined, httpMethod?: string) {\n    util.debug('Calling API method: ' + method);\n    var url: string;\n\n    if (typeof (endpoint) !== 'undefined') {\n      url = endpoint;\n    } else {\n      url = getEndpoint();\n    }\n    url = url + method;\n\n    if (typeof (params) === 'undefined' || !params) {\n      params = {};\n    }\n\n    var tbc = util.getTbcCookie();\n    if (tbc) {\n      params['tbc'] = tbc;\n    }\n\n    let userProvider: UserProviderType | undefined;\n\n    if (pn.user) {\n      userProvider = pn.user.getProvider();\n    }\n\n    getCallParams(params, userProvider);\n\n    var tpCallback: Function;\n    tpCallback = (json: any) => {\n      util.debug('API Response', json);\n      if (json) {\n        util.setTbcCookieFromResponse(json);\n        util.setAppTimezoneOffsetFromResponse(json);\n        util.setCurrentDomainFromResponse(json);\n      }\n      if (typeof (callback) !== 'undefined') {\n        callback(json);\n      }\n    }\n\n    // Mock access endpoints for anonymous user to reduce server load;\n    var accessEndpointMockResponse = getAccessEndpointMockResponse(method);\n\n    if (accessEndpointMockResponse !== null && !pn.user.getProvider().isUserValid()) {\n      tpCallback(accessEndpointMockResponse);\n      return;\n    }\n\n    checkDoubleOptIn(method);\n\n    const aid = params.aid;\n    const data = { ...params };\n    delete data.aid;\n\n    const requestParams: Record<string, any> = {\n      type: httpMethod ?? 'POST',\n      dataType: 'json',\n      data\n    };\n\n    url += '?aid=' + aid;\n    requestParams.url = url;\n\n    if (sync) {\n      requestParams.async = false;\n    }\n\n    requestParams.success = (data: any) => {\n      tpCallback(data);\n    }\n    requestParams.error = (err: any) => {\n      var response = {\n        code: 503,\n        message: 'Error: Received error when requesting API response from URL: ' + url\n      };\n      util.log(response.message);\n      tpCallback(response);\n    }\n    ajax.request(requestParams);\n  };\n\n  return {\n    name,\n    callApi: function (method: string, params: any, callback: Function, endpoint: string | undefined, sync: boolean | undefined, httpMethod?: string) {\n      return callApi(method, params, callback, endpoint, sync, httpMethod);\n    },\n    getEndpoint: function () {\n      return getEndpoint();\n    },\n    // setUserProvider: function (provider) {\n    //   return _setUserProvider(provider);\n    // },\n    getCallParams: function (params, userProvider?) {\n      return getCallParams(params, userProvider);\n    }\n  }\n\n})();\n\npn.container.register('api', {\n  useValue: api\n});\n\npn.api = pn.container.resolve<APIInterface>('api');\n", "import { UtilInterface } from \"./util\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { IframeInfoInterface } from \"./containerUtils\";\n\nexport interface PostmessageInterface {\n  name: string;\n\n  __protected__: {\n    isIframeManaged(iframeId: string): boolean;\n  };\n\n  init(config: any, initParams?: any): void;\n\n  send(event: any, params: any, recipient?: string): void;\n\n  removeIframe(iframeId: string): void;\n\n  broadcast(event: any, params?: any, exceptIframeId?: string): void;\n\n  subscribe(eventName: string, callback: Function): void;\n\n  unsubscribe(eventName: string, callback: Function): void;\n}\n\nconst postmessage = ((): PostmessageInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const name = 'postmessage';\n\n  const iframesOptions: any = {};\n  const iframes: any = {};\n  let stackMessage: any[] = [];\n  const subscribers: any = {};\n\n  const postmessage = (($: any) => {\n    var g: any, d: any, j = 1, a: any, b: any = window, f = !1, h = \"postMessage\", e = \"addEventListener\", c: any;\n    // @ts-ignore\n    const i = b[h];\n    $[h] = (k: any, l: any, m: any) => {\n      if (!l) {\n        return\n      }\n      k = typeof k === \"string\" ? k : jqUtils.param(k);\n      m = m || parent;\n      if (i) {\n        m[h](k, l.replace(/([^:]+:\\/\\/[^\\/]+).*/, \"$1\"))\n      } else {\n        if (l) {\n          m.location = l.replace(/#.*$/, \"\") + \"#\" + (+new Date) + (j++) + \"&\" + k\n        }\n      }\n    };\n    $.receiveMessage = c = (l: any, m: any, k: any) => {\n      if (i) {\n        if (l) {\n          a && c();\n          a = (n: any) => {\n            if ((typeof m === \"string\" && n.origin !== m) || (jqUtils.isFunction(m) && m(n.origin) === f)) {\n              return f\n            }\n            l(n)\n          }\n        }\n        if (b[e]) {\n          b[l ? e : 'removeEventListener']('message', a, f)\n        } else {\n          b[l ? 'attachEvent' : 'detachEvent']('onmessage', a)\n        }\n      } else {\n        g && clearInterval(g);\n        g = null;\n        if (l) {\n          k = typeof m === \"number\" ? m : typeof k === \"number\" ? k : 100;\n          g = setInterval(() => {\n            var o = document.location.hash, n = /^#?\\d+&/;\n            if (o !== d && n.test(o)) {\n              d = o;\n              l({ data: o.replace(n, \"\") })\n            }\n          }, k)\n        }\n      }\n    }\n    return $;\n  })({});\n\n  const deparam = (params: any, coerce?: any) => {\n    var obj: any = {}, coerce_types: any = { 'true': !0, 'false': !1, 'null': null };\n    params.replace(/\\+/g, ' ').split('&').forEach((j: any, v: any) => {\n      var param = v.split('=');\n      var key = '';\n      try {\n        key = decodeURIComponent(param[0]);\n      } catch (e) {\n        return;\n      }\n      var val: any, cur: any = obj, i = 0, keys: any = key.split(']['), keys_last = keys.length - 1;\n      if (/\\[/.test(keys[0]) && /\\]$/.test(keys[keys_last])) {\n        keys[keys_last] = keys[keys_last].replace(/\\]$/, '');\n        // @ts-ignore\n        keys = keys.shift().split('[').concat(keys);\n        keys_last = keys.length - 1;\n      } else {\n        keys_last = 0;\n      }\n      if (param.length === 2) {\n        val = decodeURIComponent(param[1]);\n        if (coerce) {\n          val = val && !isNaN(val) ? +val : val === 'undefined' ? undefined : coerce_types[val] !== undefined ? coerce_types[val] : val;\n        }\n        if (keys_last) {\n          for (; i <= keys_last; i++) {\n            key = keys[i] === '' ? cur.length : keys[i];\n            cur = cur[key] = i < keys_last ? cur[key] || (keys[i + 1] && isNaN(keys[i + 1]) ? {} : []) : val;\n          }\n        } else {\n          if (Array.isArray(obj[key])) {\n            obj[key].push(val);\n          } else if (obj[key] !== undefined) {\n            obj[key] = [obj[key], val];\n          } else {\n            obj[key] = val;\n          }\n        }\n      } else if (key) {\n        obj[key] = coerce ? undefined : '';\n      }\n    });\n    return obj;\n  }\n\n  function _onLoad(recipient: string) {\n    return () => {\n      var recipentMessages = stackMessage.filter(function (message) {\n        return message.recipient === recipient;\n      });\n      stackMessage = stackMessage.filter(function (message) {\n        return message.recipient !== recipient;\n      });\n      for (var i = recipentMessages.length; i--;) {\n        var tempMessage = recipentMessages.pop();\n        _postMessageSend(tempMessage.event, tempMessage.params, tempMessage.recipient);\n      }\n    };\n  };\n\n  const send = (event: any, params: any, recipient?: string): void => {\n    if (recipient && _isParent(recipient) && !(recipient in iframes)) {\n      util.error('Cannot send message to unmanaged iframe: ' + recipient);\n      return;\n    }\n    if (recipient && iframes[recipient].element) {\n      if ((iframes[recipient].config.displayMode === 'popup') ||\n        (iframes[recipient].config.displayMode !== 'popup' && iframes[recipient].element.contentWindow)) {\n        _postMessageSend(event, params, recipient);\n      } else {\n        stackMessage.push({\n          event: event, params: params, recipient: recipient\n        });\n        jqUtils.on(iframes[recipient].element, 'load', _onLoad(recipient));\n      }\n    }\n  };\n\n  const isIframeManaged = (iframeId: string): boolean => {\n    var iframe = iframes[iframeId];\n\n    return iframe && _isParent(iframe);\n  };\n\n  const _postMessageSend = (event: any, params: any, recipient: string) => {\n    var contentWindow;\n    var postMessageParams: any = {};\n    var source: any = (iframes[recipient].config.displayMode === 'popup') ? 'opener' : 'parent';\n\n    postMessageParams.sender = (_isParent(recipient) ? source : recipient);\n    postMessageParams.recipient = (_isParent(recipient) ? recipient : source);\n    postMessageParams.event = event;\n    postMessageParams.params = params;\n\n    var element = iframes[recipient].element;\n\n    if (iframes[recipient].config.displayMode === 'popup') {\n      contentWindow = iframes[recipient].container;\n    } else if (element && element.contentWindow) {\n      contentWindow = element.contentWindow;\n    } else if (element && element.toString() === '[object Window]') {\n      contentWindow = iframes[recipient].element;\n    } else {\n      contentWindow = window[source];\n    }\n    postmessage.postMessage(JSON.stringify(postMessageParams), iframesOptions[recipient].postMessageUrl, contentWindow);\n  };\n\n  const _handleKeystroke = (event: any) => {\n    if (event.keyCode === 27 && _isIframe(event.data.iframeId) && _isIframeClosable(event.data.iframeId)) {\n      send('close', null, event.data.iframeId);\n    }\n  };\n\n  function init (config: any, initParams?: any): void {\n    _addIframe(config.iframe);\n\n    if (!config.postMessageUrl) {\n      util.error('Must specify postMessageUrl to send and receive postMessages');\n      return;\n    }\n    if (config.iframe.iframeId) {\n      if (!iframesOptions[config.iframe.iframeId].initializedKeystrokeHandler) {\n        iframesOptions[config.iframe.iframeId].initializedKeystrokeHandler = true;\n        jqUtils.delegate(window, `#${config.iframe.iframeId}`, 'keyup', (event: any) => _handleKeystroke(event));\n      }\n      iframesOptions[config.iframe.iframeId].postMessageUrl = config.postMessageUrl;\n      if (!iframesOptions[config.iframe.iframeId].initializedListener) {\n        iframesOptions[config.iframe.iframeId].initializedListener = true;\n        iframesOptions[config.iframe.iframeId].receive = config.receive;\n        postmessage.receiveMessage(_processMessage);\n      }\n      iframesOptions[config.iframe.iframeId].iframeConfig = config;\n      var params = initParams || {};\n      params.height = document.documentElement.offsetHeight;\n      params.width = ((config.iframeParams && config.iframeParams.width) ? config.iframeParams.width : document.documentElement.offsetWidth);\n      send('loaded', params, config.iframe.iframeId);\n    }\n  };\n\n  const _addIframe = (iframe: IframeInfoInterface) => {\n    iframesOptions[iframe.iframeId] = {\n      iframeConfig: null,\n      receive: null,\n      postMessageUrl: null,\n      initializedListener: false,\n      initializedKeystrokeHandler: false\n    };\n    iframes[iframe.iframeId] = iframe;\n  };\n\n  const removeIframe = (iframeId: string) => {\n    delete iframes[iframeId];\n    delete iframesOptions[iframeId];\n  };\n\n  const _isIframe = (recipient: string) => {\n    return (iframesOptions[recipient] && iframesOptions[recipient].iframeConfig) ? true : false;\n  };\n\n  const _isParent = (recipient: string) => {\n    return (iframesOptions[recipient] && iframesOptions[recipient].iframeConfig) ? false : true;\n  };\n\n  const _isIframeClosable = (iframeId: string) => {\n    const iframeConfig = _getIframeConfig(iframeId);\n    return iframeConfig.showCloseButton && iframeConfig.displayMode !== 'inline';\n  }\n\n  const _getIframeConfig = (iframeId: string) => {\n    var iframeOption = iframesOptions[iframeId];\n    var iframe = iframeOption && iframeOption.iframeConfig && iframeOption.iframeConfig.iframe;\n    return iframe && iframe.config;\n  }\n\n  function _processMessage(event: any) {\n    var postMessageParams;\n    var usingCurtain = false;\n    var iframe;\n    try {\n      postMessageParams = JSON.parse(event.data);\n    } catch (err) {\n      try {\n        postMessageParams = deparam(event.data);\n        if (postMessageParams) {\n          usingCurtain = true;\n        }\n      } catch (err) {\n        util.debug('Error parsing postMessage: ' + event.data);\n        return;\n      }\n    }\n\n    notifySubscribers(postMessageParams);\n\n    if (usingCurtain) {\n      var found;\n      for (var iframeId in iframes) {\n        iframe = iframes[iframeId];\n        if (!iframe.config.isCurtain) {\n          continue;\n        }\n        found = true;\n        if (iframe.config.parent && iframesOptions[iframe.config.parent].receive) {\n          iframesOptions[iframe.config.parent].receive(postMessageParams);\n        }\n        if (iframesOptions[iframeId].receive) {\n          iframesOptions[iframeId].receive(postMessageParams);\n        }\n      }\n      if (!found) {\n        util.debug('Error parsing postMessage: ' + event.data);\n      }\n      return;\n    }\n\n    if (_isParent(postMessageParams.sender) && (!postMessageParams.sender || !(postMessageParams.sender in iframes))) {\n      util.debug('Received message from unmanaged iframe: ' + postMessageParams.sender);\n      return;\n    }\n\n    util.debug((_isIframe(postMessageParams.sender) ? 'iframe(' + postMessageParams.recipient : 'the parent') + ') received event \\'' + postMessageParams.event + '\\' from iframe(' + postMessageParams.sender + ')', postMessageParams);\n    if (iframesOptions[postMessageParams.sender].receive) {\n      iframesOptions[postMessageParams.sender].receive(postMessageParams);\n    }\n    // hotfix because it doubles one postmessage\n    if (iframes[postMessageParams.sender]) {\n      iframe = iframes[postMessageParams.sender];\n      if (iframe.config.parent && iframesOptions[iframe.config.parent].receive) {\n        var evFromChildrenToParent = true;\n        postMessageParams.sender = iframe.config.parent;\n        iframesOptions[iframe.config.parent].receive(postMessageParams, evFromChildrenToParent);\n      }\n    }\n  };\n\n  const notifySubscribers = (postMessageParams: any) => {\n    var callbacks = subscribers[postMessageParams.event] || [];\n\n    callbacks.forEach(function (callback: Function) {\n      callback(postMessageParams);\n    });\n  }\n\n  const broadcast = (event: any, params?: any, exceptIframeId?: string) => {\n    for (var iframeId in iframes) {\n      if (iframes.hasOwnProperty(iframeId) && iframeId === exceptIframeId) {\n        continue;\n      }\n      send(event, params, iframeId);\n    }\n  }\n\n  const subscribe = (eventName: string, callback: Function): void => {\n    subscribers[eventName] = subscribers[eventName] || [];\n    subscribers[eventName].push(callback);\n  }\n\n  const unsubscribe = (eventName: string, callback: Function): void => {\n    if (!(subscribers[eventName] instanceof Array)) {\n      return;\n    }\n\n    subscribers[eventName] = subscribers[eventName].filter(function (_callback: Function) {\n      return _callback !== callback;\n    });\n  }\n\n  return {\n    name,\n    init,\n    __protected__: {\n      isIframeManaged,\n    },\n    send,\n    removeIframe,\n    broadcast,\n    subscribe,\n    unsubscribe,\n  };\n\n})();\n\npn.container.register('postmessage', {\n  useValue: postmessage\n});\npn.postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n", "import { UtilInterface } from \"./util\";\nimport { PostmessageInterface } from \"./postmessage\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface EventUtilsInterface {\n  name: string;\n\n  createEventManager(config: string[]): CreateManagerInterface;\n}\n\nexport interface CreateManagerInterface {\n  addEvent(event: string): void;\n\n  hasIframeCallback(event: string, iframeId: string): boolean;\n\n  hasCallback(event: string): boolean;\n\n  registerCallback(p1: any, p2: any): void;\n\n  fireCallbacks(event: string, object: any, iframeId?: string, invokeCallbacksOnFire?: boolean): any;\n\n  fire(iframeId: string | undefined, event: string, invokeCallbacksOnFire: boolean, object: any, p1?: any, p2?: any): void;\n\n  fireCallbacksAndStopOnFirstFalse(event: string, eventCondition?: any, p1?: any, p2?: any): boolean;\n}\n\nconst eventUtils = ((): EventUtilsInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n\n  const name = 'eventUtils';\n\n  const createEventManager = (events: string[]): CreateManagerInterface => {\n    var callbacks: any = {};\n    var i;\n\n    for (i = 0; i < events.length; i++) {\n      callbacks[events[i]] = [];\n    }\n\n    var me: CreateManagerInterface = {\n      addEvent: function (event: string) {\n        if (callbacks[event] === undefined) {\n          callbacks[event] = [];\n        }\n      },\n      hasIframeCallback: function (event: string, iframeId: string) {\n        var result, callback, i;\n        if (callbacks[event] && callbacks[event].length > 0) {\n          for (i = 0, result = null, callback = null; i < callbacks[event].length; ++i) {\n            callback = callbacks[event][i];\n            if (typeof (callback) === 'object') {\n              if (iframeId === callback.iframeId) {\n                return true;\n              }\n            }\n          }\n        }\n        return false;\n      },\n      hasCallback: function (event: string) {\n        return callbacks[event] && callbacks[event].length > 0;\n      },\n      registerCallback: (p1: any, p2: any) => {\n        var event = (typeof (p1) === 'string') ? p1 : null;\n        var config = (typeof (p1) === 'object') ? p1 : null;\n        var callback, frameId, cb;\n\n        if (event) {\n          callback = (typeof p2 === 'function') ? p2 : null;\n          if (callbacks[event] === undefined) {\n            return;\n          }\n          callbacks[event].push(callback);\n        }\n\n        if (config) {\n          frameId = (typeof p2 === 'string') ? p2 : null;\n\n          for (cb in callbacks) {\n            if (typeof (config[cb]) === 'function') {\n              util.debug('Registering ' + cb + ' callback for iframe ' + frameId);\n              callbacks[cb].push({\n                iframeId: frameId,\n                callback: config[cb]\n              });\n            }\n          }\n        }\n      },\n      fireCallbacks: function (event: string, object: any, iframeId: string, invokeCallbacksOnFire: boolean) {\n        return me.fire(iframeId, event, invokeCallbacksOnFire, object);\n      },\n      fire: (iframeId: string | undefined, event: string, invokeCallbacksOnFire: boolean, object: any, p1?: any, p2?: any) => {\n        let result: any;\n        let callback: any;\n        let i: number;\n        let callbackFound = false;\n        let params: any[] = [];\n\n        object && params.push(object);\n        p1 && params.push(p1);\n        p2 && params.push(p2);\n\n        //noinspection JSUnresolvedVariable\n        var hasResultCallback = object && object.resultCallbackId;\n\n        var fire = (obj: any) => {\n          if (invokeCallbacksOnFire) {\n            try {\n              if (params.length > 1) {\n                return callback.apply(null, params);\n              } else {\n                if (event === 'loginRequired') {\n                  var term = jqUtils.deepExtend({}, obj.term);\n\n                  delete obj.term;\n\n                  return callback(obj, iframeId, term);\n                } else {\n                  return callback(obj, iframeId);\n                }\n              }\n            } catch (e) {\n              util.debug(e);\n            }\n          }\n        }\n\n        if (typeof (callbacks[event]) === 'undefined') {\n          return;\n        }\n\n        for (i = 0, result = null, callback = null; i < callbacks[event].length; ++i) {\n          callback = callbacks[event][i];\n\n          if (typeof (callback) === 'function') {\n            util.debug('firing callback for event \\'' + event + '\\'' + ' from iframe(' + iframeId + ')');\n            result = fire(object);\n            callbackFound = true;\n          } else if (typeof (callback) === 'object') {\n            if (iframeId === callback.iframeId) {\n              util.debug('firing callback for event \\'' + event + '\\'' + ' from iframe(' + iframeId + ')');\n              callback = callback.callback;\n              result = fire(object);\n              callbackFound = true;\n            } else {\n              continue;\n            }\n          }\n\n          if (hasResultCallback) {\n            object.result = result;\n            object.event = event;\n            postmessage.send('resultCallback', object, iframeId);\n          }\n        }\n\n        if (!callbackFound && hasResultCallback) {\n          object.callbackNotFound = true;\n          object.event = event;\n          postmessage.send('resultCallback', object, iframeId);\n        }\n\n        return result\n      },\n      fireCallbacksAndStopOnFirstFalse: (event: string, eventCondition?: any, p1?: any, p2?: any, ...args): boolean => {\n        if (typeof (callbacks[event]) === 'undefined') {\n          return true;\n        }\n\n        var result = true;\n        for (var i = 0; i < callbacks[event].length; i++) {\n          var callback = callbacks[event][i];\n\n          if (typeof (callback) === 'function') {\n            util.debug('firing callback for event \\'' + event + '\\'');\n\n            try {\n              let params: any[] = [];\n              params.push(eventCondition);\n              params.push(p1);\n              params.push(p2);\n              params = params.concat([].slice.call(args));\n              if (callback.apply(null, params) === false) {\n                util.debug('callback for event \\'' + event + '\\' returned false');\n                result = false;\n                break;\n              }\n            } catch (e) {\n              util.debug('firing callback for event \\'' + event + '\\' failed', e);\n            }\n          }\n        }\n\n        return result;\n      }\n    };\n    return me;\n  };\n\n  return {\n    name,\n    createEventManager,\n  }\n\n})();\n\npn.container.register('eventUtils', {\n  useValue: eventUtils\n});\npn.eventUtils = pn.container.resolve<EventUtilsInterface>('eventUtils');\n", "import { APIInterface } from \"./api\";\nimport { UtilInterface } from \"./util\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { LocalStorageInterface } from \"./localStorage\";\n\nexport interface JanrainInterface {\n  isv: boolean;\n  name: string;\n\n  init(config: any): void;\n\n  isUserValid(): boolean;\n\n  getToken(): string | null;\n\n  getName(): string;\n\n  onLoginSuccess(params: any): void;\n\n  login(callback?: Function, params?: any): void;\n\n  logout(config: any, callback: Function): void;\n\n  isConfigured(): boolean;\n\n  getLoginRequiredScreen(): string;\n\n  addEventHandler(event: string, callback: Function): void;\n\n  registerCallback(callbackName: string, callback: Function): void;\n}\n\nconst janrain = ((): JanrainInterface => {\n\n  const util = pn.container.resolve<UtilInterface>('util');\n  const api = pn.container.resolve<APIInterface>('api');\n  const eventUtils = pn.container.resolve<EventUtilsInterface>('eventUtils');\n  const localStorage = pn.container.resolve<LocalStorageInterface>('localStorage');\n\n  const eventManager = eventUtils.createEventManager(['userChanged', 'logout']);\n\n  let isv = false;\n\n  const name = 'janrain';\n\n  // any new user provider should implement these methods\n  const getName = (): string => {\n    return name;\n  };\n\n  const getToken = (): string | null => {\n    return util.getUserTokenCookie();\n  };\n\n  const isUserValid = (): boolean => {\n    var userToken = getToken();\n    return (typeof (userToken) !== 'undefined' && userToken && userToken.length >= 0) ? true : false;\n  };\n\n  const onLoginSuccess = (params: any) => {\n    util.setAccessTokenListCookie({\n        value: params.token_list,\n        cookie_domain: params.cookie_domain\n      },\n      params.user_token\n    );\n  }\n\n  /** flag to let us know we have configured janrain properly */\n  let _isJanrainConfigured = false;\n\n  /** flag that tells the janrain objects are loaded in global namespace */\n  let _isJanrainLoaded = false;\n\n  const callbackEvents: any = {\n    onCaptureSessionCreated: []\n  };\n\n  const _config: any = {\n    loginRequiredScreen: 'signIn',\n    appName: null,\n    appId: null,\n    clientId: null,\n    settings: null,\n    disableLogout: false,\n    startCapture: false\n  };\n\n  const janrainScreenMap: any = {\n    register: 'traditionalRegistration',\n    login: 'signIn'\n  };\n\n  function init(config: any) {\n    if (_isJanrainConfigured) {\n      return;\n    }\n    if (!config.appName || !config.appId || !config.clientId) {\n      throw 'Must specify appName, appId, and clientId to initialize janrain';\n    }\n\n    for (var item in _config) {\n      if (typeof (config[item]) !== 'undefined') {\n        _config[item] = config[item];\n      }\n    }\n\n    /**\n     * Copy the janrain settings to our own object\n     * This is probably legacy and not needed anymore\n     */\n    if (config.settings) {\n      _config.settings = config.settings;\n    }\n\n    if (config.loginRequiredScreen) {\n      _config.loginRequiredScreen = config.loginRequiredScreen;\n    }\n\n    /**\n     * This configuration only applies when the integrator actually passes in the janrain object\n     * Consider a legacy integration\n     */\n    if (_config.settings) {\n\n      if (typeof window.janrain !== 'object') window.janrain = {};\n      if (typeof window.janrain.settings !== 'object') window.janrain.settings = {};\n\n      const janrain = window.janrain;\n      janrain.settings = _config.settings;\n\n      if (typeof window.janrain.settings.capture !== 'object') window.janrain.settings.capture = {};\n\n      janrain.settings.appUrl = 'https://' + _config.appName + '.rpxnow.com';\n      janrain.settings.capture.captureServer = 'https://' + _config.appName + '.janraincapture.com';\n      janrain.settings.capture.appId = _config.appId;\n      janrain.settings.capture.clientId = _config.clientId;\n\n      var scriptName = _config.appName.replace(/\\./g, '-');\n      var httpLoadUrl = 'http://widget-cdn.rpxnow.com/load/' + scriptName;\n      var httpsLoadUrl = 'https://rpxnow.com/load/' + scriptName;\n      var scriptUrl;\n\n      if (util.__protected__.isHttpsProtocol()) {\n        scriptUrl = httpsLoadUrl;\n      } else {\n        scriptUrl = httpLoadUrl;\n      }\n\n      pn.push(['addExternalLibrary', scriptUrl, () => {\n        janrain.ready = true;\n      }]);\n    }\n\n    util.log('JANRAIN:', 'start refresh user token');\n    /** Start call prevents experience from running until we have established the janrain user */\n    util.startCall('refreshUserToken', 30000);\n    util.waitCall('refreshUserToken', () => {\n      util.log('JANRAIN:', 'end refresh user token');\n    });\n\n    _checkForJanrain();\n\n    _isJanrainConfigured = true;\n\n    pn.zIndexes = {\n      backdrop: 900,\n      modal: 950,\n      close: 990\n    };\n\n    var onLogin = function (result: any) {\n      util.log('JANRAIN: onLogin');\n      const janrain = window.janrain;\n      janrain.capture.ui.modal.close();\n      processUser();\n    };\n\n    addEventHandler('onCaptureLoginSuccess', onLogin);\n    addEventHandler('onCaptureRegistrationSuccess', onLogin);\n  };\n\n  function _checkForJanrain() {\n    // waiting for janrain initialization\n    var max_tries = 100;\n    var attempt = 0;\n\n    function checkForJanrain() {\n\n      const janrain = window.janrain;\n\n      if (window.janrain &&\n        window.janrain.ready &&\n        window.janrain.capture &&\n        window.janrain.capture.ui &&\n        window.janrain.capture.ui.hasActiveSession\n      ) {\n        debugAllHandlers();\n        addHandlers();\n        if (_config.startCapture) {\n          janrain.capture.ui.start();\n        }\n        _isJanrainLoaded = true;\n      } else {\n        if (attempt > max_tries) {\n          throw 'Janrain is not initialized';\n        }\n        attempt++;\n        window.setTimeout(checkForJanrain, 100);\n      }\n    }\n\n    checkForJanrain();\n  };\n\n  const getLoginRequiredScreen = (params?: any): string => {\n    return (params && janrainScreenMap.hasOwnProperty(params.startScreen)) ?\n      janrainScreenMap[params.startScreen] : _config.loginRequiredScreen;\n  };\n\n  function _registerCallback(name: string, callback: Function) {\n    // currently we don't de-register the callback if login/registration is abandoned\n    // so this is necessary to ensure that only the latest callback is ever fired.\n    // TODO: see if janrain has abandonment events that we can hook into\n    callbackEvents[name] = [];\n    callbackEvents[name].push(callback);\n  };\n\n  function _fireCallback(name: string, params: any) {\n    if (typeof (callbackEvents[name]) === 'undefined' || callbackEvents[name].length === 0) {\n      return;\n    }\n    for (var i = 0; i < callbackEvents[name].length; ++i) {\n      callbackEvents[name][i].apply(null, arguments);\n    }\n  };\n\n  function login(callback?: Function, params?: any): void {\n    if (!_isJanrainConfigured) {\n      throw 'Janrain is not configured';\n    }\n    // waiting for janrain initialization\n    var max_tries = 100;\n    var attempt = 0;\n\n    const signIn = () => {\n      if (_isJanrainLoaded) {\n        try {\n          const janrain = window.janrain;\n          janrain.capture.ui.renderScreen(getLoginRequiredScreen(params));\n          if (typeof callback === 'function') {\n            _registerCallback('onCaptureSessionCreated', callback);\n          }\n        } catch (e) {\n          attempt++;\n          window.setTimeout(signIn, 100);\n          return;\n        }\n      } else {\n        if (attempt > max_tries) {\n          throw 'Janrain is not initialized';\n        }\n        attempt++;\n        window.setTimeout(signIn, 100);\n      }\n    }\n\n    signIn();\n  };\n\n  function logout(callback: Function): void {\n    if (!_isJanrainConfigured) {\n      throw 'Janrain is not configured';\n    }\n    // waiting for janrain initialization\n    var max_tries = 100;\n    var attempt = 0;\n    var activeSessionAttempt = 0;\n\n    function waitForActiveSession() {\n      if (activeSessionAttempt > max_tries) {\n        callback();\n        return;\n      }\n      if (hasActiveSession()) {\n        activeSessionAttempt++;\n\n        window.setTimeout(waitForActiveSession, 100);\n      } else {\n        callback();\n      }\n    }\n\n    function signOut() {\n      if (_isJanrainLoaded) {\n        const janrain = window.janrain;\n\n        janrain.capture.ui.modal.close();\n        janrain.capture.ui.endCaptureSession();\n\n        eventManager.fireCallbacks('logout', null, undefined, true);\n        if (callback) {\n          waitForActiveSession();\n        }\n      } else {\n        if (attempt > max_tries) {\n          throw 'Janrain is not initialized';\n        }\n        attempt++;\n\n        window.setTimeout(signOut, 100);\n      }\n    }\n\n    cleanCookies();\n    signOut();\n  };\n\n  const isConfigured = (): boolean => {\n    return _isJanrainConfigured;\n  };\n\n  const cleanCookies = () => {\n    // default value of disable logout == false\n    if (!_config.disableLogout) {\n      util.setAccessTokenListCookie(undefined, undefined, true);\n    }\n  }\n\n  let firstRefresh = true;\n\n  const hasActiveSession = () => {\n    const janrain = window.janrain;\n    return janrain && janrain.capture && janrain.capture.ui && janrain.capture.ui.hasActiveSession();\n  }\n\n  /**\n   * Method is responsible for processing the current state of the user\n   * The ultimate goal is to make sure to convert the janrain user\n   * into our user_ref before experience executes.\n   *\n   */\n  function processUser() {\n    util.log('JANRAIN:', 'Processing janrain user');\n    if (firstRefresh) {\n      firstRefresh = false\n    } else {\n      util.startCall('refreshUserToken'); // for first refresh it start on init\n    }\n\n    util.log('JANRAIN:', 'hasActiveSession:' + hasActiveSession());\n\n    /**\n     * If the janrain token does not exist we cannot\n     * 'normally' proceed.  There is an exception\n     * with the double logout issue with Post.   Where user\n     * actually stays logged into the subdomain\n     */\n    var janrainCaptureToken = getJanrainToken();\n    if (!hasActiveSession()) {\n      util.log('JANRAIN:', 'No token found.  Done processing user');\n      cleanCookies();\n      util.doneCall('refreshUserToken');\n      return;\n    }\n\n    /**\n     * If we have a valid user_ref __ut then we are good to go\n     * there is no need for further conversion\n     */\n    if (isUserValid()) {\n      util.log('JANRAIN:', 'Using __ut.  Done processing user');\n      util.doneCall('refreshUserToken');\n      return;\n    }\n\n    var params = {\n      janrain_capture_token: janrainCaptureToken,\n      url: util.prepareUrlParameter(window.location.href)\n    };\n\n    api.callApi('/anon/janrain/verifyAccountInfo', params, (response: any) => {\n      if (response && response.access) {\n        try {\n          util.log('JANRAIN:', 'Verify success.  Done processing user');\n          util.setAccessTokenListCookie(\n            response.access.access_token,\n            response.access.user_token\n          );\n\n          var params: any = {\n            access_token: response.access.access_token,\n            user_token: response.access.user_token,\n          };\n\n          if (response.access.user) {\n            params.user = {\n              uid: response.access.user.uid,\n              email: response.access.user.email,\n              firstName: response.access.user.first_name,\n              lastName: response.access.user.last_name,\n              valid: response.access.user.valid\n            }\n          }\n\n          _fireCallback('onCaptureSessionCreated', params);\n          eventManager.fireCallbacks('userChanged', params, undefined, true);\n        } finally {\n          util.doneCall('refreshUserToken');\n        }\n      } else {\n        util.log('JANRAIN:', 'Verify failed');\n        //some reason we fail on the server, we don't want to log the user out.\n        //To me we should fail silently to avoid logging the user out\n        //due to a 500 on the server.\n        //Moreover this means something is wrong because if janrain\n        //has a valid token and we can't convert it must be our fault\n        // cookies don't clean and never finish refreshUserToken\n      }\n    });\n  }\n\n  /**\n   * Retrieve the cookie from local storage\n   */\n  const getJanrainToken = () => {\n    return localStorage.get('janrainCaptureToken');\n  }\n\n  /**\n   * These handlers are the critical ones we must listen\n   * to for proper janrain integration\n   */\n  const addHandlers = () => {\n    const janrain = window.janrain;\n    janrain.events.onProviderLogoutComplete.addHandler(() => {\n      cleanCookies();\n    });\n\n    /**\n     * This is Janrain equivalent of logout\n     */\n    janrain.events.onCaptureSessionEnded.addHandler((e: any) => {\n      util.log('JANRAIN: Events received for logout', e);\n      cleanCookies();\n    });\n\n    addProcessUserHandlers();\n  }\n\n  const addProcessUserHandlers = () => {\n    /**\n     * if we have active session it means that janrain capture token is valid\n     * and we not need wait sso handlers.\n     */\n    if (hasActiveSession()) {\n      util.log('JANRAIN:', 'Found early active session via function');\n      processUser();\n      return;\n    }\n\n    /**\n     * if we dont have any cookies or janrain capture token. we should process user\n     */\n    if (!hasActiveSession() && !isUserValid() && !getJanrainToken()) {\n      util.log('JANRAIN:', 'not found __ut cookie and janrain token');\n      processUser();\n      return;\n    }\n\n    var isCaptureFederateNoLogin = false;\n    /**\n     * Session found happens when a user is normally logged in\n     * In the case of SSO,  there are two events that are required.\n     * First isCaptureFederateNoLogin and SessionFound.  If both\n     * are received then we have a valid user\n     */\n    const janrain = window.janrain;\n\n    janrain.events.onCaptureSessionFound.addHandler((e: any) => {\n      if (isJanrainSSO()) {\n        if (isCaptureFederateNoLogin) {\n          util.log('JANRAIN: Events received for logged in user', e);\n          processUser();\n        }\n      } else {\n        processUser();\n      }\n    });\n\n    /**\n     * Represents a logged out user\n     * In SSO mode, two events must be fired before we can proceed.\n     */\n    janrain.events.onCaptureSessionNotFound.addHandler((e: any) => {\n      if (isJanrainSSO()) {\n        if (isCaptureFederateNoLogin) {\n          util.log('JANRAIN: Events received for logged out user', e);\n          processUser();\n        }\n      } else {\n        processUser();\n      }\n    });\n\n    janrain.events.onCaptureFederateNoLogin.addHandler((result: any) => {\n      isCaptureFederateNoLogin = result;\n    });\n\n    /**\n     * Represents the first time a user SSO logins going to a new domain\n     * In janrain world it is consider a silent login hence\n     * the onCaptureFederateLogin event.\n     */\n    janrain.events.onCaptureFederateLogin.addHandler((e: any) => {\n      util.log('JANRAIN: Events received for SSO login', e);\n      processUser();\n    });\n  }\n\n  /**\n   * Helper method to verify janrain is configured for SSO mode\n   */\n  const isJanrainSSO = () => {\n    const janrain = window.janrain;\n    return janrain && janrain.settings && janrain.settings.capture && janrain.settings.capture.federate;\n  }\n\n  function addEventHandler (event: string, callback: Function): void {\n    if (!_isJanrainConfigured) {\n      throw 'Janrain is not configured';\n    }\n    // waiting for janrain initialization\n    var max_tries = 100;\n    var attempt = 0;\n\n    function _addEventHandler () {\n      const janrain = window.janrain;\n\n      if (_isJanrainLoaded) {\n        janrain.events[event].addHandler((data: any) => {\n          callback(data);\n        });\n      } else {\n        if (attempt > max_tries) {\n          throw 'Janrain is not initialized';\n        }\n        attempt++;\n\n        window.setTimeout(_addEventHandler, 100);\n      }\n    }\n\n    _addEventHandler();\n  }\n\n  /**\n   * Dump all janrain events into the logger\n   */\n  function debugAllHandlers () {\n    const janrain = window.janrain;\n    const addLog = function (e: string) {\n      janrain.events[e].addHandler((...handlerArgs: any[]) => {\n        util.log('JANRAIN: ', e, handlerArgs);\n      })\n    }\n\n    if (pn.debug) {\n      janrain.events.captureEvents.forEach(addLog);\n    }\n  }\n\n  const registerCallback = (callbackName: string, callback: Function): void => {\n    eventManager.addEvent(callbackName);\n    eventManager.registerCallback(callbackName, (data: any) => {\n      callback(data);\n    });\n  }\n\n  return {\n    name,\n    isv,\n    init,\n    isUserValid,\n    getToken,\n    getName,\n    onLoginSuccess,\n    login,\n    logout,\n    isConfigured,\n    getLoginRequiredScreen,\n    addEventHandler,\n    registerCallback,\n  };\n\n})();\n\npn.container.register('janrain', {\n  useValue: janrain\n});\npn.janrain = pn.container.resolve<JanrainInterface>('janrain');\n", "export interface SHA1Interface {\n  name: string;\n\n  hash(msg: string, length?: number): string;\n}\n\nconst sha1 = ((): SHA1Interface => {\n  /**\n   *\n   *  Secure Hash Algorithm (SHA1)\n   *  http://www.webtoolkit.info/\n   *\n   **/\n\n  function hash(msg: string, length?: number): string {\n    length = length || 32;\n\n    function rotate_left(n: number, s: number) {\n      var t4 = (n << s) | (n >>> (32 - s));\n      return t4;\n    };\n\n    function lsb_hex(val: number) {\n      var str = \"\";\n      var i;\n      var vh;\n      var vl;\n      for (i = 0; i <= 6; i += 2) {\n        vh = (val >>> (i * 4 + 4)) & 0x0f;\n        vl = (val >>> (i * 4)) & 0x0f;\n        str += vh.toString(16) + vl.toString(16);\n      }\n      return str;\n    };\n\n    function cvt_hex(val: number) {\n      var str = \"\";\n      var i;\n      var v;\n      for (i = 7; i >= 0; i--) {\n        v = (val >>> (i * 4)) & 0x0f;\n        str += v.toString(16);\n      }\n      return str;\n    };\n\n    function Utf8Encode(string: string) {\n      string = string.replace(/\\r\\n/g, \"\\n\");\n      var utftext = \"\";\n      for (var n = 0; n < string.length; n++) {\n        var c = string.charCodeAt(n);\n        if (c < 128) {\n          utftext += String.fromCharCode(c);\n        } else if ((c > 127) && (c < 2048)) {\n          utftext += String.fromCharCode((c >> 6) | 192);\n          utftext += String.fromCharCode((c & 63) | 128);\n        } else {\n          utftext += String.fromCharCode((c >> 12) | 224);\n          utftext += String.fromCharCode(((c >> 6) & 63) | 128);\n          utftext += String.fromCharCode((c & 63) | 128);\n        }\n      }\n      return utftext;\n    };\n    var blockstart;\n    var i, j;\n    var W = new Array(80);\n    var H0 = 0x67452301;\n    var H1 = 0xEFCDAB89;\n    var H2 = 0x98BADCFE;\n    var H3 = 0x10325476;\n    var H4 = 0xC3D2E1F0;\n    var A, B, C, D, E;\n    var temp: number | string;\n    msg = Utf8Encode(msg);\n    var msg_len = msg.length;\n    var word_array = new Array();\n    for (i = 0; i < msg_len - 3; i += 4) {\n      j = msg.charCodeAt(i) << 24 | msg.charCodeAt(i + 1) << 16 |\n        msg.charCodeAt(i + 2) << 8 | msg.charCodeAt(i + 3);\n      word_array.push(j);\n    }\n    switch (msg_len % 4) {\n      case 0:\n        i = 0x080000000;\n        break;\n      case 1:\n        i = msg.charCodeAt(msg_len - 1) << 24 | 0x0800000;\n        break;\n      case 2:\n        i = msg.charCodeAt(msg_len - 2) << 24 | msg.charCodeAt(msg_len - 1) << 16 | 0x08000;\n        break;\n      case 3:\n        i = msg.charCodeAt(msg_len - 3) << 24 | msg.charCodeAt(msg_len - 2) << 16 | msg.charCodeAt(msg_len - 1) << 8 | 0x80;\n        break;\n    }\n    word_array.push(i);\n    while ((word_array.length % 16) != 14) word_array.push(0);\n    word_array.push(msg_len >>> 29);\n    word_array.push((msg_len << 3) & 0x0ffffffff);\n    for (blockstart = 0; blockstart < word_array.length; blockstart += 16) {\n      for (i = 0; i < 16; i++) W[i] = word_array[blockstart + i];\n      for (i = 16; i <= 79; i++) W[i] = rotate_left(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16], 1);\n      A = H0;\n      B = H1;\n      C = H2;\n      D = H3;\n      E = H4;\n      for (i = 0; i <= 19; i++) {\n        temp = (rotate_left(A, 5) + ((B & C) | (~B & D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;\n        E = D;\n        D = C;\n        C = rotate_left(B, 30);\n        B = A;\n        A = temp;\n      }\n      for (i = 20; i <= 39; i++) {\n        temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;\n        E = D;\n        D = C;\n        C = rotate_left(B, 30);\n        B = A;\n        A = temp;\n      }\n      for (i = 40; i <= 59; i++) {\n        temp = (rotate_left(A, 5) + ((B & C) | (B & D) | (C & D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;\n        E = D;\n        D = C;\n        C = rotate_left(B, 30);\n        B = A;\n        A = temp;\n      }\n      for (i = 60; i <= 79; i++) {\n        temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;\n        E = D;\n        D = C;\n        C = rotate_left(B, 30);\n        B = A;\n        A = temp;\n      }\n      H0 = (H0 + A) & 0x0ffffffff;\n      H1 = (H1 + B) & 0x0ffffffff;\n      H2 = (H2 + C) & 0x0ffffffff;\n      H3 = (H3 + D) & 0x0ffffffff;\n      H4 = (H4 + E) & 0x0ffffffff;\n    }\n    temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);\n    return temp.toLowerCase().slice(0, length);\n  }\n\n  return {\n    name: 'sha1',\n    hash,\n  }\n\n})()\n\npn.sha1 = sha1;\n\npn.container.register('sha1', {\n  useValue: sha1\n})\n", "import { UtilInterface } from \"./util\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface ObserverInterface {\n  name: string;\n\n  create($element: HTMLElement, callback: Function): AttrObserver | MutationObserver;\n}\n\nclass AttrObserver {\n  callback: Function;\n  _isActive = false;\n  targets: any[] = [];\n  timeout = 200;\n  util: UtilInterface;\n\n  constructor(callback: Function, util: UtilInterface) {\n    this.util = util;\n    this.callback = callback;\n  }\n\n  _mutationSearch() {\n    var that = this;\n    this.targets.forEach(function (target) {\n      var state = that._getState(target.element);\n      if (!state === target.currentState) {\n        target.currentState = state;\n        that.callback([{\n          target: target.element\n        }]);\n      }\n    });\n    if (this._isActive) {\n      setTimeout(this._mutationSearch.bind(this), this.timeout);\n    }\n  };\n\n  _getState(element: any) {\n    var attributes = [].slice.call(element.attributes);\n    var attributesMap = attributes.reduce(function (acc: any, attr: any) {\n      acc[attr.name] = element.getAttribute(attr.name);\n      return acc;\n    }, {});\n\n    return JSON.stringify(attributesMap);\n  };\n\n  observe(element: any) {\n    this.targets.push({\n      id: this.util.randomString(),\n      element: element,\n      currentState: this._getState(element)\n    });\n    if (!this._isActive) {\n      this._isActive = true;\n      this._mutationSearch();\n    }\n  };\n\n  disconnect() {\n    this._isActive = false;\n    this.targets = [];\n  };\n\n}\n\nconst observer = ((): ObserverInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const mutationObserver = window.MutationObserver ||\n    window.WebKitMutationObserver ||\n    window.MozMutationObserver;\n\n  const attrsConfig = {\n    attributes: true\n  };\n\n  const name = 'observer';\n\n  const create = ($element: HTMLElement, callback: Function): AttrObserver | MutationObserver => {\n    if (!$element) {\n      util.error('element must be NODE');\n    }\n    var Observer = !!mutationObserver ? mutationObserver : AttrObserver;\n    var observer = new Observer((mutations) => {\n      var elements = mutations.map((mutation) => {\n        return mutation.target;\n      });\n      return typeof callback === 'function' && callback(elements);\n    }, util);\n\n    observer.observe($element, attrsConfig);\n\n    return observer;\n  }\n\n  return {\n    name,\n    create,\n  }\n\n})();\n\npn.container.register('observer', {\n  useValue: observer\n});\npn.observer = pn.container.resolve<ObserverInterface>('observer');\n", "import { UtilInterface } from \"./util\";\nimport { PostmessageInterface } from \"./postmessage\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { SHA1Interface } from \"./sha1\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface IframeConfigInterface {\n  initTime: number;\n  preview: boolean;\n  displayMode: string;\n  child: string;\n  isPreload: boolean;\n  userToken?: string;\n  verification_code?: string;\n  maxHeight: number;\n}\n\nexport interface IframeParamsInterface {\n  iframeId: string;\n  iframeUrl?: string;\n  pos?: any;\n  containerSelector: string | undefined;\n  width: number;\n  height: number;\n  zone?: string;\n}\n\nexport interface IPopupPosition {\n  width: number;\n  height: number;\n  top: number;\n  left: number;\n}\n\nexport interface IframeInfoInterface {\n  iframeId: string;\n  config: IframeConfigInterface;\n  element: HTMLElement;\n  container: HTMLElement;\n  iframeParams?: IframeParamsInterface;\n  containerReady?: boolean;\n  waitFinishProcesses?: boolean;\n  containerWidth?: number;\n  containerHeight?: number;\n  statParams?: any;\n  browserId?: string;\n  observer?: any;\n  resizeObserver?: ResizeObserver;\n  [key: string]: any\n}\n\nexport interface IframesInfoMapInterface {\n  [index: string]: IframeInfoInterface;\n}\n\nexport interface PopupContainersIntervalMapInterface {\n  [index: string]: {\n    container: Window,\n    interval: number\n  };\n}\n\nexport interface ContainerUtilsInterface {\n  name: string;\n  fakeOfferId: string;\n\n  createContainer(config: any): IframeInfoInterface;\n\n  showPreloadedContainer(iframe: any): void;\n\n  redirectContainer(iframeId: string, config: any): void;\n\n  hasModalIframe(): boolean;\n\n  getForm(params: Record<string, any>): HTMLFormElement;\n\n  getIframe(iframeId: string): any;\n\n  generateIframe(config: any, params: any, src: string): HTMLElement;\n\n  generateIframeWrapper(): HTMLElement;\n\n  getPopupPosition(params: any): any;\n\n  generatePopup(params: any, src: string): Window | null;\n\n  initInlineContainer(config: any): IframeInfoInterface;\n\n  getModalContainer(config: any, onClose: Function): HTMLElement;\n\n  centerBackdrop(container: any): any;\n\n  checkBackdropAndContainer(iframe: any, useStack?: boolean, putOnStack?: boolean): void;\n\n  resizeIframe(iframe: IframeInfoInterface, params: any): void;\n\n  centerIt(container: HTMLElement): void;\n\n  operationWithContainer(containerSelector: string, operation: Function): void;\n\n  closeContainer(iframeId: string, parentId?: string): void;\n\n  closeModalContainer(iframeId?: string, parentId?: string): void;\n\n  purgeIframe(iframeId: string, parentId: string): void;\n\n  hideModalContainer(sender?: string): string[];\n\n  closeModal(iframe: any): void;\n\n  hideCloseButton(container?: any): void;\n\n  activateContainers(iframeIds: string[]): void;\n\n  showWaitPanel(): void;\n\n  hideWaitPanel(): void;\n\n  addClassToContainer(iframe: any, className: string): void;\n\n  showBackdrop(tpModalElement?: any, useStack?: boolean, putOnStack?: boolean): void;\n\n  hideBackdrop(): void;\n\n  turnOnRTL(iframe: any): void;\n\n  turnOffRTL(iframe: any): void;\n\n  setIframesPopstateHandlers(): void;\n\n  __protected__: {\n    setElementSizes(elem: any, params: any): void,\n    closeInlineContainers(selector: string): void,\n    addChildToInlineIframe(iframe: any, sender: string): void,\n    closeAndRemoveIframe(iframe: any): void\n  },\n  __private__: {\n    mobileModalFix: any,\n  }\n}\n\nconst containerUtils = ((): ContainerUtilsInterface => {\n\n  const BROWSER_ELEMENT_SIZE_ADMISSIBLE_ERROR = 0.1; // in pixels\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const eventUtils = pn.container.resolve<EventUtilsInterface>('eventUtils');\n  const sha1 = pn.container.resolve<SHA1Interface>('sha1');\n\n  const name = 'containerUtils';\n\n  const iframes: IframesInfoMapInterface = {};\n  const popupContainersInterval: PopupContainersIntervalMapInterface = {};\n  const eventManager = eventUtils.createEventManager(['close']);\n\n  const fakeOfferId = 'fakeOfferId';\n  const containerInnerClass = 'tp-container-inner';\n  const localWaitPanelsMap = new Map<string, ChildNode>();\n  const excludedQueryParams = {\n    continuation: true,\n  };\n\n  let waitPanelElement: ChildNode | null;\n  let modalHeightObserver: MutationObserver | null;\n\n  // this creates the backdrop on load by default\n\n  /**\n   * This is the modal wrapper. It contains iframe wrapper, iframe and close button\n   */\n    // @ts-ignore\n  let tpModal: HTMLElement;\n\n  const tpModalStack: HTMLElement[] = [];\n\n  const scrollPreventionClassNames: { [key: string]: string } = {\n    tpModal: 'tp-modal-overscroll-prevented',\n    scrollPrevented: 'tp-scroll-prevented',\n    body: 'tp-body-scroll-prevented',\n  }\n\n  const mobileModalFix: any = {\n    _initialScrollPosition: {\n      x: 0,\n      y: 0,\n    },\n    applyFix: function () {\n      var maxTop = window.visualViewport\n        ? Math.max(window.scrollY, document.documentElement.scrollTop, window.visualViewport.pageTop)\n        : Math.max(window.scrollY, document.documentElement.scrollTop);\n\n      this.saveInitialScroll(window.scrollX, maxTop);\n\n      if (tpModal) {\n        !util.isIphone17OrHigher() && _scrollToTopAfterLoading();\n        _preventContentElementScroll();\n\n        _setClassToElement(tpModal, scrollPreventionClassNames.tpModal);\n      }\n    },\n    removeFix: function () {\n      if (document.querySelectorAll('.tp-iframe-wrapper.tp-active').length) {\n        return;\n      }\n\n      this._scrollBack();\n\n      if (modalHeightObserver) {\n        modalHeightObserver.disconnect();\n        modalHeightObserver = null;\n      }\n\n      _unPreventContentElementScroll();\n    },\n    _scrollBack: function () {\n      if (this._initialScrollPosition.y || this._initialScrollPosition.x) {\n        _scrollTo(this._initialScrollPosition.x, this._initialScrollPosition.y);\n      }\n    },\n    saveInitialScroll: function (x: number, y: number) {\n      this._initialScrollPosition.x = x;\n      this._initialScrollPosition.y = y;\n    },\n    modalOpened: function () {\n      this.applyFix();\n    },\n    modalClosed: function () {\n      this.removeFix();\n    }\n  };\n\n  const _setClassToElement = (element: HTMLElement, className: string) => {\n    element.classList.add(className);\n  }\n\n\n  // let scrollListener: EventListenerOrEventListenerObject | null;\n  // let contentElementOptions: { element: HTMLElement; oldHeight: string; oldOverflow: string; oldPosition: string; } | null = null;\n\n  // const _findHighestElement = (): HTMLElement | null => {\n  //   const bodyChildren = Array.from(document.body.children);\n  //   let highestEl: HTMLElement | null = null;\n  //   let elHeight = 0;\n  //\n  //   bodyChildren.forEach((el) => {\n  //     if (el.tagName !== 'SCRIPT' && el.tagName !== 'STYLE' && el.tagName !== 'IFRAME') {\n  //       if (el.clientHeight > elHeight) {\n  //         elHeight = el.clientHeight;\n  //         highestEl = el as HTMLElement;\n  //       }\n  //     }\n  //   });\n  //\n  //   return highestEl;\n  // }\n  //\n  // const _preventBackdropTouchmove = () => {\n  //   document.addEventListener('touchmove', (event) => {\n  //     console.log('touchmove', event);\n  //     const changeList: TouchList = event.changedTouches;\n  //     const targetEl = changeList[0].target as HTMLElement;\n  //     const isBackdropEl = targetEl.classList.contains('tp-backdrop tp-active');\n  //\n  //     if (isBackdropEl) {\n  //       console.log('prevent touchmove');\n  //       event.preventDefault();\n  //       event.stopPropagation();\n  //     }\n  //   });\n  // }\n  //\n  // const _preventContentElementScroll2 = () => {\n  //   const element = _findHighestElement() as HTMLElement;\n  //\n  //   if (element) {\n  //     contentElementOptions = {\n  //       element,\n  //       oldHeight: element.style.height,\n  //       oldOverflow: element.style.overflow,\n  //       oldPosition: element.style.position\n  //     };\n  //\n  //     element.style.height = '100vh';\n  //     element.style.overflow = 'hidden';\n  //     element.style.position = 'fixed';\n  //   }\n  // }\n  //\n  // const _preventUnderBackdropScroll = () => {\n  //   scrollListener = (event) => {\n  //     console.log('scroll', event);\n  //     const targetEl = event.target as HTMLDocument;\n  //     const isDocument = targetEl.nodeName === '#document';\n  //\n  //     if (isDocument) {\n  //       targetEl.documentElement.style.height = '100vh';\n  //       targetEl.documentElement.style.overflow = 'hidden';\n  //       targetEl.documentElement.style.position = 'fixed';\n  //       scrollListener && document.removeEventListener('scroll', scrollListener);\n  //       scrollListener = null;\n  //     }\n  //   };\n  //\n  //   document.addEventListener('scroll', scrollListener);\n  // }\n\n  const _preventContentElementScroll = () => {\n    _setClassToElement(document.documentElement, scrollPreventionClassNames.scrollPrevented);\n    _setClassToElement(document.body, scrollPreventionClassNames.body);\n  }\n\n  const removeClassesFromElements = (className: string): void => {\n    document.querySelectorAll(`.${className}`).forEach((element) => {\n      element.classList.remove(className);\n    });\n  }\n\n  const _unPreventContentElementScroll = () => {\n    removeClassesFromElements(scrollPreventionClassNames.scrollPrevented);\n\n    removeClassesFromElements(scrollPreventionClassNames.body);\n  }\n\n  const _scrollToTopAfterLoading = () => {\n    const iframeWrapperEl = document.querySelectorAll('.tp-iframe-wrapper');\n    const lastIframeWrapperEl = iframeWrapperEl[iframeWrapperEl.length - 1];\n\n    const callbackFn = (mutationsList: MutationRecord[], observer: MutationObserver) => {\n      for (let mutation of mutationsList) {\n        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {\n          _scrollTo(0, 0);\n        }\n      }\n    }\n\n    modalHeightObserver = new MutationObserver(callbackFn);\n    modalHeightObserver.observe(lastIframeWrapperEl as Node, { attributes: true, childList: true, subtree: true });\n  }\n\n  /**\n   * Scrolls window to passed coordinates\n   *\n   * @param x x coordinate\n   * @param y y coordinate\n   * @const\n   */\n  const _scrollTo = (x: number, y: number) => {\n    function isNative(fn: Function) {\n      return ((/\\{\\s*\\[native code\\]\\s*\\}/)).test('' + fn);\n    }\n\n    try {\n      if (isNative(window.scrollTo)) {\n        window.scrollTo(x, y);\n        return;\n      }\n\n      if (isNative(window.scroll)) {\n        window.scroll(x, y);\n        return;\n      }\n\n      if (document.body) {\n        document.body.scrollTop = 0;\n      }\n    } catch (e: any) {\n      console.warn('Can not perform scroll: ' + e.message);\n    }\n  };\n\n  jqUtils.on(window, 'resize', () => {\n    _resizeAllContainers();\n    if (util.isAndroid()) {\n      const modal = document.querySelector('.tp-iframe-wrapper.tp-active')?.closest('.tp-modal');\n      if (modal) {\n        modal.scrollBy(0, 1);\n      }\n    }\n  })\n\n  if (util.isIOS()) {\n    jqUtils.on(window, 'orientationchange', () => {\n      setTimeout(() => _resizeAllContainers(), 100);\n    });\n  }\n\n  postmessage.subscribe('close', () => {\n    mobileModalFix.modalClosed();\n  });\n\n  postmessage.subscribe('toggleIframeShadow', (data: any) => {\n    toggleWrapperShadow(data.params.isEnabled);\n  });\n\n  postmessage.subscribe('toggleLoadingContainer', (data: any) => {\n    if (data.params.isEnabled) {\n      return showWaitPanel();\n    }\n\n    hideWaitPanel();\n  });\n\n  const toggleWrapperShadow = (isEnabled: boolean) => {\n    var wrapperElement = document.querySelector('.tp-iframe-wrapper');\n    if (!wrapperElement) {\n      return;\n    }\n\n    if (isEnabled) {\n      return wrapperElement.classList.contains('no-shadow') && wrapperElement.classList.remove('no-shadow');\n    }\n\n    wrapperElement.classList.add('no-shadow');\n  }\n\n  /**\n   * Removes an iframe from the dom. This will not dismiss the backdrop\n   * or container.\n   *\n   * @param iframe The ifram remove\n   * @const\n   */\n  const _removeIframe = (iframe: any) => {\n    util.debug('Removing iframe', iframe);\n\n    if (iframe.element) {\n      jqUtils.hide(iframe.element);\n\n      if (iframe.config.displayMode === 'inline') {\n        const parentEl = iframe.element.parentElement;\n        if (parentEl) {\n          jqUtils.hide(parentEl);\n        }\n      }\n    }\n\n    if (iframe.resizeObserver) {\n      iframe.resizeObserver.disconnect();\n    }\n\n    if (iframe.config.displayMode === 'modal' || iframe.config.displayMode === 'inline') {\n      iframe.waitFinishProcesses = true;\n    }\n  };\n\n  /**\n   * Purge an iframe from the dom\n   *\n   * @param iframeId The iframeId to remove\n   * @const\n   */\n  const purgeIframe = (iframeId: string, parentId?: string) => {\n    util.debug('Purging iframe', iframeId);\n    var iframe = iframes[iframeId];\n\n    try {\n      if (iframe.resizeObserver) {\n        iframe.resizeObserver.disconnect();\n      }\n      postmessage.removeIframe(iframe.iframeId);\n      jqUtils.remove(iframe.element);\n\n      if (iframe.config.displayMode === 'inline') {\n\n        const innerContainer = jqUtils.queryEl('.tp-container-inner', iframe.container);\n\n        if (innerContainer) {\n          jqUtils.remove(innerContainer);\n        }\n      }\n    } catch (e) {\n    }\n\n    delete iframes[iframeId];\n  };\n\n  const _checkInternalProcessesBeforeClose = (iframe: any) => {\n    postmessage.send('checkProccessesForClose', {}, iframe.iframeId);\n  };\n\n  /**\n   * Closes an iframe and removes it from the dom. In most cases if not all\n   * cases, this should not be used for inline iframes.\n   *\n   * @param iframe  The iframe to close\n   * @const\n   */\n  const closeAndRemoveIframe = (iframe: any): void => {\n    _checkInternalProcessesBeforeClose(iframe);\n    if (iframe.config.displayMode === 'popup') {\n      iframe.container.close();\n    } else {\n      _removeIframe(iframe);\n      _hideTpModal();\n      hideBackdrop();\n    }\n  };\n\n  const hasModalIframe = (): boolean => {\n    for (var iframeId in iframes) {\n      var iframe = iframes[iframeId];\n      if (iframe.config.displayMode === 'modal' && !iframe.waitFinishProcesses && !iframe.config.isPreload) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  const getForm = (params: Record<string, any>): HTMLFormElement => {\n    let form = document.createElement('form');\n\n    const formAttrs: Record<string, string> = {\n      id: 'form_' + params.iframeId,\n      method: 'post',\n      action: params.iframeSrc,\n      target: params.iframeId\n    };\n\n    jqUtils.setAttrs(formAttrs, form);\n\n    const fields = [\n      {name: 'userToken', value: params.userToken},\n    ];\n\n    fields.forEach( (field) => {\n      const input = document.createElement('input');\n      const inputAttrs: Record<string, string> = {\n        type: 'hidden',\n        name: field.name\n      };\n\n      jqUtils.setAttrs(inputAttrs, input);\n\n      input.value = field.value;\n\n      jqUtils.append(form, input);\n    });\n\n    return form;\n  }\n\n  const getIframe = (iframeId: string): IframeInfoInterface => {\n    return iframes[iframeId];\n  };\n\n  /**\n   * Initializes the container for an iframe to sit inside of. This is only\n   * used if we are showing an offer or the checkout process in a modal.\n   *\n   * In the case of an inline offer, the publisher specifies the container\n   * by passing in:\n   *\n   *    tp.offer.show({\n   *        // all required fields, plus\n   *        displayMode: \"inline\"\n   *        containerSelector: \"my-jquery-selector'\n   *    });\n   *\n   * In the case of a modal, this container can be re-used.\n   *\n   * @returns {*}\n   * @const\n   */\n  class ModalContainer {\n    // @ts-ignore\n    container: HTMLElement;\n    // @ts-ignore\n    element: HTMLElement;\n    // @ts-ignore\n    close: HTMLElement;\n    iframeWrapper?: HTMLElement;\n    closeClick?: Function;\n    _operationWithContainer: Function;\n    $: JqUtilsInterface;\n    util: UtilInterface;\n    iOSBottomToolbarHeight: number;\n\n    constructor(\n      $: JqUtilsInterface,\n      util: UtilInterface,\n      _operationWithContainer: Function\n    ) {\n      this.$ = $;\n      this._operationWithContainer = _operationWithContainer;\n      this.util = util;\n      this._initModalContainer();\n      this.iOSBottomToolbarHeight = 90;\n    }\n\n    private _initModalContainer(): HTMLElement {\n      if (this.container) {\n        return this.container;\n      }\n\n      this.container = document.createElement('div');\n      this.element = this.container;\n      this.$.addClass('tp-modal', this.container);\n      this.close = document.createElement('button');\n      this.$.setAttr('type', \"button\", this.close);\n      this.$.setAttr('aria-label', 'Close', this.close);\n      this.$.addClass('tp-close', this.close);\n      this.iframeWrapper = document.createElement('div');\n      this.$.addClass('tp-iframe-wrapper', this.iframeWrapper);\n      this.$.append(this.iframeWrapper, this.close);\n\n      this.container.style.zIndex = pn.zIndexes.modal + '';\n      this.close.style.zIndex = pn.zIndexes.close + '';\n\n      this.$.on(this.close, 'click', () => {\n        if (typeof (this.closeClick) === 'function') {\n          this.closeClick();\n        }\n      });\n\n      if (this.util.isIOS() && !this.util.isFBOrInstWebView()) {\n        this.iframeWrapper.style.marginBottom = `${this.iOSBottomToolbarHeight}px`;\n      }\n\n      this.$.append(this.container, this.iframeWrapper);\n\n      this._operationWithContainer('body', (containerBody: any) => {\n        this.$.append(containerBody, this.container);\n      });\n\n      return this.container;\n    };\n\n    getContainer(withCloseButton: boolean, onClose: Function): HTMLElement {\n      this._initModalContainer();\n      this.closeClick = onClose;\n\n      if (typeof (withCloseButton) === 'undefined') {\n        withCloseButton = true;\n      }\n\n      if (withCloseButton) {\n        this.showCloseButton();\n      } else {\n        this.hideCloseButton();\n      }\n\n      // @ts-ignore\n      return this.iframeWrapper;\n    };\n\n    show(withCloseButton: boolean) {\n      this._initModalContainer();\n\n      if (typeof (withCloseButton) === 'undefined') {\n        withCloseButton = true;\n      }\n\n      if (withCloseButton) {\n        this.showCloseButton();\n      } else {\n        this.hideCloseButton();\n      }\n\n      this.$.addClass('tp-active', this.container);\n    };\n\n    hide() {\n      this._initModalContainer();\n      this.$.removeClass('tp-active', this.container);\n    };\n\n    showCloseButton() {\n      this._initModalContainer();\n      this.$.addClass('tp-active', this.close);\n    };\n\n    hideCloseButton() {\n      this._initModalContainer();\n      this.$.removeClass('tp-active', this.close);\n    };\n  }\n\n  const _applyInlineContainer = (iframe: IframeInfoInterface) => {\n    jqUtils.show(iframe.container);\n    const innerContainer = jqUtils.queryEl(`.${containerInnerClass}`, iframe.container);\n    if (innerContainer) {\n      jqUtils.show(innerContainer);\n    }\n    resizeIframe(iframe, {\n      width: jqUtils.getWidth(iframe.container)\n    });\n  };\n\n  const _applyModalContainer = (iframe: IframeInfoInterface) => {\n    tpModal = iframe.container.closest('.tp-modal') as HTMLElement;\n    if (tpModal) {\n      tpModal = tpModal;\n    } else {\n      util.error('there is no such modal container');\n    }\n\n    checkBackdropAndContainer(iframe, true, true);\n  };\n\n  /**\n   * Handles keystrokes and closes the container if the user presses the escape\n   * key. This only works for offers that are operating with displayMode: modal\n   *\n   * @param event\n   * @const\n   */\n  const _handleKeystroke = (event: any) => {\n    // if (event.keyCode === 27 && iframes.map(util.mapArrayIndex).length > 0) {\n    // omv3 commented out because this needs to respect whether the close button is shown or not\n    //_closeModalContainer();\n    // }\n  };\n\n  /**\n   * Closes container.\n   * If modalOnly is set, closes only modal containers.\n   *\n   * @const\n   */\n  const closeContainer = (sender?: string, parent?: string, modalOnly?: boolean) => {\n    util.debug('Search container to close', sender, parent, modalOnly);\n\n    for (var iframeId in iframes) {\n      var iframe = iframes[iframeId];\n\n      if (sender && iframeId !== sender) {\n        continue;\n      }\n\n      if (modalOnly && iframe.config.displayMode === 'inline') {\n        continue;\n      }\n\n      if (modalOnly && iframe.config.isPreload) {\n        continue;\n      }\n\n      if (iframe.config.displayMode === 'modal') {\n        closeModal(iframe);\n      }\n\n      closeAndRemoveIframe(iframe);\n    }\n    eventManager.fireCallbacks('close', null, sender, true);\n  };\n\n  const _closeInlineContainer = (iframeId: string) => {\n    var iframe = getIframe(iframeId);\n\n    if (iframe.config.child) {\n      closeContainer(iframe.config.child);\n    }\n\n    closeContainer(iframeId);\n  }\n\n  const closeInlineContainers = (selector: string): void => {\n    var domIframes = Array.prototype.slice.call(document.querySelectorAll(selector + ' > .' + containerInnerClass + ' > iframe'));\n    domIframes.forEach((domIframe) => {\n      if (domIframe.id) {\n        _closeInlineContainer(domIframe.id);\n      }\n    });\n  }\n\n  const closeModal = (iframe: any): void => {\n    var stackModal = tpModalStack.shift();\n\n    if (backdrop && !stackModal) {\n      jqUtils.removeClass('tp-active', backdrop);\n    }\n\n    iframe.iframeParams.shown = false;\n    jqUtils.removeClass('tp-active', iframe.container);\n\n    if (!stackModal) {\n      _hideTpModal();\n      hideBackdrop();\n    } else {\n      jqUtils.hide(tpModal);\n      tpModal = stackModal;\n      jqUtils.show(tpModal);\n    }\n  }\n\n  /**\n   * This is the semi-transparent backdrop that appears beneath modals\n   */\n    // @ts-ignore\n  let backdrop: HTMLElement;\n  let showBackdropTimeout: number;\n  const showBackdropTimeoutMs = 50;\n\n  const _createBackdrop = () => {\n    if (backdrop) {\n      return backdrop;\n    }\n    var elm = document.createElement('div');\n\n    jqUtils.addClass('tp-backdrop', elm);\n    // elm.addClass('tp-backdrop');\n    elm.style.zIndex = pn.zIndexes.backdrop + '';\n\n    operationWithContainer('body', (containerBody: HTMLElement) => {\n      jqUtils.append(containerBody, elm);\n    });\n\n    backdrop = elm;\n\n    return elm;\n  };\n\n  /**\n   * Shows the main wrapper of the popup's\n   * @const\n   */\n  const _showTpModal = (tpModalElement: HTMLElement) => {\n    if (jqUtils.visible(tpModalElement)) {\n      return;\n    }\n\n    operationWithContainer('body', (containerBody: any) => {\n      jqUtils.removeClass('tp-modal-close', containerBody);\n      jqUtils.addClass('tp-modal-open', containerBody);\n    });\n\n    // may occurs some bugs with closed modal\n    jqUtils.show(tpModalElement);\n\n    if (util.isIphone() || util.isSafariOrIOsUiWebView() || util.isAndroid()) {\n      mobileModalFix.modalOpened();\n    }\n  };\n\n  /**\n   * Hides the main wrapper of the popup's if it exists\n   * @const\n   */\n  const _hideTpModal = () => {\n    if (!tpModal) {\n      return;\n    }\n\n    operationWithContainer('body', (containerBody: any) => {\n      jqUtils.addClass('tp-modal-close', containerBody);\n      jqUtils.removeClass('tp-modal-open', containerBody);\n\n      if (containerBody.classList.contains('body-fixed')) {\n        jqUtils.removeClass('body-fixed', containerBody);\n      }\n    });\n    jqUtils.hide(tpModal);\n  };\n\n  /**\n   * Shows the backdrop, and creates it if necessary\n   * @const\n   */\n  const showBackdrop = (tpModalElement?: HTMLElement, useStack?: boolean, putOnStack?: boolean): void => {\n    _createBackdrop();\n\n    if (jqUtils.visible(backdrop)) {\n      const modals = jqUtils.qa('.tp-modal');\n      const modal = modals.find((el: HTMLElement) => jqUtils.visible(el));\n\n      if (useStack && !putOnStack) {\n        if (modal) {\n          jqUtils.hide(modal);\n          tpModalStack.unshift(modal);\n        }\n\n        if (tpModalElement) {\n          jqUtils.show(tpModalElement);\n        }\n      } else if (useStack) {\n        if (modal) {\n          if (tpModalElement) {\n            tpModalStack.push(tpModalElement);\n          }\n          tpModal = modal;\n        } else {\n          if (tpModalElement) {\n            jqUtils.show(tpModalElement);\n          }\n        }\n      }\n\n      return;\n    }\n\n    jqUtils.show(backdrop);\n    if (tpModalElement) {\n      _showTpModal(tpModalElement);\n    }\n\n    showBackdropTimeout = window.setTimeout(() => {\n      jqUtils.addClass('tp-active', backdrop);\n    }, showBackdropTimeoutMs);\n  };\n\n  /**\n   * Hides the backdrop if it exists\n   * @const\n   */\n  const hideBackdrop = (): void => {\n    if (backdrop) {\n      jqUtils.removeClass('tp-active', backdrop);\n      jqUtils.hide(backdrop);\n      clearTimeout(showBackdropTimeout);\n    }\n\n    mobileModalFix.modalClosed();\n  };\n\n  /**\n   * Centers the backdrop on the screen.\n   *\n   * @param container  The container to check the window's height against\n   * @const\n   */\n  const centerBackdrop = (container: HTMLElement): void => {\n    if (!backdrop) {\n      return;\n    }\n    //noinspection JSValidateTypes\n    const winSize = jqUtils.winSize();\n    if (container.offsetHeight > winSize.height) {\n      backdrop.style.height = winSize.height + '';\n    } else {\n      backdrop.style.height = '100%';\n    }\n  };\n\n  /**\n   * Centers the iframe's container. This event should get called after the iframe\n   * loads to ensure that the container is centered on the browser's screen.\n   *\n   * @param container\n   * @const\n   */\n  const centerIt = (container: HTMLElement): void => {\n    if (backdrop) {\n      backdrop.style.height = '100%';\n    }\n\n    const tpClose = jqUtils.queryEl('.tp-close', container);\n\n    if (tpClose) {\n      jqUtils.removeClass('tp-square', tpClose);\n    }\n  }\n\n  /**\n   * Resizes an iframe given a width and a height\n   * @param iframe The iframe to resize\n   * @param params The params object with the width and the height to resize to\n   * @const\n   */\n  const resizeIframe = (iframe: IframeInfoInterface, params: any): void => {\n    if (!iframe) {\n      return;\n    }\n\n    setElementSizes(iframe.element, params);\n\n    var noAnimateParams = Object.assign({}, params, {\n      animate: false\n    });\n\n    switch (iframe.config.displayMode) {\n      case 'modal':\n        setElementSizes(iframe.container, noAnimateParams);\n        operationWithContainer('body', (containerBody: any) => {\n          jqUtils.addClass('tp-modal-resizing', containerBody);\n          setTimeout(() => {\n            jqUtils.removeClass('tp-modal-resizing', containerBody);\n          }, 50);\n        });\n        break;\n      case 'inline':\n        var _innerContainer = jqUtils.queryEl('.' + containerInnerClass, iframe.container)\n        if (_innerContainer) {\n          setElementSizes(_innerContainer, params);\n        }\n        break;\n      default:\n        // iframe.container.focus();\n        break;\n    }\n  };\n\n  const checkBackdropAndContainer = (iframe: any, useStack?: boolean, putOnStack?: boolean) => {\n    var container = iframe.container as HTMLElement;\n    var tpModalElement = container.parentElement;\n\n    if (!tpModalElement || !tpModalElement.classList.contains('tp-modal')) {\n      tpModalElement = tpModal;\n    } else {\n      tpModal = tpModalElement;\n    }\n\n    iframe.iframeParams = iframe.iframeParams || {};\n    if (!iframe.iframeParams.shown) {\n      iframe.iframeParams.shown = true;\n      showBackdrop(tpModalElement, useStack, putOnStack);\n\n      if (!putOnStack) {\n        if (!container.classList.contains('tp-active')) {\n          jqUtils.addClass('tp-active', container);\n        }\n        centerIt(container);\n      }\n    }\n  };\n\n  const hideCloseButton = (container?: HTMLElement): void => {\n    if (container) {\n      var closeBtn = jqUtils.queryEl('.tp-close', container);\n\n      if (closeBtn && closeBtn.classList.contains('tp-active')) {\n        jqUtils.removeClass('tp-active', closeBtn);\n      }\n    }\n  };\n\n  /**\n   * Waiting ready $(containerSelector) and run operation.\n   *\n   * @param containerSelector\n   * @param operation\n   * @const\n   */\n\n  const containersIterations: any = {};\n\n  const operationWithContainer = function (containerSelector: string, operation: Function) {\n    var container = jqUtils.queryEl(containerSelector);\n\n    if (!containersIterations[containerSelector]) {\n      containersIterations[containerSelector] = 0;\n    }\n\n    if (!container) {\n      if (containersIterations[containerSelector] < 100) {\n        containersIterations[containerSelector] += 1;\n\n        setTimeout(() => {\n          operationWithContainer(containerSelector, operation);\n        }, 50);\n      } else {\n        // usually there are a lot of widgets which shouldn't be shown by design\n        // console.error(\"PN error log: container for inline widget hasn't been found\");\n      }\n    } else {\n      delete containersIterations[containerSelector];\n      operation(container);\n    }\n  }\n\n  const getModalContainer = (c: any, onClose: Function): HTMLElement => {\n    if (typeof (c.showCloseButton) === 'undefined') {\n      c.showCloseButton = true;\n    }\n\n    if (c.container) {\n      return c.container;\n    } else {\n      // create a container to put the iframe in\n      var container = new ModalContainer(jqUtils, util, operationWithContainer);\n\n      if (!c.isPreload) {\n        tpModal = container.element;\n      }\n\n      return container.getContainer(c.showCloseButton, onClose);\n    }\n  }\n\n  const initInlineContainer = (config: any): IframeInfoInterface => {\n    var res: any = { container: null, containerReady: false };\n\n    if (!config.iframeParams.containerSelector) {\n      util.log('Inline offer must have a valid containerSelector');\n      return res;\n    }\n\n    res.container = config.singleContainer || jqUtils.queryEl(config.iframeParams.containerSelector);\n\n    if (!res.container) {\n      // if ($.isReady) {\n      util.log('Invalid containerSelector');\n      return res;\n      // }\n    } else {\n      var innerConfig = config.config;\n      var isInnerConfigExists = typeof innerConfig === 'object' && innerConfig !== null;\n\n      jqUtils.empty(res.container);\n\n      if (isInnerConfigExists) {\n        var isPreview = !!innerConfig.preview === true;\n\n        //iframe can't be bigger then the container\n        if (!isPreview) {\n          config.iframeParams.width = jqUtils.getWidth(res.container);\n        }\n      } else {\n        config.iframeParams.width = config.iframeParams.width || jqUtils.getWidth(res.container);\n      }\n\n      res.containerReady = true;\n    }\n\n    return res;\n  }\n\n  const getPopupPosition = (iframeParams: any): any => {\n    const winSize = jqUtils.winSize();\n    var w = iframeParams.width ? iframeParams.width : winSize.width;\n    var h = iframeParams.height ? iframeParams.height : winSize.height;\n\n    var center = util.centerScreen(w, h);\n\n    return {\n      width: w,\n      height: h,\n      top: center.top,\n      left: center.left\n    };\n  }\n\n  const generatePopup = (iframeParams: any, src: string): Window | null => {\n    var pos = getPopupPosition(iframeParams);\n\n    var newWindow = window.open(src, util.randomString(16), 'scrollbars=yes,location=yes,status=0,toolbar=0,resizable=1, width=' + pos.width + ', height=' + pos.height + ', top=' + pos.top + ', left=' + pos.left);\n\n    // Puts focus on the newWindow\n    //noinspection JSUnresolvedVariable\n    // @ts-ignore\n    if (window.focus && newWindow) {\n      newWindow.focus();\n    }\n\n    return newWindow;\n  }\n\n  let count = 1;\n\n  const generateIframe = (c: any, iframeParams: any, src: string): HTMLElement => {\n    var id = 'iframe-' + (count++) + '-' + util.randomString();\n    if (iframeParams.iframeId)\n      id = iframeParams.iframeId;\n\n    // var iframe = $(document.createElement('iframe'))\n    var iframe = document.createElement('iframe');\n    const attrs: Record<string, any> = {\n      id: id,\n      name: id,\n      scrolling: 'no',\n      allowtransparency: 'true',\n      allow: 'payment',\n      allowfullscreen: 'true',\n      // unfortunately we cannot use sandbox because of braintree 3ds implementation (nested iframes with navigations)\n      // sandbox: 'allow-forms allow-popups allow-top-navigation-by-user-activation allow-scripts allow-same-origin',\n    }\n\n    if (!pn.isSensitiveDataProtectionEnabled || c.isSensitiveDataProtectionDisabled) {\n      attrs.src = src;\n    }\n\n    Object.keys(attrs).forEach((key: string) => {\n      // @ts-ignore\n      jqUtils.setAttr(key, attrs[key], iframe);\n    })\n    const css = {\n      overflow: 'hidden',\n      backgroundColor: 'transparent',\n      border: '0',\n      width: c.displayMode === 'inline' ? iframeParams.width + 'px' : '0px',\n      height: '0px'\n    };\n    Object.keys(css).forEach((key: string) => {\n      // @ts-ignore\n      iframe.style[key] = css[key];\n    })\n\n    try {\n      jqUtils.setAttr('frameBorder', '0', iframe);\n    } catch (ex2) {\n      util.log(ex2);\n    }\n\n    return iframe;\n  }\n\n  const generateIframeWrapper = (): HTMLElement => {\n    const wrapper = document.createElement('div');\n    const css = {\n      overflow: 'hidden',\n      backgroundColor: 'transparent',\n      border: '0',\n      width: '0px',\n      height: '0px',\n      position: 'absolute',\n      display: 'block',\n      top: '-1px',\n      left: '-1px'\n    };\n    Object.keys(css).forEach((key: string) => {\n      // @ts-ignore\n      wrapper.style[key] = css[key];\n    });\n    return wrapper;\n  }\n\n  const showPreloadedContainer = (iframe: any): any => {\n    if (iframe.config.displayMode === 'modal') {\n      if (hasModalIframe()) {\n        util.log('Modal is already shown; must be one modal per time');\n        return;\n      }\n      _applyModalContainer(iframe);\n    } else if (iframe.config.displayMode === 'inline') {\n      _applyInlineContainer(iframe);\n    } else {\n      util.log('Unexpected displayMode of preloaded iframe\\n');\n    }\n\n    iframe.config.isPreload = false;\n    iframe.iframeParams.isPreload = false;\n\n    util.debug('show preloaded iframe: ', iframe.config);\n    return iframe;\n  }\n\n  const getInnerContainerWidth = (iframe: IframeInfoInterface): number => {\n    var _innerContainer = jqUtils.queryEl('.' + containerInnerClass, iframe.container);\n\n    if (!_innerContainer) {\n      return 0;\n    }\n\n    return jqUtils.getWidth(iframe.container);\n  }\n\n  const isBrowserElementSizeAdmissibleError = (iframe: IframeInfoInterface, iframeContainerWidth: number): boolean => {\n    const innerContainerWidth = getInnerContainerWidth(iframe);\n\n    if (!innerContainerWidth || !iframeContainerWidth) {\n      return false;\n    }\n\n    return Math.abs(innerContainerWidth - iframeContainerWidth) < BROWSER_ELEMENT_SIZE_ADMISSIBLE_ERROR;\n  }\n\n  const createContainer = (config: any): IframeInfoInterface => {\n    let params: Record<string, any> = {};\n    let form: HTMLFormElement = document.createElement('form');\n    let src;\n    var container: HTMLElement;\n    var containerReady = true;\n    var iframeParams = config.iframeParams;\n\n    if (iframeParams.displayMode !== 'inline' && !iframeParams.width) {\n      iframeParams.width = window.innerWidth;\n    }\n\n    var buildQueryStringFn;\n    if (!config.config.buildQueryStringFn) {\n      buildQueryStringFn = (iframeParams: any) => {\n        var queryString = jqUtils.param(iframeParams, excludedQueryParams);\n        return queryString + '&_qh=' + sha1.hash(queryString, 10);\n      };\n    } else {\n      buildQueryStringFn = (iframeParams: any) => {\n        return config.config.buildQueryStringFn(iframeParams, jqUtils);\n      };\n    }\n\n    //  gen iframe\n    let element: HTMLElement;\n    if (iframeParams.displayMode === 'popup') {\n      if (!iframeParams.width) {\n        iframeParams.width = window.innerWidth;\n      }\n      const _src = config.url + '?' + buildQueryStringFn(iframeParams);\n      // @ts-ignore\n      container = generatePopup(iframeParams, _src) as Window;\n      try {\n        //This breaks IE with a Access Denied exception\n        // @ts-ignore\n        element = (container as Window).document;\n      } catch (eee) {\n        try {\n          // this breaks Edge with Permission denied exception (same origin policy)\n          // @ts-ignore\n          element = container;\n        } catch (e) {\n          // @ts-ignore\n          element = null;\n          console.warn('Unable to get popup element');\n        }\n      }\n\n      popupContainersInterval[iframeParams.iframeId] = {\n        // @ts-ignore\n        container,\n        // @ts-ignore\n        interval: setInterval(() => {\n          //noinspection JSUnresolvedVariable\n          if (popupContainersInterval[iframeParams.iframeId].container.closed) {\n            clearInterval(popupContainersInterval[iframeParams.iframeId].interval);\n            popupContainersInterval[iframeParams.iframeId].container.close();\n\n            //when the window closes, fire callback for window...this is used\n            //as a workaround to IE/postMessage not working.  We have to poll this\n            //window and then query server once window is closed\n            if (config.onCloseCallback) {\n              config.onCloseCallback();\n            }\n          }\n        }, 100)\n      };\n    } else {\n      if (iframeParams.displayMode === 'inline') {\n        if (config.config.showCloseButton !== undefined) {\n          delete config.config.showCloseButton;\n        }\n\n        var inlineContainer = initInlineContainer(config);\n\n        container = inlineContainer.container;\n        containerReady = !!inlineContainer.containerReady;\n      } else { // iframeParams.displayMode === 'modal'\n        container = getModalContainer(config.config, () => {\n          closeContainer(iframeParams.iframeId, config.parent);\n        });\n      }\n\n      if (pn.isSensitiveDataProtectionEnabled) {\n        params = {\n          userToken: iframeParams.userToken,\n          iframeId: iframeParams.iframeId\n        }\n\n        delete iframeParams.userToken;\n      }\n\n      src = config.url + '?' + buildQueryStringFn(iframeParams);\n\n      //Unfortunate fix here.  Right now show offers driven from experiences\n      //are being displayed on experience.tinypass.com.  This domain is not good\n      //because it violates CORS.  We also aren't mapping publisher images to exp.tinypass.com\n      //The issue is that experience config sets Endpoint = experience.tinypass.com\n      //SHOULD NOT BE NEEDED ANYMORE\n      //src = src.replace(\"//experience.tinypass.com\", \"//buy.tinypass.com\");\n      element = generateIframe(config.config, iframeParams, src);\n    }\n\n    eventManager.registerCallback(config, iframeParams.iframeId);\n\n    var iframe: IframeInfoInterface = iframes[iframeParams.iframeId] = {\n      iframeId: iframeParams.iframeId,\n      config: config.config,\n      // @ts-ignore\n      element,\n      container,\n      iframeParams: iframeParams,\n      containerReady: containerReady\n    };\n    postmessage.init({\n      postMessageUrl: config.postMessageUrl,\n      parent: config.parent,\n      receive: config.receive,\n      iframe: iframe,\n      iframeParams: iframeParams\n    });\n\n    jqUtils.on(document, 'keyup', (event: any) => _handleKeystroke(event));\n\n    if (pn.isSensitiveDataProtectionEnabled) {\n      params.iframeSrc = src;\n      form = getForm(params);\n    }\n\n    // apply element to container\n    if (iframeParams.displayMode === 'modal') {\n      jqUtils.on(window, 'resize', () => {\n        centerIt(container);\n      })\n\n      if (pn.isSensitiveDataProtectionEnabled) {\n        jqUtils.append(container, element);\n        jqUtils.append(container, form);\n        form?.submit();\n      } else {\n        jqUtils.append(container, element);\n      }\n    } else if (iframeParams.displayMode === 'inline') {\n      if (iframes[iframeParams.iframeId].containerReady) {\n        const inner = document.createElement('div');\n        jqUtils.addClass(containerInnerClass, inner);\n        jqUtils.append(inner, element);\n\n        if (config.config.isPreload) {\n          jqUtils.hide(inner);\n        }\n\n        // @ts-ignore\n        if ((document.readyState === 'complete' || (document.readyState !== 'loading' && !document.documentElement.doScroll)) && container) {\n          jqUtils.empty(container);\n          jqUtils.append(container, inner);\n\n          if (pn.isSensitiveDataProtectionEnabled) {\n            jqUtils.append(inner, form);\n            form?.submit();\n          }\n        } else {\n          _watchOnContainerForCleaning(container, inner, form);\n        }\n      } else {\n        const tempContainer = document.createElement('div');\n        jqUtils.setAttr('id', 'temp-inline-' + iframeParams.iframeId, tempContainer);\n        jqUtils.hide(tempContainer);\n        operationWithContainer('body', (containerBody: any) => {\n          jqUtils.append(containerBody, tempContainer);\n        });\n        jqUtils.append(tempContainer, element);\n      }\n\n      if (window.ResizeObserver) {\n        const containerResize$ = new ResizeObserver(entries => {\n          const width = jqUtils.getWidth(iframe.container);\n          if (width > 0) {\n\n            /**\n             * In some browsers (like FireFox for example) getBoundingClientRect function returns wrong width value for elements\n             * with paddings like 0.75px. For example, getBoundingClientRect for element with width === 200px and horizontal paddings === 0.75px\n             * returns width === 200.017...px after minus paddings instead of 200px in FF. And then this observer will be executed forever.\n             * See https://tinypass.atlassian.net/browse/TPWEBAPP-49532\n             */\n            if (iframe.config.displayMode === 'inline' && isBrowserElementSizeAdmissibleError(iframe, width)) {\n              return;\n            }\n\n            resizeIframe(iframe, {\n              width\n            });\n          }\n        });\n        containerResize$.observe(iframe.container);\n        iframe.resizeObserver = containerResize$;\n      }\n    }\n\n    util.debug('creating iframe: ', config);\n    return iframe;\n  }\n\n  const redirectContainer = (iframeId: string, config: any): void => {\n    var src = config.url + '?' + jqUtils.param(config.iframeParams, excludedQueryParams);\n\n    var iframe = iframes[iframeId];\n\n    if (iframe.config.displayMode === 'popup') {\n      // @ts-ignore\n      iframe.container.location = src;\n    } else {\n      var iframeEl = iframe.element;\n      // @ts-ignore\n      var win = iframeEl.contentWindow || iframeEl;\n      win.location = src;\n    }\n\n    iframe.config = config.config;\n    postmessage.init({\n      postMessageUrl: config.postMessageUrl,\n      receive: config.receive,\n      iframe: iframes[config.iframeParams.iframeId],\n      iframeParams: config.iframeParams\n    });\n  }\n\n  const _watchOnContainerForCleaning = (container: any, element: any, form: any) => {\n    var interval = setInterval(() => {\n      jqUtils.empty(container);\n    }, 150);\n\n    jqUtils.ready(() => {\n      clearInterval(interval);\n      jqUtils.append(container, element);\n      if (pn.isSensitiveDataProtectionEnabled) {\n        jqUtils.append(element, form);\n        form.submit();\n      }\n    })\n  }\n\n  const _resizeAllContainers = () => {\n    for (var id in iframes) {\n      var iframe = iframes[id];\n      if (!iframe.config.preview && iframe.config.displayMode === 'inline' && iframe.container) {\n        resizeIframe(iframe, {\n          width: jqUtils.getWidth(iframe.container)\n        });\n      }\n\n      if (iframe.config.displayMode === 'modal' && iframe.container) {\n        var width = Math.max(\n          document.documentElement['clientWidth'],\n          document.body['offsetWidth'],\n          document.documentElement['offsetWidth']\n        );\n\n        postmessage.send('RESIZE_MODAL_CHECKOUT', { iframe: iframe, width: width }, iframe.iframeId);\n      }\n    }\n  }\n\n  const setElementSizes = (elem: HTMLElement, params: any): void => {\n    if (!elem) {\n      return;\n    }\n\n    if (params.width !== undefined) {\n      elem.style.width = params.width + 'px';\n      if ((params.width === 0 && !elem.classList.contains('no-width')) ||\n        (params.width !== 0 && elem.classList.contains('no-width'))) {\n        jqUtils.toggleClass('no-width', elem);\n      }\n    }\n\n    if (params.height !== undefined) {\n      if (!!params.animate) {\n        elem.style.height = params.height + 'px';\n      } else {\n        elem.style.height = params.height + 'px';\n      }\n      if ((params.height === 0 && !elem.classList.contains('no-height')) ||\n        (params.height !== 0 && elem.classList.contains('no-height'))) {\n        jqUtils.toggleClass('no-height', elem);\n      }\n    }\n  }\n\n  const hideModalContainer = (sender?: string): string[] => {\n    var hiddenIframes = [];\n    for (var iframeId in iframes) {\n      var iframe = iframes[iframeId];\n\n      if (sender && iframeId !== sender) {\n        continue;\n      }\n\n      if (iframe.config.displayMode === 'inline') {\n        continue;\n      }\n\n      if (iframe.config.displayMode === 'modal') {\n        closeModal(iframe);\n        jqUtils.hide(iframe.container);\n\n        hiddenIframes.push(iframeId);\n      }\n    }\n    return hiddenIframes;\n  }\n\n  const activateContainers = (iframeIds: string[]): void => {\n    if (!iframeIds || !iframeIds.length) {\n      return;\n    }\n\n    for (var iframeId in iframes) {\n      var iframe = iframes[iframeId];\n\n      for (var i = 0; i < iframeIds.length; i++) {\n        if (iframeId === iframeIds[i]) {\n          const container = iframe.container;\n\n          const parentEl = container.parentElement;\n          if (parentEl) {\n            showBackdrop(parentEl);\n          }\n\n          jqUtils.addClass('tp-active', container);\n          jqUtils.show(container);\n        }\n      }\n    }\n  }\n\n  const addChildToInlineIframe = (iframe: IframeInfoInterface, sender: string): void => {\n    if (iframe) {\n      var parentIframe = getIframe(sender);\n      if (parentIframe && parentIframe.config) {\n        parentIframe.config.child = iframe.iframeId;\n      }\n    }\n  }\n\n  const createElementFromStringTemplate = (stringTemplate: string) => {\n    var parentElement = document.createElement('div');\n    parentElement.innerHTML = stringTemplate.trim();\n\n    return parentElement.firstChild;\n  }\n\n  const getWaitPanelMarkdown = (containerCSSClasses: string = '') => (\n    `<div class=\"tp-please-wait tp-active tp-overlap ${containerCSSClasses}\"><div class=\"tp-icon tp-centered\"><div class=\"pn-spinner\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div></div>`\n  )\n\n  const showWaitPanel = (): void => {\n    if (waitPanelElement) {\n      return;\n    }\n\n    waitPanelElement = createElementFromStringTemplate(getWaitPanelMarkdown());\n\n    if (waitPanelElement) {\n      document.body.appendChild(waitPanelElement);\n    }\n  }\n\n  const hideWaitPanel = (): void => {\n    if (!waitPanelElement) {\n      return;\n    }\n\n    document.body.removeChild(waitPanelElement);\n    waitPanelElement = null;\n  }\n\n  const showLocalWaitPanel = (iframe: IframeInfoInterface): void => {\n    if (!iframe || !iframe?.container || localWaitPanelsMap.has(iframe.iframeId)) {\n      return;\n    }\n\n    const localWaitPanelElement = createElementFromStringTemplate(getWaitPanelMarkdown('tp-local-overlap'));\n\n    if (localWaitPanelElement) {\n      iframe.container.appendChild(localWaitPanelElement);\n      localWaitPanelsMap.set(iframe.iframeId, localWaitPanelElement);\n    }\n  }\n\n  const hideLocalWaitPanel = (iframe: IframeInfoInterface): void => {\n    if (!iframe || !iframe?.container || !localWaitPanelsMap.has(iframe.iframeId)) {\n      return;\n    }\n\n    const localWaitPanelElement = localWaitPanelsMap.get(iframe.iframeId);\n\n    if (localWaitPanelElement) {\n      iframe.container.removeChild(localWaitPanelElement);\n      localWaitPanelsMap.delete(iframe.iframeId);\n    }\n  }\n\n  const addClassToContainer = (iframe: any, className: string): void => {\n    jqUtils.addClass(className, iframe.container);\n  }\n\n  const turnOnRTL = (iframe: any): void => {\n    iframe.container && iframe.container.setAttribute && iframe.container.setAttribute('dir', 'rtl');\n  }\n\n  const turnOffRTL = (iframe: any): void => {\n    iframe.container && iframe.container.removeAttribute && iframe.container.removeAttribute('dir');\n  }\n\n  const closeModalContainer = (iframeId?: string, parentId?: string) => {\n    closeContainer(iframeId, parentId, true);\n  }\n\n  function setLocalWaitPanel(iframe: IframeInfoInterface): void {\n    if (!iframe || !iframe.container) {\n      return;\n    }\n\n    showLocalWaitPanel(iframe);\n    const onIframeLoad = (): void => {\n      hideLocalWaitPanel(iframe);\n    }\n    iframe.container.addEventListener('load', onIframeLoad, { once: true, capture: true });\n  }\n\n  function reloadIframe (iframe: IframeInfoInterface): void {\n    if (!iframe || !iframe.element) {\n      return;\n    }\n\n    if (isIframeVisible(iframe)) {\n      setLocalWaitPanel(iframe);\n    }\n\n    // @ts-ignore\n    iframe.element.src = iframe.element.src;\n  }\n\n  function isIframeVisible(iframe: IframeInfoInterface): boolean {\n    if (!iframe) {\n      return false;\n    }\n\n    return !!(iframe?.element.getBoundingClientRect()?.width);\n  }\n\n  function setupPopstateHandler (): void {\n    for (const key in iframes) {\n      const iframe = iframes[key];\n\n      if (iframe) {\n        reloadIframe(iframe);\n      }\n    }\n  }\n\n  /**\n   * Iframes stop to working on the IOS 14 and upper when the safari redirects user\n   * and then he returns to the previous page with iframes by the Safari back button press.\n   * Safari open the cached page instead of loading previous page again and iframes stop to working.\n   * Therefore, we reload these iframes.\n   */\n  function setIframesPopstateHandlers(): void {\n    if (!util.isIphone() && !util.isSafariOrIOsUiWebView()) {\n      return;\n    }\n\n    window.addEventListener('popstate', setupPopstateHandler);\n  }\n\n  return {\n    name,\n    fakeOfferId,\n    createContainer,\n    showPreloadedContainer,\n    redirectContainer,\n    hasModalIframe,\n    getForm,\n    getIframe,\n    generateIframe,\n    generateIframeWrapper,\n    getPopupPosition,\n    generatePopup,\n    initInlineContainer,\n    getModalContainer,\n    centerBackdrop,\n    showBackdrop,\n    hideBackdrop,\n    checkBackdropAndContainer,\n    resizeIframe,\n    centerIt,\n    operationWithContainer,\n    closeContainer,\n    closeModalContainer,\n    purgeIframe,\n    hideModalContainer,\n    closeModal,\n    hideCloseButton,\n    activateContainers,\n    showWaitPanel,\n    hideWaitPanel,\n    addClassToContainer,\n    turnOnRTL,\n    turnOffRTL,\n    setIframesPopstateHandlers,\n    __protected__: {\n      setElementSizes,\n      closeInlineContainers,\n      addChildToInlineIframe,\n      closeAndRemoveIframe\n    },\n    __private__: {\n      mobileModalFix\n    }\n  };\n\n})();\n\npn.container.register('containerUtils', {\n  useValue: containerUtils\n});\npn.containerUtils = pn.container.resolve<ContainerUtilsInterface>('containerUtils');", "import {UtilInterface} from \"./util\";\nimport {PostmessageInterface} from \"./postmessage\";\nimport {AjaxInterface} from \"./ajax\";\nimport {dataLayer} from \"@piano-sdk/data-layer\";\n\nexport enum EventType {\n  EXTERNAL_LINK = 'EXTERNAL_LINK',\n  EXTERNAL_EVENT = 'EXTERNAL_EVENT',\n}\n\nexport interface LogInterface {\n  name: string;\n\n  logMicroConversion(trackingId: string, eventGroupId: string, customParams?: any): void;\n\n  logAutoMicroConversion(trackingId: string, eventGroupId: string, eventType: string, customParams?: any): void;\n\n  logConversion(trackingId: string, termId: string, termName: string, stepNumber?: number, amount?: number, currency?: string, customParams?: any, conversionCategory?: string): void;\n\n  logFunnelStep(trackingId: string, stepNumber: number, stepName: string, customParams?: any): void;\n\n  logEspMicroConversion(trackingId: string, espWidgetId: string, eventGroupId: string, eventType: string, customParams?: any): void;\n\n  logBeaconRequest(url: string, params: any): void;\n\n  __protected__: {\n    handleEvent(eventType: LOG_EVENT_TYPE, eventParams: any): void,\n    logCustomFormImpression(trackingId: string | undefined, formName: string | undefined, source: string): void;\n    logCustomFormSubmission(trackingId: string | undefined, formName: string | undefined, source: string): void;\n    logEspMicroConversion(trackingId: string, espWidgetId: string, eventGroupId: string, eventType: string, customParams?: any): void;\n    logAutoMicroConversion(trackingId: string, eventGroupId: string, eventType: string, customParams?: any): void;\n  };\n  __private__: {\n    doLog(url: string, params: any): void;\n    logBeaconRequest(url: string, params: any): void;\n  };\n}\n\nexport enum LOG_EVENT_TYPE {\n  LOG_MICRO_CONVERSION = 'logMicroConversion',\n  LOG_AUTO_MICRO_CONVERSION = 'logAutoMicroConversion',\n  LOG_TELEMETRY = 'logTelemetry',\n  LOG_CONVERSION = 'logConversion',\n  LOG_FUNNEL_STEP = 'logFunnelStep',\n  LOG_ESP_MICRO_CONVERSION = 'logEspMicroConversion',\n  LOG_BEACON_REQUEST = 'logBeaconRequest',\n  LOG_CUSTOM_FORM_IMPRESSION = 'logCustomFormImpression',\n  LOG_CUSTOM_FORM_SUBMISSION = 'logCustomFormSubmission',\n}\n\nexport const log = ((container = pn.container): LogInterface => {\n\n  const ajax = container.resolve<AjaxInterface>('ajax');\n  const util = container.resolve<UtilInterface>('util');\n  const postmessage = container.resolve<PostmessageInterface>('postmessage');\n\n  const name = 'log';\n\n  postmessage.subscribe('iframeLogRequest', (data: any) => {\n    const logData = 'browser_id' in data.queryParams ? data.queryParams : appendBrowserId(data.queryParams)\n\n    doLog(data.url, logData);\n  });\n\n  const prepareQueryStringParams = (params: any) => {\n    var queryParams: string[] = [];\n    for (var key in params) {\n      var value = params[key];\n      queryParams.push(encodeURIComponent(key) + '=' + encodeURIComponent(typeof value === 'object' ? JSON.stringify(value) : value));\n    }\n    return queryParams.join('&');\n  };\n\n  const isDoNotTrackEnabled = (): boolean => {\n    const doNotTrackOption = (\n      window.doNotTrack ||\n      window.navigator.doNotTrack ||\n      // @ts-ignore\n      window.navigator.msDoNotTrack\n    )\n\n    if (!doNotTrackOption) {\n      return false\n    }\n\n    if (\n      doNotTrackOption.charAt(0) === '1' ||\n      doNotTrackOption === 'yes'\n    ) {\n      return true\n    }\n\n    return false\n  }\n\n  const doLog = (url: string, params: any) => {\n    var queryParams = prepareQueryStringParams(params);\n\n    if (!util.isRelativeUrl(url.trim())) {\n      util.log('Url parameter is incorrect')\n      return;\n    }\n\n    if (queryParams.length > 6000) {\n      ajax.request({\n        type: 'POST',\n        url: pn.getTrackingEndpoint() + url,\n        data: queryParams\n      });\n    } else {\n      ajax.request({\n        url: pn.getTrackingEndpoint() + url + '?' + queryParams,\n        dataType: 'jsonp'\n      });\n    }\n  };\n\n  const appendBrowserId = <T extends Record<string, any>>(\n    val: T,\n    includePageViewContext = false\n  ): T & { browser_id?: string } & Partial<ReturnType<UtilInterface['getPageViewContext']>> => {\n    const browserId = util.getBrowserId();\n    const result: any = {\n      ...val,\n    };\n    const append = (name: string, val?: string | string[] | null) => {\n      if (val) {\n        result[name] = val;\n      }\n    };\n    append('browser_id', browserId);\n\n    if (includePageViewContext) {\n      const context = util.getPageViewContext();\n\n      append('page_title', context.pageTitle);\n      append('url', context.url);\n      append('page_view_id', context.pageViewId);\n      append('referrer', context.referrerUrl);\n      append('content_author', context.author);\n      append('content_created', context.created?.toString());\n      append('content_section', context.section);\n      append('tags', context.tags?.join(',') || null);\n      append('content_type', context.contentType);\n    }\n\n    return result;\n  }\n\n  const appendPageViewContext = <T extends Record<string, any>>(\n    val: T\n  ): ReturnType<typeof appendBrowserId<T>> => appendBrowserId(val, true);\n\n  /**\n   * Send request about micro conversion\n   * All this function have duplicate in piano object\n   */\n  const logMicroConversion = (trackingId: string, eventGroupId: string, customParams?: any) => {\n    var logEventParams = appendPageViewContext({\n      tracking_id: trackingId,\n      event_group_id: eventGroupId,\n      custom_params: (customParams || ''),\n      cookie_consents: util.getCookieConsents(),\n      previous_user_segments: util.getUserSegmentsString(),\n      user_state: util.getUserState(),\n    });\n\n    if (!trackingId) {\n      util.log('Parameter trackingId is required to log micro conversion.');\n      return;\n    }\n\n    if (!eventGroupId) {\n      util.log('Parameter eventGroupId is required to log micro conversion.');\n      return;\n    }\n\n    doLog('/api/v3/conversion/logMicroConversion', logEventParams);\n  };\n\n  const logAutoMicroConversion = (trackingId: string, eventGroupId: string, eventType: string, customParams?: any) => {\n    var logEventParams = appendPageViewContext({\n      tracking_id: trackingId,\n      event_type: eventType,\n      event_group_id: eventGroupId,\n      custom_params: (customParams || ''),\n      cookie_consents: util.getCookieConsents(),\n      previous_user_segments: util.getUserSegmentsString(),\n      user_state: util.getUserState(),\n    });\n\n    if (!trackingId) {\n      util.log('Parameter trackingId is required to log auto micro conversion.');\n      return;\n    }\n\n    if (!eventGroupId) {\n      util.log('Parameter eventGroupId is required to log auto micro conversion.');\n      return;\n    }\n\n    console.log(logEventParams);\n    doLog('/api/v3/conversion/logAutoMicroConversion', logEventParams);\n  };\n\n  const logEspMicroConversion = (trackingId: string, espWidgetId: string, eventGroupId: string, eventType: string, customParams?: any) => {\n    var logEventParams = appendPageViewContext({\n      tracking_id: trackingId,\n      esp_widget_id: espWidgetId,\n      event_type: eventType,\n      event_group_id: eventGroupId,\n      custom_params: (customParams || ''),\n      cookie_consents: util.getCookieConsents(),\n      previous_user_segments: util.getUserSegmentsString(),\n      user_state: util.getUserState(),\n    });\n\n    if (!trackingId) {\n      util.log('Parameter trackingId is required to log esp micro conversion.');\n      return;\n    }\n\n    if (!eventGroupId) {\n      util.log('Parameter eventGroupId is required to log esp micro conversion.');\n      return;\n    }\n\n    if (!espWidgetId) {\n      util.log('Parameter espWidgetId is required to log esp micro conversion.');\n      return;\n    }\n\n    doLog('/api/v3/conversion/logEspMicroConversion', logEventParams);\n  };\n\n  const _doLogConversion = (trackingId: string, termId: string, termName: string, stepNumber?: number, amount?: number, currency?: string, customParams?: any, conversionCategory?: string) => {\n    var logParams: any = appendPageViewContext({\n      tracking_id: trackingId,\n      term_id: termId,\n      term_name: termName,\n      cookie_consents: util.getCookieConsents(),\n      previous_user_segments: util.getUserSegmentsString(),\n      user_state: util.getUserState(),\n    });\n\n    if (!trackingId) {\n      util.log('Parameter trackingId is required to log conversion.');\n      return;\n    }\n\n    if (!termId) {\n      util.log('Parameter termId is required to log conversion.');\n      return;\n    }\n    if (!termName) {\n      util.log('Parameter termName is required to log conversion.');\n      return;\n    }\n    if (typeof stepNumber !== 'undefined') {\n      logParams.step_number = stepNumber;\n    }\n    if (typeof amount !== 'undefined') {\n      logParams.amount = amount;\n    }\n    if (typeof currency !== 'undefined') {\n      logParams.currency = currency;\n    }\n    if (typeof customParams !== 'undefined') {\n      logParams.custom_params = customParams;\n    }\n    if (typeof conversionCategory !== 'undefined') {\n      logParams.conversion_category = conversionCategory;\n    }\n\n    doLog('/api/v3/conversion/log', logParams);\n  };\n\n  /**\n   * Send request about conversion\n   * All this function have duplicate in piano object\n   */\n  const logConversion = (trackingId: string, termId: string, termName: string, stepNumber?: number, amount?: number, currency?: string, customParams?: any, conversionCategory?: string) => {\n    if (typeof trackingId === 'object') {\n      const params = trackingId as any;\n      _doLogConversion(\n        params.tracking_id,\n        params.term_id,\n        params.term_name,\n        params.step_number,\n        params.amount,\n        params.currency,\n        params.custom_params,\n        params.conversion_category\n      );\n    } else {\n      _doLogConversion(trackingId, termId, termName, stepNumber, amount, currency, customParams, conversionCategory);\n    }\n  };\n\n  /**\n   * Send request about funnel step\n   * All this function have duplicate in piano object\n   */\n  const logFunnelStep = (trackingId: string, stepNumber: number, stepName: string, customParams?: any) => {\n    var logEventParams = appendPageViewContext({\n      tracking_id: trackingId,\n      step_number: stepNumber,\n      step_name: stepName,\n      custom_params: (customParams || ''),\n      cookie_consents: util.getCookieConsents(),\n      previous_user_segments: util.getUserSegmentsString(),\n      user_state: util.getUserState(),\n    });\n\n    if (!trackingId) {\n      util.log('Parameter trackingId is required to log funnel step.');\n      return;\n    }\n    if (!stepNumber) {\n      util.log('Parameter stepNumber is required to log funnel step.');\n      return;\n    }\n    if (!stepName) {\n      util.log('Parameter stepName is required to log funnel step.');\n      return;\n    }\n\n    doLog('/api/v3/conversion/logFunnelStep', logEventParams);\n  };\n\n  const logCustomFormImpression = (trackingId: string | undefined, formName: string | undefined, source: string) => {\n    if (!formName) {\n      util.log('Parameter formName is required to log impression.');\n    }\n\n    if (!source) {\n      util.log('Parameter source is required to log impression.');\n    }\n\n    var data: any = {\n      aid: pn.aid,\n      pageview_id: pn.main.fetchPageViewId(),\n      custom_form_name: formName,\n      custom_form_source: source,\n      cookie_consents: util.getCookieConsents(),\n      browser_id: util.getBrowserId(),\n    };\n\n    var token = pn.user.getProvider().getToken();\n\n    if (token) {\n      data.user_token = token;\n    }\n\n    if (trackingId) {\n      data.tracking_id = trackingId;\n    }\n    return doLog('/api/v3/customform/log/impression', data);\n  };\n\n  const logCustomFormSubmission = (trackingId: string | undefined, formName: string, source: string) => {\n    if (!formName) {\n      util.log('Parameter formName is required to log submission.');\n    }\n\n    if (!source) {\n      util.log('Parameter source is required to log submission.');\n    }\n    var data: any = {\n      aid: pn.aid,\n      pageview_id: pn.main.fetchPageViewId(),\n      custom_form_name: formName,\n      custom_form_source: source,\n      cookie_consents: util.getCookieConsents(),\n      browser_id: util.getBrowserId(),\n    };\n\n    var token = pn.user.getProvider().getToken();\n\n    if (token) {\n      data.user_token = token;\n    }\n    if (trackingId) {\n      data.tracking_id = trackingId;\n    }\n    return doLog('/api/v3/customform/log/submission', data);\n  };\n\n  const logTelemetryRequest = (url: string, queryParams: any) => {\n    if (isDoNotTrackEnabled()) {\n      return;\n    }\n    const queryString = url + '?' + prepareQueryStringParams(queryParams);\n    if (navigator.sendBeacon) {\n      navigator.sendBeacon(queryString);\n    } else {\n      ajax.send(queryString, null, 'POST', null, 'application/json', true);\n    }\n  };\n\n  const logBeaconRequest = (url: string, params: any) => {\n    if (isDoNotTrackEnabled()) {\n      return;\n    }\n    var preparedQueryStringParams = prepareQueryStringParams(params);\n    var queryString = url + '?' + preparedQueryStringParams;\n    if (navigator.sendBeacon) {\n      // we have 8K HTTP header limit on tomcat/apache level, it includes query string and request headers (including cookie)\n      // if query string is larger than 6K - let's send beacon parameters in request \"body\"\n      if (queryString.length > 6000) {\n        var blob = new Blob([preparedQueryStringParams], {type: 'application/x-www-form-urlencoded'});\n        navigator.sendBeacon(url, blob);\n      } else {\n        navigator.sendBeacon(queryString);\n      }\n    } else {\n      var ie9 = navigator.appVersion.indexOf('MSIE 9') !== -1;\n\n      var ajaxSettings: any;\n      if (ie9) {\n        ajaxSettings = {\n          dataType: 'jsonp',\n          url: queryString\n        };\n      } else {\n        ajaxSettings = {\n          type: 'post',\n          url: queryString,\n          async: false,\n          xhrFields: {\n            withCredentials: true\n          }\n        };\n      }\n\n      ajaxSettings.error = function (...args: []) {\n        // @ts-ignore\n        util.debug('Beacon request has been failed', ...args);\n      };\n\n      ajax.request(ajaxSettings);\n    }\n  };\n\n  const handleEvent = (handlingEventType: LOG_EVENT_TYPE, eventParams: any): void => {\n    const {\n      trackingId,\n      termId,\n      termName,\n      stepNumber,\n      stepName,\n      amount,\n      currency,\n      customParams,\n      conversionCategory,\n      eventGroupId,\n      eventType,\n      url,\n      params,\n      formName,\n      source,\n      espWidgetId,\n      body,\n    } = eventParams;\n\n    switch (handlingEventType) {\n      case LOG_EVENT_TYPE.LOG_TELEMETRY:\n        logTelemetryRequest(url, params);\n        return;\n      case LOG_EVENT_TYPE.LOG_CONVERSION:\n        logConversion(trackingId, termId, termName, stepNumber, amount, currency, customParams, conversionCategory);\n        return;\n      case LOG_EVENT_TYPE.LOG_AUTO_MICRO_CONVERSION:\n        logAutoMicroConversion(trackingId, eventGroupId, eventType, customParams);\n        return;\n      case LOG_EVENT_TYPE.LOG_BEACON_REQUEST:\n        logBeaconRequest(url, params);\n        return;\n      case LOG_EVENT_TYPE.LOG_CUSTOM_FORM_IMPRESSION:\n        logCustomFormImpression(trackingId, formName, source);\n        return;\n      case LOG_EVENT_TYPE.LOG_CUSTOM_FORM_SUBMISSION:\n        logCustomFormSubmission(trackingId, formName, source);\n        return;\n      case LOG_EVENT_TYPE.LOG_ESP_MICRO_CONVERSION:\n        logEspMicroConversion(trackingId, espWidgetId, eventGroupId, eventType, customParams);\n        return;\n      case LOG_EVENT_TYPE.LOG_FUNNEL_STEP:\n        logFunnelStep(trackingId, stepNumber, stepName, customParams);\n        return;\n      case LOG_EVENT_TYPE.LOG_MICRO_CONVERSION:\n        logMicroConversion(trackingId, eventGroupId, customParams);\n        return;\n    }\n  }\n\n  return {\n    name,\n    /**\n     * Send request about micro conversion\n     * All this function have duplicate in piano object\n     */\n    logMicroConversion,\n    /**\n     * Send request about conversion\n     * All this function have duplicate in piano object\n     */\n    logConversion,\n    /**\n     * Send request about funnel step\n     * All this function have duplicate in piano object\n     */\n    logFunnelStep,\n    logEspMicroConversion,\n    logBeaconRequest,\n    logAutoMicroConversion,\n    __protected__: {\n      handleEvent,\n      logCustomFormImpression,\n      logCustomFormSubmission,\n      logEspMicroConversion,\n      logAutoMicroConversion,\n    },\n    __private__: {\n      doLog,\n      logBeaconRequest,\n    }\n  }\n\n});\n\npn.container.register('log', {\n  useValue: log()\n});\npn.log = pn.container.resolve<LogInterface>('log');\n", "import { UtilInterface } from \"./util\";\n\nexport interface FbpixelInterface {\n  name: string;\n\n  isInitialized(): boolean;\n\n  __private__: {\n    isInitialized(): boolean;\n  };\n\n  __protected__: {\n    init(): void;\n    handleEvent(eventType: FB_PIXEL_EVENT_TYPE, eventParams: FBEventParams): void;\n  };\n}\n\nexport interface FBEventParams {\n  eventName: string;\n  eventParams: unknown;\n}\n\nexport enum FB_PIXEL_EVENT_TYPE {\n  TRACK_EVENT = 'track',\n  TRACK_CUSTOM_EVENT = 'trackCustom'\n}\n\nconst fbpixel = ((): FbpixelInterface => {\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const name = 'fbpixel';\n\n  let _isInitialized = false;\n\n  const init = (): void => {\n    if (_isInitialized) {\n      return;\n    }\n\n    var fbPixelId = pn.getFbPixelId();\n    if (!fbPixelId) {\n      util.error('fbpixel: Facebook Pixel ID is not defined');\n      return;\n    }\n\n    util.log('fbpixel: Initialize Facebook Pixel tracking', fbPixelId);\n\n    // Facebook Pixel Code\n    // @ts-ignore\n    !function (f, b, e, v, n?: any, t?: any, s?: any) {\n      if (f.fbq) return;\n      n = f.fbq = function () {\n        n.callMethod ?\n          n.callMethod.apply(n, arguments) : n.queue.push(arguments)\n      };\n      if (!f._fbq) f._fbq = n;\n      n.push = n;\n      n.loaded = !0;\n      n.version = '2.0';\n      n.queue = [];\n      t = b.createElement(e);\n      t.async = !0;\n      t.src = v;\n      s = b.getElementsByTagName(e)[0];\n      s.parentNode.insertBefore(t, s)\n    }(window,\n      document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');\n    // End Facebook Pixel Code\n\n    window.fbq('set', 'autoConfig', 'false', fbPixelId);\n    window.fbq('init', fbPixelId);\n\n    _isInitialized = true;\n  };\n\n  const handleEvent = (eventType: FB_PIXEL_EVENT_TYPE, { eventName, eventParams }: FBEventParams): void => {\n    switch (eventType) {\n      case FB_PIXEL_EVENT_TYPE.TRACK_EVENT:\n        _doTrackEvent(FB_PIXEL_EVENT_TYPE.TRACK_EVENT, eventName, eventParams);\n        return;\n      case FB_PIXEL_EVENT_TYPE.TRACK_CUSTOM_EVENT:\n        _doTrackEvent(FB_PIXEL_EVENT_TYPE.TRACK_CUSTOM_EVENT, eventName, eventParams);\n        return;\n    }\n  }\n\n  const _doTrackEvent = (trackMethod: string, eventName: string, customData: any) => {\n    if (!_isInitialized) {\n      util.log('fbpixel: Skip tracking event - Facebook Pixel is not initalized', eventName, customData);\n      return;\n    }\n\n    if (!customData) {\n      customData = {};\n    }\n\n    util.log('fbpixel: Track Facebook Pixel event', eventName, customData);\n\n    window.fbq(trackMethod, eventName, customData);\n  };\n\n  const isInitialized = (): boolean => {\n    return _isInitialized;\n  };\n\n  return {\n    name,\n    isInitialized,\n    __private__: {\n      isInitialized\n    },\n    __protected__: {\n      init,\n      handleEvent,\n    },\n  }\n\n})();\n\npn.container.register('fbpixel', {\n  useValue: fbpixel\n});\npn.fbpixel = pn.container.resolve<FbpixelInterface>('fbpixel');\n", "import { ClientConfigurationResponse } from \"./client-configuration-response\";\nimport {AjaxInterface} from \"../ajax\";\n\nexport const clientConfiguration = (container = pn.container) => {\n  const ajax = container.resolve<AjaxInterface>(\"ajax\");\n\n  let configuration: ClientConfigurationResponse | undefined;\n  let configurationPromise: Promise<ClientConfigurationResponse> | undefined;\n\n  const getConfiguration = async (): Promise<ClientConfigurationResponse> => {\n    if (configuration) {\n      return configuration;\n    }\n\n    if (configurationPromise) {\n      return configurationPromise;\n    }\n\n    configurationPromise = new Promise((resolve, reject) => {\n      ajax.request({\n        url: pn.getApiEndpoint() + \"/anon/assets/sdk-runtime-config.js?aid=\" + pn.aid,\n        type: \"GET\",\n        success: (response?: { code: number; client_configurations_dto: ClientConfigurationResponse }) => {\n          if (response?.code === 0) {\n            configuration = response.client_configurations_dto;\n            resolve(response.client_configurations_dto);\n            configurationPromise = undefined;\n          } else {\n            reject();\n          }\n        },\n        error: () => reject()\n      });\n    });\n    return configurationPromise;\n  };\n\n  return {\n    configuration,\n    getConfiguration,\n  };\n};\n\nexport type ClientConfiguration = ReturnType<typeof clientConfiguration>;\n\npn.container.register(\"clientConfiguration\", {\n  useValue: clientConfiguration(),\n});\n", "export interface GaCollectingServiceInterface {\n  name: string;\n\n  setParam(paramName: string, paramValue: unknown): void;\n  setParamMap(paramsMap: { [key: string]: unknown }): void;\n  getParams(): { [key: string]: unknown };\n\n  isEventExcluded(eventName: string): boolean;\n  setExcludedEvents(events: ExcludedEvents): void;\n}\n\nexport type ExcludedEvents = {\n  [key: string]: boolean;\n};\n\nconst gaCollectingService = ((): GaCollectingServiceInterface => {\n  let excludedEvents: ExcludedEvents = {};\n  let gaParams: { [key: string]: unknown } = {};\n\n  const setParam = (paramName: string, paramValue: unknown): void => {\n    if (paramValue) {\n      gaParams[paramName] = paramValue;\n    }\n  };\n\n  const setParamMap = (paramsMap: { [key: string]: unknown }): void => {\n    gaParams = {\n      ...gaParams,\n      ...paramsMap,\n    };\n  };\n\n  const getParams = (): { [key: string]: unknown } => {\n    return {\n      aid: pn.aid,\n      tags: pn.tags,\n      debug: pn.debug,\n      url: window.location.href,\n      ...gaParams,\n    };\n  };\n\n  const isEventExcluded = (eventName: string): boolean => excludedEvents[eventName];\n\n  const setExcludedEvents = (events: ExcludedEvents): void => {\n    excludedEvents = {\n      ...excludedEvents,\n      ...events,\n    };\n  }\n\n  return {\n    name: 'gaCollectingService',\n\n    setParam,\n    getParams,\n    setParamMap,\n    isEventExcluded,\n    setExcludedEvents,\n  }\n})();\n\npn.container.register('gaCollectingService', {\n  useValue: gaCollectingService,\n});\n\npn.gaCollectingService = pn.container.resolve<GaCollectingServiceInterface>('gaCollectingService');\n", "export enum GA_EVENT_TYPE {\n    EMIT_GA_EVENT = 'emitGAEvent',\n    EMIT_METRICS_EVENT = 'emitMetricsEvent',\n}\n\nexport const EVENT_NON_INTERACTION_VALUES: { [key: string]: boolean } = {\n    experienceExecute: true,\n    meterActive: true,\n    meterExpired: true,\n    beforeBrowserEvent: false,\n    setResponseVariable: true,\n    startCheckout: false,\n    showOffer: true,\n    showTemplate: true,\n    termSelected: true,\n    promoApplied: true,\n    promoInvalid: true,\n    submitPayment: false,\n    checkoutCustomEvent: true,\n    checkoutStateChange: false,\n    receiptDisplayed: false,\n    checkoutSuccess: true,\n    checkoutRestarted: false,\n    checkoutError: true,\n    checkoutClose: false,\n    publisherLoginRequired: false,\n    loginRequired: false,\n    loginDisplayed: false,\n    registrationDisplayed: false,\n    loginSuccess: true,\n    registrationSuccess: true,\n    logout: false,\n}", "import { UtilInterface } from '../util';\nimport { APIInterface } from '../api';\nimport { PostmessageInterface } from '../postmessage';\nimport {EVENT_NON_INTERACTION_VALUES, GA_EVENT_TYPE} from \"./constants\";\nimport {GaCollectingServiceInterface} from \"./gaCollectingService\";\nimport {ClientConfiguration} from \"../clientConfiguration\";\n\nexport interface GaServiceInterface {\n  name: string;\n\n  getClientId(): string | undefined;\n  getGAAccount(): any;\n  metricsTrackerAppended(): void;\n  recreateWithClientId(clientId: string): void;\n  setClientId(clientId: string): void;\n  setTrackerName(name: string): void;\n  trackerAppended(): void;\n\n  __protected__: {\n    handleEvent(eventType: GA_EVENT_TYPE, eventParams: any): void;\n  }\n}\n\n// @pn.singleton()\n// export class GaService implements GaServiceInterface {\nconst gaService = ((): GaServiceInterface => {\n\n  const util = pn.container.resolve<UtilInterface>('util');\n  const api = pn.container.resolve<APIInterface>('api');\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const gaCollectingService = pn.container.resolve<GaCollectingServiceInterface>('gaCollectingService');\n  const clientConfiguration = pn.container.resolve<ClientConfiguration>('clientConfiguration');\n\n  const name = 'gaService';\n\n  const TRACKER_NAME = 'pianoTracker';\n  const METRICS_TRACKER_NAME = 'performanceTracker';\n  const GA_ACCOUNT_KEY = 'gaAccount';\n  const METRICS_GA_ACCOUNT_KEY = 'metricsGAAccount';\n  const TRACK_ONLY_AIDS_KEY = 'trackOnlyAids';\n  const DISABLED_VALUE = 'disabled';\n  const STORAGE_EXPIRATION = 1; // 1 day\n\n  const config = {\n    gaAccount: <any>undefined,\n    trackerName: TRACKER_NAME,\n    trackOnlyAids: <any>[],\n    metricsGAAccount: <any>undefined,\n    isGAEnabled: false,\n    isGAAppended: false,\n    isMetricsEnabled: false,\n    isTrackerAppended: false,\n    isMetricsTrackerAppended: false\n  };\n\n  const _batch: any[] = [];\n  let _clientId: string;\n  let _initialised = false;\n  let _isFirstStart = true;\n  let _isGAInitialising = false;\n  let _isMetricsInitialising = false;\n  const _metricsBatch: any[] = [];\n\n  /** @function\n   * @name emitEvent\n   * @desc Emits GA event\n   * @param {Object} params - GA event params\n   * @param {Object} params.eventAction - GA eventAction\n   * @param {string} params.eventCategory - GA eventCategory\n   * @param {string} params.eventLabel - GA eventLabel\n   * @param {function} params.hitCallback - GA hitCallback\n   * @param {string} params.hitType - GA hitType\n   */\n  const emitEvent = (params: any): void => {\n    params.hitType = 'event';\n    params.nonInteraction = EVENT_NON_INTERACTION_VALUES[params.eventCategory];\n\n    if (!config.isTrackerAppended) {\n      batchPush('send', params);\n      initGA();\n      return;\n    }\n\n    if (!config.isGAEnabled) {\n      return;\n    }\n\n    if (!window.ga || !config.isTrackerAppended) {\n      batchPush('send', params);\n      return;\n    }\n\n    if (_batch.length) {\n      batchExecute();\n    }\n\n    gaWrapper('send', params);\n  };\n\n  /** @function\n   * @name emitMetricsEvent\n   * @desc Emits PerformanceMetrics GA event\n   * @param {Object} params - GA event params\n   * @param {Object} params.eventAction - GA eventAction\n   * @param {string} params.eventCategory - GA eventCategory\n   * @param {string} params.eventLabel - GA eventLabel\n   * @param {function} params.hitCallback - GA hitCallback\n   * @param {string} params.hitType - GA hitType\n   */\n  const emitMetricsEvent = (params: any): void => {\n    params.hitType = 'timing';\n\n    if (!config.isMetricsTrackerAppended) {\n      metricsBatchPush('send', params);\n      initMetricsGA();\n      return;\n    }\n\n    if (!config.isMetricsEnabled) {\n      return;\n    }\n\n    if (!window.ga || !config.isMetricsTrackerAppended) {\n      metricsBatchPush('send', params);\n      return;\n    }\n\n    if (_metricsBatch.length) {\n      metricsBatchExecute();\n    }\n\n    metricsGAWrapper('send', params);\n  };\n\n  const getGAAccount = (): any => {\n    return config.gaAccount;\n  };\n\n  const getClientId = (): string | undefined => {\n    return _clientId;\n  };\n\n  const setClientId = (clientId: string): void => {\n    _clientId = clientId;\n  };\n\n  const recreateWithClientId = (clientId: string): void => {\n    _clientId = clientId;\n    initGA();\n  }\n\n  const setTrackerName = (name: string): void => {\n    config.trackerName = name;\n  };\n\n  const metricsTrackerAppended = (): void => {\n    config.isMetricsTrackerAppended = true;\n    _isMetricsInitialising = false;\n    metricsBatchExecute();\n  };\n\n  const trackerAppended = (): void => {\n    config.isTrackerAppended = true;\n    postmessage.broadcast('gaAppended', { clientId: _clientId, gaAccount: config.gaAccount });\n    _isGAInitialising = false;\n    batchExecute();\n  };\n\n  function initGA(): void {\n    if (_isGAInitialising) {\n      return;\n    }\n\n    _isGAInitialising = true;\n\n    if (_isFirstStart) {\n      setTimeout(function () {\n        _isFirstStart = false;\n        deferredInitGA();\n      }, 3000);\n    } else {\n      deferredInitGA();\n    }\n  }\n\n  function deferredInitGA() {\n    initConfig();\n\n    if (!config.gaAccount) {\n      _getGAAccount()\n        .then(() => {\n          return injectTracker();\n        })\n        .catch(() => {});\n      return;\n    }\n\n    injectTracker().catch(() => {});\n  }\n\n  function initMetricsGA() {\n    if (_isMetricsInitialising) {\n      return;\n    }\n\n    _isMetricsInitialising = true;\n    initConfig();\n\n    if (!config.metricsGAAccount) {\n      getPerformanceMetrics()\n        .then(() => {\n          return injectMetricsTracker();\n        })\n        .catch((err: string) => {\n          util.error(`PN catch: something vent wrong with GA injection: ${err}`);\n        });\n      return;\n    }\n\n    injectMetricsTracker().catch((err: string) => {\n      util.error(`PN catch: something vent wrong with GA injection: ${err}`);\n    });\n  }\n\n  const batchPush = (action: string, params: any) => {\n    _batch.push({ action: action, params: params });\n  }\n\n  const batchExecute = () => {\n    if (!window.ga || !config.isTrackerAppended) {\n      return;\n    }\n\n    while (_batch.length) {\n      const args = _batch.pop();\n      gaWrapper(args.action, args.params);\n    }\n  }\n\n  const metricsBatchPush = (action: string, params: any) => {\n    _metricsBatch.push({ action, params });\n  }\n\n  const metricsBatchExecute = () => {\n    if (!window.ga || !config.isMetricsTrackerAppended) {\n      return;\n    }\n\n    while (_metricsBatch.length) {\n      const args = _metricsBatch.pop();\n      metricsGAWrapper(args.action, args.params);\n    }\n  }\n\n  const gaWrapper = (action: string, params: any) => {\n    if (gaCollectingService.isEventExcluded(params.eventCategory)) {\n      return;\n    }\n\n    if (!window.ga || !config.isTrackerAppended) {\n      batchPush(action, params);\n      return;\n    }\n\n    window.ga(config.trackerName + '.' + action, params);\n  }\n\n  const metricsGAWrapper = (action: string, params: any) => {\n    if (!config.isMetricsEnabled) {\n      return;\n    }\n\n    if (!window.ga || !config.isMetricsTrackerAppended) {\n      metricsBatchPush(action, params);\n      return;\n    }\n\n    window.ga(METRICS_TRACKER_NAME + '.' + action, params);\n  }\n\n  const initConfig = () => {\n    if (_initialised) {\n      return;\n    }\n\n    if (!!tp.gaClientId) {\n      _clientId = tp.gaClientId;\n    }\n\n    if (util.__protected__.hasLocalStorage()) {\n      const gaAccount = util.__protected__.getLocalStorageItem(GA_ACCOUNT_KEY);\n      const metricsGAAccount = util.__protected__.getLocalStorageItem(METRICS_GA_ACCOUNT_KEY);\n      const trackOnlyAids = util.__protected__.getLocalStorageItem(TRACK_ONLY_AIDS_KEY);\n\n      config.isGAEnabled = !!gaAccount && gaAccount !== DISABLED_VALUE;\n      config.isMetricsEnabled = !!metricsGAAccount && metricsGAAccount !== DISABLED_VALUE;\n      config.gaAccount = gaAccount;\n      config.metricsGAAccount = metricsGAAccount;\n      config.trackOnlyAids = trackOnlyAids ? trackOnlyAids : [];\n    }\n\n    _initialised = true;\n  }\n\n  async function _getGAAccount() {\n    const response = await clientConfiguration.getConfiguration();\n    return setGA(response.ga_account);\n  }\n\n  async function getPerformanceMetrics() {\n    const response = await clientConfiguration.getConfiguration();\n    return setMetrics({\n      is_enabled: response.is_performance_metrics_enabled,\n      ga_account: response.performance_metrics_ga_account,\n      track_only_aids: response.performance_metrics_track_only_aids,\n    });\n  }\n\n  const setGA = (gaAccount: any) => {\n    config.isGAEnabled = !!gaAccount;\n    config.gaAccount = !!gaAccount ? gaAccount : DISABLED_VALUE;\n    util.__protected__.setLocalStorageItem(\"vx\", GA_ACCOUNT_KEY, config.gaAccount, STORAGE_EXPIRATION);\n  }\n\n  const setMetrics = (performanceMetrics: any) => {\n    config.isMetricsEnabled = JSON.parse(performanceMetrics.is_enabled);\n    config.metricsGAAccount = config.isMetricsEnabled ? performanceMetrics.ga_account : DISABLED_VALUE;\n    config.trackOnlyAids = config.isMetricsEnabled ? JSON.parse(performanceMetrics.track_only_aids) : [];\n    util.__protected__.setLocalStorageItem(\"vx\", TRACK_ONLY_AIDS_KEY, config.trackOnlyAids, STORAGE_EXPIRATION);\n    util.__protected__.setLocalStorageItem(\"vx\", METRICS_GA_ACCOUNT_KEY, config.metricsGAAccount, STORAGE_EXPIRATION);\n  }\n\n  function injectTracker() {\n    return new Promise((resolve, reject) => {\n      if (!config.isGAEnabled) {\n        reject();\n      } else {\n        injectGA().then(() => {\n          if (config.isGAAppended) {\n            if (!config.isTrackerAppended) {\n              try {\n                const script = document.createElement('script');\n                script.innerHTML = gaAppendingScript();\n                document.head.appendChild(script);\n                config.isTrackerAppended = true;\n                resolve(null);\n              } catch (e) {\n                reject();\n              }\n            } else {\n              resolve(null);\n            }\n          } else {\n            reject();\n          }\n        })\n          .catch((err: any) => {});\n      }\n    });\n  }\n\n  function injectMetricsTracker() {\n    return new Promise((resolve, reject) => {\n      if (!config.isMetricsEnabled) {\n        resolve('isMetricsEnabled !== true');\n        return;\n      } else {\n        injectGA().then(() => {\n          if (config.isGAAppended) {\n            if (!config.isMetricsTrackerAppended) {\n              try {\n                const shouldBeTracked: boolean = !config.trackOnlyAids.length || config.trackOnlyAids.contains(tp.aid);\n                const script = document.createElement('script');\n                const gaAccountMatched = new RegExp('^UA-[0-9a-zA-Z]*-[0-9a-zA-Z]*$').test(config.metricsGAAccount);\n\n                if (!gaAccountMatched) {\n                  reject();\n                  return;\n                }\n                script.innerHTML = `\n                  ga(function() {\n                    if (${shouldBeTracked}) {\n                      ga('create', '${config.metricsGAAccount}', 'auto', '${METRICS_TRACKER_NAME}', { storage: 'none' });\n                      tp.gaService.metricsTrackerAppended();\n                    }\n                  });\n                  `;\n                document.head.appendChild(script);\n                config.isMetricsTrackerAppended = true;\n                resolve(null);\n              } catch (e) {\n                reject();\n              }\n            } else {\n              resolve(null);\n            }\n          } else {\n            reject();\n          }\n        });\n      }\n    });\n  }\n\n  function injectGA() {\n    return new Promise((resolve, reject) => {\n      if (config.isGAAppended) {\n        resolve(null);\n      } else {\n        try {\n          const script = document.createElement('script');\n          script.innerHTML = `\n            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n          `;\n          document.head.appendChild(script);\n          config.isGAAppended = true;\n          resolve(null);\n        } catch (e) {\n          reject();\n        }\n      }\n    });\n  }\n\n  function gaAppendingScript() {\n    const gaAccountMatched = new RegExp('^UA-[0-9a-zA-Z]*-[0-9a-zA-Z]*$').test(config.gaAccount);\n    const gaClientIdMatched = new RegExp('([{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?)|([0-9]*\\\\.[0-9]*)')\n      .test(_clientId || '');\n\n    if (!gaAccountMatched) {\n      return '';\n    }\n\n    let script =\n      `ga(function() {\n        ga('create', '${config.gaAccount}', 'auto', '${TRACKER_NAME}'`;\n    if (!!_clientId && gaClientIdMatched) {\n      script += `, { clientId: '${_clientId}' });`;\n    } else {\n      script += `);\n        tp.gaService.setClientId(ga.getByName('${TRACKER_NAME}').get('clientId'));`;\n    }\n\n    script += 'tp.gaService.trackerAppended(); });';\n\n    return script;\n  }\n\n  const handleEvent = (eventType: GA_EVENT_TYPE, eventParams: any): void => {\n    switch (eventType) {\n      case GA_EVENT_TYPE.EMIT_GA_EVENT:\n        emitEvent(eventParams);\n        return;\n      case GA_EVENT_TYPE.EMIT_METRICS_EVENT:\n        emitMetricsEvent(eventParams);\n        return;\n    }\n  }\n\n  return {\n    name,\n\n    getClientId,\n    getGAAccount,\n    metricsTrackerAppended,\n    recreateWithClientId,\n    setClientId,\n    setTrackerName,\n    trackerAppended,\n\n    __protected__: {\n      handleEvent,\n    }\n  }\n\n})();\n\npn.container.register('gaService', {\n  useValue: gaService\n});\npn.gaService = pn.container.resolve<GaServiceInterface>('gaService');\n", "import {GaCollectingServiceInterface} from \"./gaCollectingService\";\nimport {EVENT_NON_INTERACTION_VALUES, GA_EVENT_TYPE} from \"./constants\";\n\nexport interface Ga4ServiceInterface {\n  name: string;\n\n  getMeasurementId(): string;\n\n  setGa4Config(config: Ga4Config): void;\n\n  appendGoogleTag(): void;\n\n  sendCustomEvent(params: GoogleEventParams): void;\n\n  __protected__: {\n    handleEvent(eventType: GA_EVENT_TYPE, eventParams: any): void;\n  };\n}\n\nexport type Ga4Config = {\n  measurementId: string;\n  eventParameters?: EventParameters;\n};\n\ntype EventParameters = {\n  [key: string]: unknown;\n};\n\ntype GoogleEventParams = {\n  name: string;\n  sendTo: string;\n  params?: any;\n  non_interaction?: boolean;\n  nonInteraction?: boolean;\n};\n\nconst ga4Service = ((container = pn.container): Ga4ServiceInterface => {\n\n  const gaCollectingService = container.resolve<GaCollectingServiceInterface>('gaCollectingService');\n\n  //#region Private\n  const pianoPrefix = 'piano_';\n  const googleRestrictedParams = ['trackingId'];\n\n  let config: Ga4Config = {\n    measurementId: '',\n  };\n\n  let pendingEvents: GoogleEventParams[] = [];\n\n  const isTagLoaded = (): boolean => typeof window.gtag === 'function';\n\n  const loadGoogleTagManager = (): void => {\n    if (isTagLoaded()) {\n      return;\n    }\n\n    const tagScriptElement = document.createElement('script');\n    tagScriptElement.async = true;\n    tagScriptElement.src = `https://www.googletagmanager.com/gtag/js?id=${config.measurementId}`\n\n    document.head.appendChild(tagScriptElement);\n  };\n\n  const stringifyEventParameters = (eventParams: EventParameters | undefined): string => {\n    if (!eventParams) {\n      eventParams = {};\n    }\n\n    return JSON.stringify(eventParams);\n  };\n\n  const getGtagInitScript = (): string => {\n    if (!isTagLoaded()) {\n      return 'window.dataLayer = window.dataLayer || [];\\n' +\n        'function gtag(){dataLayer.push(arguments);}\\n' +\n        'gtag(\\'js\\', new Date());';\n    }\n\n    return '';\n  };\n\n  const getConfigScript = (config: Ga4Config): string => {\n    if (config.eventParameters) {\n      return `gtag(\\'config\\', \\'${config.measurementId}\\', ${stringifyEventParameters(config.eventParameters)});`\n    }\n\n    return `gtag(\\'config\\', \\'${config.measurementId}\\');`;\n  };\n\n  const getGoogleTag = (config: Ga4Config): HTMLElement => {\n    const generateTagScript = document.createElement('script');\n\n    generateTagScript.innerHTML = `${getGtagInitScript()}\\n` +\n      'function setGoogleTagConfig() {\\n' +\n      `  if (${!config.measurementId}) { return; }\\n` +\n      `  ${getConfigScript(config)}\\n` +\n      '}\\n' +\n      'setGoogleTagConfig();';\n\n    return generateTagScript;\n  };\n\n  const postponeEventSending = (eventParams: GoogleEventParams): void => {\n    pendingEvents.push(eventParams);\n  };\n\n  const sendPendingEvents = (): void => {\n    pendingEvents.forEach((event) => {\n      if (!event.sendTo) {\n        event.sendTo = config.measurementId;\n      }\n\n      sendCustomEvent(event);\n    });\n\n    pendingEvents = [];\n  };\n\n  const getEventParams = (eventType: GA_EVENT_TYPE, params: any): GoogleEventParams => {\n    return {\n      name: params.eventCategory,\n      sendTo: config.measurementId,\n      params: buildEventParams(params, gaCollectingService.getParams()),\n    };\n  };\n\n  const toSnakeCase = (camelCaseString: string): string => {\n    return camelCaseString.replace(\n      /[A-Z]+(?![a-z])|[A-Z]/g,\n      (matchingPart, index) => index ? '_' + matchingPart : matchingPart,\n    ).toLowerCase();\n  };\n\n  const isParamInvalid = (paramKey: string, paramValue: unknown): boolean => {\n    return paramKey.includes('user') ||\n      paramKey === 'nonInteraction' ||\n      typeof paramValue === 'object' ||\n      typeof paramValue === 'function';\n  };\n\n  const formatParamKey = (key: string): string => {\n    if (googleRestrictedParams.includes(key)) {\n      key = pianoPrefix + key;\n    }\n\n    return toSnakeCase(key);\n  };\n\n  const buildAdditionalInfo = (eventParamValue: string = '', placeholder: string, delimiter: string, collectedParams: any): string => {\n    const additionalKeys = ['offerId', 'aid', 'templateId', 'templateVariantId'];\n\n    if (eventParamValue && eventParamValue.includes(delimiter)) {\n      return eventParamValue;\n    }\n\n    return additionalKeys.reduce((additionalInfo: string, key: string) => {\n      if (!collectedParams[key]) {\n        return additionalInfo;\n      }\n\n      if (additionalInfo.length) {\n        additionalInfo += placeholder;\n      }\n\n      additionalInfo += `${key}${delimiter}${collectedParams[key]}`;\n\n      return additionalInfo;\n    }, eventParamValue);\n  };\n\n  const buildEventParams = (eventParams: any, collectedParams: any): any => {\n    const paramMap = {\n      ...collectedParams,\n      ...eventParams,\n      'non_interaction': EVENT_NON_INTERACTION_VALUES[eventParams.eventCategory],\n      'event_action': buildAdditionalInfo(eventParams.eventAction, '____', '_', collectedParams),\n      'event_label': buildAdditionalInfo(eventParams.eventLabel, ' ', ':', collectedParams),\n    };\n\n    return Object.keys(paramMap).reduce((params: { [key: string]: unknown }, paramKey) => {\n      const paramValue = paramMap[paramKey];\n\n      if (isParamInvalid(paramKey, paramValue)) {\n        return params;\n      }\n\n      params[formatParamKey(paramKey)] = paramValue;\n\n      return params;\n    }, {});\n  };\n  //#endregion\n\n  //#region Public\n  const setGa4Config = (gaConfig: Ga4Config) => {\n    config = gaConfig;\n\n    appendGoogleTag();\n  };\n\n  const getMeasurementId = (): string => config.measurementId;\n\n  const appendGoogleTag = (): void => {\n    if (!config.measurementId) {\n      return;\n    }\n\n    loadGoogleTagManager();\n\n    document.head.appendChild(getGoogleTag(config));\n  };\n\n  const sendCustomEvent = (eventParams: GoogleEventParams) => {\n    if (gaCollectingService.isEventExcluded(eventParams.name)) {\n      return;\n    }\n\n    window.gtag('event', eventParams.name, {\n      'send_to': eventParams.sendTo,\n      ...eventParams.params,\n    });\n  };\n\n  const handleEvent = (eventType: GA_EVENT_TYPE, eventParams: any): void => {\n    if (eventType !== GA_EVENT_TYPE.EMIT_GA_EVENT) {\n      return;\n    }\n\n    const googleEventParams = getEventParams(eventType, eventParams);\n\n    if (isTagLoaded() && googleEventParams.sendTo) {\n      sendCustomEvent(googleEventParams);\n      sendPendingEvents();\n      return;\n    }\n\n    postponeEventSending(googleEventParams);\n  };\n\n  //#endregion\n\n  return {\n    name: 'ga4Service',\n\n    getMeasurementId,\n    appendGoogleTag,\n    sendCustomEvent,\n    setGa4Config,\n\n    __protected__: {\n      handleEvent,\n    }\n  }\n})();\n\npn.container.register('ga4Service', {\n  useValue: ga4Service,\n});\n\npn.ga4Service = pn.container.resolve<Ga4ServiceInterface>('ga4Service');\n", "import {PostmessageInterface} from \"./postmessage\";\nimport {dataLayer} from \"@piano-sdk/data-layer\";\nimport {UtilInterface} from \"./util\";\nimport {TemplateInteractionParam} from \"./templateInteraction/types\";\n\ntype FireCallbacksFn = (event: string, object: any, iframeId: string, invokeCallbacksOnFire?: boolean) => any;\n\ntype TemplateInteractionConfig = {\n  autoRenewalDisabled: boolean;\n  subscriptionCancellation: boolean;\n};\n\ntype CurrentUserConfig = {\n  token: string;\n  isFlowInProgress?: boolean;\n  templateInteractionConfig: TemplateInteractionConfig;\n};\n\ntype ContinuationEventParams = {\n  subscriptionId: string;\n  autoRenew?: boolean;\n  cancellationType?: string;\n  trackingId?: string;\n};\n\ntype ContinuationResponseParams = ContinuationEventParams & {\n  isFlowError: boolean;\n  pageViewId: string;\n  tbc: string;\n}\n\nexport interface AcpInterface {\n  handleAcpEvent: (fireCallbacks: FireCallbacksFn, eventParams: any, iframeConfig: any, invokeCallbacksOnFire: boolean) => void;\n  extendByAcpParams: (eventName: string, eventParameters: { [key: string]: unknown }, iframeConfig: any) => unknown;\n  sendTemplateInteractionActive: (iframeConfig: any) => void;\n  getComposerAcpEvents: () => string[];\n}\n\nexport enum ACP_CHECKOUT_EVENTS {\n  purge = 'purge',\n  dismissTemplate = 'acp-close',\n  retainSubscription = 'acp-retain-subscription',\n  cancelSubscription = 'acp-cancel-subscription',\n}\n\nexport enum ACP_MYACCOUNT_EVENTS {\n  autoRenewalDisabled = 'acp-auto-renewal-disabled',\n  subscriptionCancellation = 'acp-subscription-cancellation',\n}\n\nenum ACP_COMPOSER_EVENTS {\n  dismissTemplate = 'dismissTemplate',\n  finalConfirmation = 'finalConfirmation',\n  autoRenewalDisabled = 'autoRenewalDisabled',\n  subscriptionCancellation = 'subscriptionCancellation',\n}\n\nconst acp = ((container = pn.container): AcpInterface => {\n  //#region Injections\n  const postmessage = container.resolve<PostmessageInterface>('postmessage');\n  const util = pn.container.resolve<UtilInterface>('util');\n  //#endregion Injections\n\n  //#region Private\n  const templateInteractionInitialConfig: TemplateInteractionConfig = {\n    autoRenewalDisabled: false,\n    subscriptionCancellation: false,\n  };\n\n  const currentUserInitialConfig: CurrentUserConfig = {\n    token: '',\n    isFlowInProgress: false,\n    templateInteractionConfig: { ...templateInteractionInitialConfig },\n  };\n\n  let currentUserConfig = { ...currentUserInitialConfig };\n\n  const getContinuationCallbackParams = (\n    eventParams: ContinuationEventParams,\n    templateInteractionParam: TemplateInteractionParam\n  ): ContinuationResponseParams | boolean => {\n    if (typeof eventParams?.autoRenew !== 'boolean' && typeof eventParams?.cancellationType !== 'string') {\n      return templateInteractionParam instanceof Error;\n    }\n\n    return {\n      isFlowError: templateInteractionParam instanceof Error,\n      autoRenew: eventParams?.autoRenew,\n      cancellationType: eventParams?.cancellationType,\n      pageViewId: dataLayer.get('pageViewId') as string,\n      tbc: util.getTbcCookie(),\n      subscriptionId: eventParams?.subscriptionId,\n      trackingId: typeof templateInteractionParam === \"string\" ? templateInteractionParam : undefined,\n    };\n  }\n\n  const continuationCallback = (\n    eventName: string,\n    eventParams: ContinuationEventParams,\n    templateInteractionParams: string | Error | undefined,\n  ): void => {\n    postmessage.broadcast(eventName, getContinuationCallbackParams(eventParams, templateInteractionParams));\n    setAcpFlowInProgress(false);\n\n    if (templateInteractionParams instanceof Error && templateInteractionParams.message === 'Subscription was upgraded') {\n      window.location.reload();\n    }\n  };\n\n  const sendTemplateInteractionEvent = (templateInteractionConfig: TemplateInteractionConfig): void => {\n    postmessage.broadcast('setTemplateInteractionConfig', templateInteractionConfig);\n  };\n\n  const setAcpFlowInProgress = (isInProgress: boolean): void => {\n    currentUserConfig.isFlowInProgress = isInProgress;\n  };\n\n  const setCurrentUserConfig = (config: CurrentUserConfig): void => {\n    currentUserConfig = {\n      ...currentUserConfig,\n      ...config\n    };\n  };\n\n  //#endregion Private\n\n  //#region Public\n  const handleAcpEvent = (\n    fireCallbacks: FireCallbacksFn,\n    eventParams: any,\n    iframeConfig: any,\n    invokeCallbacksOnFire: boolean\n  ) => {\n    const eventName = eventParams.params?.eventName || eventParams.event;\n    const {experienceActionId, continuation, containerSelector, displayMode, trackingId} = iframeConfig;\n    const selector: string | null = displayMode === 'inline' ? containerSelector : null;\n    const subscriptionId: string = eventParams.params?.subscriptionId;\n\n    const fireCustomEvent = () => {\n      fireCallbacks('customEvent', {\n        experienceActionId,\n        continuation,\n        trackingId,\n        customEventName: eventName,\n        containerSelector: selector,\n        ...eventParams.params,\n      }, eventParams.sender, invokeCallbacksOnFire);\n    }\n\n    switch (eventName) {\n      case ACP_CHECKOUT_EVENTS.purge:\n        fireCallbacks(ACP_COMPOSER_EVENTS.dismissTemplate, {\n          experienceActionId,\n          continuation,\n          trackingId,\n          offerType: iframeConfig.offerType || null,\n          ...eventParams.params,\n        }, eventParams.sender, invokeCallbacksOnFire);\n        break;\n\n      case ACP_CHECKOUT_EVENTS.retainSubscription:\n      case ACP_CHECKOUT_EVENTS.cancelSubscription:\n        fireCallbacks(ACP_COMPOSER_EVENTS.finalConfirmation, {\n          experienceActionId,\n          continuation,\n          confirm: eventName === ACP_CHECKOUT_EVENTS.cancelSubscription,\n          trackingId,\n          ...eventParams.params,\n        }, eventParams.sender, invokeCallbacksOnFire);\n        fireCustomEvent();\n        break;\n\n      case ACP_MYACCOUNT_EVENTS.autoRenewalDisabled:\n        fireCallbacks(ACP_COMPOSER_EVENTS.autoRenewalDisabled, {\n          templateType: 1,\n          continuation: continuationCallback.bind(\n            this,\n            `${ACP_MYACCOUNT_EVENTS.autoRenewalDisabled}-result`,\n            { ...eventParams.params, trackingId },\n          ),\n          subscriptionId,\n        }, eventParams.sender);\n        setAcpFlowInProgress(true);\n        break;\n\n      case ACP_MYACCOUNT_EVENTS.subscriptionCancellation:\n        fireCallbacks(ACP_COMPOSER_EVENTS.subscriptionCancellation, {\n          templateType: 1,\n          continuation: continuationCallback.bind(\n            this,\n            `${ACP_MYACCOUNT_EVENTS.subscriptionCancellation}-result`,\n            { ...eventParams.params, trackingId },\n          ),\n          subscriptionId,\n        }, eventParams.sender);\n        setAcpFlowInProgress(true);\n        break;\n\n      default:\n        fireCustomEvent();\n        break;\n    }\n  };\n\n  const extendByAcpParams = (eventName: string, eventParams: { [key: string]: unknown }, iframeConfig: any) => {\n    const {experienceActionId, continuation} = iframeConfig;\n\n    return {\n      ...eventParams,\n      experienceActionId,\n      continuation,\n      customEventName: eventName,\n    };\n  };\n\n  const getComposerAcpEvents = (): string[] => {\n    return Object.values(ACP_COMPOSER_EVENTS);\n  };\n\n  const sendTemplateInteractionActive = (iframeConfig: any): void => {\n    if (!iframeConfig.activateTemplateInteraction || !pn.user.isUserValid()) {\n      sendTemplateInteractionEvent(templateInteractionInitialConfig);\n      return;\n    }\n\n    const userToken = pn.user.getProvider().getToken();\n\n    if (userToken === currentUserConfig.token || currentUserConfig.isFlowInProgress) {\n      sendTemplateInteractionEvent(currentUserConfig.templateInteractionConfig);\n      return;\n    }\n\n    const expectedEvents = [\n      ACP_COMPOSER_EVENTS.subscriptionCancellation,\n      ACP_COMPOSER_EVENTS.autoRenewalDisabled,\n    ];\n\n    pn.experience.executeTemplateInteraction({ templateType: 1 })\n      .then(({ registeredEvents }) => {\n        const composerEvents = registeredEvents as string[];\n\n        return expectedEvents.reduce((config, expectedEvent) => {\n          if (composerEvents.includes(expectedEvent)) {\n            return {\n              ...config,\n              [expectedEvent]: true,\n            }\n          }\n\n          return config;\n        }, { ...templateInteractionInitialConfig });\n      })\n      .then((config: TemplateInteractionConfig) => {\n        sendTemplateInteractionEvent(config);\n        setCurrentUserConfig({\n          templateInteractionConfig: config,\n          token: userToken,\n        });\n      })\n      .catch(() => {\n        sendTemplateInteractionEvent(templateInteractionInitialConfig);\n        setCurrentUserConfig(currentUserInitialConfig);\n      });\n  };\n\n  //#endregion Public\n\n  return {\n    handleAcpEvent,\n    extendByAcpParams,\n    sendTemplateInteractionActive,\n    getComposerAcpEvents,\n  }\n})();\n\npn.container.register('acp', {\n  useValue: acp,\n});\n\npn.acp = pn.container.resolve<AcpInterface>('acp');\n", "import { FB_PIXEL_EVENT_TYPE, FbpixelInterface } from \"./fbpixel\";\nimport { GaServiceInterface } from \"./googleAnalytics/gaService\";\nimport { LOG_EVENT_TYPE, LogInterface } from \"./log\";\nimport {Ga4ServiceInterface} from \"./googleAnalytics/ga4Service\";\nimport { GA_EVENT_TYPE } from \"./googleAnalytics/constants\";\n\nexport interface AnalyticsInterface {\n  name: string;\n  ga: AnalyticDefaultMethods;\n  fbpixel: AnalyticDefaultMethods;\n  log: AnalyticDefaultMethods;\n}\n\ninterface AnalyticDefaultMethods {\n  event: (eventParams: AnalyticsEventParams) => void;\n  initialize: () => void;\n}\n\ninterface AnalyticsEventParams {\n  eventType: unknown;\n  payload?: unknown;\n}\n\nconst analytics = (container = pn.container): AnalyticsInterface => {\n  const gaService = container.resolve<GaServiceInterface>('gaService');\n  const ga4Service = container.resolve<Ga4ServiceInterface>('ga4Service');\n  const fbpixelService = container.resolve<FbpixelInterface>('fbpixel');\n  const logService = container.resolve<LogInterface>('log');\n  const name = 'analytics';\n\n  const getInitMethod = (initMethod: () => void | undefined): () => void => {\n    return initMethod || function () {};\n  }\n\n  const createAnalyticDefaultMethods = <T extends { __protected__: any }, K>(analyticService: T): AnalyticDefaultMethods => {\n    return {\n      initialize: getInitMethod(analyticService.__protected__.init),\n      event: ({ eventType, payload }: AnalyticsEventParams) => analyticService.__protected__.handleEvent(eventType as K, payload)\n    }\n  }\n\n  const createGADefaultMethods= <T extends { __protected__: any }, Y extends { __protected__: any }, K>(gaService: T, ga4Service: Y): AnalyticDefaultMethods =>  ({\n    initialize: () => {},\n    event: ({ eventType, payload }: AnalyticsEventParams) => {\n      gaService.__protected__.handleEvent(eventType as K, payload);\n      ga4Service.__protected__.handleEvent(eventType as K, payload);\n    },\n  });\n\n  const ga: AnalyticDefaultMethods = createGADefaultMethods<GaServiceInterface, Ga4ServiceInterface, GA_EVENT_TYPE>(gaService, ga4Service);\n  const fbpixel: AnalyticDefaultMethods = createAnalyticDefaultMethods<FbpixelInterface, FB_PIXEL_EVENT_TYPE>(fbpixelService);\n  const log: AnalyticDefaultMethods = createAnalyticDefaultMethods<LogInterface, LOG_EVENT_TYPE>(logService);\n\n  return {\n    name,\n\n    ga,\n    fbpixel,\n    log,\n  }\n};\n\npn.container.register('analytics', {\n  useValue: analytics()\n});\npn.analytics = pn.container.resolve<AnalyticsInterface>('analytics');\n", "import { LOG_EVENT_TYPE } from \"./log\";\nimport { APIInterface } from \"./api\";\nimport { AnalyticsInterface } from \"./analytics\";\n\nexport interface LoggingInterface {\n  name: string;\n\n  setTime(actionType: LogActionType, time: number, additionalTags?: AdditionalTagsMapType): void\n}\n\ntype TSBundleType = \"ts_s\" | \"ts_c\"; // ts_c = typescript completed | ts_s = typescript short\n\nexport type LogActionType = 'expExec' | 'track' | 'completeInit' | 'startInit' |\n  'offerShow' | 'templateShow' |\n  'myAccountShow' |\n  'idShow';\n\ntype AdditionalTagsType = \"aot\" | \"form_type\" | \"template_id\" | \"offer_id\" | \"exp_id\";\n\ntype AdditionalTagsMapType = {\n    [k in AdditionalTagsType]?: string;\n}\n\ntype LogActionInfoType = {\n    name: LogActionType;\n    time: number;\n    tags?: AdditionalTagsMapType,\n}\n\ntype SendLogQueryParamsType = {\n  aid: string;\n  type: TSBundleType,\n  actions: LogActionInfoType[],\n}\n\nconst logging = ((): LoggingInterface => {\n\n  const api = pn.container.resolve<APIInterface>('api');\n  const analytics = pn.container.resolve<AnalyticsInterface>('analytics');\n\n  const name = 'logging';\n\n  const times: LogActionInfoType[] = [];\n\n  const ANON_LOG_ENDPOINT = '/telemetry/ux/timings';\n\n  setTimeout(() => {\n    sendTimeLog();\n  }, 10000);\n\n  const getApiEndpoint = (): string => {\n    return api.getEndpoint() + ANON_LOG_ENDPOINT;\n  }\n\n  const sendTimeLog = (type?: TSBundleType): void => {\n    if ((Math.floor(Math.random() * 500) + 1) !== 255) {\n      return;\n    }\n    const t = type || (pn.fullTPVersion ? 'ts_c' : 'ts_s');\n    const params: SendLogQueryParamsType = {\n      aid: pn.aid,\n      type: t,\n      actions: times,\n    }\n\n    analytics.log.event({\n      eventType: LOG_EVENT_TYPE.LOG_TELEMETRY,\n      payload: {\n        url: getApiEndpoint(),\n        params,\n      }\n    });\n  }\n\n  const setTime = (actionType: LogActionType, time: number, additionalTags?: AdditionalTagsMapType): void => {\n    times.push({\n        name: actionType,\n        time,\n        tags: additionalTags,\n    })\n  }\n\n  return {\n    name,\n    setTime,\n  }\n\n})();\n\npn.container.register('logging', {\n  useValue: logging\n});\npn.logging = pn.container.resolve<LoggingInterface>('logging');\n", "import { UtilInterface } from \"./util\";\nimport { AjaxInterface } from \"./ajax\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { dataLayer } from \"@piano-sdk/data-layer\";\nimport { ConsentInterface } from \"./consent\";\n\nconst CREDIT_COMMON_PATH = \"/execution/credit\";\nconst REDEEM_COMMON_PATH = `${CREDIT_COMMON_PATH}/redeem`;\nconst CHECK_COMMON_PATH = `${CREDIT_COMMON_PATH}/check`;\n\nconst MANUAL_CREDIT_REDEEM = \"manualCreditRedeemed\";\nconst CREDIT_CHECK = \"creditChecked\";\n\nexport interface CreditInterface {\n  redeem(data: any): Promise<CreditResponseInterface>;\n\n  check(data: any): Promise<CreditResponseInterface>;\n\n  registerCallback(callbackName: string, callback: Function): void;\n}\n\nexport interface CreditResponseInterface {\n  uid?: string;\n  xbc?: string;\n  cid: string;\n  itemId: string;\n  redeemed: boolean;\n}\n\nenum RedemptionMethods {\n  AUTO = \"A\",\n  MANUAL = \"M\",\n}\n\ntype Request = Promise<CreditResponseInterface>;\n\nconst credit = ((): CreditInterface => {\n  const util = pn.container.resolve<UtilInterface>(\"util\");\n  const ajax = pn.container.resolve<AjaxInterface>(\"ajax\");\n  const jqUtils = pn.container.resolve<JqUtilsInterface>(\"jqUtils\");\n  const eventUtils = pn.container.resolve<EventUtilsInterface>(\"eventUtils\");\n  const consent = pn.container.resolve<ConsentInterface>(\"consent\");\n\n  const prepareParams = (params: Record<string, any>): Record<string, any> => {\n    return Object.entries(params).reduce((res, [key, value]) => {\n      if (value || value === 0) {\n        res[key] = value;\n      }\n\n      return res;\n    }, {} as Record<string, any>);\n  };\n\n  const name = \"credit\";\n\n  const XB_COOKIE = \"xbc\";\n\n  const eventManager = eventUtils.createEventManager([]);\n\n  const getXbc = (): string | undefined => {\n    return util.__protected__.getCookie(XB_COOKIE) || undefined;\n  };\n\n  const getTbc = (): string | undefined => {\n    return util.getTbcCookie() || undefined;\n  };\n\n  const getEndpoint = () => {\n    const domain = pn.getExperienceEndpoint(false);\n\n    return `${domain}/${pn.aid}`;\n  };\n\n  const getDefaultParams = (): any => {\n    return prepareParams({\n      xbc: getXbc(),\n      tbc: getTbc(),\n    });\n  };\n\n  const request = (url: string, data: any, queries?: any): Request => {\n    return new Promise((resolve, reject) => {\n      const queryString = queries ? \"?\" + jqUtils.param(queries) : \"\";\n      const path = getEndpoint() + url + queryString;\n      const param = getDefaultParams();\n      const body = prepareParams({\n        ...param,\n        ...data,\n      });\n\n      if (!(body.cid && body.itemId && body.xbc)) {\n        const errMsg = \"credit: Error: Required params are absent\";\n\n        util.debug(errMsg);\n        reject({\n          code: 0,\n          message: errMsg,\n        });\n      }\n\n      ajax.request({\n        type: \"post\",\n        url: path,\n        data: {\n          ...param,\n          ...data,\n        },\n        xhrFields: {\n          withCredentials: true,\n        },\n        error: (err: any) => {\n          const errMsg = `credit: Error: Received error:${err.status} ${err.responseText}`;\n\n          util.debug(errMsg);\n          reject({\n            code: err.status,\n            message: err.responseText,\n          });\n        },\n        success: (data: any) => {\n          resolve(data);\n        },\n      });\n    });\n  };\n\n  const requestFireCb = (\n    events: string | { success: string; failure: string },\n    url: string,\n    data: any,\n    queries?: any\n  ): any => {\n    const createFaireCb = (event: string) => (data: any) => {\n      eventManager.fire(undefined, event, true, data);\n\n      return data;\n    };\n    const successFairCb = createFaireCb(\n      typeof events === \"string\" ? events : events.success\n    );\n    const failureFairCb = createFaireCb(\n      typeof events === \"string\" ? events : events.failure\n    );\n\n    return request(url, data, queries).then(successFairCb).catch(failureFairCb);\n  };\n\n  const registerCallback = (callbackName: string, callback: Function) => {\n    eventManager.addEvent(callbackName);\n    eventManager.registerCallback(callbackName, callback);\n  };\n\n  const redeem = (data: {\n    cid: string;\n    itemId: string;\n    newRedemptionMethod?: RedemptionMethods;\n    uid?: string;\n    trackingId?: string;\n  }): Promise<CreditResponseInterface> => {\n    const { consent_modes: consentModes, consent_purposes: consentPurposes } =\n      consent.__protected__.addConsentsToParams({});\n    return requestFireCb(MANUAL_CREDIT_REDEEM, REDEEM_COMMON_PATH, {\n      ...data,\n      previousUserSegments: dataLayer.get(\"userSegments\"),\n      consentModes,\n      consentPurposes,\n    }).then(({ xbc }: CreditResponseInterface) => {\n      if (xbc && xbc !== getXbc()) {\n        util.setXbcCookieFromResponse({ xbc });\n      }\n    });\n  };\n\n  const check = (data: {\n    cid: string;\n    itemId: string;\n    uid?: string;\n  }): Promise<CreditResponseInterface> => {\n    return requestFireCb(CREDIT_CHECK, CHECK_COMMON_PATH, data);\n  };\n\n  return {\n    redeem,\n    check,\n    registerCallback,\n  };\n})();\n\npn.container.register(\"credit\", {\n  useValue: credit,\n});\npn.credit = pn.container.resolve<CreditInterface>(\"credit\");\n", "import { UtilInterface } from \"./util\";\nimport { PostmessageInterface } from \"./postmessage\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { ContainerUtilsInterface } from \"./containerUtils\";\nimport { LoggingInterface } from \"./logging\";\n\nexport interface TinypassLoginInterface {\n  name: string;\n\n  show(config: any): void;\n\n  close(): void;\n\n  showBackdrop(): void;\n\n  hideBackdrop(): void;\n\n  centerBackdrop(container: any): void;\n\n  registerCallback(callbackName: string, callback: Function): void;\n\n  listenLogin(config: any): void;\n}\n\nconst tinypassLogin = ((): TinypassLoginInterface => {\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const containerUtils = pn.container.resolve<ContainerUtilsInterface>('containerUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const eventUtils = pn.container.resolve<EventUtilsInterface>('eventUtils');\n  const logging = pn.container.resolve<LoggingInterface>('logging');\n\n  const name = 'tinypassLogin';\n\n  let iframeLoadStatus: boolean;\n\n  /**\n   * This boolean is used to determine if the browser\n   * is actually receiving postMessages.  IE has support for it\n   * but messages are not received because of an IE bug\n   */\n  let postMessageIsWorking = false;\n  const eventManager = eventUtils.createEventManager(['resize', 'loginSuccess', 'logout']);\n\n  /**\n   * Gets the base url for offer iframes. This respects the environment that\n   * is being worked in. To override the base url, set:\n   *\n   *     tp.endpoint = \"http://hostname/api/v3\";\n   *\n   * Offer iframes would be loaded from: //hostname/checkout/offer/show?param=value\n   *\n   * @returns {string}  The base url for offer iframes\n   * @const\n   */\n  const _getBaseUrl = () => {\n    return pn.getEndpointRoot(true) + '/checkout/user/loginShow';\n  };\n\n  const _getCheckUrl = () => {\n    return pn.getEndpointRoot(true) + '/checkout/user/check';\n  };\n\n  /**\n   * Handles the receipt of a message from an iframe.\n   * @param params\n   * @const\n   */\n  function _receive(params: any) {\n    util.debug('Login event received', params.event, params.params, params);\n    var iframe = containerUtils.getIframe(params.sender);\n    var invokeCallbacksOnFire = !iframe.config.parent;\n\n    //        if(!postMessageIsWorking)\n    //            return;\n\n    switch (params.event) {\n      //case \"resize\":\n      //    containerUtils.resizeIframe(iframe, params.params);\n      //    if (iframe.config.displayMode == \"modal\") {\n      //        containerUtils.centerIt(iframe.container);\n      //    }\n      //    postmessage.send(\"afterResize\", {}, iframe.iframeId);\n      //    break;\n      case 'loaded':\n        iframeLoadStatus = false;\n        postMessageIsWorking = true;\n\n        // logging.setTime('tpAccShow', Math.floor(performance.now() - iframe.iframeParams.initTime));\n        //if (iframe.config.displayMode === \"modal\") {\n        //    containerUtils.resizeIframe(iframe, params.params);\n        //    containerUtils.checkBackdropAndContainer(iframe.container);\n        //}\n        //\n        //if (iframe.config.displayMode === \"popup\") {\n        //    containerUtils.resizeIframe(iframe, params.params);\n        //}\n        //\n        //eventManager.fireCallbacks(params.event, params.params, params.sender);\n        //\n        //if (iframe.config.displayMode === 'inline') {\n        //    if (!iframe.containerReady) iframeParams        //                containerUtils.operationWithContainer(iframe.iframeParams.containerSelector, function(container) {\n        //                    var tempContainer = $('#temp-inline-' + iframe.iframeId);\n        //                    container.html(tempContainer.html());\n        //                    tempContainer.remove();\n        //                    //noinspection JSValidateTypes\n        //                    iframe.element = container.children('iframe');\n        //                    iframe.containerReady = true;\n        //                    containerUtils.resizeIframe(iframe, params.params);\n        //                });\n\n        //    } else {\n        //        containerUtils.resizeIframe(iframe, params.params);\n        //    }\n        //}\n\n        break;\n      case 'close':\n        containerUtils.closeModalContainer();\n        eventManager.fireCallbacks(params.event, params.params, params.sender, invokeCallbacksOnFire);\n        break;\n      case 'cancel':\n      case 'error':\n      case 'customEvent':\n        eventManager.fireCallbacks(params.event, params.params, params.sender, invokeCallbacksOnFire);\n        break;\n      case 'loginSuccess':\n        _loginSuccess(params.event, params.params, params.sender, invokeCallbacksOnFire);\n        break;\n      case 'logoutSuccess':\n        _logoutSuccess(params.event, params.params, params.sender, invokeCallbacksOnFire);\n        break;\n      case 'readyToSubmitStats':\n        let stats = {\n          pageViewId: pn.main.fetchPageViewId(),\n          tbc: util.getTbcCookie()\n        }\n        postmessage.send('submitStats', stats, params.sender);\n        break;\n      default:\n        util.debug('Received invalid event type: ' + params.event);\n        return;\n    }\n  };\n\n  function _logoutSuccess(event: any, params: any, sender: string, callback: boolean) {\n    eventManager.fireCallbacks('logout', null, undefined, true);\n    util.setAccessTokenListCookie(\n      { value: params.token_list, cookie_domain: params.cookie_domain },\n      params.user_token, true\n    );\n  };\n\n  function _loginSuccess(event: any, params: any, sender: string, invokeCallbacksOnFire: boolean) {\n    var iframe = containerUtils.getIframe(sender);\n    util.setAccessTokenListCookie(\n      { value: params.token_list, cookie_domain: params.cookie_domain },\n      params.user_token\n    );\n    iframe.config.userToken = params.user_token;\n\n    if (iframe && iframe.config && iframe.config.loginSuccess) {\n      iframe.config.loginSuccess(params.event, params.params, params.sender);\n    }\n    eventManager.fireCallbacks(event, params, sender, invokeCallbacksOnFire);\n\n    if (iframe && iframe.config && iframe.config.closeAfterSuccess) {\n      containerUtils.closeModalContainer(sender);\n    }\n\n    var config = {\n      reloadAfterLogin: true,\n      userToken: params.user_token,\n      user: params.user\n    };\n    _reload(config);\n  };\n\n  const _reload = (config: any) => {\n    postmessage.broadcast('reloadOffer', config);\n  }\n\n  function _loginSuccessNoPostMessage(tokenList: string[], cookieDomain: string, userToken: string, iframeParams: any) {\n    var iframe = containerUtils.getIframe(iframeParams.iframeId);\n    var invokeCallbacksOnFire = !iframe.config.parent;\n    util.setAccessTokenListCookie(\n      { value: tokenList, cookie_domain: cookieDomain },\n      userToken\n    );\n    iframe.config.userToken = userToken;\n\n    if (iframe && iframe.config && iframe.config.loginSuccess) {\n      iframe.config.loginSuccess('loginSuccess', {}, {});\n    }\n    eventManager.fireCallbacks('loginSuccess', {}, undefined, invokeCallbacksOnFire);\n  };\n\n  const _getTpConfigurationParameters = (iframeParams: any) => {\n    var propsToCopy: string[] = [\n      'aid',\n      'gaClientId',\n      'tags',\n      'contentSection',\n      'contentAuthor'\n    ];\n    propsToCopy.forEach((value: string) => {\n      // @ts-ignore\n      if (pn[value]) {\n        // @ts-ignore\n        iframeParams[value] = pn[value];\n      }\n    });\n\n    if (pn.contentCreated) {\n      iframeParams.contentCreated = pn.contentCreated;\n    }\n\n    return iframeParams;\n  }\n\n  const _getConfigurationParameters = (c: any) => {\n    var iframeParams: any = {};\n\n    //generic properties coping\n    var propsToCopy = [\n      'displayMode',\n      'aid',\n      'width',\n      'height',\n      'state'\n    ];\n    propsToCopy.forEach((value: string) => {\n      if (c[value]) {\n        iframeParams[value] = c[value];\n      }\n    });\n\n    return iframeParams;\n  }\n\n  let openedIframeId: string;\n\n  function _open (config: any): any {\n    const initTime = performance.now();\n    if (openedIframeId) {\n      containerUtils.closeModalContainer(openedIframeId);\n    }\n    var defaultConfig = {\n      closeAfterSuccess: true\n    };\n    var c: any = {};\n    Object.assign(c, defaultConfig, config);\n\n    c.displayMode = 'popup';\n    c.width = 360;\n    c.height = 660;\n    c.state = c.state ? c.state : 'login';\n    var iframeParams = _getConfigurationParameters(c);\n\n    iframeParams.iframeId = util.randomString(16);\n    iframeParams.url = window.location.href;\n    iframeParams.host_url = window.location.href;\n    iframeParams.initTime = initTime;\n\n    openedIframeId = iframeParams.iframeId;\n\n    _getTpConfigurationParameters(iframeParams);\n\n    iframeParams.user_provider = 'tinypass_accounts';\n    if (config.userToken) {\n      iframeParams.user_token = config.userToken;\n    }\n\n    util.getCampaigns(iframeParams);\n\n    var iframe;\n    const params = {\n      url: _getBaseUrl(),\n      config: c,\n      postMessageUrl: _getBaseUrl(),\n      receive: _receive,\n      iframeParams: iframeParams\n    };\n\n    if (c.iframeId) {\n      params.iframeParams.iframeId = c.iframeId;\n      iframe = containerUtils.redirectContainer(c.iframeId, params);\n    } else {\n      iframe = containerUtils.createContainer(params);\n    }\n\n    eventManager.registerCallback(c, iframeParams.iframeId);\n\n    return iframe;\n  };\n\n  /**\n   * Shows an offer.\n   *\n   * Look at tp.offer.show for documentation for the configuration\n   *\n   * @param config\n   * @const\n   */\n  const show = (config: any) => {\n    if (iframeLoadStatus) {\n      return false;\n    } else {\n      iframeLoadStatus = true;\n      setTimeout(() => {\n        iframeLoadStatus = false;\n      }, 10000);\n    }\n\n    if (!_open(config)) {\n      util.error('Could not initialize login; check configuration');\n    }\n  };\n\n  function _listenLogin (config: any) {\n    eventManager.registerCallback(config, config.iframeId);\n    var iframe = {\n      iframeId: config.iframeId,\n      config: config,\n      iframeParams: config\n    };\n    postmessage.init({\n      postMessageUrl: _getBaseUrl(),\n      receive: _receive,\n      iframe: iframe,\n      iframeParams: {}\n    });\n  };\n\n  const close = () => {\n    containerUtils.closeModalContainer();\n  }\n\n  const showBackdrop = () => {\n    containerUtils.showBackdrop();\n  }\n\n  const hideBackdrop = () => {\n    containerUtils.hideBackdrop();\n  }\n\n  const centerBackdrop = (container: any) => {\n    containerUtils.centerBackdrop(container);\n  }\n\n  const registerCallback = (callbackName: string, callback: Function) => {\n    eventManager.registerCallback(callbackName, callback);\n  }\n\n  const listenLogin = (config: any) => {\n    // TODO verify that no one is using this function and remove it\n    _listenLogin(config);\n  }\n\n  return {\n    name,\n    show,\n    close,\n    showBackdrop,\n    hideBackdrop,\n    centerBackdrop,\n    registerCallback,\n    listenLogin,\n  };\n\n})();\n\npn.container.register('tinypassLogin', {\n  useValue: tinypassLogin\n});\npn.tinypassLogin = pn.container.resolve<TinypassLoginInterface>('tinypassLogin');\n", "import { UtilInterface } from \"./util\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { TinypassLoginInterface } from \"./tinypassLogin\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { AjaxInterface } from \"./ajax\";\n\nexport interface TinypassAccountsInterface {\n  isv: boolean;\n  name: string;\n\n  isUserValid(): boolean;\n\n  getToken(): string | null;\n\n  getName(): string;\n\n  onLoginSuccess(params: any): void;\n\n  isConfigured(): boolean;\n\n  login(config: any): void;\n\n  logout(callback: Function): void;\n\n  registerCallback(callbackName: string, callback: Function): void;\n}\n\nconst tinypassAccounts = ((): TinypassAccountsInterface => {\n\n  const ajax = pn.container.resolve<AjaxInterface>('ajax');\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const tinypassLogin = pn.container.resolve<TinypassLoginInterface>('tinypassLogin');\n  const eventUtils = pn.container.resolve<EventUtilsInterface>('eventUtils');\n\n  const isv = false;\n  const name = 'tinypassAccounts';\n\n  const eventManager = eventUtils.createEventManager(['logout']);\n\n  const getName = () => {\n    return 'tinypass_accounts';\n  };\n\n  const getToken = () => {\n    return util.getUserTokenCookie() || null;\n  };\n\n  const isUserValid = () => {\n    return !!util.getUserTokenCookie();\n  };\n\n  const onLoginSuccess = (params: any) => {\n    util.setAccessTokenListCookie(\n      { value: params.token_list, cookie_domain: params.cookie_domain },\n      params.user_token\n    );\n  }\n\n  const isConfigured = (): boolean => {\n    return (pn.useTinypassAccounts === true || (typeof pn.useTinypassAccounts === 'string' && pn.useTinypassAccounts === 'true'));\n  };\n\n  const login = (config: any): void => {\n    config = config || {};\n    config.userToken = getToken();\n    return tinypassLogin.show(config);\n  };\n\n  const logout = (callback: Function): void => {\n    var params = {\n      aid: pn.aid,\n      url: document.location.href\n    };\n\n    var url = pn.getEndpointRoot(true) + '/checkout/user/logout?' + jqUtils.param(params);\n\n    //blank out the uat,uae,ut tokens regardless of logout response\n    util.setAccessTokenListCookie({ value: null }, undefined, true);\n\n    ajax.request({\n      url: url,\n      dataType: 'jsonp',\n      success: (rspData: any) => {\n        util.setAccessTokenListCookie({\n          value: '',\n          cookie_domain: rspData.models.cookie_domain\n        }, rspData.models.user_token, true);\n        eventManager.fireCallbacks('logout', null, undefined, true);\n        if (callback) {\n          callback(rspData);\n        }\n      },\n      error: (rspData: any) => {\n        util.setAccessTokenListCookie(null, undefined, true);\n        eventManager.fireCallbacks('logout', null, undefined, true);\n        if (callback) {\n          callback(rspData);\n        }\n      }\n    });\n  };\n\n  const registerCallback = (callbackName: string, callback: Function) => {\n    eventManager.addEvent(callbackName);\n    eventManager.registerCallback(callbackName, callback);\n  }\n\n  return {\n    name,\n    isv,\n    isUserValid,\n    getToken,\n    getName,\n    onLoginSuccess,\n    isConfigured,\n    login,\n    logout,\n    registerCallback,\n  };\n\n})();\n\npn.container.register('tinypassAccounts', {\n  useValue: tinypassAccounts\n});\npn.tinypassAccounts = pn.container.resolve<TinypassAccountsInterface>('tinypassAccounts');\n", "import { UtilInterface } from \"./util\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { CookieInterface } from \"./cookie\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface CondeUserProviderInterface {\n  isv: boolean;\n  name: string;\n\n  getName(): string;\n\n  isUserValid(): boolean;\n\n  getToken(): string | null;\n\n  onLoginSuccess(params: any): void;\n\n  logout(callback?: Function): void;\n\n  isConfigured(): boolean;\n\n  registerCallback(callbackName: string, callback: Function): void;\n}\n\nconst condeUserProvider = ((): CondeUserProviderInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const cookie = pn.container.resolve<CookieInterface>('cookie');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const eventUtils = pn.container.resolve<EventUtilsInterface>('eventUtils');\n\n  const isv = false;\n  const name = 'condeUserProvider';\n\n  const eventManager = eventUtils.createEventManager(['logout']);\n\n  const getName = (): string => {\n    return 'conde';\n  }\n\n  const getToken = (): string | null => {\n    var cnid = util.findCookieByName('amg_user_partner');\n    if (typeof (cnid) !== 'undefined' && cnid && cnid.length >= 0) {\n      return cnid;\n    }\n    return null;\n  }\n\n  const isUserValid = (): boolean => {\n    return !!util.getUserTokenCookie();\n  }\n\n  const logout = (callback?: Function): void => {\n    util.setAccessTokenListCookie({ value: null }, undefined, true);\n    var domains = util.getPossibleCookieDomains();\n\n    for (var i in domains) {\n      util.deleteCookie('amg_user', domains[i]);\n      util.deleteCookie('amg_user_partner', domains[i]);\n      util.deleteCookie('amg_user_info', domains[i]);\n      util.deleteCookie('amg_user_ext', domains[i]);\n      util.deleteCookie('amg_user_update', domains[i]);\n    }\n\n    util.deleteCookie('amg_user');\n    util.deleteCookie('amg_user_partner');\n    util.deleteCookie('amg_user_info');\n    util.deleteCookie('amg_user_ext');\n    util.deleteCookie('amg_user_update');\n\n    eventManager.fireCallbacks(\"logout\", null, undefined, true);\n    if (callback) {\n      callback();\n    }\n  }\n\n  const onLoginSuccess = (params: any): void => {\n    util.setAccessTokenListCookie(\n      { value: params.token_list, cookie_domain: params.cookie_domain },\n      params.user_token\n    );\n    var options: any = {\n      path: '/',\n      expires: 730\n    };\n\n    if (params.cookie_domain && params.cookie_domain !== 'localhost' && (jqUtils.inArray(params.cookie_domain, util.getPossibleCookieDomains()) >= 0)) {\n      options.domain = params.cookie_domain;\n    }\n\n    //2016-05-09 - By default the cookie plugin always encodes.  Conde logic is not smart enough to decode\n    cookie.raw = true;\n    util.__protected__.setCookie(params.params.cookieName, params.params.cookieValue, options);\n    util.__protected__.setCookie('amg_user_partner', params.params.externalId, options);\n    util.__protected__.setCookie('amg_user_info', params.params.userName, options);\n    util.__protected__.setCookie('amg_user_ext', params.params.siteUserId, options);\n\n    if (params.params.updateToken) {\n      util.__protected__.setCookie('amg_user_update', params.params.updateToken, options);\n    }\n    cookie.raw = false;\n  }\n\n  const isConfigured = (): boolean => {\n    return (pn.useCondeUserProvider === true || (typeof pn.useCondeUserProvider === 'string' && pn.useCondeUserProvider === 'true'));\n  };\n\n  const registerCallback = (callbackName: string, callback: Function) => {\n    eventManager.addEvent(callbackName);\n    eventManager.registerCallback(callbackName, callback);\n  }\n\n  return {\n    isv,\n    name,\n    getName,\n    isUserValid,\n    getToken,\n    onLoginSuccess,\n    logout,\n    isConfigured,\n    registerCallback,\n  };\n\n})();\n\npn.container.register('condeUserProvider', {\n  useValue: condeUserProvider\n});\npn.condeUserProvider = pn.container.resolve<CondeUserProviderInterface>('condeUserProvider');\n", "import { APIInterface } from \"./api\";\nimport { UtilInterface } from \"./util\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface GigyaInterface {\n  isv: boolean;\n  name: string;\n\n  init(config: any): void;\n\n  isUserValid(): boolean;\n\n  getToken(): string | null;\n\n  getName(): string;\n\n  onLoginSuccess(params: any): void;\n\n  login(callback?: Function): void;\n\n  logout(callback?: Function): void;\n\n  isConfigured(): boolean;\n\n  registerCallback(callbackName: string, callback: Function): void;\n\n  loginByPasswordless(sessionInfo: any): void;\n}\n\nconst gigya = ((): GigyaInterface => {\n\n  const util = pn.container.resolve<UtilInterface>('util');\n  const api = pn.container.resolve<APIInterface>('api');\n  const eventUtils = pn.container.resolve<EventUtilsInterface>('eventUtils');\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n\n  let isv = false;\n  const name = 'gigya';\n\n  // const provider: any;\n\n  let _isGigyaInitialized = false;\n\n  function _isGigyaLoaded() {\n    return window.gigya && window.gigya.__initialized\n  };\n\n  const eventManager = eventUtils.createEventManager([\"userChanged\", \"onHide\", \"logout\"]);\n  const _config: any = {\n    apiKey: null,\n    screenSet: \"Default-RegistrationLogin\",\n    startScreen: null,\n    enabledProviders: null,\n    lang: null\n  };\n\n  // any new user provider should implement these methods\n  // const provider = function () {\n  const getName = (): string => {\n    return 'gigya'\n  };\n\n  function getToken(): string | null {\n    var ut = util.getUserTokenCookie();\n    if (ut) {\n      var gigyaCookie = util.findCookieByName(\"glt_\" + _config.apiKey);\n      var userTokenGigyaCookie = util.findCookieByName(\"__utg_\" + _config.apiKey);\n\n      if (gigyaCookie === userTokenGigyaCookie) {\n        return ut;\n      }\n    }\n\n    return null;\n  };\n\n  function isUserValid(): boolean {\n    var userToken = getToken();\n    return !!(typeof (userToken) !== 'undefined' && userToken && userToken.length >= 0);\n  };\n\n  function onLoginSuccess(params: any): void {\n    util.setAccessTokenListCookie({\n        value: params.token_list,\n        cookie_domain: params.cookie_domain\n      },\n      params.user_token\n    );\n  }\n\n  function init(config: any): void {\n    if (_isGigyaInitialized) {\n      return;\n    }\n    for (var item in config) {\n      if (typeof (config[item]) !== 'undefined') {\n        _config[item] = config[item];\n      }\n    }\n\n    if (!_config.screenSet) {\n      throw \"Gigya is not configured: screenSet parameter required\";\n    }\n\n    if (!_config.apiKey) {\n      throw \"Gigya is not configured: apiKey parameter required\";\n    }\n\n    _addEventHandlers();\n    _isGigyaInitialized = true;\n\n    _refreshUserToken();\n  };\n\n  // need to avoid multiple getAccountInfo request.\n  let refreshUserTokenCallbacks: any[] = [];\n\n  function _refreshUserToken(force?: boolean, callback?: Function) {\n    if (!_isGigyaInitialized) {\n      throw \"Gigya is not configured\";\n    }\n\n    checkGigyaLoaded();\n\n    var gigyaCookie = util.findCookieByName(\"glt_\" + _config.apiKey);\n    var userTokenGigyaCookie = util.findCookieByName(\"__utg_\" + _config.apiKey);\n\n    var getAccountInfoResponse = (response: any) => {\n      if (response.errorCode === 0) {\n        var params = {\n          uid: response.UID,\n          signature: response.UIDSignature,\n          signature_timestamp: response.signatureTimestamp,\n          url: util.prepareUrlParameter(window.location.href)\n        };\n\n        util.startCall(\"refreshUserToken\");\n        api.callApi(\"/anon/gigya/verifyAccountInfo\", params, (response: any) => {\n            if (response && response.result) {\n              util.setAccessTokenListCookie(\n                response.result.access_token,\n                response.result.user_token\n              );\n\n              var options: any = {\n                path: \"/\",\n                expires: 730\n              };\n\n              if (response.result.access_token) {\n                var cookie_domain = response.result.access_token.cookie_domain;\n                if (cookie_domain\n                  && cookie_domain !== 'localhost'\n                  && (jqUtils.inArray(cookie_domain, util.getPossibleCookieDomains()) >= 0)\n                ) {\n                  options[\"domain\"] = cookie_domain;\n                }\n              }\n\n              var value = util.findCookieByName(\"glt_\" + _config.apiKey);\n              util.__protected__.setCookieConsent(\"vx\", \"__utg_\" + _config.apiKey, value, options);\n\n              for (var i = 0; i < refreshUserTokenCallbacks.length; i++) {\n                var c = refreshUserTokenCallbacks[i];\n                if (c) {\n                  c(response.result);\n                }\n              }\n\n              if (response.result.user) {\n                response.result.user = {\n                  uid: response.result.user.uid,\n                  email: response.result.user.email,\n                  firstName: response.result.user.first_name,\n                  lastName: response.result.user.last_name,\n                  valid: response.result.user.valid\n                }\n              }\n              eventManager.fireCallbacks(\"userChanged\", response.result, undefined, true);\n            } else {\n              util.log(\"Can't verify gigya user: may be the configuration of gigya user provider is invalid\");\n              util.setAccessTokenListCookie();\n            }\n\n            refreshUserTokenCallbacks = [];\n            util.doneCall(\"refreshUserToken\");\n          }\n        );\n      } else {\n        util.setAccessTokenListCookie();\n        refreshUserTokenCallbacks = [];\n      }\n    }\n\n    if (gigyaCookie !== userTokenGigyaCookie || !!gigyaCookie && gigyaCookie === userTokenGigyaCookie && !isUserValid() || force) {\n      refreshUserTokenCallbacks.push(callback);\n      if (refreshUserTokenCallbacks.length === 1) {\n        window.gigya.accounts.getAccountInfo({ callback: getAccountInfoResponse });\n      }\n    } else {\n      // we don't need to invoke callback here because user token don't changed.\n    }\n\n  };\n\n  function login(callback?: Function): void {\n    if (!_isGigyaInitialized) {\n      throw \"Gigya is not configured\";\n    }\n    checkGigyaLoaded();\n    if (callback) {\n      window.gigya.accounts.addEventHandlers({\n        onLogin: () => {\n          _refreshUserToken(true, callback);\n        }\n      });\n    }\n    var params: any = {\n      screenSet: _config.screenSet,\n      onHide: () => {\n        eventManager.fireCallbacks(\"onHide\", { afterLogin: afterLogin }, undefined, true);\n      }\n    };\n\n    var internalPianoParams = ['apiKey', 'screenSet'];\n\n    for (var property in _config) {\n      var isPianoInternalProperty = property in internalPianoParams;\n      if (!isPianoInternalProperty) {\n        params[property] = _config[property];\n      }\n    }\n\n    afterLogin = false;\n    window.gigya.accounts.showScreenSet(params);\n  };\n\n  let afterLogin = false;\n\n  function _addEventHandlers() {\n    checkGigyaLoaded();\n\n    window.gigya.accounts.addEventHandlers({\n      onLogin: () => {\n        afterLogin = true;\n        _refreshUserToken();\n      },\n      onLogout: () => {\n        util.setAccessTokenListCookie({ value: null }, undefined, true);\n        eventManager.fireCallbacks(\"logout\", null, undefined, true);\n      }\n    });\n  };\n\n  function loginByPasswordless(sessionInfo?: any): void {\n    if (!sessionInfo) {\n      throw \"Session info is empty\";\n    }\n\n    var cookieName = sessionInfo.accessTokenName,\n      value = sessionInfo.accessToken;\n    util.__protected__.setCookie(cookieName, value);\n\n    // need for refreshToken and isUserValid\n    var dublicateGigyaCookieName = 'glt_' + _config.apiKey;\n    util.__protected__.setCookieConsent(\"vx\", dublicateGigyaCookieName, value);\n\n    _refreshUserToken(true);\n  };\n\n  function logout(callback?: Function): void {\n    if (!_isGigyaInitialized) {\n      throw \"Gigya is not configured\";\n    }\n\n    checkGigyaLoaded();\n\n    window.gigya.accounts.logout({\n      callback: () => {\n        eventManager.fireCallbacks(\"logout\", null, undefined, true);\n        if (callback) {\n          callback();\n        }\n        util.setAccessTokenListCookie({ value: null }, undefined, true);\n      }\n    });\n    util.setAccessTokenListCookie({ value: null }, undefined, true);\n  };\n\n  function isConfigured(): boolean {\n    return (pn.useGigyaUserProvider === true || (typeof pn.useGigyaUserProvider === 'string' && pn.useGigyaUserProvider === 'true'));\n  };\n\n  function checkGigyaLoaded() {\n    if (!_isGigyaLoaded()) {\n      throw \"Gigya is not initialized\";\n    }\n  }\n\n  function registerCallback(callbackName: string, callback: Function): void {\n    eventManager.addEvent(callbackName);\n    eventManager.registerCallback(callbackName, (data: any) => callback(data));\n  }\n\n  return {\n    isv,\n    name,\n\n    init,\n\n    isUserValid,\n\n    getToken,\n\n    getName,\n\n    onLoginSuccess,\n\n    login,\n\n    logout,\n\n    isConfigured,\n\n    registerCallback,\n\n    loginByPasswordless,\n  }\n\n})();\n\npn.container.register('gigya', {\n  useValue: gigya\n});\npn.gigya = pn.container.resolve<GigyaInterface>('gigya');\n", "const jwtDecode = ((): Function => {\n\n  /**\n   * The code was extracted from:\n   * https://github.com/davidchambers/Base64.js\n   */\n\n  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n  class InvalidCharacterError extends Error {\n    construct(message: string) {\n      this.message = message;\n      this.name = 'InvalidCharacterError';\n    }\n  }\n\n  function polyfill(input: string) {\n    var str = String(input).replace(/=+$/, '');\n    if (str.length % 4 === 1) {\n      throw new InvalidCharacterError('\\'atob\\' failed: The string to be decoded is not correctly encoded.');\n    }\n    for (\n      // initialize result and counters\n      var bc = 0, bs: number, buffer, idx = 0, output = '';\n      // get next character\n      buffer = str.charAt(idx++);\n      // character found in table? initialize bit storage and add its ascii value;\n      // @ts-ignore\n      ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,\n        // and if not first of each 4 characters,\n        // convert the first 8 bits to one ascii character\n      bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0\n    ) {\n      // try to find character in table (0-63, not found => -1)\n      buffer = chars.indexOf(buffer);\n    }\n    return output;\n  }\n\n  try {\n    var atob = window.atob && window.atob.bind(window) || polyfill;\n  } catch (e) {\n    atob = polyfill;\n  }\n\n  function b64DecodeUnicode(str: string) {\n    return decodeURIComponent(atob(str).replace(/(.)/g, function (m, p) {\n      var code = p.charCodeAt(0).toString(16).toUpperCase();\n      if (code.length < 2) {\n        code = '0' + code;\n      }\n      return '%' + code;\n    }));\n  }\n\n  var base64_url_decode = function (str: string) {\n    var output = str.replace(/-/g, '+').replace(/_/g, '/');\n    switch (output.length % 4) {\n      case 0:\n        break;\n      case 2:\n        output += '==';\n        break;\n      case 3:\n        output += '=';\n        break;\n      default:\n        throw 'Illegal base64url string!';\n    }\n\n    try {\n      return b64DecodeUnicode(output);\n    } catch (err) {\n      return atob(output);\n    }\n  };\n\n  return function (token: string, options: any): any {\n    if (typeof token !== 'string') {\n      throw new Error('Invalid token specified');\n    }\n\n    options = options || {};\n    var pos = options.header === true ? 0 : 1;\n    return JSON.parse(base64_url_decode(token.split('.')[pos]));\n  };\n\n})()\n\nexport type IJwtDecode = typeof jwtDecode;\n\npn.jwtDecode = jwtDecode;\n\npn.container.register('jwtDecode', {\n  useValue: jwtDecode\n})\n", "export const urlManager = (container = pn.container) => {\n  let iframeUrlFromGlobalConfig: string | undefined;\n  const DEFAULT_PIANOID_ORIGIN = \"https://id.tinypass.com\";\n\n  const getPianoIdDomain = () => {\n    const isSandbox = pn.sandbox || pn.isNonProdEndpoint();\n    let domain =\n      iframeUrlFromGlobalConfig ||\n      pn.pianoIdUrl ||\n      (!isSandbox && DEFAULT_PIANOID_ORIGIN) ||\n      \"/\";\n    if (domain === \"/\") {\n      domain = pn.getEndpointRoot(true);\n    }\n    return domain.replace(/\\/$/, \"\");\n  };\n\n  const getPianoIdUrl = () => `${getPianoIdDomain()}/id/`;\n  const getIdentifyUrl = () => `${getPianoIdUrl()}api/v1/identity`;\n\n  return {\n    getPianoIdDomain,\n    getPianoIdUrl,\n    getIdentifyUrl,\n    iframeUrlFromGlobalConfig,\n    setIframeUrlFromGlobalConfig: (value: string | undefined) => (iframeUrlFromGlobalConfig = value)\n  };\n};\n\nexport type UrlManager = ReturnType<typeof urlManager>;\n\npn.container.register(\"urlManager\", {\n  useValue: urlManager(),\n});\n", "import { UtilInterface } from \"../../util\";\n\nexport const langManager = (container = pn.container) => {\n  const LANG_COOKIE_NAME = \"__pil\";\n\n  const util = container.resolve<UtilInterface>(\"util\");\n\n  return {\n    getLang: () =>\n      pn.locale || util.__protected__.getCookie(LANG_COOKIE_NAME) || \"\",\n  };\n};\n\nexport type LangManager = ReturnType<typeof langManager>;\n\npn.container.register(\"langManager\", {\n  useValue: langManager(),\n});\n", "export namespace PianoIdUtils {\n  export function isPianoIdLiteConfigured(): boolean {\n    return (\n      pn.usePianoIdLiteUserProvider === true ||\n      (typeof pn.usePianoIdLiteUserProvider === \"string\" &&\n        pn.usePianoIdLiteUserProvider === \"true\")\n    );\n  }\n\n  export function isCustomForm<\n    T extends { isRegistration?: boolean; formName?: string }\n  >(config: T, base: string): boolean {\n    const isNotRegistration = !config.isRegistration;\n    const isNotOtherHtml = !/\\.html$/.test(base);\n    return !!config.formName && isNotOtherHtml && isNotRegistration;\n  }\n}\n", "import { GlobalConfig, IframeQueryParams, ShowConfig } from \"../interfaces\";\nimport { IframeParamsInterface } from \"../../containerUtils\";\nimport { DisplayMode } from \"../interfaces/displayMode\";\nimport { UtilInterface } from \"../../util\";\nimport { LangManager } from \"./lang-manager\";\nimport { GaServiceInterface } from \"../../googleAnalytics/gaService\";\nimport { PianoIdUtils } from \"./utils\";\nimport { JqUtilsInterface } from \"../../jqUtils\";\nimport isCustomForm = PianoIdUtils.isCustomForm;\n\nexport const iFrameBuilder = (container = pn.container) => {\n  const util = container.resolve<UtilInterface>(\"util\");\n  const langManager = container.resolve<LangManager>(\"langManager\");\n  const gaService = container.resolve<GaServiceInterface>(\"gaService\");\n  const jqUtils = container.resolve<JqUtilsInterface>(\"jqUtils\");\n\n  const buildIframeUrl = (\n    base: string,\n    config: GlobalConfig & ShowConfig,\n    params?: IframeParamsInterface,\n    origin?: string\n  ) => {\n    const { contentType } = util.getPageViewContext();\n    const { pageTitle, pageViewId } = util.getPageViewContext();\n    const userState = util.getUserState();\n    const query: IframeQueryParams = {\n      client_id: config.aid!,\n      sender: params?.iframeId,\n      origin: origin || window.location.origin || window.location.href,\n      site: window.location.href,\n      display_mode: config.displayMode,\n      page_view_id: pageViewId ?? undefined,\n      browser_id: util.getBrowserId() ?? undefined,\n      page_title: pageTitle,\n      tbc: util.getTbcCookie(),\n    };\n\n    if (contentType) {\n      query.content_type = contentType;\n    }\n\n    if (pn.staticDomain) {\n      query.static_domain = pn.staticDomain;\n    }\n\n    const lang = langManager.getLang();\n    if (lang) {\n      query.lang = lang;\n    }\n    if (!!gaService.getClientId()) {\n      query.ga_client_id = gaService.getClientId();\n    }\n    if (!!gaService.getGAAccount()) {\n      query.ga = gaService.getGAAccount();\n    }\n    if (config.disableSignUp) {\n      query.disable_sign_up = true;\n    }\n    if (config.screen) {\n      query.screen = config.screen;\n    }\n    if (config.resetPasswordToken) {\n      query.reset = config.resetPasswordToken;\n    }\n    if (config.verification_code) {\n      query.verification_code = config.verification_code;\n    }\n    if (config.stage) {\n      query.stage = config.stage;\n    }\n    if (config.resetPasswordLandingUrl) {\n      query.reset_uri = config.resetPasswordLandingUrl;\n    }\n    if (config.width && config.displayMode === DisplayMode.Modal) {\n      query.width = config.width;\n    }\n    if (config.formName) {\n      query.form_name = config.formName;\n    }\n    if (userState) {\n      query.user_state = userState;\n    }\n\n    if (config.preview) {\n      switch (config.template) {\n        case \"custom_form\":\n          base += \"form\";\n          break;\n        case \"profile\":\n          base += \"profile\";\n          break;\n        case \"newsletters\":\n          base += \"newsletters\";\n          break;\n        case \"layout_gm_sso\":\n        case \"sso_confirm\":\n        case \"sso_confirm_before\":\n          base += \"gm-sso\";\n          break;\n      }\n    } else {\n      if (isCustomForm(config, base)) {\n        base += \"form\";\n      }\n      if (config.isGmSsoEnabled) {\n        // global property does not use because we add gm-sso only on auth mode.\n        base += \"gm-sso\";\n      }\n    }\n\n    /* Confirm type */\n    if (config.confirmation) {\n      query.gm_sso_confirm = config.confirmation;\n    }\n\n    if (config.hideIfComplete) {\n      query.hide_if_complete = config.hideIfComplete;\n    }\n    if (config.preview) {\n      query.preview = config.preview;\n    }\n    if (config.templateVersion) {\n      query.templateVersion = config.templateVersion;\n    }\n    if (config.template) {\n      query.template = config.template;\n    }\n    if (config.accessToken) {\n      query.access_token = config.accessToken;\n    }\n    if (config.email) {\n      query.email = config.email;\n    }\n    if (config.singleStep) {\n      query.single_step = true;\n    }\n    if (config.createPasswordlessUser) {\n      query.create_passwordless_user = true;\n    }\n    if (config.customParams) {\n      query.custom_params = JSON.stringify(config.customParams);\n    }\n    if (config.customEvents) {\n      const ce = Object.keys(config.customEvents);\n      if (ce.length) {\n        query.custom_events = JSON.stringify(ce);\n      }\n    }\n    if (config.jsonpError) {\n      query.jsonp_error = JSON.stringify(config.jsonpError);\n    }\n    if (config.passwordlessSuccess) {\n      query.passwordless_success = true;\n    }\n    if (config.passwordlessToken) {\n      query.passwordless_token = config.passwordlessToken;\n    }\n    if (config.redirectUri) {\n      query.redirect_uri = config.redirectUri;\n    }\n\n    if (params?.iframeUrl) {\n      query.url = params.iframeUrl;\n    }\n\n    if (config.returnBack) {\n      query.return_back = config.returnBack;\n    }\n\n    if (params?.pos) {\n      query.width = params.pos.width;\n      query.height = params.pos.height;\n      query.top = params.pos.top;\n      query.left = params.pos.left;\n    }\n\n    if (config.templateId) {\n      query.template_id = config.templateId;\n    }\n\n    if (config.variantId) {\n      query.variant_id = config.variantId;\n    }\n\n    if (config.sss) {\n      query.sss_mode = config.sss.sss_mode;\n      query.sss_callback_url = config.sss.sss_callback_url;\n      query.sss_origin_url = config.sss.sss_origin_url;\n    }\n\n    if (config.trackingId) {\n      query.tracking_id = config.trackingId;\n    }\n\n    if (config.response_id) {\n      query.response_id = config.response_id;\n    }\n\n    if (config.transparentMode) {\n      query.transparent_mode = true;\n    }\n\n    return [base, jqUtils.param(query)].join(\"?\");\n  };\n\n  return {\n    buildIframeUrl,\n  };\n};\n\nexport type IframeBuilder = ReturnType<typeof iFrameBuilder>;\n\npn.container.register(\"iframeBuilder\", {\n  useValue: iFrameBuilder(),\n});\n", "export class MSQAError extends Error {}\n", "import { UtilInterface } from \"../../../util\";\nimport { MSQAError } from \"./msqa.error\";\nimport { MSQA } from \"./msqa.shim\";\nimport { AjaxInterface } from \"../../../ajax\";\nimport { LocalStorageInterface } from \"../../../localStorage\";\nimport { GaServiceInterface } from \"../../../googleAnalytics/gaService\";\nimport { MsqaPromptCustomization } from \"./msqa-prompt-customization\";\n\ndeclare var ms: MSQA.Lib;\n\n/**\n * ### This service uses for configuring and showing MSQA features\n * Supports:\n * * Prompt\n */\nexport const microsoftQuickAuth = (container = pn.container) => {\n  const SCRIPT = \"https://edge-auth.microsoft.com/js/ms_auth_client.min.js\";\n  const LINKING_STATE_TTL = 10 * 60 * 1000; // 10 minutes\n  const LINKING_STATE_LS_KEY = \"msqaLinkingState\";\n\n  const util = container.resolve<UtilInterface>(\"util\");\n  const ajax = container.resolve<AjaxInterface>(\"ajax\");\n  const localStorage = container.resolve<LocalStorageInterface>(\"localStorage\");\n  const gaService = container.resolve<GaServiceInterface>(\"gaService\");\n\n  let linkingStateUrl = \"\";\n  let linkingRedirectUri = \"\";\n  let configuration: Partial<MsqaPromptCustomization> | undefined;\n\n  const init = async (\n    clientId: string,\n    redirectUri: string,\n    callback = () => {}\n  ) => {\n    if (!clientId || !redirectUri) {\n      throw new MSQAError(\n        \"[Piano ID] Microsoft Quick Auth configuration failed. Client ID or redirectUri are missed.\"\n      );\n    }\n\n    await util.requireJsFile(SCRIPT);\n    util.debug(\"[Piano ID][Microsoft Quick Auth] Script loaded.\");\n\n    // Setup library\n    if (!ms) {\n      throw new MSQAError(\n        \"[Piano ID] Microsoft Quick Auth configuration failed. MSQA is not loaded.\"\n      );\n    }\n    const result = ms.auth.initialize({\n      client_id: clientId,\n      callback,\n      redirect_uri: redirectUri,\n      ux_mode: \"redirect\",\n      // it should be always false because for showing a prompt we have to initialize linking state first\n      // auto showing should be controlled outside of this module\n      auto_prompt: false,\n      auto_sign_in: configuration?.autoSignIn,\n      context: configuration?.context,\n      cancel_on_tap_outside: configuration?.cancelOnTapOutside,\n      locale: configuration?.locale,\n    });\n\n    const existingState = localStorage.get(LINKING_STATE_LS_KEY);\n    if (existingState) {\n      ms.auth.setRedirectState(existingState);\n    }\n\n    if (result.result === \"failure\") {\n      throw new MSQAError(\n        `[Piano ID] Microsoft Quick Auth configuration failed due to ${result.reason}`\n      );\n    }\n\n    util.debug(\"[Piano ID][Microsoft Quick Auth] Initialized.\");\n  };\n\n  const showPrompt = () => {\n    return new Promise<MSQA.PromptNotification>((resolve) => {\n      const position = configuration?.promptPosition ?? \"left\";\n      ms.auth.prompt(position, function (notification) {\n        if (notification.displayed) {\n          util.debug(\"[Piano ID][Microsoft Quick Auth] Prompt displayed.\");\n          localStorage.remove(LINKING_STATE_LS_KEY);\n        }\n        resolve(notification);\n      });\n    });\n  };\n\n  const fetchLinkingState = () => {\n    const url = new URL(linkingStateUrl);\n\n    const browserId = util.getBrowserId();\n    if (browserId) {\n      url.searchParams.append(\"browser_id\", browserId);\n    }\n\n    const pageViewId = pn.main.fetchPageViewId();\n    if (pageViewId) {\n      url.searchParams.append(\"page_view_id\", pageViewId);\n    }\n\n    const { contentType } = util.getPageViewContext();\n    if (contentType) {\n      url.searchParams.append(\"content_type\", contentType);\n    }\n\n    return new Promise((resolve, reject) =>\n      ajax.request({\n        url: url.toString(),\n        type: \"POST\",\n        contentType: \"application/json\",\n        dataType: \"text\",\n        data: JSON.stringify({\n          state: localStorage.get(LINKING_STATE_LS_KEY),\n          back_url: window.location.href,\n          social_type: \"MSQA\",\n          response_type: \"token\",\n          prompt: true,\n          redirect_uri: linkingRedirectUri,\n        }),\n        success: (data: string) => {\n          localStorage.set(LINKING_STATE_LS_KEY, data);\n          if (\"ms\" in window) {\n            ms.auth.setRedirectState(data);\n          }\n          resolve(data);\n        },\n        error: (xhr: XMLHttpRequest) => {\n          reject(xhr);\n        },\n      })\n    );\n  };\n\n  /**\n   * This function re-new linking state and re-open prompt\n   */\n  const runLinkingStateAndPromptObserver = () => {\n    util.debug(\n      \"[Piano ID][Microsoft Quick Auth] Running linking state and prompt observer.\"\n    );\n    setInterval(\n      () => fetchLinkingState().then(() => showPrompt()),\n      LINKING_STATE_TTL\n    );\n  };\n\n  const setLinkingRedirectUri = (\n    pianoIdUrl: string,\n    aid: string,\n    pianoIdDomain: string,\n    lang: string\n  ) => {\n    const url = new URL(pianoIdUrl);\n    url.searchParams.append(\"client_id\", aid);\n    url.searchParams.append(\"origin\", pianoIdDomain);\n    url.searchParams.append(\"site\", window.location.href);\n    url.searchParams.append(\"display_mode\", \"modal\");\n\n    const pageViewId = pn.main.fetchPageViewId();\n    if (pageViewId) {\n      url.searchParams.append(\"page_view_id\", pageViewId);\n    }\n\n    const browserId = util.getBrowserId();\n    if (browserId) {\n      url.searchParams.append(\"browser_id\", browserId);\n    }\n\n    const tbc = util.getTbcCookie();\n    if (tbc) {\n      url.searchParams.append(\"tbc\", tbc);\n    }\n\n    const ga = gaService.getGAAccount();\n    if (ga) {\n      url.searchParams.append(\"ga\", gaService.getGAAccount());\n    }\n\n    const pageViewContext = util.getPageViewContext();\n    if (pageViewContext?.contentType) {\n      url.searchParams.append(\"content_type\", pageViewContext?.contentType);\n    }\n\n    url.searchParams.append(\"lang\", lang);\n    url.searchParams.append(\"width\", \"400\");\n\n    linkingRedirectUri = url.toString();\n  };\n\n  return {\n    init,\n    showPrompt,\n    fetchLinkingState,\n    setLinkingStateUrl: (url: string) => (linkingStateUrl = url),\n    setLinkingRedirectUri,\n    runLinkingStateAndPromptObserver: runLinkingStateAndPromptObserver,\n    clearConfirmationParameters: () => {\n      const internalRedirectQueryParamName = \"internal_redirect_uri\";\n      const responseQueryParamName = \"response_id\";\n      if (util.hasQueryParamByName(internalRedirectQueryParamName)) {\n        util.removeQueryParamByName(internalRedirectQueryParamName);\n      }\n      if (util.hasQueryParamByName(responseQueryParamName)) {\n        util.removeQueryParamByName(responseQueryParamName);\n      }\n    },\n    setConfiguration: (config?: Partial<MsqaPromptCustomization>) =>\n      (configuration = config),\n  };\n};\n\nexport type MicrosoftQuickAuth = ReturnType<typeof microsoftQuickAuth>;\n\npn.container.register(\"microsoftQuickAuth\", {\n  useValue: microsoftQuickAuth(),\n});\n", "import { LangManager } from \"./lang-manager\";\nimport { UrlManager } from \"./url-manager\";\nimport { SssParams } from \"../interfaces\";\n\nexport const selfServeSessions = (container = pn.container) => {\n  const langManager = container.resolve<LangManager>(\"langManager\");\n  const urlManager = container.resolve<UrlManager>(\"urlManager\");\n\n  const getAccessToken = () => pn.sssAccessToken;\n\n  const isSssEnabled = () => {\n    const { sss_mode, sss_callback_url } = getSssParams();\n    return !!sss_mode && !!sss_callback_url;\n  };\n\n  /**\n   * Get SSS params for setting them to iframe config\n   */\n  const getSssParams = (): SssParams => {\n    const originUrl =\n      pn.sssOriginUrl || window.location.href || window.location.origin;\n\n    return {\n      sss_mode: pn.sssMode,\n      sss_callback_url: pn.sssCallbackUrl,\n      sss_origin_url: originUrl,\n    };\n  };\n\n  /**\n   * Go to ID sss endpoint API directly to pass an access token to publisher callback URI\n   * @param accessToken Current JWT token\n   * @param onlyClientSide Save token only in client side w/o redirecting to publisher's API\n   */\n  const setSssAccessToken = (accessToken: string, onlyClientSide = false) => {\n    pn.setSssAccessToken(accessToken);\n\n    if (onlyClientSide) {\n      return;\n    }\n\n    let query = \"\";\n\n    query += \"callback_url=\" + getSssParams().sss_callback_url;\n    query += \"&origin_url=\" + getSssParams().sss_origin_url;\n    query += \"&aid=\" + pn.aid;\n    query += \"&lang=\" + langManager.getLang();\n    query += \"&token=\" + accessToken;\n\n    window.location.href =\n      urlManager.getPianoIdDomain() + \"/id/api/v1/sss?\" + query;\n  };\n\n  const isRedirect = (showConfig: { sss?: SssParams }) => {\n    return showConfig.sss?.sss_mode === \"redirect\";\n  };\n\n  const logout = () => {\n    if (isSssEnabled() && pn.sssAccessToken) {\n      pn.setSssAccessToken(undefined);\n    }\n  };\n\n  return {\n    getAccessToken,\n    isSssEnabled,\n    getSssParams,\n    setSssAccessToken,\n    isRedirect,\n    logout,\n  };\n};\n\nexport type SelfServeSessions = ReturnType<typeof selfServeSessions>;\n\npn.container.register(\"selfServeSessions\", {\n  useValue: selfServeSessions(),\n});\n", "import { PianoIdUtils } from \"./utils\";\nimport { UtilInterface } from \"../../util\";\nimport { SelfServeSessions } from \"./self-serve-sessions\";\n\nexport const tokenManager = (container = pn.container) => {\n  const util = container.resolve<UtilInterface>(\"util\");\n  const sss = container.resolve<SelfServeSessions>(\"selfServeSessions\");\n\n  const TOKEN_COOKIE_NAME = util.getAidSpecifiedName(\"__utp\");\n\n  const loadToken = () => {\n    if (sss.isSssEnabled() && !!sss.getAccessToken()) {\n      return sss.getAccessToken() ?? null;\n    }\n\n    const token = util.findCookieByName(TOKEN_COOKIE_NAME);\n    return token ? token : null;\n  };\n\n  const getToken = () => {\n    if (pn.externalJWT && PianoIdUtils.isPianoIdLiteConfigured()) {\n      return pn.externalJWT;\n    }\n\n    return loadToken();\n  };\n\n  return {\n    getToken,\n    loadToken,\n  };\n};\n\nexport type TokenManager = ReturnType<typeof tokenManager>;\n\npn.container.register(\"tokenManager\", {\n  useValue: tokenManager(),\n});\n", "import { GlobalConfig, ShowConfig } from \"../interfaces\";\nimport { DisplayMode } from \"../interfaces/displayMode\";\nimport { TokenManager } from \"./token-manager\";\n\nexport const configManager = (container = pn.container) => {\n  const tokenManager = container.resolve<TokenManager>(\"tokenManager\");\n\n  const prepareConfig = (\n    config: GlobalConfig & ShowConfig,\n    modifier?: (con: typeof config) => void\n  ) => {\n    if (!config.aid) {\n      config.aid = pn.aid;\n    }\n\n    if (!config.displayMode) {\n      config.displayMode = DisplayMode.Modal;\n    }\n\n    if (config.displayMode === DisplayMode.Popup) {\n      config.width = parseInt(String(config.width)) || getDefaultWidth();\n      config.height = parseInt(String(config.height)) || 460;\n    } else if (config.displayMode === DisplayMode.Modal) {\n      config.width = parseInt(String(config.width)) || getDefaultWidth();\n    }\n\n    modifier?.(config);\n\n    config.accessToken = tokenManager.loadToken();\n  };\n\n  const getDefaultWidth = () => {\n    const screenWidth =\n      window.innerWidth ||\n      document.documentElement.clientWidth ||\n      window.screen.width;\n    return Math.min(screenWidth, 400);\n  };\n\n  return {\n    prepareConfig,\n    getDefaultWidth,\n  };\n};\n\nexport type ConfigManager = ReturnType<typeof configManager>;\n\npn.container.register(\"configManager\", {\n  useValue: configManager(),\n});\n", "import { RequestOptions } from \"../interfaces/requestOptions\";\nimport { UtilInterface } from \"../../util\";\nimport { AjaxInterface } from \"../../ajax\";\n\nexport const requestManager = (container = pn.container) => {\n  const util = container.resolve<UtilInterface>(\"util\");\n  const ajax = container.resolve<AjaxInterface>(\"ajax\");\n\n  /** @deprecated use the requestWithPromise method. */\n  const oldRequest = (options: RequestOptions) => {\n    const url = new URL(options.url);\n    const { pageTitle, pageViewId } = util.getPageViewContext();\n    const browserId = getBrowserId();\n    const userState = util.getUserState();\n\n    if (browserId) {\n      url.searchParams.append(\"browser_id\", browserId);\n    }\n    if (pageViewId) {\n      url.searchParams.append(\"page_view_id\", pageViewId);\n    }\n    const { contentType } = util.getPageViewContext();\n    if (contentType) {\n      url.searchParams.append(\"content_type\", contentType);\n    }\n\n    url.searchParams.append(\"page_title\", pageTitle);\n\n    if (userState) {\n      if (options.dataType === \"jsonp\") {\n        options.data = { ...options.data, user_state: userState };\n      } else {\n        options.headers = { ...options.headers, \"User-State\": userState };\n      }\n    }\n\n    options.url = url.toString();\n\n    ajax.request(options);\n  };\n\n  const request = <R>(\n    options: RequestOptions\n  ): Promise<R> => new Promise<R>((resolve, reject) =>\n      oldRequest({\n        ...options,\n        success: (args: R) => resolve(args),\n        error: (xhr: XMLHttpRequest) => reject(xhr),\n      })\n    );\n\n  const getBrowserId = (): string | undefined => {\n    return util.getBrowserId() ?? undefined;\n  };\n\n  return {\n    oldRequest,\n    request,\n  };\n};\n\nexport type RequestManager = ReturnType<typeof requestManager>;\n\npn.container.register(\"pianoIdRequestManager\", {\n  useValue: requestManager(),\n});\n", "import { APIInterface } from \"../api\";\nimport { UtilInterface } from \"../util\";\nimport {\n  ContainerUtilsInterface,\n  IframeInfoInterface,\n  IframeParamsInterface,\n} from \"../containerUtils\";\nimport { PostmessageInterface } from \"../postmessage\";\nimport { LOG_EVENT_TYPE } from \"../log\";\nimport { ObserverInterface } from \"../observer\";\nimport { GaServiceInterface } from \"../googleAnalytics/gaService\";\nimport { IJwtDecode } from \"../jwtDecode\";\nimport { JqUtilsInterface } from \"../jqUtils\";\nimport { CookieInterface } from \"../cookie\";\nimport { LoggingInterface } from \"../logging\";\nimport { LocalStorageInterface } from \"../localStorage\";\nimport { ConsentInterface } from \"../consent\";\nimport {\n  GlobalConfig,\n  GmRedirectQueryParams,\n  GmSsoParamsAfterRedirect,\n  InitConfig,\n  PasswordlessCodeAuthResponse,\n  PianoIdInterface,\n  ShowConfig,\n  ShowFormConfig,\n  SssParams,\n  StoreTokenData,\n  TcString,\n  TokenVerifyResponse,\n  User,\n  CommonEventName,\n  GlobalEventName,\n  LocalEventName,\n} from \"./interfaces\";\nimport { TCookieOptions } from \"@piano-sdk/storage\";\nimport { LoadExtendedUserResult } from \"./interfaces/loadExtendedUserResult\";\nimport { AnalyticsInterface } from \"../analytics\";\nimport { GA_EVENT_TYPE } from \"../googleAnalytics/constants\";\nimport { DisplayMode } from \"./interfaces/displayMode\";\nimport { SsoConfirmation } from \"./interfaces/ssoConfirmation\";\nimport { ModalCloseReason } from \"./interfaces/modal-close-reason\";\nimport { AuthByCookieRejectReason } from \"./interfaces/authByCookieRejectReason\";\nimport { PianoIdUtils } from \"./features/utils\";\nimport { MicrosoftQuickAuth, ConfigManager, SelfServeSessions, TokenManager, UrlManager, IframeBuilder } from \"./features\";\nimport { ClientConfiguration } from \"../clientConfiguration\";\nimport { MSQAError } from \"./features/msqa/msqa.error\";\nimport { RegistrationSuccessPayload } from \"./interfaces/registration-success-payload\";\nimport { RequestManager } from \"./features/request.manager\";\n\nexport const pianoId = (container = pn.container): PianoIdInterface => {\n  const cookie = container.resolve<CookieInterface>(\"cookie\");\n  const jqUtils = container.resolve<JqUtilsInterface>(\"jqUtils\");\n  const requestManager = container.resolve<RequestManager>(\"pianoIdRequestManager\");\n  const jwtDecode = container.resolve<IJwtDecode>(\"jwtDecode\");\n  const util = container.resolve<UtilInterface>(\"util\");\n  const containerUtils =\n    container.resolve<ContainerUtilsInterface>(\"containerUtils\");\n  const postmessage = container.resolve<PostmessageInterface>(\"postmessage\");\n  const observer = container.resolve<ObserverInterface>(\"observer\");\n  const gaService = container.resolve<GaServiceInterface>(\"gaService\");\n  const api = container.resolve<APIInterface>(\"api\");\n  const logging = container.resolve<LoggingInterface>(\"logging\");\n  const localStorage = container.resolve<LocalStorageInterface>(\"localStorage\");\n  const consent = container.resolve<ConsentInterface>(\"consent\");\n  const analytics = container.resolve<AnalyticsInterface>(\"analytics\");\n  const clientConfiguration = container.resolve<ClientConfiguration>(\"clientConfiguration\");\n  const msqa = container.resolve<MicrosoftQuickAuth>(\"microsoftQuickAuth\");\n  let isMsqaInitiated = false;\n  let msqaInitializationPromise: Promise<unknown>;\n\n  // Features\n  const sss = container.resolve<SelfServeSessions>(\"selfServeSessions\");\n  const iframeBuilder = container.resolve<IframeBuilder>(\"iframeBuilder\");\n  const configManager = container.resolve<ConfigManager>(\"configManager\");\n  const urlManager = container.resolve<UrlManager>(\"urlManager\");\n  const tokenManager = container.resolve<TokenManager>(\"tokenManager\");\n\n  const isv = false;\n  const name = \"pianoId\";\n\n  const GM_SSO_REDIRECT_QUERY = \"gm_sso_redirect\";\n  const GM_SSO_REDIRECT_TOKEN = \"token\";\n  const GM_SSO_TERM_ID = \"term_id\";\n  const GM_SSO_OFFER_ID = \"offer_id\";\n  const GM_SSO_CHECKOUT_FLOW_ID = \"checkout_flow_id\";\n  const GM_SSO_EXPERIENCE_ID = \"experience_id\";\n  const GM_SSO_FORM_NAME = \"form_name\";\n  const GM_SSO_FORM_NAME_BY_TERM_ID = \"form_name_by_term_id\";\n  const GM_SSO_REDIRECT_REMEMBER = \"remember\";\n  const GM_SSO_REGISTRATION = \"registration\";\n\n  const RESET_TOKEN_QUERY = \"reset_token\";\n  const PASSWORDLESS_TOKEN_QUERY = \"passwordless_token\";\n  const VERIFICATION_CODE_QUERY = \"verification_code\";\n  const TRACKING_ID_QUERY = \"_ptid\";\n  const ACCESS_TOKEN = \"piano_social_token\";\n  const COOKIE_NAME = util.getAidSpecifiedName(\"__utp\");\n  const LANG_COOKIE_NAME = \"__pil\";\n  const DOMAIN_COOKIE_NAME = \"__pid\";\n  const REMEMBER_ME_COOKIE_NAME = \"__idr\";\n  const EXTEND_EXPIRED_ACCESS_COOKIE_NAME = \"__eea\";\n  const containerInner = \"piano-id-container\";\n  const PIANO_ID_SOURCE = \"PIANOID\";\n  const DEFAULT_PIANOID_ORIGIN = \"https://id.tinypass.com\";\n  const SOURCE_CUSTOM_FORM = \"show_form\";\n  const SOURCE_REGISTRATION = \"registration\";\n  const SOURCE_CHECKOUT = \"checkout\";\n  let REQUEST_TIMEOUT = 3000;\n  const FORCE_CLOSE_IFRAME_TIMEOUT = 600;\n  const TC_STRING_LOCAL_STORAGE_KEY = \"pnid-tc-string\";\n  const RTL_LOCALES = [\"he_IL\", \"ar_EG\"];\n  let globalConfig: GlobalConfig = {};\n  let iframes: IframeInfoInterface[] = [];\n  let iframeModal: IframeInfoInterface | undefined;\n  const langChangeFromIframe: { [iframeId: string]: Function } = {};\n  const localCallbacks: Record<LocalEventName, Function[]> = {\n    loggedIn: [],\n    loggedOut: [],\n    loginSuccess: [],\n    registrationSuccess: [],\n    profileUpdate: [],\n    langChange: [],\n    fire_loginSuccess: [],\n    loginDisplayed: [],\n    registerDisplayed: [],\n    loginFailed: [],\n    registrationFailed: [],\n    onShow: [],\n    layoutReady: [],\n  };\n  let customEvents: Record<string, Function> = {};\n  const globalCallbacks: Partial<Record<GlobalEventName, Function[]>> = {};\n  let initPromise: Promise<unknown> | undefined | null;\n  let configPromise: Promise<void>;\n  let isNewUser: boolean;\n  let loginSuccessInProgress: boolean;\n  const postMessagesBatch: any[] = [];\n  let isGmSsoEnabled = false;\n  // cache params after returned from redirected page\n  let gmSsoParamsAfterRedirect: GmSsoParamsAfterRedirect = {};\n\n  jqUtils.on(window, \"resize\", () => {\n    checkInlineWidgetResize();\n    checkModalWidgetResize();\n  });\n\n  const setDefaultGmSsoConfirmationType = (\n    config: GlobalConfig & ShowConfig\n  ) => {\n    if (isGmSsoEnabled) {\n      config.confirmation = config.confirmation ?? SsoConfirmation.After;\n    }\n  };\n\n  const checkInlineWidgetResize = (elements?: HTMLElement[]): void => {\n    iframes\n      .filter((iframe) => iframe.config.displayMode === \"inline\")\n      .filter((iframe) => (!elements || elements.some((element: HTMLElement) => iframe.container === element)))\n      .forEach((iframe) => {\n        const containerWidth = jqUtils.getWidth(iframe.container);\n        containerUtils.resizeIframe(iframe, {\n          width: containerWidth,\n        });\n      });\n  };\n\n  const checkModalWidgetResize = (): void => {\n    iframes\n      .filter((iframe) => iframe.config.displayMode === \"modal\" && !iframe.closed)\n      .forEach((iframe) => {\n        const config = iframe.config as GlobalConfig;\n        containerUtils.resizeIframe(iframe, { width: getDefaultWidth(config.width) });\n      });\n  };\n\n  const setAccessToken = (accessToken: string, remember: boolean): void => {\n    const user = jwtDecode(accessToken);\n    user.rememberMe = remember;\n    storeToken({\n      user: user,\n      token: accessToken,\n    });\n  };\n\n  const setAccessTokenAfterGmSsoRedirect = async () => {\n    const token = util.getQueryParamByName(GM_SSO_REDIRECT_TOKEN);\n    const remember = !!util.getQueryParamByName(GM_SSO_REDIRECT_REMEMBER);\n    const isRegistration = util.getQueryParamByName(GM_SSO_REGISTRATION) === 'true';\n    // todo move removing to parseConfig function\n    util.removeQueryParamByName([\n      GM_SSO_REDIRECT_QUERY,\n      GM_SSO_REDIRECT_TOKEN,\n      GM_SSO_REDIRECT_REMEMBER,\n      GM_SSO_TERM_ID,\n      GM_SSO_OFFER_ID,\n      GM_SSO_EXPERIENCE_ID,\n      GM_SSO_CHECKOUT_FLOW_ID,\n      GM_SSO_FORM_NAME,\n      GM_SSO_FORM_NAME_BY_TERM_ID,\n      GM_SSO_REGISTRATION,\n    ]);\n    if (token) {\n      await setToken({\n        source: PIANO_ID_SOURCE,\n        user: jwtDecode(token),\n        remember,\n        token,\n      }, true);\n      const result = getLoginSuccessPayload(PIANO_ID_SOURCE);\n      if (result) {\n        fireGlobalCallbacks(\"loginSuccess\", result.params);\n      }\n      if (isRegistration) {\n        fireCallbacks(\"registrationSuccess\", getRegistrationSuccessPayload(PIANO_ID_SOURCE));\n      }\n    }\n  };\n\n  const setGmSsoEmailAndPhoneConfirmationFromToken = () => {\n    const token = tokenManager.getToken();\n    const user = jwtDecode(token);\n    // todo Maybe here should be isUserValid() instead of !!token?\n    if (!!token) {\n        gmSsoParamsAfterRedirect.emailConfirmationRequired = user.email_confirmation_required;\n    }\n  };\n\n  const parseConfig = (initConfig?: InitConfig): Promise<void> => {\n    if (configPromise && !initConfig) {\n      return configPromise;\n    }\n\n    globalConfig = Object.assign(globalConfig, initConfig);\n    urlManager.setIframeUrlFromGlobalConfig(globalConfig.iframeUrl);\n\n    if (initConfig) {\n      setCallbacks(initConfig);\n    }\n    // remove callbacks which was set in the init method,\n    // because globalConfig will be used inside show method and this callbacks should not get into show method.\n    (Object.keys(localCallbacks) as LocalEventName[]).forEach((eventName) => {\n      // todo use list of local events instead of object keys\n      const containsEventCallback = !!globalConfig[eventName];\n      if (containsEventCallback) {\n        delete globalConfig[eventName];\n      }\n    });\n\n    let res: any;\n    configPromise = new Promise((resolve) => {\n      res = resolve;\n    });\n\n    if (!PianoIdUtils.isPianoIdLiteConfigured()) {\n      pn.setUsePianoIdUserProvider(true);\n    }\n\n    const resetToken = util.getQueryParamByName(RESET_TOKEN_QUERY);\n    if (globalConfig.resetPasswordToken === undefined && resetToken) {\n      globalConfig.resetPasswordToken = resetToken;\n    }\n\n    if (util.getQueryParamByName(GM_SSO_REDIRECT_QUERY)) {\n      const termId = util.getQueryParamByName(GM_SSO_TERM_ID);\n      const offerId = util.getQueryParamByName(GM_SSO_OFFER_ID);\n      const experienceId = util.getQueryParamByName(GM_SSO_EXPERIENCE_ID);\n      const checkoutFlowId = util.getQueryParamByName(GM_SSO_CHECKOUT_FLOW_ID);\n      const formName = util.getQueryParamByName(GM_SSO_FORM_NAME);\n      const formNameByTermId = util.getQueryParamByName(\n        GM_SSO_FORM_NAME_BY_TERM_ID\n      );\n      if (termId && offerId) {\n        gmSsoParamsAfterRedirect.termId = termId;\n        gmSsoParamsAfterRedirect.offerId = offerId;\n      }\n      if (experienceId) {\n        gmSsoParamsAfterRedirect.experienceId = experienceId;\n      }\n      if (checkoutFlowId) {\n        gmSsoParamsAfterRedirect.checkoutFlowId = checkoutFlowId;\n      }\n      if (formName) {\n        gmSsoParamsAfterRedirect.formName = formName;\n      }\n      if (formNameByTermId) {\n        gmSsoParamsAfterRedirect.formNameByTermId = formNameByTermId;\n      }\n      setAccessTokenAfterGmSsoRedirect();\n      setGmSsoEmailAndPhoneConfirmationFromToken();\n    }\n\n    const passwordlessToken = util.getQueryParamByName(\n      PASSWORDLESS_TOKEN_QUERY\n    );\n    if (globalConfig.passwordlessToken === undefined && passwordlessToken) {\n      globalConfig.passwordlessToken = passwordlessToken;\n    }\n\n    const verificationCode = util.getQueryParamByName(VERIFICATION_CODE_QUERY);\n    if (globalConfig.verification_code === undefined && verificationCode) {\n      globalConfig.verification_code = verificationCode;\n    }\n\n    // used to sign in when an inapp browser was used.\n    const access_token = util.getQueryParamByName(ACCESS_TOKEN);\n    if (access_token) {\n      util.removeQueryParamByName(ACCESS_TOKEN);\n      if (!isUserValid()) {\n        pn.inappBrowserReturn = true;\n        setAccessToken(access_token, true);\n      }\n    }\n    setTimeout(() => res(), 50);\n    return configPromise;\n  };\n\n  const init = (\n    config?: InitConfig,\n    withoutAuthByCookie?: boolean\n  ): Promise<any> => {\n    if (initPromise && !config) {\n      return initPromise;\n    }\n\n    let res: any;\n\n    initPromise = new Promise((resolve) => {\n      res = resolve;\n    });\n\n    const doneAndResolve = () => {\n      util.doneCall(\"refreshUserToken\"); // unblocking experience after user check\n      initPromise = null;\n      res();\n    };\n\n    const isUserWasInvalidBeforeTokenVerify = !isUserValid();\n    const handleAuthByCookieSuccess = () => {\n      const result = getLoginSuccessPayload(PIANO_ID_SOURCE);\n      if (isUserWasInvalidBeforeTokenVerify && result) {\n        fireGlobalCallbacks(\"loginSuccess\", result.params);\n      }\n      doneAndResolve();\n    };\n\n    const handleAuthByCookieFail = (rejectReason: AuthByCookieRejectReason) => {\n      if (rejectReason === \"token_not_valid\") {\n        doneAndResolve();\n\n        if (isMsqaInitiated) {\n          return;\n        }\n\n        // If any verification was failed or user is anonymous we offer to continue with Edge authorization prompt\n        if (util.isEdge()) {\n          // Handle internal_redirect_uri(coming back from MSQA)\n          const pianoIdUrlString = util.getQueryParamByName(\"internal_redirect_uri\");\n          const responseId = util.getQueryParamByName(\"response_id\");\n          const isMsqaAuthConfirmationFlow = pianoIdUrlString && responseId;\n          if (isMsqaAuthConfirmationFlow) {\n            msqa.clearConfirmationParameters();\n\n            const params = Array.from(new URL(pianoIdUrlString).searchParams.entries());\n            show({\n              ...globalConfig,\n              ...params.reduce((acc, [key, value]) => ({\n                ...acc,\n                [key]: value,\n              }), {} as ShowConfig),\n              response_id: responseId,\n              transparentMode: true,\n            });\n            isMsqaInitiated = true;\n            return;\n          }\n\n          // Initialize the script\n          msqa.setLinkingStateUrl(`${urlManager.getIdentifyUrl()}/social/${globalConfig.aid || pn.aid}/state`);\n          msqa.setLinkingRedirectUri(urlManager.getPianoIdUrl(), globalConfig.aid || pn.aid, urlManager.getPianoIdUrl(), \"en-US\");\n          msqa.setConfiguration({\n            ...config?.msqaPromptConfiguration,\n            locale: config?.msqaPromptConfiguration?.locale ?? getLang().replace('_', '-')\n          });\n          msqaInitializationPromise = clientConfiguration\n            .getConfiguration()\n            .then(async (config) => {\n              if (config.msqa_client_id) {\n                await msqa.fetchLinkingState();\n                return config;\n              } else {\n                return Promise.reject();\n              }\n            })\n            .then((config) =>\n              msqa.init(\n                config.msqa_client_id,\n                `${urlManager.getIdentifyUrl()}/login/social/callback/MSQA`\n              )\n            )\n            // Start observer for renew linking state and showing prompt\n            .then(() => msqa.runLinkingStateAndPromptObserver())\n            // Show prompt when linking state is ready\n            .then(() => {\n              if (config?.msqaPromptConfiguration?.autoPrompt ?? true) {\n                return msqa.showPrompt();\n              }\n            })\n            .then(() => (isMsqaInitiated = true))\n            // Rejected promise shouldn't throw any error outside because publisher's error analytics systems could handle it\n            // Except of MSQAError which indicates missed configuration or wrong flow\n            .catch(e => {\n              if (e instanceof MSQAError) {\n                console.error(e);\n              }\n            });\n        }\n      } else if (rejectReason === \"request_failed\") {\n        console.error(\n          \"Opening the ID screen is prohibited because authentication via cookie failed.\"\n        );\n      }\n    };\n\n    if (config && config.preview) {\n      setTimeout(() => res(), 10);\n      return initPromise;\n    }\n    // validating current token(from id.piano.io cookie) or obtaining access token from SSO using __preut cookie\n    util.startCall(\"refreshUserToken\"); // blocking experience until user check\n    parseConfig(config).then(() => {\n      if (globalConfig.passwordlessToken) {\n        return authByPasswordless().then(doneAndResolve, doneAndResolve);\n      } else if (!withoutAuthByCookie) {\n        return authByCookie().then(handleAuthByCookieSuccess, handleAuthByCookieFail);\n      } else {\n        return Promise.resolve().then(doneAndResolve, doneAndResolve);\n      }\n    });\n\n    return initPromise;\n  };\n\n  const prepare = (): Promise<void> => {\n    return parseConfig();\n  };\n\n  const show = (showConfig?: ShowConfig) => {\n    const initTime = performance.now();\n\n    init().then(() => {\n      const config: GlobalConfig = {\n        ...globalConfig,\n        ...showConfig,\n        isRegistration: true,\n        initTime,\n        // isSensitiveDataProtection is turned off for piano id as SensitiveDataProtection feature is not supported for pianoId iframe,\n        // form is not creating , so src attribute should be inserted into the iframe and pianoId src doesn't have sensitive data\n        isSensitiveDataProtectionDisabled: true,\n      };\n\n      if (isUserValid()) {\n        config.loggedIn?.({\n          token: tokenManager.loadToken(),\n          user: getUser(),\n        });\n      }\n\n      if (sss.isSssEnabled()) {\n        config.sss = sss.getSssParams();\n      }\n\n      if (isGmSsoEnabled) {\n        if (isGmSsoRedirectEnabled(config)) {\n          authByGmSsoRedirect(config);\n        } else {\n          authByGmSsoModalOrPopup(config);\n        }\n        return;\n      }\n\n      if (sss.isSssEnabled() && sss.isRedirect(config)) {\n        authBySssRedirect(config, (config) => {\n          setDefaultGmSsoConfirmationType(config);\n        });\n        return;\n      }\n\n      if (isUserValid()) {\n        return;\n} else if (iframeModal) {\n        util.log(\"Modal login window already shown\");\n      } else {\n        configManager.prepareConfig(config, (config) => {\n          setDefaultGmSsoConfirmationType(config);\n        });\n        createIframe(config);\n      }\n    });\n  };\n\n  const checkAndShowEmailIsNotConfirmed = (): void => {\n    const EMAIL_IS_NOT_CONFIRMED = \"email_is_not_confirmed\";\n\n    const user = getUser(); // todo need to change to the isUserValid method\n    if (!user) {\n      return;\n    }\n\n    const emailIsNotConfirmedType = util.getQueryParamByName(EMAIL_IS_NOT_CONFIRMED);\n    if (!emailIsNotConfirmedType) return;\n\n    util.removeQueryParamByName(EMAIL_IS_NOT_CONFIRMED);\n\n    const screen =\n      emailIsNotConfirmedType === \"registration\"\n        ? \"email_is_not_confirmed\"\n        : \"email_confirmation_required\";\n    _showCustom({ screen: screen, email: user?.email });\n  };\n\n  const showEmailConfirmationRequired = (config?: ShowConfig): void => {\n    if (iframeModal) {\n      util.log(\"Modal window already shown\");\n      return;\n    }\n\n    init().then(() => {\n      const showConfig = Object.assign(\n        { screen: \"email_confirmation_required\" },\n        globalConfig,\n        config\n      );\n      configManager.prepareConfig(showConfig, (config) => {\n        setDefaultGmSsoConfirmationType(config);\n      });\n      createIframe(showConfig);\n    });\n  };\n\n  const showEmailConfirmation = (config: ShowConfig): void => {\n    if (iframeModal) {\n      util.log(\"Modal window already shown\");\n      return;\n    }\n    init().then(() => {\n      const showConfig = Object.assign(\n        { screen: \"email_confirmation\" },\n        globalConfig,\n        config\n      );\n      if (isGmSsoRedirectEnabled(showConfig)) {\n        // FOR GMSSO DOI works on client side\n        showConfig.displayMode = DisplayMode.Modal;\n      }\n      if (util.getQueryParamByName(VERIFICATION_CODE_QUERY)) {\n        util.removeQueryParamByName(VERIFICATION_CODE_QUERY);\n      }\n      configManager.prepareConfig(showConfig, (config) => {\n        setDefaultGmSsoConfirmationType(config);\n      });\n      createIframe(showConfig);\n    });\n  };\n\n  /**\n   * shows iframe with extended config\n   * @param config\n   * @const\n   * @example with customParams\n   * _showCustom({\n   *   screen: 'passwordless_confirmation',\n   *   customParams: {\n   *     resourceName: 'scratta du forlurar du'\n   *   }\n   * });\n   *\n   * @example with customEvents\n   * _showCustom({\n   *   screen: 'passwordless_confirmation',\n   *   customEvents: {\n   *     checkoutContinue: function() {\n   *       console.log('ylyl');\n   *     }\n   *   }\n   * });\n   *\n   * @example resend email modal\n   * _showCustom({\n   *   screen: 'passwordless_confirmation',\n   *   email: 'test@piano.io'\n   * });\n   */\n  const _showCustom = <T>(config?: ShowConfig) => {\n    if (iframeModal) {\n      util.log(\"Modal window already shown\");\n      return;\n    }\n\n    if (!config) {\n      config = {} as ShowConfig;\n    }\n\n    const showConfig = { ...globalConfig, ...config };\n    if (config.customEvents && typeof config.customEvents === \"object\") {\n      customEvents = config.customEvents;\n    }\n    configManager.prepareConfig(showConfig, (config) => {\n      setDefaultGmSsoConfirmationType(config);\n    });\n    createIframe(showConfig);\n  };\n\n  const showForm = (config: ShowFormConfig): void => {\n    const initTime = performance.now();\n\n    init().then(() => {\n      const showConfig = Object.assign({}, globalConfig, config, {\n        initTime,\n        isRegistration: false,\n      });\n\n      const formName = showConfig.formName;\n\n      if (!formName) {\n        throw new Error(\n          'Form name should be specified, like\\ntp.pianosId.showForm({formName: \"...\"});'\n        );\n      }\n\n      const startShowForm = () => {\n        if (iframeModal) {\n          util.log(\"Modal login window already shown\");\n        } else {\n          configManager.prepareConfig(showConfig, (config) => {\n            setDefaultGmSsoConfirmationType(config);\n          });\n          if (!showConfig.preview && isNewUser) {\n            util.log(\"Skip show form, register new user\");\n            return;\n          }\n\n          if (!showConfig.hideIfComplete) {\n            createIframe({\n              ...showConfig,\n              entityType: \"customForm\",\n              readyCallback: (iframe: any) => {\n                postmessage.send(\"setToken\", tokenManager.getToken(), iframe.iframeId);\n              },\n            });\n            return;\n          }\n\n          getUserInfo(showConfig).then((data: any) => {\n            if (\n              data?.has_all_custom_field_values_filled &&\n              showConfig.hideIfComplete\n            ) {\n              util.log(\"Skip show form, all fields are completed\");\n              return;\n            }\n\n            createIframe({\n              ...showConfig,\n              entityType: \"customForm\",\n              readyCallback: (iframe: any) => {\n                postmessage.send(\"setToken\", tokenManager.getToken(), iframe.iframeId);\n                postmessage.send(\"userData\", data, iframe.iframeId);\n              },\n            });\n          });\n        }\n      };\n      if (!config.preview && !isUserValid()) {\n        const authConfig = Object.assign({}, config, {\n          closedCallback: () => {\n            if (isUserValid()) {\n              startShowForm();\n            }\n          },\n        });\n\n        show(authConfig);\n      } else {\n        startShowForm();\n      }\n    });\n  };\n\n  const submitLoginForm = (): void => {\n    postmessage.send(\"submitLoginForm\", null, iframeModal?.iframeId);\n  };\n\n  const authByPasswordless = () => {\n    return new Promise((resolve, reject) => {\n      const query = {\n        aid: globalConfig.aid || pn.aid,\n        passwordless_token: globalConfig.passwordlessToken,\n        lang: getLang(),\n      };\n      requestManager.oldRequest({\n        url: `${urlManager.getIdentifyUrl()}/passwordless/authorization/code?${jqUtils.param(\n          query\n        )}`,\n        type: \"POST\",\n        success: (resp: PasswordlessCodeAuthResponse) => {\n          _onPasswordlessLoginSuccess(resp);\n          resolve(null);\n        },\n        error: ({ response }: XMLHttpRequest) => {\n          const { error_code_list } = JSON.parse(response) as {\n            error_code_list: { message: string }[];\n          };\n          _onPasswordlessLoginError(error_code_list);\n          reject();\n        },\n      });\n    });\n  };\n\n  const _onPasswordlessLoginSuccess = async (\n    resp: PasswordlessCodeAuthResponse\n  ) => {\n    const {\n      access_token,\n      error,\n      token_type,\n      direction_url,\n      code,\n      extend_expired_access_enabled,\n    } = resp;\n    if (!error && token_type === \"code\" && direction_url && code) {\n      const redirectUriWithCode = new URL(direction_url);\n      redirectUriWithCode.searchParams.append(\"code\", code);\n      window.open(redirectUriWithCode, window.name);\n    } else if (!error && access_token) {\n      _completeCheckout(resp);\n\n      delete globalConfig[\"passwordlessToken\"];\n      util.removeQueryParamByName(PASSWORDLESS_TOKEN_QUERY);\n\n      if (sss.isSssEnabled()) {\n        sss.setSssAccessToken(access_token, true);\n      }\n      await setToken({\n        source: PIANO_ID_SOURCE,\n        token: access_token,\n        user: jwtDecode(access_token),\n        extendExpiredAccessEnabled: extend_expired_access_enabled,\n      });\n      if (sss.isSssEnabled()) {\n        sss.setSssAccessToken(access_token);\n      }\n    }\n    util.doneCall(\"refreshUserToken\");\n  };\n\n  const _onPasswordlessLoginError = (errors: { message: string }[]) => {\n    _showCustom({\n      screen: \"passwordless_confirmation\",\n      jsonpError: {\n        error_description: errors.map((e) => e.message).join(\"\\n\"),\n      },\n    });\n\n    delete globalConfig[\"passwordlessToken\"];\n    util.removeQueryParamByName(PASSWORDLESS_TOKEN_QUERY);\n  };\n\n  const _completeCheckout = (resp: any) => {\n    const data = {\n      aid: globalConfig.aid || pn.aid,\n      login_token_id: resp.login_token_id,\n      user_token: resp.access_token,\n    };\n\n    const additionalConfig = {\n      passwordlessToken: resp.passwordless_token,\n      redirectUri: resp.direction_url,\n    };\n\n    _sendCompleteRequest(data, additionalConfig);\n  };\n\n  const _sendCompleteRequest = (data: any, additionalConfig: any) => {\n    containerUtils.showWaitPanel();\n    api.callApi(\"/anon/passwordless/complete\", data, (resp: any) => {\n      if (resp.result && resp.result.polling_enabled) {\n        return checkPolling(resp).then((response: any) => {\n          completeCheckoutCallback(response, additionalConfig);\n        });\n      }\n\n      completeCheckoutCallback(resp, additionalConfig);\n    });\n  };\n\n  const checkPolling = (response: any) => {\n    return new Promise((resolve) => {\n      const pollingRequestParams = {\n        aid: pn.aid,\n        oid: response.result.oid,\n        process_id: response.result.process_id,\n        user_token: pn.user.getProvider().getToken(),\n      };\n\n      sendPollingRequest(\n        pollingRequestParams,\n        0,\n        response.result.polling_timeouts,\n        resolve\n      );\n    });\n  };\n\n  const sendPollingRequest = (\n    requestParams: any,\n    attempts: number,\n    timeouts: any[],\n    callback: Function\n  ) => {\n    api.callApi(\"/anon/passwordless/check\", requestParams, (response: any) => {\n      attempts++;\n      if (\n        response &&\n        response.result &&\n        response.result.poll_status !== \"waiting\"\n      ) {\n        callback(response);\n      } else if (!response.result && response.message) {\n        util.error(\"Passwordless purchase failed\", response.message);\n        callback();\n      } else if (attempts <= timeouts.length) {\n        setTimeout(() => {\n          sendPollingRequest(requestParams, attempts, timeouts, callback);\n        }, timeouts[attempts - 1]);\n      } else {\n        callback();\n      }\n    });\n  };\n\n  const completeCheckoutCallback = (response: any, additionalConfig: any) => {\n    try {\n      const resource = response.result.resource || {};\n      const showOfferParams = JSON.parse(response.result.show_offer_params);\n      let config = getCustomScreenConfig(additionalConfig);\n\n      if (\n        !Object.keys(resource).length &&\n        !Object.keys(showOfferParams).length\n      ) {\n        return _showCustom(config);\n      }\n\n      if (resource.name) {\n        config = getCustomScreenConfig(additionalConfig, {\n          customParams: {\n            resourceName: resource.name,\n          },\n        });\n      } else {\n        config = getCustomScreenConfig(additionalConfig, {\n          customEvents: {\n            checkoutContinue: () => {\n              closeModalContainer();\n              containerUtils.closeModalContainer();\n              pn.offer.show(showOfferParams);\n            },\n          },\n        });\n      }\n\n      _showCustom(config);\n    } catch (e) {\n      _showCustom(getCustomScreenConfig(additionalConfig));\n    } finally {\n      containerUtils.hideWaitPanel();\n    }\n  };\n\n  const getCustomScreenConfig = (additionalConfig: any, config?: any): any => {\n    const defaultConfig: any = {\n      screen: \"passwordless_confirmation\",\n    };\n\n    if (additionalConfig) {\n      defaultConfig.passwordlessToken = additionalConfig.passwordlessToken;\n      defaultConfig.redirectUri = additionalConfig.redirectUri;\n    }\n\n    if (config) {\n      return Object.assign(defaultConfig, config);\n    }\n\n    return Object.assign(defaultConfig, { passwordlessSuccess: true });\n  };\n\n  const getLoginSuccessPayload = (source?: string, stage?: string): { payload: any, params: any } | undefined => {\n    const user = getUser();\n    if (!user) {\n      return;\n    }\n    const token = tokenManager.loadToken();\n    const payload = {\n      token: token,\n      user: user,\n      source,\n      stage,\n    };\n    const params = {\n      event: \"loginSuccess\",\n      params: payload.user,\n      user_token: payload.token,\n      registration: isNewUser,\n      source,\n      stage,\n    };\n\n    return { payload, params };\n  }\n\n\n  const getRegistrationSuccessPayload = (source: string): RegistrationSuccessPayload | undefined => {\n    const user = getUser();\n    const token = tokenManager.loadToken();\n    if (!user || !token) {\n      return;\n    }\n\n    return {\n      token,\n      user,\n      source\n    };\n  };\n\n  const fireLoginSuccessEvent = (data?: { source?: string, stage?: string }) => {\n    data = data || {};\n\n    const result = getLoginSuccessPayload(data.source, data.stage);\n    if (!result) {\n      return;\n    }\n\n    fireLocalCallbacks(\"loggedIn\", result.payload); // todo can we remove this event because we have loginSuccess?\n    fireLocalCallbacks(\"loginSuccess\", result.payload);\n\n    if (data.source === PIANO_ID_SOURCE) {\n      fireLocalCallbacks(\"fire_loginSuccess\", result.params); // todo where this event is using?\n      fireGlobalCallbacks(\"loginSuccess\", result.params);\n    }\n  };\n\n  const _fireLoggedOut = (source: any) => {\n    const data = {\n      source: source,\n    };\n    fireLocalCallbacks(\"loggedOut\", data);\n    fireGlobalCallbacks(\"logout\", data);\n  };\n\n  const _fireChangeScreen = (screen: string, onlyGlobal?: boolean) => {\n    const eventNamesMap: Record<\n      string,\n      \"loginDisplayed\" | \"registerDisplayed\"\n    > = {\n      login: \"loginDisplayed\",\n      register: \"registerDisplayed\",\n    };\n    const eventName = eventNamesMap[screen];\n    if (!onlyGlobal) {\n      fireLocalCallbacks(eventName, {});\n    }\n    fireGlobalCallbacks(eventName, {});\n  };\n\n  const _fireCustomEvent = (config: any, params: any) => {\n    config?.customEvent?.(params); // todo replace with fireLocalCallbacks(\"customEvent\", params);\n    fireGlobalCallbacks(\"customEvent\", params);\n  };\n\n  const fireLocalCallbacks = (event: LocalEventName, params?: any) => {\n    _fireCallbackForActiveInstance(event, params);\n    localCallbacks[event]?.forEach((callback) => callback(params));\n  };\n\n  const _fireCallbackForActiveInstance = (\n    event: LocalEventName,\n    payload?: unknown\n  ) => {\n    // @ts-ignore\n    iframes\n      .filter((i) => !i.closed)\n      .map((i) => _getCallbackFromConfig(i.config, event))\n      .filter((f) => !!f)\n      .forEach((f) => f!(payload));\n  };\n\n  const _getCallbackFromConfig = (\n    config: any,\n    callbackName: LocalEventName\n  ): Function | undefined =>\n    typeof config?.[callbackName] === \"function\"\n      ? config[callbackName]\n      : undefined;\n\n  const fireGlobalCallbacks = (event: GlobalEventName, params: any) => {\n    globalCallbacks[event]?.forEach((callback) => callback(params));\n  };\n\n  const fireCallbacks = (event: CommonEventName, params?: any) => {\n    fireLocalCallbacks(event, params);\n    fireGlobalCallbacks(event, params);\n  };\n\n  const _fireCustomEvents = (name: string) => {\n    if (customEvents && typeof customEvents[name] === \"function\") {\n      customEvents[name]();\n    }\n  };\n\n  const setCallbacks = (\n    callbacks: Partial<Record<LocalEventName, Function>>\n  ): void => {\n    if (!callbacks) {\n      return;\n    }\n    (Object.keys(localCallbacks) as LocalEventName[]).forEach((eventName) => {\n      const callback = callbacks[eventName];\n      if (callback) {\n        localCallbacks[eventName]?.push(callback);\n      }\n    });\n  };\n\n  const setRequestTimeout = (time: number) => {\n    REQUEST_TIMEOUT = time;\n  };\n\n  const getDefaultWidth = (widthFromConfig?: number) => {\n    const screenWidth =\n      window.innerWidth ||\n      document.documentElement.clientWidth ||\n      window.screen.width;\n    return Math.min(screenWidth, widthFromConfig || 400);\n  };\n\n  const loginByToken = async (accessToken: string) => {\n    const user = jwtDecode(accessToken);\n    await setToken({\n      user,\n      token: accessToken,\n    });\n    closeIframesOrHideCloseButton(user);\n  };\n\n  const logout = async (\n    callback?: Function,\n    source?: any,\n    skipCallbacks?: boolean\n  ) => {\n    isNewUser = false;\n    await removeTokenInAuthCookie();\n    removeAllTokens();\n\n    sss.logout();\n\n    localStorage.remove(TC_STRING_LOCAL_STORAGE_KEY);\n    util.setAccessTokenListCookie({ value: null }, undefined, true);\n    if (!skipCallbacks) {\n      _fireLoggedOut(source);\n    }\n    callback && callback();\n  };\n\n  function messageReceiver(iframe: IframeInfoInterface) {\n    return function (message: { event: string; params: any }) {\n      const config = iframe.config as GlobalConfig;\n      const trackingId = config.trackingId;\n      const formName = config.formName;\n      switch (message.event) {\n        case \"updateToken\":\n          setToken(message.params);\n          break;\n        case \"loaded\":\n          if (config.displayMode === DisplayMode.Modal) {\n            containerUtils.checkBackdropAndContainer(iframe, true);\n          }\n          config.loadedCallback?.(iframe);\n          const consentParams = pn.consent.getByPurpose();\n          if (consentParams) {\n            postmessage.send(\n              \"consentWithModes\",\n              consentParams,\n              iframe.iframeId\n            );\n          }\n          break;\n        case \"stateReady\":\n          config.readyCallback?.(iframe);\n          break;\n        case \"resize\": {\n          const width = config.displayMode === \"modal\" ? getDefaultWidth(config.width) : message.params;\n          containerUtils.resizeIframe(iframe, {...message.params, width});\n          break;\n        }\n        case \"restoreSize\":\n          if (iframe.config.displayMode === \"inline\") {\n            containerUtils.resizeIframe(iframe, {\n              width: jqUtils.getWidth(iframe.container),\n            });\n          }\n          break;\n        case \"loginSuccess\":\n          onRegistrationOrLoginSuccess(message, () => {\n            config.callback?.();\n            pn.user.refreshAccessToken(true);\n            // todo add description where this even is using\n            postmessage.broadcast(\"pianoIdLoginSuccess\", message.params);\n          });\n          break;\n        case \"loginFailed\":\n          fireCallbacks(\"loginFailed\", message.params);\n          break;\n        case \"registrationSuccess\":\n          onRegistrationOrLoginSuccess(message, () => {\n            fireCallbacks(\"registrationSuccess\", message.params);\n            postmessage.broadcast(\"pianoIdLoginSuccess\", message.params);\n          });\n          break;\n        case \"registrationFailed\":\n          fireCallbacks(\"registrationFailed\", message.params);\n          break;\n        case \"lang\":\n          updateLang(message.params.lang, true);\n          toggleRTLStyles(message.params.lang, iframe);\n          break;\n        case \"customEvent\":\n          _fireCustomEvent(iframe.config, message.params);\n          break;\n        case \"closed\":\n          const entityType = (iframe.config as GlobalConfig).entityType;\n          if (entityType === \"customForm\") {\n            fireGlobalCallbacks(\"customFormClosed\", {\n              config: iframe.config,\n              reason: message.params?.reason,\n            });\n          }\n          closeIframe(iframe, { force: true });\n          config.closedCallback?.(iframe);\n          break;\n        case \"cfFormSubmission\":\n          analytics.log.event({\n            eventType: LOG_EVENT_TYPE.LOG_CUSTOM_FORM_SUBMISSION,\n            payload: {\n              trackingId,\n              formName,\n              source: SOURCE_CUSTOM_FORM,\n            },\n          });\n          break;\n        case \"formSend\":\n          fireGlobalCallbacks(\"customFormSubmitted\", {\n            config: iframe.config as ShowFormConfig,\n            submittedFields: message.params?.submittedFields,\n          });\n          closeIframe(iframe, { reason: \"customFormSubmitted\" });\n          break;\n        case \"formSkip\":\n          closeIframe(iframe);\n          break;\n        case \"cfAppImpression\":\n          analytics.log.event({\n            eventType: LOG_EVENT_TYPE.LOG_CUSTOM_FORM_IMPRESSION,\n            payload: {\n              trackingId,\n              formName,\n              source: SOURCE_REGISTRATION,\n            },\n          });\n          break;\n        case \"cfAppSubmission\":\n          analytics.log.event({\n            eventType: LOG_EVENT_TYPE.LOG_CUSTOM_FORM_SUBMISSION,\n            payload: {\n              trackingId,\n              formName,\n              source: SOURCE_REGISTRATION,\n            },\n          });\n          break;\n        case \"cfFormImpression\":\n          analytics.log.event({\n            eventType: LOG_EVENT_TYPE.LOG_CUSTOM_FORM_IMPRESSION,\n            payload: {\n              trackingId,\n              formName,\n              source: SOURCE_CUSTOM_FORM,\n            },\n          });\n          break;\n        case \"changeScreen\":\n          _fireChangeScreen(message.params.screen);\n          break;\n        case \"screenReady\":\n          if (config.initTime) {\n            logging.setTime(\"idShow\", Math.floor(performance.now() - config.initTime), {\n              aot: message.params?.AOT,\n              form_type: config.entityType ?? ''\n            });\n          }\n          fireCallbacks(\"onShow\");\n          break;\n        case \"layoutReady\":\n          fireCallbacks(\"layoutReady\", message.params);\n          break;\n        case \"confirmationEmailSent\":\n          if (\n            iframe.config.displayMode !== \"inline\" &&\n            !message.params.isDOI &&\n            !message.params.isPasswordlessDigitalCode\n          ) {\n            closeIframe(iframe);\n          }\n          break;\n        case \"verificationCodeStartCheckout\":\n          let startCheckoutParams = {};\n          try {\n            startCheckoutParams = JSON.parse(\n              message.params.startCheckoutParams\n            );\n          } catch (e) {\n            util.log(\"error parse start checkout params\");\n            startCheckoutParams = {};\n          }\n          authByCookie(true, true).then(() => {\n            closeIframe(iframe, { force: true });\n          });\n          util.waitCall(\"refreshUserToken\", function () {\n            pn.offer.show(startCheckoutParams);\n          });\n          break;\n        case \"removeParamFromGlobalConfig\":\n          removeParamFromGlobalConfig(message);\n          break;\n        case \"verifyCode\":\n          verifyCode(message, iframe);\n          break;\n        case \"openPasswordlessLoginWithCreatingUser\":\n          openPasswordlessLoginWithCreateUser();\n          break;\n        case \"fireCustomEvent\":\n          _fireCustomEvents(message.params.name);\n          break;\n        case \"passwordRestored\":\n          util.removeQueryParamByName(RESET_TOKEN_QUERY);\n          globalConfig.resetPasswordToken = undefined;\n          break;\n        case GA_EVENT_TYPE.EMIT_GA_EVENT:\n          analytics.ga.event({\n            payload: message.params,\n            eventType: GA_EVENT_TYPE.EMIT_GA_EVENT,\n          });\n          break;\n        case \"redirect\":\n          document.location.href = message.params.url;\n          break;\n        case \"designVersion\":\n          containerUtils.addClassToContainer(\n            iframe,\n            `piano-id-modal-ver-${message.params.version}`\n          );\n          break;\n        case \"profileUpdated\":\n          fireLocalCallbacks(\"profileUpdate\", message.params);\n          break;\n        case \"logout\":\n          const isUserLoggedIn = isUserValid();\n          if (isUserLoggedIn) {\n            logout();\n          }\n          break;\n        case \"successDOI\":\n          postmessage.broadcast(message.event, message.params);\n          gmSsoActionAfterTokenVerify();\n          break;\n        default:\n          util.debug(\"Received invalid event type: \" + message.event);\n          break;\n      }\n    };\n  }\n\n  const openPasswordlessLoginWithCreateUser = () => {\n    show({ createPasswordlessUser: true });\n  };\n\n  const removeParamFromGlobalConfig = (message: any) => {\n    const parameter = message.params.name;\n    const camelCaseName = util.fromUnderscoreToCamelCase(\n      parameter\n    ) as keyof GlobalConfig;\n    delete globalConfig[camelCaseName];\n\n    if (message.params.removeFromUrl) {\n      util.removeQueryParamByName(parameter);\n    }\n  };\n\n  const verifyCode = (message: any, iframe: any) => {\n    const verificationCode = message.params.verificationCode;\n    const locale = message.params.locale;\n    const clientId = globalConfig.aid || pn.aid;\n    const access_token = tokenManager.getToken();\n    const site = document.location.href;\n    const trackingId = (iframe.config as GlobalConfig).trackingId;\n\n    requestManager.oldRequest({\n      url: `${urlManager.getIdentifyUrl()}/verification/code`,\n      dataType: \"jsonp\",\n      data: {\n        client_id: clientId,\n        access_token: access_token,\n        site: site,\n        verification_code: verificationCode,\n        lang: locale,\n        tracking_id: trackingId,\n      },\n      success: (resp: any) => {\n        if (!resp.error) {\n          onVerificationSuccess(resp, iframe);\n        }\n      },\n      xhrFields: {\n        withCredentials: true,\n      },\n      crossDomain: true,\n    });\n  };\n\n  const onVerificationSuccess = (resp: any, iframe: any) => {\n    if (!resp.error && resp.access_token) {\n      storeToken({\n        token: resp.access_token,\n        user: jwtDecode(resp.access_token),\n        cookie_domain: resp.site_cookie_domain,\n      });\n      if (sss.isSssEnabled()) {\n        sss.setSssAccessToken(resp.access_token);\n      }\n    }\n    postmessage.send(\"verificationCodeComplete\", resp, iframe.iframeId);\n  };\n\n  const onRegistrationOrLoginSuccess = async (\n    message: any,\n    callback: Function\n  ) => {\n    if (message && message.params && !message.params.areCookiesSet) {\n      message.params.source = PIANO_ID_SOURCE;\n      isNewUser = !!message.params.registration;\n      const data = await setToken(message.params);\n      callback(data);\n      closeIframesOrHideCloseButton(message.params?.user);\n    } else if (typeof callback === \"function\") {\n      callback();\n    }\n\n    markGmSsoConfirmAsShown();\n  };\n\n  const offerMessageReceiver = (message: any): void => {\n    switch (message.params.event) {\n      case \"cfAppImpression\":\n      case \"cfFormImpression\":\n        analytics.log.event({\n          eventType: LOG_EVENT_TYPE.LOG_CUSTOM_FORM_IMPRESSION,\n          payload: {\n            trackingId: message.params.trackingId,\n            formName: message.params.trackingId,\n            source: SOURCE_CHECKOUT,\n          },\n        });\n        break;\n      case \"cfFormSubmission\":\n        analytics.log.event({\n          eventType: LOG_EVENT_TYPE.LOG_CUSTOM_FORM_SUBMISSION,\n          payload: {\n            trackingId: message.params.trackingId,\n            formName: message.params.trackingId,\n            source: SOURCE_CHECKOUT,\n          },\n        });\n        break;\n      case \"updateToken\":\n        setToken(message.params.params);\n        break;\n      case \"changeScreen\":\n        _fireChangeScreen(message.params.params.screen, true);\n        break;\n      case \"loginFailed\":\n      case \"registrationFailed\":\n      case \"successDOI\":\n      case \"registrationSuccess\":\n      case \"customEvent\":\n        fireGlobalCallbacks(message.params.event, message.params.params);\n        break;\n      case GA_EVENT_TYPE.EMIT_GA_EVENT:\n        analytics.ga.event({\n          payload: message.params.params,\n          eventType: GA_EVENT_TYPE.EMIT_GA_EVENT,\n        });\n        break;\n      case \"redirect\":\n        document.location.href = message.params.params.url;\n        break;\n      default:\n        util.debug(\"Received invalid event type: \" + message.params.event);\n        return;\n    }\n  };\n\n  const getPianoIdDomain = () => {\n    const isSandbox = pn.sandbox || pn.isNonProdEndpoint();\n    let domain =\n      globalConfig.iframeUrl ||\n      pn.pianoIdUrl ||\n      (!isSandbox && DEFAULT_PIANOID_ORIGIN) ||\n      \"/\";\n    if (domain === \"/\") {\n      domain = pn.getEndpointRoot(true);\n    }\n    return domain.replace(/\\/$/, \"\");\n  };\n\n  /**\n   * Close all ID iframes\n   * or hide close button if is DOI enabled\n   * or if the verification code was in the site URL\n   */\n  const closeIframesOrHideCloseButton = (user: any) => {\n    const isDOIEnabled = user?.email_confirmation_required;\n    const verificationCode = globalConfig.verification_code; // todo check could we move this condition to the one right place?\n    if (isDOIEnabled || verificationCode) {\n      containerUtils.hideCloseButton();\n    } else {\n      closeIframes();\n    }\n  };\n\n  /**\n   * Initiate authorization flow by SSS\n   * @param config Initial config for next showing Piano ID screen\n   * @param configModifier Config modifier function for passing external params\n   */\n  const authBySssRedirect = (\n    config: GlobalConfig & ShowConfig,\n    configModifier: (conf: typeof config) => void\n  ) => {\n    configManager.prepareConfig(config, configModifier);\n    if (!tokenManager.getToken()) {\n      window.open(\n        iframeBuilder.buildIframeUrl(urlManager.getPianoIdUrl(), config),\n        window.name\n      );\n    }\n  };\n\n  const createIframe = (\n    config: GlobalConfig\n  ): IframeInfoInterface => {\n    const wrapper = config.containerSelector\n      ? jqUtils.queryEl(config.containerSelector)\n      : null;\n    const id = `piano-id-${\n      !config.isRegistration ? \"form-\" : \"\"\n    }${util.randomString()}`;\n    config.singleContainer = wrapper;\n\n    const iframeParams: IframeParamsInterface = {\n      iframeId: id,\n      containerSelector: config.containerSelector,\n      width: config.width as number,\n      height: config.height as number,\n    };\n\n    let iframeUrl = iframeBuilder.buildIframeUrl(\n      urlManager.getPianoIdUrl(),\n      config,\n      iframeParams\n    );\n\n    let container: HTMLElement;\n    let element: HTMLElement;\n    let containerReady = true;\n    let obs: ReturnType<typeof observer.create>;\n    config.iframeParams = iframeParams;\n\n    if (config.displayMode === DisplayMode.Inline) {\n      const inlineContainer = containerUtils.initInlineContainer(config);\n      container = inlineContainer.container;\n      if (!container) {\n        // @ts-ignore\n        return;\n      }\n      element = containerUtils.generateIframe(config, iframeParams, iframeUrl);\n      containerReady = !!inlineContainer.containerReady;\n      if (config.observeContainer) {\n        obs = observer.create(container, checkInlineWidgetResize);\n      }\n    } else if (config.displayMode === DisplayMode.Modal) {\n      container = containerUtils.getModalContainer(config, () => {\n        return closeIframe(iframeModal);\n      });\n      element = containerUtils.generateIframe(config, iframeParams, iframeUrl);\n    } else if (config.displayMode === DisplayMode.Popup) {\n      if (util.isIE()) {\n        container = containerUtils.generateIframeWrapper();\n        iframeUrl = iframeBuilder.buildIframeUrl(\n          urlManager.getPianoIdUrl(),\n          config,\n          iframeParams,\n          urlManager.getPianoIdUrl() + \"proxy.html\"\n        );\n        iframeParams.iframeUrl = iframeUrl;\n        iframeParams.pos = containerUtils.getPopupPosition(iframeParams);\n        const popupUrl = iframeBuilder.buildIframeUrl(\n          urlManager.getPianoIdUrl() + \"proxy.html\",\n          config,\n          iframeParams\n        );\n        config.displayMode = DisplayMode.InlinePopup;\n        element = containerUtils.generateIframe({}, iframeParams, popupUrl);\n      } else {\n        // @ts-ignore\n        container = containerUtils.generatePopup(iframeParams, iframeUrl);\n        try {\n          try {\n            // @ts-ignore\n            element = container.document;\n          } catch (e) {\n            element = container;\n          }\n        } catch (e) {\n          // @ts-ignore\n          element = window.document;\n        }\n      }\n    }\n\n    const iframe: IframeInfoInterface = {\n      iframeId: iframeParams.iframeId,\n      // @ts-ignore\n      config,\n      // @ts-ignore\n      element,\n      // @ts-ignore\n      container,\n      iframeParams,\n      containerReady,\n    };\n\n    addEventsListener(iframe);\n\n    if (config.displayMode === DisplayMode.Inline) {\n      const elementWrapper = document.createElement(\"div\");\n      jqUtils.addClass(containerInner, elementWrapper);\n      // @ts-ignore\n      jqUtils.append(elementWrapper, element);\n      // @ts-ignore\n      jqUtils.append(container, elementWrapper);\n    } else if (config.displayMode === DisplayMode.Modal) {\n      // @ts-ignore\n      jqUtils.append(container, element);\n    } else if (config.displayMode === DisplayMode.InlinePopup) {\n      // @ts-ignore\n      jqUtils.append(container, element);\n      // @ts-ignore\n      jqUtils.append(document.body, container);\n    }\n\n    util.debug(\"creating iframe: \", config);\n    iframes.push(iframe);\n    if (config.displayMode === DisplayMode.Modal) {\n      iframeModal = iframe;\n      // @ts-ignore\n      iframeModal.observer = obs;\n\n      // Check for RTL of initial locale\n      const lang = getLang();\n      toggleRTLStyles(lang, iframe);\n    }\n    return iframe;\n  };\n\n  const addEventsListener = (iframe: IframeInfoInterface) => {\n    const initParams = {\n      // todo refactor this params\n      center: util.centerScreen(),\n      originUrl: document.location.href,\n    };\n    postmessage.init(\n      {\n        postMessageUrl: urlManager.getPianoIdUrl(),\n        receive: messageReceiver(iframe),\n        iframe: iframe,\n        iframeParams: iframe.iframeParams,\n      },\n      initParams\n    );\n  };\n\n  const closeModalContainer = (iframe?: any) => {\n    if (!iframeModal) {\n      return;\n    }\n\n    const mobileModalFix = containerUtils.__private__.mobileModalFix;\n\n    containerUtils.closeModal(iframeModal);\n    jqUtils.remove(iframeModal.element);\n    if (iframeModal.observer) {\n      iframeModal.observer.disconnect();\n    }\n\n    if (mobileModalFix.isIphoneCaretFixed) {\n      mobileModalFix.modalClosed();\n    }\n\n    iframeModal = undefined;\n  };\n\n  const getBaseCookieOptions = (): Partial<TCookieOptions> => {\n    const options: Partial<TCookieOptions> = {\n      path: \"/\",\n      secure: util.__protected__.isHttpsProtocol(),\n      priority: \"High\",\n    };\n\n    if (pn.cookieDomain) {\n      options.domain = pn.cookieDomain;\n    } else {\n      const domainFromCookie = util.__protected__.getCookie(DOMAIN_COOKIE_NAME);\n      const domain = util.extractCookieDomain(domainFromCookie);\n      if (domain) {\n        options.domain = domain;\n      }\n    }\n    if (pn.cookiePath) {\n      options.path = pn.cookiePath;\n    }\n    return options;\n  };\n\n  const storeToken = (data: StoreTokenData) => {\n    if (!data || !data.user || !data.token) {\n      return;\n    }\n    removeAllTokens({\n      keepRememberMe: true,\n      keepExtendExpiredAccess: true,\n    });\n\n    if (data.cookie_domain) {\n      setDomainCookie(data.cookie_domain);\n    }\n\n    const rememberMe =\n      \"r\" in data.user\n        ? data.user.r\n        : (data.user as User).rememberMe || hasRememberMeCookie();\n    const options: TCookieOptions = {};\n    if (rememberMe) {\n      // if a user set the remember me checkbox then the __utp cookie will be set to long term.\n      options.expires = new Date(data.user.exp * 1000);\n      setCookie(REMEMBER_ME_COOKIE_NAME, 1, options);\n    }\n\n    if (!!data.extendExpiredAccessEnabled) {\n      postMessagesBatchPush(\"setExtendExpiredAccess\", true, \"broadcast\");\n      setCookie(EXTEND_EXPIRED_ACCESS_COOKIE_NAME, \"true\", options);\n    }\n\n    if (sss.isSssEnabled()) {\n      // Skip cookies setting for Self-serve sessions\n      // because publisher should pass it to init config each time\n      return;\n    }\n\n    const domains = util.getPossibleCookieDomains();\n    for (let i in domains) {\n      util.deleteCookie(COOKIE_NAME, domains[i]);\n    }\n\n    setCookie(COOKIE_NAME, data.token, options);\n  };\n\n  const setCookie = (\n    name: string,\n    value: any,\n    additionalOptions?: TCookieOptions\n  ) => {\n    util.__protected__.setCookieConsent(\"id\", name, value, {\n      ...getBaseCookieOptions(),\n      ...additionalOptions,\n    });\n  };\n\n  const setDomainCookie = (value: string) => {\n    // set the domain cookie then it will be used in other cookies for domain property.\n    // todo why it is set only for 30 days?\n    setCookie(DOMAIN_COOKIE_NAME, value, { domain: value, expires: 30 });\n  };\n\n  const removeAllTokens = ({\n    keepRememberMe,\n    keepExtendExpiredAccess,\n  }: {\n    keepRememberMe?: boolean;\n    keepExtendExpiredAccess?: boolean;\n  } = {}) => {\n    const options = getBaseCookieOptions();\n    const domains = util.getPossibleCookieDomains(options.domain);\n\n    domains.forEach((domain) => {\n      if (!domain) {\n        return;\n      }\n      const domain_option: TCookieOptions = { ...options, domain };\n      cookie.remove(COOKIE_NAME, domain_option);\n      if (!keepExtendExpiredAccess) {\n        cookie.remove(EXTEND_EXPIRED_ACCESS_COOKIE_NAME, domain_option);\n      }\n      if (!keepRememberMe) {\n        removeRememberMeCookie(domain_option);\n      }\n    });\n  };\n\n  const getUser = (): User | null => {\n    let user: User | null = null;\n    const token = tokenManager.loadToken();\n    if (token) {\n      try {\n        user = jwtDecode(token);\n        if (user) {\n          user.firstName = user.given_name;\n          user.lastName = user.family_name;\n          user.valid = true;\n          user.uid = user.sub;\n          user.confirmed = !user.email_confirmation_required && !user.pn_cr;\n\n          const now = new Date();\n          const exp = new Date(user.exp * 1000);\n          if (exp < now) {\n            removeAllTokens();\n            user = null;\n          }\n        }\n      } catch (e) {}\n    }\n\n    return user;\n  };\n\n  const loadExtendedUser = (_config?: {\n    formName?: string;\n    extendedUserLoaded: (data?: LoadExtendedUserResult) => void;\n  }) => {\n    const config = Object.assign({}, globalConfig, _config);\n    getUserInfo(config).then((data: any) => {\n      const newData = Object.assign({}, data);\n      if (data && Array.isArray(data.custom_field_values)) {\n        data.custom_field_values = data.custom_field_values.map(\n          (field: any) => {\n            let value;\n            try {\n              value = JSON.parse(field.value);\n            } catch (e) {\n              value = field.value;\n            }\n            return {\n              field_name: field.field_name,\n              value: value,\n              created: field.created,\n            };\n          }\n        );\n      }\n\n      if (typeof config.extendedUserLoaded === \"function\") {\n        config.extendedUserLoaded(newData);\n      }\n      fireGlobalCallbacks(\"extendedUserLoaded\", newData);\n    });\n  };\n\n  const setToken = async (data: any, silent?: boolean) => {\n    storeToken(data);\n    await storeTokenInAuthCookie(data.token, data.rememberMe);\n    !silent && fireLoginSuccessEvent({ stage: data.stage, source: data.source });\n  };\n\n  const isUserValid = (): boolean => {\n    if (PianoIdUtils.isPianoIdLiteConfigured()) {\n      return !!pn.externalJWT;\n    }\n\n    return !!getUser();\n  };\n\n  const authSetToken = async (\n    resp: any,\n    silent?: boolean,\n    closeModal?: boolean\n  ) => {\n    const user = jwtDecode(resp.access_token);\n    const result = await setToken(\n      {\n        token: resp.access_token,\n        user,\n        cookie_domain: resp.site_cookie_domain,\n        extendExpiredAccessEnabled: resp.extend_expired_access_enabled,\n      },\n      silent\n    );\n    if (closeModal) {\n      closeIframesOrHideCloseButton(user);\n    }\n    util.doneCall(\"refreshUserToken\");\n    return result;\n  };\n\n  const authByGmSsoModalOrPopup = async (config: GlobalConfig) => {\n    let gmSsoShowConfig: GlobalConfig = {\n      ...config,\n      isGmSsoEnabled,\n    };\n\n    configManager.prepareConfig(gmSsoShowConfig, (config) => {\n      setDefaultGmSsoConfirmationType(config);\n    });\n\n    if (iframeModal) {\n      util.log(\"Modal login window already shown\");\n      return;\n    }\n\n    if (!tokenManager.getToken()) {\n      createIframe(gmSsoShowConfig);\n    } else {\n      // do not show confirmation when display mode is popup. it looks bad when the show method is called immediately after page load.\n      // for instance, in myaccount page the id screen opens immediately\n      const isNeedShowAfterConfirmation =\n        gmSsoShowConfig.confirmation !== SsoConfirmation.None &&\n        !wasGmSsoModalShown() &&\n        gmSsoShowConfig.displayMode !== DisplayMode.Popup;\n      if (isNeedShowAfterConfirmation) {\n        // for modals we always show the \"after confirmation\" because we can not get access token without login.\n        createIframe({\n          ...gmSsoShowConfig,\n          confirmation: SsoConfirmation.After,\n        });\n        markGmSsoConfirmAsShown();\n      }\n    }\n  };\n\n  const gmSsoActionAfterTokenVerify = (): void => {\n    if (gmSsoParamsAfterRedirect?.offerId && gmSsoParamsAfterRedirect?.termId) {\n      let config: any = {\n        offerId: gmSsoParamsAfterRedirect.offerId,\n        termId: gmSsoParamsAfterRedirect.termId,\n        closeOnLogout: true,\n      };\n      if (gmSsoParamsAfterRedirect.formNameByTermId) {\n        config.formNameByTermId = gmSsoParamsAfterRedirect.formNameByTermId;\n      }\n      if (gmSsoParamsAfterRedirect.experienceId) {\n        config.experienceId = gmSsoParamsAfterRedirect.experienceId;\n      }\n      if (gmSsoParamsAfterRedirect.checkoutFlowId) {\n        config.checkoutFlowId = gmSsoParamsAfterRedirect.checkoutFlowId;\n      }\n\n      pn.offer.show(config);\n      gmSsoParamsAfterRedirect.offerId = undefined;\n      gmSsoParamsAfterRedirect.termId = undefined;\n      gmSsoParamsAfterRedirect.formNameByTermId = undefined;\n      gmSsoParamsAfterRedirect.experienceId = undefined;\n      gmSsoParamsAfterRedirect.checkoutFlowId = undefined;\n      // should be confirm inside checkout\n      gmSsoParamsAfterRedirect.emailConfirmationRequired = undefined;\n      return;\n    }\n\n    if (gmSsoParamsAfterRedirect?.emailConfirmationRequired) {\n      showEmailConfirmationRequired({ displayMode: DisplayMode.Modal });\n      gmSsoParamsAfterRedirect.emailConfirmationRequired = undefined;\n      return;\n    }\n\n    if (gmSsoParamsAfterRedirect?.formName) {\n      showForm({ formName: gmSsoParamsAfterRedirect?.formName });\n      gmSsoParamsAfterRedirect.formName = undefined;\n    }\n\n    if (\n      globalConfig.confirmation !== SsoConfirmation.None &&\n      !wasGmSsoModalShown()\n    ) {\n      // will show confirmation screen after sso auto login.\n      authByGmSsoModalOrPopup({ doNotCloseAfterLogin: true, isRegistration: true });\n    }\n  };\n\n  const authByCookie = (silent?: boolean, withoutCloseModal?: boolean) => {\n    return new Promise((resolve, reject) => {\n      util.startCall(\"refreshUserToken\");\n\n      const onAuthByCookieComplete = (\n        options:\n          | { isSuccessful: true }\n          | {\n              isSuccessful: false;\n              failReason: AuthByCookieRejectReason;\n            }\n      ): void => {\n        if (options.isSuccessful) {\n          resolve(null);\n          if (isGmSsoEnabled) {\n            gmSsoActionAfterTokenVerify();\n          }\n\n          // Confirmation parameters should be cleared if user was authorized by another source\n          // E.g. user have two same tabs and initiated authorization in both\n          // After first authorization second one tab will be authorized too and confirmation flow won't be completed\n          msqa.clearConfirmationParameters();\n        } else {\n          reject(options.failReason);\n        }\n\n        util.doneCall(\"refreshUserToken\");\n      };\n\n      const authByCookieSuccess = async (resp: TokenVerifyResponse) => {\n        isGmSsoEnabled = resp.authorized_by_sso;\n        if (!resp.error && resp.access_token) {\n          if (!PianoIdUtils.isPianoIdLiteConfigured()) {\n            await authSetToken(resp, false, true);\n          }\n          onAuthByCookieComplete({ isSuccessful: true });\n        } else {\n          if (resp.site_cookie_domain) {\n            // if validation faild we need set cookies also\n            setDomainCookie(resp.site_cookie_domain);\n          }\n          removeAllTokens(); // clearing cached cookies for the logged out token;\n          onAuthByCookieComplete({\n            isSuccessful: false,\n            failReason: \"token_not_valid\",\n          });\n        }\n      };\n\n      const accessToken = tokenManager.getToken() || undefined;\n      const data: { client_id: string; site: string; tcf?: string } = {\n        client_id: globalConfig.aid || pn.aid,\n        site: document.location.origin || document.location.href,\n      };\n      const tcString = getTcString();\n      if (!!tcString) {\n        data.tcf = tcString;\n      }\n      if (accessToken) {\n        requestManager.oldRequest({\n          url: `${urlManager.getIdentifyUrl()}/token/validation`,\n          data: {\n            client_id: globalConfig.aid || pn.aid,\n            site: document.location.origin || document.location.href,\n          },\n          headers: {\n            Authorization: accessToken,\n          },\n          success: function (resp: TokenVerifyResponse) {\n            authByCookieSuccess(resp);\n            if (resp.access_token) {\n              saveTcStringToLocalStorage(tcString);\n            }\n          },\n          error: () =>\n            onAuthByCookieComplete({\n              isSuccessful: false,\n              failReason: \"request_failed\",\n            }),\n        });\n      } else {\n        requestManager.oldRequest({\n          url: `${urlManager.getIdentifyUrl()}/token/verify`,\n          data: data,\n          success: function (resp: any) {\n            authByCookieSuccess(resp);\n            if (resp.access_token) {\n              saveTcStringToLocalStorage(tcString);\n              if (sss.isSssEnabled()) {\n                sss.setSssAccessToken(resp.access_token);\n              }\n            }\n          },\n          error: () =>\n            onAuthByCookieComplete({\n              isSuccessful: false,\n              failReason: \"request_failed\",\n            }),\n          dataType: \"jsonp\",\n          xhrFields: {\n            withCredentials: true,\n          },\n          crossDomain: true,\n        });\n      }\n    });\n  };\n  /*\n  Generate tcfString for LiveRamp.\n  If the publisher has integration with LiveRamp enabled. tcfString sent to the backend with token/validation API\n   */\n  const getTcString = (): string | null => {\n    const windowRef: Window & { __tcfapi: Function } = window as any;\n    let localTcString = localStorage.get(\n      TC_STRING_LOCAL_STORAGE_KEY\n    ) as TcString;\n\n    const isTcStringActual = function (data: TcString) {\n      if (!data) return false;\n      const tcData = data;\n      if (!tcData || !tcData.tcString || !tcData.date) return false;\n      const currentDate = new Date();\n      const tcStringGenerateDate = new Date(tcData.date);\n      const delta = Math.abs(\n        tcStringGenerateDate.getTime() - currentDate.getTime()\n      );\n      const daysPassed = Math.ceil(delta / (1000 * 60 * 60 * 24));\n      return daysPassed <= 1;\n    };\n\n    const generateTcString = function () {\n      let result = null;\n      const callback = function (\n        tcData: { tcString: string },\n        success: boolean\n      ) {\n        if (success && !!tcData.tcString) {\n          result = tcData.tcString;\n        }\n      };\n\n      if (windowRef.__tcfapi) {\n        // 412 is pianoVendorId\n        windowRef.__tcfapi(\"getTCData\", 2, callback, [412]);\n      }\n      return result;\n    };\n\n    if (isTcStringActual(localTcString)) {\n      return null;\n    }\n    return generateTcString();\n  };\n\n  const saveTcStringToLocalStorage = (value: string | null) => {\n    if (value) {\n      const saveObject = {\n        date: new Date().toString(),\n        tcString: value,\n      };\n      setToLocalStorage(\n        TC_STRING_LOCAL_STORAGE_KEY,\n        JSON.stringify(saveObject)\n      );\n    }\n  };\n\n  const extendUserToken = (): void => {\n    const token = tokenManager.loadToken();\n    if (!token) {\n      return;\n    }\n\n    const now = new Date().getTime();\n    const isExtendAccessEnabled = util.__protected__.getCookie(\n      EXTEND_EXPIRED_ACCESS_COOKIE_NAME\n    );\n    const user = jwtDecode(token);\n    const isPassed1DayAfterTokenIssue =\n      now - user.iat * 1000 > 24 * 60 * 60 * 1000;\n\n    if (isExtendAccessEnabled && isPassed1DayAfterTokenIssue) {\n      authByCookie(false, true);\n    }\n  };\n\n  const removeTokenInAuthCookie = () => {\n    return new Promise((resolve) => {\n      const token = tokenManager.getToken();\n      const data = {\n        client_id: globalConfig.aid || pn.aid,\n      };\n      if (!!token) {\n        Object.assign(data, { token });\n      }\n\n      requestManager.oldRequest({\n        url: `${urlManager.getIdentifyUrl()}/logout`,\n        data,\n        dataType: \"jsonp\",\n        complete: resolve,\n        xhrFields: {\n          withCredentials: true,\n        },\n        crossDomain: true,\n      });\n    });\n  };\n\n  const storeTokenInAuthCookie = (\n    token: string | undefined,\n    rememberMe: boolean\n  ) => {\n    return new Promise((resolve) => {\n      const isSessionCookie = !(rememberMe || hasRememberMeCookie());\n      requestManager.oldRequest({\n        url: `${urlManager.getIdentifyUrl()}/vxauth/cookie`,\n        data: {\n          client_id: globalConfig.aid || pn.aid,\n          session_cookie: isSessionCookie,\n        },\n        headers: {\n          Authorization: token || undefined,\n        },\n        complete: resolve,\n      });\n    });\n  };\n\n  const closeIframe = (\n    iframe: any,\n    { force, reason }: { reason?: ModalCloseReason; force?: boolean } = {}\n  ) => {\n    if (!iframe) {\n      return;\n    }\n    if (!force) {\n      postmessage.send(\"close\", { reason }, iframe.iframeId);\n      iframes = iframes.filter(function (iframeItem) {\n        return iframeItem.iframeId !== iframe.iframeId;\n      });\n      setTimeout(() => {\n        closeIframe(iframe, { force: true });\n      }, FORCE_CLOSE_IFRAME_TIMEOUT);\n    } else if (!iframe.closed) {\n      iframe.closed = true;\n      if (iframe.config.displayMode === \"inline\") {\n        jqUtils.empty(iframe.container);\n      } else if (iframe.config.displayMode === \"popup\") {\n        iframe.container.close();\n      } else if (iframe.config.displayMode === \"modal\") {\n        closeModalContainer(iframe);\n        jqUtils.remove(iframe.container.parentElement);\n      }\n\n      if (isGmSsoEnabled) {\n        markGmSsoConfirmAsShown();\n      }\n    }\n  };\n\n  const closeIframes = () => {\n    iframes\n      .filter((iframe) => {\n        const config = iframe.config as GlobalConfig;\n        return !config.doNotCloseAfterLogin;\n      })\n      .forEach((iframe) => {\n      closeIframe(iframe);\n    });\n    iframes = [];\n  };\n\n  const updateLang = (locale: string, within?: boolean): void => {\n    const currentLangInCookie = util.__protected__.getCookie(LANG_COOKIE_NAME);\n    const domainFromCookie = util.__protected__.getCookie(DOMAIN_COOKIE_NAME);\n    if (currentLangInCookie === locale || !domainFromCookie) {\n      return;\n    }\n\n    setCookie(LANG_COOKIE_NAME, locale, { expires: 30 });\n\n    if (!within) {\n      iframes.forEach((iframe) => {\n        postmessage.send(\"lang\", { lang: locale }, iframe.iframeId);\n      });\n    }\n\n    Object.keys(langChangeFromIframe).forEach((iframeId) => {\n      const callback = langChangeFromIframe[iframeId];\n\n      if (postmessage.__protected__.isIframeManaged(iframeId) && callback) {\n        callback(locale);\n      } else {\n        delete langChangeFromIframe[iframeId];\n      }\n    });\n    fireCallbacks(\"langChange\", locale);\n  };\n\n  const onLangChange = (func: Function, iframeId: string): Function => {\n    langChangeFromIframe[iframeId] = func;\n\n    return () => {\n      delete langChangeFromIframe[iframeId];\n    };\n  };\n\n  const getLang = (): string => {\n    return pn.locale || util.__protected__.getCookie(LANG_COOKIE_NAME) || \"\";\n  };\n\n  const getRememberMeCookie = () => {\n    return util.__protected__.getCookie(REMEMBER_ME_COOKIE_NAME) || false;\n  };\n\n  const removeRememberMeCookie = (options: TCookieOptions) => {\n    if (options) {\n      cookie.remove(REMEMBER_ME_COOKIE_NAME, options);\n    }\n  };\n\n  const hasRememberMeCookie = () => {\n    return !!getRememberMeCookie();\n  };\n\n  const onLoginSuccess = async (params: any) => {\n    if (loginSuccessInProgress) {\n      return;\n    }\n\n    loginSuccessInProgress = true;\n    const data = {\n      source: params.source,\n      token: params.user_token,\n      user: params.params || params.user,\n      cookie_domain: params.cookie_domain,\n      stage: params.stage,\n    };\n\n    util.setAccessTokenListCookie(\n      {\n        value: params.token_list,\n        cookie_domain: params.cookie_domain,\n      },\n      params.user_token\n    );\n\n    await setToken(data);\n    closeIframesOrHideCloseButton(data.user);\n    loginSuccessInProgress = false;\n  };\n\n  const onProfileUpdate = async (params: any, callback: Function) => {\n    const data = {\n      token: params.token,\n      user: params.user,\n      cookie_domain: params.cookie_domain,\n    };\n    await setToken(data, true);\n    callback();\n    fireLocalCallbacks(\"profileUpdate\", data);\n  };\n\n  const onExtendedUserLoginRequired = (): void => {\n    _showCustom();\n  };\n\n  const isConfigured = (): boolean => {\n    return (\n      pn.usePianoIdUserProvider === true ||\n      (typeof pn.usePianoIdUserProvider === \"string\" &&\n        pn.usePianoIdUserProvider === \"true\")\n    );\n  };\n\n  const getName = (): string => {\n    return \"piano_id\";\n  };\n\n  /**\n   *  Register global callback\n   */\n  const registerCallback = (event: GlobalEventName, callback: Function) => {\n    const eventCallbacks = globalCallbacks[event] ?? [];\n    globalCallbacks[event] = [...eventCallbacks, callback];\n  };\n\n  const getUserInfo = (config?: { formName?: string }) => {\n    return new Promise((resolve) => {\n      const showConfig = Object.assign({}, globalConfig, config);\n      requestManager.oldRequest({\n        url: `${urlManager.getIdentifyUrl()}/userinfo`,\n        data: {\n          client_id: globalConfig.aid || pn.aid,\n          form_name: showConfig.formName,\n        },\n        headers: {\n          Authorization: tokenManager.getToken() || undefined,\n        },\n        success: resolve,\n        complete: () => resolve(null),\n      });\n      setTimeout(resolve, REQUEST_TIMEOUT);\n    });\n  };\n\n  const isAot = (): void => {\n    iframes.forEach((iframe) => {\n      postmessage.send(\"isAOT\", {}, iframe.iframeId);\n    });\n  };\n\n  const isGmSso = (): boolean => {\n    return isGmSsoEnabled;\n  };\n\n  const isGmSsoRedirectEnabled = (config?: GlobalConfig): boolean => {\n    const isBrowserBlocksThirdPartyCookies = util.isSafariOrUiWebView() || util.isChrome();\n    const isRedirectConfigured = config?.displayMode === DisplayMode.Redirect || (!config?.displayMode && globalConfig?.displayMode === DisplayMode.Redirect);\n    const isSafariAndDisplayModeUndefined = isBrowserBlocksThirdPartyCookies && !config?.displayMode && !globalConfig?.displayMode;\n    return isRedirectConfigured || isSafariAndDisplayModeUndefined;\n  };\n\n  const authByGmSsoRedirect = (\n    config: GlobalConfig & GmSsoParamsAfterRedirect\n  ) => {\n    if (tokenManager.getToken()) {\n      return;\n    }\n\n    config = {\n      ...globalConfig,\n      ...config,\n      redirectUri: config.redirectUri ?? window.location.href,\n    };\n\n    const buildGmSsoRedirectUrl = (\n      base: string,\n      config: GlobalConfig & GmSsoParamsAfterRedirect\n    ) => {\n      const { pageViewId, pageTitle } = util.getPageViewContext();\n      const userState = util.getUserState();\n      const query: GmRedirectQueryParams & Partial<SssParams> = {\n        client_id: config.aid,\n        gm_sso_piano_id_domain: getPianoIdDomain(),\n        site: document.location.href,\n        display_mode: \"redirect\",\n        gm_sso_redirect_container_width: config.width ?? getDefaultWidth(),\n        page_view_id: pageViewId ?? undefined,\n        page_title: pageTitle,\n        browser_id: getBrowserId(),\n      };\n      const lang = getLang();\n      if (lang) {\n        query.lang = lang;\n      }\n\n      if (pn.staticDomain) {\n        query.static_domain = pn.staticDomain;\n      }\n\n      if (config.screen) {\n        query.screen = config.screen;\n      }\n      if (config.resetPasswordToken) {\n        query.reset = config.resetPasswordToken;\n      }\n      if (config.redirectUri) {\n        query.redirect_uri = config.redirectUri;\n      }\n      if (config.offerId) {\n        query.gm_sso_offer_id = config.offerId;\n      }\n      if (config.termId) {\n        query.gm_sso_term_id = config.termId;\n      }\n      if (config.experienceId) {\n        query.gm_sso_experience_id = config.experienceId;\n      }\n      if (config.checkoutFlowId) {\n        query.gm_sso_checkout_flow_id = config.checkoutFlowId;\n      }\n\n      if (config.confirmation) {\n        query.gm_sso_confirm = config.confirmation;\n      }\n\n      if (config.transparentMode) {\n        query.transparent_mode = true;\n      }\n\n      if (userState) {\n        query.user_state = userState;\n      }\n\n      const wasTermOpenedViaComposer = config.termId && config.formNameByTermId;\n      if (config.formName) {\n        query.form_name = config.formName;\n      } else if (wasTermOpenedViaComposer) {\n        // set form name from the composer passed formNameByTermId\n        const checkoutFormName: string | undefined = getCheckoutCustomFormName(config.formNameByTermId!, config.termId!);\n        if (checkoutFormName) {\n          query.form_name = checkoutFormName;\n        }\n      }\n\n      if (config.formNameByTermId) {\n        query.form_name_by_term_id = config.formNameByTermId;\n      }\n\n      if (config.sss) {\n        query.sss_mode = config.sss.sss_mode;\n        query.sss_callback_url = config.sss.sss_callback_url;\n        query.sss_origin_url = config.sss.sss_origin_url;\n      }\n      base += \"gm-sso\";\n      return [base, jqUtils.param(query)].join(\"?\");\n    };\n    const openRedirectGmSsoPage = (config: GlobalConfig) => {\n      const openedWindow = window.open(\n        buildGmSsoRedirectUrl(urlManager.getPianoIdUrl(), config),\n        window.name\n      );\n      if (!!openedWindow) {\n        markGmSsoConfirmAsShown();\n      }\n    };\n    const getCheckoutCustomFormName = (formNameByTermIdJson: string, termId: string): string | undefined => {\n      const formNameByTermId = JSON.parse(formNameByTermIdJson) as Record<string, string>;\n      return formNameByTermId[termId];\n    };\n\n\n    configManager.prepareConfig(config, (conf) => {\n      setDefaultGmSsoConfirmationType(conf);\n    });\n    openRedirectGmSsoPage(config);\n  };\n\n  const postMessagesBatchPush = (\n    name: string,\n    data: any,\n    type: string\n  ): void => {\n    postMessagesBatch.push({ type, name, data });\n  };\n\n  const executePostMessagesBatch = (): void => {\n    while (postMessagesBatch.length) {\n      const pm = postMessagesBatch.pop();\n\n      if (pm.type === \"broadcast\") {\n        postmessage.broadcast(pm.name, pm.data);\n      } else {\n        postmessage.send(pm.name, pm.data);\n      }\n    }\n  };\n\n  const toggleRTLStyles = (locale: string, iframe: any): void => {\n    if (RTL_LOCALES.includes(locale)) {\n      containerUtils.turnOnRTL(iframe);\n    } else {\n      containerUtils.turnOffRTL(iframe);\n    }\n  };\n\n  const wasGmSsoModalShown = (): boolean => {\n    return !!util.__protected__.getCookie(\n      \"piano-id-initial-gm-sso-shown-\" + (globalConfig.aid || pn.aid)\n    );\n  };\n\n  const markGmSsoConfirmAsShown = (): void => {\n    setCookie(\n      `piano-id-initial-gm-sso-shown-${globalConfig.aid || pn.aid}`,\n      true,\n      { expires: 30 }\n    );\n  };\n\n  const setToLocalStorage = (key: string, value: string): void => {\n    if (consent.id) {\n      consent.id.localStorage.set(key, value);\n    } else {\n      localStorage.set(key, value);\n    }\n  };\n\n  const getBrowserId = (): string | undefined => {\n    return util.getBrowserId() ?? undefined;\n  };\n\n  const getStage = (): string | undefined => globalConfig.stage;\n\n  const showMsqaPrompt =  async () => {\n    if (util.isEdge()) {\n      await msqaInitializationPromise;\n      return msqa.showPrompt();\n    }\n  };\n\n  const checkVerificationCode = () => {\n    const verificationCode = util.getQueryParamByName(VERIFICATION_CODE_QUERY);\n    if (!verificationCode) {\n      return;\n    }\n\n    const trackingId = util.getQueryParamByName(TRACKING_ID_QUERY);\n\n    const pianoIdConfig: ShowConfig = {\n      verification_code: verificationCode,\n      ...(trackingId ? { trackingId } : {}),\n    };\n\n    if (!isUserValid()) {\n      show(pianoIdConfig);\n    } else {\n      showEmailConfirmation(pianoIdConfig);\n    }\n  }\n\n  /** Updates a user's first name and last name. If firstName or lastName are not defined they will have empty string value. */\n  const updateUser = async ({\n    firstName,\n    lastName,\n  }: {\n    firstName: string;\n    lastName: string;\n  }): Promise<void> => {\n    const accessToken = tokenManager.getToken() || undefined;\n    if (!accessToken) {\n      throw new Error(\"The user must be logged in.\");\n    }\n\n    try {\n      const { token: newAccessToken } = await requestManager.request<{\n        token: string;\n      }>({\n        type: \"PUT\",\n        contentType: \"application/json\",\n        dataType: \"json\",\n        url: `${urlManager.getIdentifyUrl()}/userinfo/name?${jqUtils.param({\n          lang: getLang(),\n        })}`,\n        headers: { Authorization: accessToken },\n        data: JSON.stringify({\n          aid: globalConfig.aid || pn.aid,\n          first_name: firstName,\n          last_name: lastName,\n        }),\n      });\n\n      await setToken({\n        token: newAccessToken,\n        user: jwtDecode(newAccessToken) as User,\n      });\n    } catch (e) {\n      throw e;\n    }\n  };\n\n  return {\n    name,\n    isv,\n    init,\n    prepare, // todo is it protected method?\n    show,\n    showForm,\n    checkAndShowEmailIsNotConfirmed,\n    showEmailConfirmationRequired,\n    submitLoginForm,\n    loginByToken,\n    logout,\n    getToken: tokenManager.getToken,\n    getUser,\n    loadExtendedUser,\n    getName,\n    isConfigured,\n    onLoginSuccess,\n    onProfileUpdate,\n    onExtendedUserLoginRequired,\n    isUserValid,\n    setCallbacks,\n    getIframeUrl: urlManager.getPianoIdUrl,\n    updateLang,\n    onLangChange,\n    getLang,\n    isAot,\n    registerCallback,\n    setRequestTimeout,\n    showMsqaPrompt,\n    updateUser,\n    /** Protected region contains methods witch are using in another Tinypass modules */\n    __protected__: {\n      offerMessageReceiver,\n      showEmailConfirmation,\n      checkAndShowEmailIsNotConfirmed,\n      closeModalContainer,\n      executePostMessagesBatch,\n      isGmSso,\n      isGmSsoRedirectEnabled,\n      authByGmSsoRedirect,\n      extendUserToken,\n      getStage,\n      isSssEnabled: sss.isSssEnabled,\n      getSssParams: sss.getSssParams,\n      checkVerificationCode\n    },\n    /** Private region is used only for test private methods */\n    __private__: {\n      prepareConfig: (config) =>\n        configManager.prepareConfig(config, (conf) => {\n          setDefaultGmSsoConfirmationType(conf);\n        }),\n      setRequestTimeout,\n      createIframe,\n      addEventsListener,\n      gmSsoActionAfterTokenVerify,\n    },\n  };\n};\n\npn.container.register(\"pianoId\", {\n  useValue: pianoId(),\n});\npn.pianoId = pn.container.resolve<PianoIdInterface>(\"pianoId\");\n", "import { UtilInterface } from \"./util\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport {PianoIdInterface} from \"./pianoId/interfaces/pianoIdInterface\";\n\nexport interface PianoIdLiteInterface {\n  isv: boolean;\n  name: string;\n\n  isConfigured(): boolean;\n\n  isUserValid(): boolean;\n\n  getToken(): string | null;\n\n  getName(): string;\n\n  onLoginSuccess(params?: any): void;\n\n  registerCallback(callbackName: string, callback: Function): void;\n\n  logout(callback: Function): void;\n\n  loginByToken(accessToken: string): void;\n}\n\nconst pianoIdLite = ((): PianoIdLiteInterface => {\n\n  const util = pn.container.resolve<UtilInterface>('util');\n  const pianoId = pn.container.resolve<PianoIdInterface>('pianoId');\n  const eventUtils = pn.container.resolve<EventUtilsInterface>('eventUtils');\n\n  const isv = false;\n  const name = 'pianoIdLite';\n\n  const eventManager = eventUtils.createEventManager(['userChanged', 'onHide', 'logout']);\n  const COOKIE_NAME = util.getAidSpecifiedName('__utp');\n\n  // any new user provider should implement these methods\n  const getName = (): string => {\n    return 'piano_id_lite';\n  };\n\n  const getToken = (): string | null => {\n    return pn.externalJWT || readTokenFromCookie();\n  };\n\n  const isUserValid = (): boolean => {\n    return !!getToken();\n  };\n\n  const readTokenFromCookie = () => {\n    return util.findCookieByName(COOKIE_NAME) || null;\n  };\n\n  const onLoginSuccess = (params: any): void => {\n    util.setAccessTokenListCookie({\n        value: params.token_list,\n        cookie_domain: params.cookie_domain\n      },\n      params.user_token\n    );\n  };\n\n  const isConfigured = (): boolean => {\n    return pn.usePianoIdLiteUserProvider === true || (typeof pn.usePianoIdLiteUserProvider === 'string' && pn.usePianoIdLiteUserProvider === 'true');\n  }\n\n  const loginByToken = (accessToken: string): void => {\n    pianoId.loginByToken(accessToken);\n  }\n\n  const logout = (callback: Function): void => {\n    util.waitCall('refreshUserToken', function () {\n      typeof callback === 'function' && callback();\n    });\n    eventManager.fireCallbacks('logout', null, undefined, true);\n  }\n\n  const registerCallback = (callbackName: string, callback: Function): void => {\n    eventManager.addEvent(callbackName);\n    eventManager.registerCallback(callbackName, callback);\n  }\n\n  return {\n    name,\n    isv,\n    isConfigured,\n    isUserValid,\n    getToken,\n    getName,\n    onLoginSuccess,\n    registerCallback,\n    loginByToken,\n    logout,\n  };\n\n})();\n\npn.container.register('pianoIdLite', {\n  useValue: pianoIdLite\n});\npn.pianoIdLite = pn.container.resolve<PianoIdLiteInterface>('pianoIdLite');\n", "import { APIInterface } from './api';\nimport { UtilInterface } from './util';\nimport { JanrainInterface } from \"./janrain\";\nimport { TinypassAccountsInterface } from \"./tinypassAccounts\";\nimport { CondeUserProviderInterface } from \"./condeUserProvider\";\nimport { GigyaInterface } from \"./gigya\";\nimport { PianoIdInterface } from \"./pianoId\";\nimport { PianoIdLiteInterface } from \"./pianoIdLite\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { dataLayer } from \"@piano-sdk/data-layer\";\n\nexport type UserProviderType =\n  IUserRefProvider\n  | JanrainInterface\n  | TinypassAccountsInterface\n  | CondeUserProviderInterface\n  | GigyaInterface\n  | PianoIdLiteInterface\n  | PianoIdInterface;\n\nexport interface UserInterface {\n  name: string;\n\n  getProvider(): any;\n\n  providerInit(callback?: Function): any;\n\n  refreshAccessToken(forceRefresh?: boolean, callback?: Function): void;\n\n  showLogin(config: any): void;\n\n  isUserValid(): boolean;\n\n  logout(callback: Function, source?: any): void;\n\n  registerCallback(event: string, callback: Function): void;\n\n  getUserInfoParams(config: any): any;\n\n  isUserConfirmed(): boolean;\n}\n\nexport interface IUserRefProvider {\n  isv: boolean;\n\n  getName(): string;\n\n  getToken(): string | null;\n\n  isUserValid(): boolean;\n\n  onLoginSuccess(params: any): void;\n\n  logout(callback?: Function): void;\n}\n\nexport const user = ((container = pn.container): UserInterface => {\n\n  const api = container.resolve<APIInterface>('api');\n  const util = container.resolve<UtilInterface>('util');\n  const janrain = container.resolve<JanrainInterface>('janrain');\n  const tinypassAccounts = container.resolve<TinypassAccountsInterface>('tinypassAccounts');\n  const condeUserProvider = container.resolve<CondeUserProviderInterface>('condeUserProvider');\n  const gigya = container.resolve<GigyaInterface>('gigya');\n  const pianoId = container.resolve<PianoIdInterface>('pianoId');\n  const pianoIdLite = container.resolve<PianoIdLiteInterface>('pianoIdLite');\n  const eventUtils = container.resolve<EventUtilsInterface>('eventUtils');\n\n  const TAC_COOKIE_MAX_BYTE_SIZE = 4096;\n\n  const name = 'user';\n\n  const eventManager = eventUtils.createEventManager([]);\n\n  const _addProviderHandler = (handlerName: 'logout', cb: Function) => {\n    [janrain, tinypassAccounts, condeUserProvider, gigya, pianoId, pianoIdLite].forEach(provider => {\n      provider.registerCallback(handlerName, cb);\n    });\n  };\n\n  // On logout handler\n  _addProviderHandler('logout', () => {\n    util.__protected__.setVxUsersToDataLayer(null);\n\n    dataLayer.set('userStatus', 'anon');\n  });\n\n  // any new user provider should implement these methods\n  const userRefProvider = ((): IUserRefProvider => {\n    var _getName = function () {\n      return 'publisher_user_ref';\n    };\n    var _getToken = function (): string | null {\n      if (!pn.userRef) {\n        return null;\n      }\n      if (pn.userRef.constructor === ''.constructor) {\n        return pn.userRef;\n      } else if (pn.userRef.constructor === {}.constructor) {\n        return '{jox}' + JSON.stringify(pn.userRef);\n      } else {\n        return pn.userRef;\n      }\n    };\n    var _isUserValid = function (): boolean {\n      return (typeof (pn.userRef) !== 'undefined' && pn.userRef && pn.userRef.length > 0) ? true : false;\n    };\n\n    return {\n      isv: false,\n      getName: function () {\n        return _getName();\n      },\n      getToken: function () {\n        return _getToken();\n      },\n      isUserValid: function (): boolean {\n        return _isUserValid();\n      },\n      onLoginSuccess,\n      logout: function (callback?: Function): void {\n        util.setAccessTokenListCookie();\n        if (callback) {\n          callback();\n        }\n      }\n    };\n\n    function onLoginSuccess(params: any): void {\n      util.setAccessTokenListCookie(\n        { value: params.token_list, cookie_domain: params.cookie_domain },\n        params.user_token\n      );\n    }\n  })();\n\n  /**\n   * This method gets the current user provider as determined by javascript. This\n   * does not perform any server-side validation, and there is no explicit or\n   * implicit validation of any of the browser-supplied details like access tokens\n   * or userRef string. This simply provides a simply mechanism to make API calls\n   * and show offers without having to do complicated checks for certain properties\n   * and the existence of cookies, etc.\n   */\n  const getProvider = (): UserProviderType => {\n    const userProviderList = [\n      janrain, tinypassAccounts, condeUserProvider, gigya, pianoId, pianoIdLite\n    ];\n    const configuredPP = userProviderList.find((pp) => {\n      return pp.isConfigured() && !pp.isv;\n    });\n    if (configuredPP) {\n      return configuredPP;\n    } else {\n      return userRefProvider;\n    }\n  };\n\n  const getTacCookieSize = (): number => {\n    const tacCookieName = '__tac';\n    const tacCookieValue = util.__protected__.getCookie(tacCookieName);\n\n    if (tacCookieValue === undefined) {\n      return 0;\n    }\n\n    /**\n     * We encode received __tac cookie value to receive its real size, because this cookie is stored in the encoded form,\n     * and the util.__protected__.getCookie, in turn, returns the decoded value\n     */\n    const tacCookieEncodedValue = encodeURIComponent(tacCookieValue);\n    const encoder = new TextEncoder();\n\n    try {\n      return encoder.encode(tacCookieEncodedValue + tacCookieName).byteLength;\n    } catch(err) {\n      util.debug('couldn\\'t encode __tac cookie', err);\n      return (tacCookieEncodedValue + tacCookieName).length;\n    }\n  }\n\n  const isTokenNeedsForRefresh = (userIsValid: boolean, forceRefresh?: boolean): boolean => {\n    if (typeof forceRefresh !== 'undefined' && forceRefresh) {\n      return  true;\n    }\n\n    if (userIsValid) {\n      const accessExpires = util.__protected__.getCookie('__tae');\n      // we haven't seen this browser in >30 days awhile; the __tae is gone\n      if (typeof (accessExpires) === 'undefined' || !accessExpires) {\n        return true;\n      } else {\n        const expires = new Date(parseInt(accessExpires));\n        const now = new Date();\n        // older than 24 hours; fetch a new one\n        if ((now.getTime() - expires.getTime()) > (24 * 60 * 60 * 1000)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n\n  /**\n   * Refreshes the encrypted Tinypass access token (__tac) and returns the value in\n   * a callback function. This method sets the __tac and __tae (access expiration)\n   * cookies on the browser for 5 days. Returns null if it was not refreshed, an empty\n   * string if the user doesn't have any access, and the base64-encoded, encrypted\n   * string if the user has active access. Passing in forceRefresh = true will cause\n   * the token list to be updated regardless of when the __tae cookie says that the\n   * access list should be updated.\n   */\n  const refreshAccessToken = (forceRefresh?: boolean, callback?: Function): void => {\n    let needsRefresh = false;\n    const userIsValid = getProvider().isUserValid();\n\n    if (getTacCookieSize() >= TAC_COOKIE_MAX_BYTE_SIZE) {\n      needsRefresh = true;\n\n      console.warn(`__tac cookie exceeds max size equals ${TAC_COOKIE_MAX_BYTE_SIZE} bytes`);\n      // just clean\n      util.setAccessTokenListCookie(null, '', true);\n    } else {\n      needsRefresh = isTokenNeedsForRefresh(userIsValid, forceRefresh);\n    }\n\n    if (typeof (callback) === 'undefined' || !callback) {\n      callback = function () {\n      };\n    }\n\n    if (!needsRefresh && userIsValid) {\n      callback(null);\n      return;\n    }\n\n    util.waitCall('refreshUserToken', () => {\n      // util.waitCall(\"pageTrack\", function () {\n      util.waitCall('offerCreate', () => {\n        util.waitCall('experienceExecute', () => {\n          if (!getProvider().isUserValid()) {\n            if (util.__protected__.getCookie('__tac')) {\n              // just clean\n              util.setAccessTokenListCookie(null, '', true);\n            }\n            if (callback) {\n              callback('');\n            }\n            return;\n          }\n\n          util.startCall('refreshAccessTokenList');\n          var params = {\n            url: util.prepareUrlParameter(window.location.href)\n          };\n          api.callApi('/access/token/list', params, (response: any) => {\n            util.doneCall('refreshAccessTokenList');\n            if (typeof (response.access_token_list) === 'undefined') {\n              if (callback) {\n                callback(null);\n              }\n              return;\n            }\n            util.setAccessTokenListCookie(response.access_token_list);\n            if (callback) {\n              callback(response.access_token_list.value);\n            }\n          }, undefined, undefined);\n        });\n      });\n      // });\n    });\n  };\n\n  const showLogin = (config: any): void => {\n    var providerName = getProvider().getName();\n    if (providerName === 'tinypass_accounts') {\n      tinypassAccounts.login(config);\n    } else if (providerName === 'piano_id') {\n      var showConfig = config || {};\n      pianoId.show(showConfig);\n    } else if (providerName === 'publisher_user_ref') {\n      eventManager.fireCallbacks('loginRequired', {}, undefined, true);\n    }\n  };\n\n  const isUserValid = (): boolean => {\n    return getProvider().isUserValid();\n  };\n\n  /**\n   * returns the boolean value for user confirmed prop.\n   * As pianoId has email verification it uses pianoId's value.\n   * For the rest user providers it's always true as there isn't DOI\n   */\n  const isUserConfirmed = (): boolean => {\n    const providerName = getProvider().getName();\n    if (providerName === 'piano_id') {\n      return pn.pianoId.getUser().confirmed;\n    }\n\n    return true;\n  };\n\n\n  const logout = (callback: Function, source?: any): void => {\n    getProvider().logout(callback, source);\n  };\n\n  const providerInit = (callback?: Function): void => {\n    if (typeof (callback) === 'undefined' || !callback) {\n      callback = function () {\n      };\n    }\n    var provider = getProvider();\n    // @ts-ignore\n    if (typeof provider.prepare === 'function') {\n      if (\"prepare\" in provider) {\n        provider.prepare().then(callback, callback);\n      }\n    } else {\n      callback();\n    }\n  };\n\n  const registerCallback = (event: string, callback: Function): void => {\n    eventManager.addEvent(event);\n    eventManager.registerCallback(event, callback);\n  }\n\n  const getUserLang = (): string => {\n    return util.__protected__.getCookie('LANG') || '';\n  };\n\n  const getUserInfoParams = (config: any): any => {\n    var userToken = config.userToken;\n    if (!userToken) {\n      var _token = getProvider().getToken();\n      userToken = _token && _token.length > 0 ? _token : '';\n    }\n    return {\n      'user_token': userToken,\n      'user_lang': getUserLang(),\n      'is_preview': config.preview,\n      'is_non_logged_user': config.previewNonLoggedUser\n    };\n  }\n\n  return {\n    name,\n    /**\n     * This method gets the current user provider as determined by javascript. This\n     * does not perform any server-side validation, and there is no explicit or\n     * implicit validation of any of the browser-supplied details like access tokens\n     * or userRef string. This simply provides a simply mechanism to make API calls\n     * and show offers without having to do complicated checks for certain properties\n     * and the existence of cookies, etc.\n     */\n    getProvider,\n    providerInit,\n    /**\n     * Refreshes the encrypted Tinypass access token (__tac) and returns the value in\n     * a callback function. This method sets the __tac and __tae (access expiration)\n     * cookies on the browser for 5 days. Returns null if it was not refreshed, an empty\n     * string if the user doesn't have any access, and the base64-encoded, encrypted\n     * string if the user has active access. Passing in forceRefresh = true will cause\n     * the token list to be updated regardless of when the __tae cookie says that the\n     * access list should be updated.\n     */\n    refreshAccessToken,\n    showLogin,\n    isUserValid,\n    logout,\n    registerCallback,\n    getUserInfoParams,\n    isUserConfirmed,\n  };\n\n});\n\npn.container.register('user', {\n  useValue: user()\n});\npn.user = pn.container.resolve<UserInterface>('user');\n", "import { UtilInterface } from \"./util\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface ViewportExitInterface {\n  name: string;\n\n  initialize(): void;\n\n  isInitialized(): boolean;\n\n  addListener(callback: Function, options: any, consumeEventFn?: Function): void;\n\n  resetSumOfCodesDirectionToDefault(): void;\n\n  getSumOfCodesDirection(): number;\n\n  removeListeners(): void;\n\n  enable(): void;\n\n  disable(): void;\n}\n\nconst viewportExit = ((): ViewportExitInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const name = 'viewportExit';\n\n  const viewportExitActivated = 'viewport-exit-activated';\n  const viewportExitPrepared = 'viewport-exit-prepared';\n  let shouldTriggerHistoryStateChange = false;\n\n  let mouseMoveCalled = false;\n  let mouseX = 0;\n  let mouseY = 0;\n\n  const sides = ['top', 'right', 'bottom', 'left'];\n  let enabled = true;\n  let initialized = false;\n  let initializedMobile = false;\n  let listeners: any[] = [];\n  const noneDirection = 0;\n  const codesDirection: any = {\n    top: {\n      visited: false,\n      value: 1\n    },\n    right: {\n      visited: false,\n      value: 2\n    },\n    bottom: {\n      visited: false,\n      value: 4\n    },\n    left: {\n      visited: false,\n      value: 8\n    }\n  };\n  let sumOfCodesDirection = noneDirection;\n\n  const initialize = (): void => {\n    if (initialized) {\n      return;\n    }\n    initialized = true;\n    sumOfCodesDirection = noneDirection;\n    // FF and Safari doesn't support document -> mouseLeave/mouseEnter events\n    const mouseLeaveElement = /(?:Firefox|Safari)[\\/\\s](\\d+\\.\\d+)/.test(navigator.userAgent) ? document.body : document;\n\n    jqUtils.on(mouseLeaveElement, 'mouseleave', (event: any) => handleMouseLeave(event));\n    jqUtils.on(document, 'mousemove', (event: any) => handleMouseMove(event));\n  }\n\n  function listenUserActionOnce (cb: Function) {\n    if (util.isIphone() && (util.getIphoneVersion() || 0) >= 16) {\n      let actionWasDone = false;\n      const onUserAction = () => {\n        if (!actionWasDone) {\n          actionWasDone = true;\n          cb();\n        }\n        document.removeEventListener('click', onUserAction);\n      }\n\n      document.addEventListener('click', onUserAction);\n    } else {\n      cb();\n    }\n  }\n  function initializeMobile () {\n    if (initializedMobile) {\n      return;\n    }\n    initializedMobile = true;\n\n    listenUserActionOnce(() => {\n      window.addEventListener('popstate', function (e) {\n        if (shouldTriggerHistoryStateChange && e.state && e.state.pianoViewportExitState === viewportExitActivated) {\n          shouldTriggerHistoryStateChange = false;\n          fire('back');\n        }\n      });\n\n      var currentHistoryState = window.history.state || {};\n      if (currentHistoryState && currentHistoryState.pianoViewportExitState !== viewportExitPrepared) {\n        if (currentHistoryState.pianoViewportExitState !== viewportExitActivated) {\n          currentHistoryState.pianoViewportExitState = viewportExitActivated;\n          window.history.replaceState(currentHistoryState, document.title);\n        }\n\n      window.history.pushState({ pianoViewportExitState: viewportExitPrepared }, document.title);\n    }\n\n      shouldTriggerHistoryStateChange = true;\n    });\n  }\n\n  const calculateSumBySide = (side: string) => {\n    if (sides.indexOf(side) !== -1) {\n      if (!codesDirection[side].visited) {\n        codesDirection[side].visited = true;\n        sumOfCodesDirection += codesDirection[side].value;\n      }\n    } else {\n      util.debug('viewportExit: the detect of the exit side failed');\n    }\n  }\n\n  const getExitSide = (clientX: number, clientY: number) => {\n    const winSize = jqUtils.winSize();\n    var windowWidth = winSize.width;\n    var windowHeight = winSize.height;\n    var side = '';\n\n    if (isRight()) {\n      side = 'right';\n    }\n\n    if (isBottom()) {\n      side = 'bottom';\n    }\n\n    if (isLeft()) {\n      side = 'left';\n    }\n\n    if (isTop()) {\n      side = 'top';\n    }\n\n    function isTop() {\n      return clientY <= 0;\n    }\n\n    function isRight() {\n      return clientX >= windowWidth;\n    }\n\n    function isBottom() {\n      return clientY >= windowHeight;\n    }\n\n    function isLeft() {\n      return clientX <= 0;\n    }\n\n    return side;\n  }\n\n  const indexMin = (array: number[]): number => {\n    if (array.length === 0) {\n      return -1;\n    }\n\n    var min = array[0];\n    var minIndex = 0;\n\n    for (var i = 1; i < array.length; i++) {\n      if (array[i] < min) {\n        minIndex = i;\n        min = array[i];\n      }\n    }\n\n    return minIndex;\n  }\n\n  const getNearestSideByLastMove = () => {\n    if (!mouseMoveCalled) {\n      return '';\n    }\n    const winSize = jqUtils.winSize();\n    var windowWidth = winSize.width;\n    var windowHeight = winSize.height;\n\n    var differenceWithSide = [mouseY, windowWidth - mouseX, windowHeight - mouseY, mouseX];\n    return sides[indexMin(differenceWithSide)];\n  }\n\n  //Detect incorrect mouseleave coordinates in Window 7 IE browsers\n  const checkWrongPoint = (e: any) => {\n    return e.clientX === e.clientY && e.clientX < 0 && e.clientX >= -1;\n  }\n\n  const handleMouseLeave = (e: any) => {\n    var closestSide;\n    closestSide = checkWrongPoint(e) ? '' : getExitSide(e.clientX, e.clientY);\n\n    if (!closestSide) {\n      closestSide = getNearestSideByLastMove();\n      if (!closestSide) {\n        util.debug('viewportExit: the detect of the exit side failed');\n      }\n    }\n\n    if (closestSide) {\n      calculateSumBySide(closestSide);\n    }\n\n    fire('all');\n\n    if (closestSide === 'top') {\n      fire('top');\n    }\n  }\n\n  const handleMouseMove = (e: any) => {\n    mouseMoveCalled = true;\n    mouseY = e.clientY;\n    mouseX = e.clientX;\n  }\n\n  const fire = (type: string) => {\n    if (!enabled) {\n      return;\n    }\n    var listener;\n    var execute = [];\n    var noExecute = [];\n    for (var i = 0; i < listeners.length; i++) {\n      listener = listeners[i];\n      if ((listener.detectExitMode === type || (type === 'back' && listener.detectBackButtonForMobile)) && listener.consumeEventFn()) {\n        execute.push(listener);\n      } else {\n        noExecute.push(listener);\n      }\n    }\n\n    if (execute.length) {\n      util.debug('viewportExit: listeners was run fire with type: ', type);\n    }\n\n    listeners = noExecute;\n    for (var i = 0; i < execute.length; i++) {\n      listener = execute[i];\n      listener.callback();\n    }\n  }\n\n  const addListener = (callback: Function, options: any, consumeEventFn?: Function): void => {\n    if ((options.clientDevice === 'mobile' || options.clientDevice === 'tablet') && !!options.detectBackButtonForMobile) {\n      initializeMobile();\n    }\n\n    initialize();\n\n    if (typeof consumeEventFn !== 'function') {\n      consumeEventFn = function () {\n        return true;\n      };\n    }\n\n    listeners.push({\n      callback: callback,\n      detectExitMode: options.detectExitMode,\n      detectBackButtonForMobile: options.detectBackButtonForMobile,\n      consumeEventFn: consumeEventFn\n    });\n  }\n\n  const removeListeners = () => {\n    listeners = [];\n  }\n\n  const isInitialized = (): boolean => {\n    return initialized;\n  }\n\n  const getSumOfCodesDirection = (): number => {\n    return sumOfCodesDirection;\n  }\n\n  const resetSumOfCodesDirectionToDefault = (): void => {\n    sumOfCodesDirection = noneDirection;\n  }\n\n  const enable = () => {\n    enabled = true;\n  }\n\n  const disable = () => {\n    enabled = false;\n  }\n\n  return {\n    name,\n    initialize,\n    isInitialized,\n    addListener,\n    resetSumOfCodesDirectionToDefault,\n    getSumOfCodesDirection,\n    removeListeners,\n    enable,\n    disable,\n  };\n\n})();\n\npn.container.register('viewportExit', {\n  useValue: viewportExit\n});\npn.viewportExit = pn.container.resolve<ViewportExitInterface>('viewportExit');\n", "import { UserInterface } from \"./user\";\nimport { ContainerUtilsInterface } from \"./containerUtils\";\nimport { PostmessageInterface } from \"./postmessage\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { APIInterface } from './api';\nimport { UtilInterface } from \"./util\";\n\nexport interface TemplateInterface {\n  name: string;\n\n  show(config: any): void;\n\n  deferredShow(config: any): any;\n\n  close(): void;\n\n  closeInline(selector: string): void;\n\n  createTemplateIframe(config: any): any;\n\n  showBackdrop(): void;\n\n  hideBackdrop(): void;\n\n  centerBackdrop(container: any): void;\n\n  registerCallback(callbackName?: string, callback?: Function): void;\n\n  refreshUser(iframeId: string): void;\n}\n\nconst template = ((): TemplateInterface => {\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const containerUtils = pn.container.resolve<ContainerUtilsInterface>('containerUtils');\n  const user = pn.container.resolve<UserInterface>('user');\n  const api = pn.container.resolve<APIInterface>('api');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const name = 'template';\n\n  function createTemplateIframe(config: any): any {\n    // TODO implement without using offer.js\n    return createTemplateIframeWithUrl(config, '/checkout/template/show')\n  }\n\n  function createCacheableTemplateIframe(config: any): any {\n    config.initContextLoadPromise = (config: any, statsParams: any): void => {\n      config.contextLoadingPromise = loadTemplateContext(config, statsParams);\n    }\n    return createTemplateIframeWithUrl(config, '/checkout/template/cacheableShow');\n  }\n\n  const createTemplateIframeWithUrl = (config: any, endpointUrl: string): any => {\n    const url = pn.getEndpointRoot(true) + endpointUrl;\n    config.iframeUrl = url;\n    config.postMessageUrl = url;\n    config.widget = 'template';\n    return pn.offer.createOfferIframe(config);\n  }\n\n  const loadTemplateContext = (config: any, statsParams: any): Promise<any> => {\n    const templateContextParams = user.getUserInfoParams(config);\n    templateContextParams.tracking_id = config.trackingId;\n    templateContextParams.templateId = config.templateId;\n    templateContextParams.templateVariantId = config.templateVariantId;\n    templateContextParams.aid = pn.aid;\n    templateContextParams.preload = config.isPreload;\n    templateContextParams.cookie_consents = JSON.stringify(util.getCookieConsents());\n    templateContextParams.previous_user_segments = util.getUserSegmentsString();\n    templateContextParams.userState = util.getUserState();\n\n    if (config.affiliateState) {\n      templateContextParams.affiliateState = JSON.stringify(config.affiliateState);\n    }\n\n    Object.keys(statsParams).forEach((key: string) => {\n      templateContextParams[key] = statsParams[key];\n    });\n\n    return new Promise((resolve, reject) => {\n      api.callApi('/anon/template/loadTemplateContext', templateContextParams, ({\n                                                                                  code,\n                                                                                  templateContext,\n                                                                                  message\n                                                                                }: any) => {\n        code === 0\n          ? resolve(templateContext)\n          : reject(message);\n      }, undefined, undefined)\n    });\n  }\n\n  const buildQueryStringFn = (iframeParams: any, jqUtils: JqUtilsInterface): string => {\n    var filteredParams: any = {};\n    // To keep CF hit rate we should use only params which are not related to user,\n    // something like user_token or trackingId will break the caching\n    var whiteListedParams: string[] = ['aid', 'templateId', 'templateVariantId', 'previewTemplateVersion',\n      'preload', 'preview', 'previewUncached', 'deploymentItemId', 'gaClientId', 'zuoraSelectedRatePlanIds',\n      'newscycleSelectedIds', 'addNewsletterAssets', 'offerId', 'experienceId', 'iframeId', 'displayMode', 'debug',\n      'pianoIdUrl', 'widget', 'url',\n    ];\n\n    whiteListedParams.forEach((f: string) => {\n      if (iframeParams[f]) {\n        filteredParams[f] = iframeParams[f];\n      }\n    });\n    return jqUtils.param(filteredParams);\n  }\n\n  function initCacheableTemplate(config: any): void {\n    config.deferredContextLoading = true;\n    config.buildQueryStringFn = buildQueryStringFn;\n  }\n\n  function setCreatingIframeFunctionToConfig(config: any) {\n    if (pn.getCacheableShowTemplate()) {\n      initCacheableTemplate(config);\n      config.createIframeFn = createCacheableTemplateIframe;\n    } else {\n      config.createIframeFn = createTemplateIframe;\n    }\n  }\n\n  // return {\n  /**\n   * Shows an template on the page.\n   *\n   * @param config\n   * The parameters that can get specified are:\n   *\n   *     templateId (required):\n   *         The id of the template being loaded, found in the publisher dashboard\n   *\n   *     displayMode (optional; default=modal):\n   *         Configures the display mode of the template. Valid options\n   *         are: inline, modal. Inline requires that a containerSelector is specified.\n   *\n   *         When set to modal, the semi-transparent backdrop will appear and the\n   *         offer and template will appear in an iframe in the middle of the browser.\n   *\n   *         When set to inline, the iframe will get loaded in the\n   *\n   *     containerSelector (conditionally required):\n   *         The jQuery selector that targets a single DOM element on the page that the\n   *         template should appear in. For example a containerSelector of\n   *         \".tp-template-form\" should be used if there were one, and only one:\n   *\n   *             <div class=\"tp-template-form\"></div>\n   *\n   *         that resided on the page that the template should appear in.\n   *\n   *         This option is only used when displayMode is inline, and must be a valid\n   *         selector for a single DOM element on the page.\n   *\n   *     close (optional):\n   *         A callback that fires when the user dismisses a modal. This event only fires\n   *         when the user dismisses an iframe that is in modal mode.\n   *\n   *     customEvent (optional):\n   *         A callback that fires when the user performs an action in the template that\n   *         the publisher has configured to listen for.\n   *\n   *         For example, a publisher might implement code on their website such as:\n   *\n   *         tp.template.show({\n   *             // all required fields, plus\n   *             customEvent : function(event) {\n   *                 switch(event.params.eventName) {\n   *                     case \"login\":\n   *                         window.location.href = \"/login\";\n   *                         break;\n   *                 }\n   *             }\n   *         });\n   *\n   *         In their template, their markup would contain:\n   *\n   *             <a href=\"#\" ng-click=\"customEvent('login')\">Login</a>\n   *\n   *         This callback would get fired when the user clicked Login from within template.\n   *\n   */\n  const show = (config: any): void => {\n    // TODO implement without using offer.js\n    config.offerId = containerUtils.fakeOfferId;\n    config.trackStatsOnShow = true;\n    setCreatingIframeFunctionToConfig(config);\n    return pn.offer.show(config);\n  }\n\n  const deferredShow = (config: any): any => {\n    config.offerId = containerUtils.fakeOfferId;\n    setCreatingIframeFunctionToConfig(config);\n    return pn.offer.deferredShow(config);\n  }\n\n  const close = (): void => {\n    containerUtils.closeModalContainer();\n  }\n\n  const closeInline = (selector: string): void => {\n    containerUtils.__protected__.closeInlineContainers(selector);\n  }\n\n  const showBackdrop = (): void => {\n    containerUtils.showBackdrop();\n  }\n\n  const hideBackdrop = () => {\n    containerUtils.hideBackdrop();\n  }\n\n  const centerBackdrop = (container: any): void => {\n    containerUtils.centerBackdrop(container);\n  }\n\n  const registerCallback = (callbackName?: string, callback?: Function): void => {\n    // TODO implement when we will use own event manager\n    //eventManager.addEvent(callbackName);\n    //eventManager.registerCallback(callbackName, callback);\n  }\n\n  const refreshUser = (iframeId: string): void => {\n    user.refreshAccessToken(true, () => {\n      postmessage.send('externalLoginSuccess', {\n        user_token: user.getProvider().getToken()\n      }, iframeId);\n    });\n  }\n\n  return {\n    name,\n    show,\n    deferredShow,\n    close,\n    closeInline,\n    createTemplateIframe,\n    showBackdrop,\n    hideBackdrop,\n    centerBackdrop,\n    registerCallback,\n    refreshUser,\n  };\n\n})();\n\npn.container.register('template', {\n  useValue: template\n});\npn.template = pn.container.resolve<TemplateInterface>('template');\n", "import { UtilInterface } from './util';\nimport { PostmessageInterface } from './postmessage';\nimport { UserInterface } from './user';\nimport { ContainerUtilsInterface, IframeInfoInterface } from './containerUtils';\nimport { EventUtilsInterface } from './eventUtils';\nimport { ViewportExitInterface } from \"./viewportExit\";\nimport { JqUtilsInterface} from './jqUtils';\nimport { GaServiceInterface } from './googleAnalytics/gaService';\nimport { SHA1Interface } from './sha1';\nimport { LogActionType, LoggingInterface } from './logging';\nimport { TemplateInterface } from './template';\nimport { AnalyticsInterface } from './analytics';\nimport { GA_EVENT_TYPE } from './googleAnalytics/constants';\nimport { GaCollectingServiceInterface } from './googleAnalytics/gaCollectingService';\nimport { AjaxInterface } from './ajax';\nimport { AcpInterface } from './acp';\nimport { APIInterface } from './api';\n\nexport interface OfferInterface {\n  name: string;\n\n  show(config: any): void;\n\n  deferredShow(config: any): any;\n\n  close(): void;\n\n  closeInline(selector: string): void;\n\n  startCheckout(config: any, sender: string): void;\n\n  startLinkedTermCheckout(termId: string, offerId?: string): void;\n\n  startRedeemVoucher(config: any): void;\n\n  createOfferIframe(config: any): IframeInfoInterface;\n\n  showBackdrop(): void;\n\n  hideBackdrop(): void;\n\n  centerBackdrop(container: any): void;\n\n  registerCallback(callbackName: string, callback: Function): void;\n\n  reload(iframeId: string, config: any): void;\n\n  reloadAll(config: any, exceptIframeId: string): void;\n\n  resetUserAndReloadAll(config: any, exceptIframeId: string): void;\n\n  checkThreeDSRedirect(): void;\n\n  passCookieConsents(iframe: IframeInfoInterface): void;\n\n  passUserSegments(iframe: IframeInfoInterface): void;\n\n  passUserState(iframe: IframeInfoInterface): void;\n}\n\ninterface IResponseData<T = unknown> {\n  [key: string]: unknown;\n  data: T;\n}\n\ninterface IOfferStatData {\n  [key: string]: unknown;\n  offer_id?: string;\n  offer_template_id?: string;\n  offer_template_version_id?: string;\n}\n\ninterface IPageViewData {\n  [key: string]: unknown;\n  page_view_id?: string;\n  page_view_content?: {\n    content_created?: string;\n    content_author?: string;\n    content_section?: string;\n    tags?: string;\n  }\n}\n\ninterface IVisibilityImpressionCalculateData {\n  top: number;\n  bottom: number;\n  left: number;\n  right: number;\n  iframeHeight: number;\n  iframeWidth: number;\n  viewportHeight: number;\n  viewportWidth: number;\n}\n\ninterface IVisibleImpressionTrackedIframeData {\n  isVisibleImpressionEventSent?: boolean;\n  initiatedFirstCheckVisibleImpression?: boolean;\n  currentState?: string;\n  previousState?: string;\n  isDirectCheckout?: boolean;\n}\n\ninterface IChangeOption {\n  access_period_from_id: string;\n  access_period_from_name: string;\n  access_period_to_id: string;\n  access_period_to_name: string;\n  base_term_to_billing_plan: string;\n  billing_date: number;\n  billing_date_text: string;\n  billing_timing: number;\n  description: string;\n  immediate_access: boolean;\n  term_change_option_id: string;\n  resource_from_name: string;\n  resource_to_name: string;\n  subscription_from_billing_period: string;\n  subscription_from_billing_plan: string;\n  subscription_from_id: string;\n  term_from_id: string;\n  term_from_name: string;\n  term_from_type: string;\n  term_to_billing_period: string;\n  term_to_id: string;\n  term_to_name: string;\n  term_to_type: string;\n}\n\nenum LINKED_TERM_PASSED_DATA_TYPE {\n  COMMON = 'linkedTermData',\n  SIGNED = 'linkTermSignedData',\n}\n\nenum LINKED_TERM_TYPES {\n  LINKED = 'linked',\n  LINK = 'link',\n}\n\nenum OFFER_TYPES {\n  UPGRADE = 'upgradeOffer',\n}\n\nexport const offer = ((container = pn.container): OfferInterface => {\n\n  const jqUtils = container.resolve<JqUtilsInterface>('jqUtils');\n  const util = container.resolve<UtilInterface>('util');\n  const postmessage = container.resolve<PostmessageInterface>('postmessage');\n  const user = container.resolve<UserInterface>('user');\n  const containerUtils = container.resolve<ContainerUtilsInterface>('containerUtils');\n  const eventUtils = container.resolve<EventUtilsInterface>('eventUtils');\n  const viewportExit = container.resolve<ViewportExitInterface>('viewportExit');\n  const gaService = container.resolve<GaServiceInterface>('gaService');\n  const sha1 = container.resolve<SHA1Interface>('sha1');\n  const logging = container.resolve<LoggingInterface>('logging');\n  const template = container.resolve<TemplateInterface>('template');\n  const analytics = container.resolve<AnalyticsInterface>('analytics');\n  const gaCollectingService = container.resolve<GaCollectingServiceInterface>('gaCollectingService');\n  const ajax = container.resolve<AjaxInterface>('ajax');\n  const acp = container.resolve<AcpInterface>('acp');\n  const api = container.resolve<APIInterface>('api');\n\n  const iframes: any[] = [];\n  const lockedConfigs: any = {};\n  let frameIdCount = 0;\n  let closeState = \"close\";\n  const lockTimeout = 10000; // lock timeout for loading checkout\n  const LOGIN_LOGOUT_SOURCE = 'OFFER';\n  let needReloadOnStartCheckout = false;\n  let loginRequiredTermId: string;\n  let loginRequiredIframeId: string;\n  let loginRequiredAllowReturnToStartState = false;\n  let isAddedUserProviderCallbacks = false;\n  const customVariablesPerIframe: any = {};\n  const iframeCounterByTemplateParamsMap = new Map();\n  let templateIframeParams: any = {};\n  const RTL_LOCALES: string[] = ['he_IL', 'ar_EG'];\n  let trackingId: string = '';\n  let lastGAEvent: string;\n  let currentIframeId: string;\n  const PROCESS_3DS_RURL = 'pn_rurl_3ds';\n  const visibilityCheckTiming = 1000;\n  const visibleImpressionTrackedIframes = new Map<string, IVisibleImpressionTrackedIframeData>();\n\n  const HIDDEN_TERM_TYPE_PROPERTY = Symbol();\n  const HIDDEN_SENDER_ID_PROPERTY = Symbol();\n\n  const eventManager = eventUtils.createEventManager([\n    'complete',\n    'cancel',\n    'close',\n    'error',\n    'loginRequired',\n    'loginSuccess',\n    'loaded',\n    'customEvent',\n    'startCheckout',\n    'resize',\n    'onMeterExpired',\n    'onMeterActive',\n    'onAccessGranted',\n    'onShowOffer',\n    'pianoIdEvent',\n    'parentSize',\n    'redeemCredit',\n    'onStartCreditRedemption',\n    'showAuthForm',\n    'callLinkTermSelectedCallback',\n    'callLinkedTermSelectedCallback',\n    'callLinkTermSelectedCallback',\n    'visibleImpression',\n    'selectChangeOption',\n    'checkoutSelectChangeOption',\n     ...acp.getComposerAcpEvents(),\n  ]);\n\n  containerUtils.setIframesPopstateHandlers();\n\n  /**\n   * Gets the base url for offer iframes. This respects the environment that\n   * is being worked in. To override the base url, set:\n   *\n   *     tp.endpoint = \"http://hostname/api/v3\";\n   *\n   * Offer iframes would be loaded from: //hostname/checkout/offer/show?param=value\n   *\n   * @returns {string}  The base url for offer iframes\n   * @const\n   */\n  const _getOfferBaseUrl = () => {\n    if (pn.offerBaseUrl) {\n      return pn.offerBaseUrl;\n    }\n    return pn.getEndpointRoot() + '/checkout/offer/show';\n  };\n\n  /**\n   * This will attempt to make the offer URL secure, unless someone has explicitely set tp.endpoint to\n   * an insecure http URL, in which case we will respect that. Recommended setting for publishers\n   * is to have them set tp.endpoint = \"//hostname\"; so that we can return http for offers (performance\n   * boost) and https for checkout (secure).\n   *\n   * @returns {string}  The base url for offer iframes\n   * @const\n   */\n  const _getCheckoutBaseUrl = () => {\n    return pn.getEndpointRoot(true) + '/checkout/offer/show';\n  };\n\n  const needToParseLinkedTermProductIds = (externalProductIds: unknown): boolean => {\n    return !!(externalProductIds && !Array.isArray(externalProductIds));\n  }\n\n  const parseLinkedTermProductIds = (externalProductIds: unknown): string[] | unknown[] => {\n    if (typeof externalProductIds === 'string') {\n      return externalProductIds.split(',');\n    }\n\n    return [externalProductIds];\n  }\n\n  const getLinkedTermDataToPass = (data: {\n    [key: string]: unknown;\n    [LINKED_TERM_PASSED_DATA_TYPE.COMMON]?: Record<string, unknown>\n    [LINKED_TERM_PASSED_DATA_TYPE.SIGNED]?: Record<string, unknown>\n  }): Record<string, unknown> | null => {\n    if (!data) {\n      return null;\n    }\n\n    const { linkedTermData, linkTermSignedData, linkedTermSignedData, ...commonLinkedTermData } = data;\n    const linkTermSignedDataParams = linkedTermSignedData || linkTermSignedData;\n\n    switch (true) {\n      case Boolean(linkedTermData):\n        return {\n          linkedTermData,\n          ...commonLinkedTermData,\n        };\n      case Boolean(linkTermSignedDataParams):\n        return {\n          linkTermSignedData: linkTermSignedDataParams,\n          ...commonLinkedTermData,\n        }\n      default:\n        return commonLinkedTermData;\n    }\n  }\n\n  const getLinkedTermExternalTermId = (\n    linkedTermData: {\n        [key: string]: unknown;\n        externalTermId?: string;\n        payload?: string;\n      },\n    dataType: LINKED_TERM_PASSED_DATA_TYPE\n  ): string => {\n    if (dataType === LINKED_TERM_PASSED_DATA_TYPE.COMMON) {\n      return linkedTermData.externalTermId || '';\n    }\n\n    if (dataType === LINKED_TERM_PASSED_DATA_TYPE.SIGNED) {\n      try {\n        return JSON.parse(linkedTermData.payload as string).externalTermId || '';\n      } catch (err) {\n        console.warn(err);\n        return '';\n      }\n    }\n\n    return '';\n  }\n\n  const createSession = (offerStatData: IOfferStatData = {}, pageViewData: IPageViewData = {}): Promise<IResponseData<string>> => {\n    const url = pn.getApiEndpoint() + '/linkedTerm/session/create';\n    const sessionData = {\n      tracking_id: trackingId || '',\n      tbc: util.getTbcCookie() || '',\n      pcid: util.getPcidCookie() || '',\n      consents: JSON.stringify(util.getCookieConsents()),\n      previous_user_segments: util.getUserSegmentsString(),\n      user_state: util.getUserState(),\n      ...offerStatData,\n      ...pageViewData\n    };\n\n    return new Promise((resolve, reject) => {\n      try {\n        ajax.request({\n          url,\n          type: 'POST',\n          dataType: 'json',\n          data: JSON.stringify(sessionData),\n          contentType: 'application/json',\n          success: resolve,\n          error: reject,\n        })\n      } catch (err) {\n        reject(err);\n      }\n    });\n  }\n\n  const hasActiveSubscriptionToLinkedTerm = (aid: string, externalTermId: string): Promise<IResponseData<boolean>> => {\n    const url = `${pn.getApiEndpoint()}/linkedTerm/subscription/hasActive`;\n    const data = {\n      aid,\n      external_term_id: externalTermId,\n      user_token: user.getProvider().getToken()\n    };\n\n    return new Promise((resolve, reject) => {\n      try {\n        ajax.request({\n          url,\n          type: 'POST',\n          dataType: 'json',\n          data,\n          contentType: 'application/x-www-form-urlencoded',\n          success: resolve,\n          error: reject,\n        })\n      } catch (err) {\n        reject(err);\n      }\n    });\n  }\n\n  const getGAEventPayload = (eventType: string) => {\n    switch (eventType) {\n      case 'purge':\n        return {\n          eventCategory: 'checkoutClose',\n          eventLabel: 'Checkout close',\n        };\n      case 'customEvent':\n        return {\n          eventCategory: 'checkoutCustomEvent',\n          eventLabel: 'Checkout custom event',\n        };\n      case 'checkoutPaymentError':\n      case 'error':\n        return {\n          eventCategory: 'checkoutError',\n          eventLabel: 'Checkout error',\n        };\n      case 'checkoutStateChange':\n        return {\n          eventCategory: 'checkoutStateChange',\n          eventLabel: 'Checkout state change',\n        };\n      case 'showTemplate':\n        return {\n          eventCategory: 'showTemplate',\n          eventLabel: 'Show template',\n        };\n      case 'startCheckout':\n        return {\n          eventCategory: 'startCheckout',\n          eventLabel: 'Start checkout',\n          isModalOnly: true,\n        };\n      case 'logout':\n        return {\n          eventCategory: 'logout',\n          eventLabel: 'Logout event',\n        };\n      case 'loginRequired':\n        return {\n          eventCategory: 'loginRequired',\n          eventLabel: 'Login required',\n        };\n      default:\n        return null;\n    }\n  }\n\n  const sendGAEvent = (eventType: string, params: any) => {\n    const eventPayload = getGAEventPayload(eventType);\n\n    if (eventPayload?.isModalOnly && params.displayMode !== 'modal') {\n      return;\n    }\n\n    if (eventPayload && lastGAEvent !== eventPayload.eventCategory) {\n      analytics.ga.event({\n        eventType: GA_EVENT_TYPE.EMIT_GA_EVENT,\n        payload: {\n          iframeId: params.sender,\n          ...eventPayload,\n          ...params.params,\n        }\n      });\n\n      lastGAEvent = eventPayload.eventCategory;\n    }\n  }\n\n  /**\n   * Handles the receipt of a message from an iframe.\n   * @param params\n   * @param evFromChildrenToParent\n   * @const\n   */\n  function _receive (params: any, evFromChildrenToParent: boolean) {\n    // util.debug(\"Offer event received\", params.event, params.params, params);\n    var iframe = containerUtils.getIframe(params.sender);\n    var invokeCallbacksOnFire = true;\n    if (iframe && iframe.config) {\n      invokeCallbacksOnFire = !iframe.config.parent;\n    }\n\n    switch (params.event) {\n      case 'initContext':\n        if (params.params && params.params.resultCallbackId) {\n          var result = {\n            resultCallbackId: params.params.resultCallbackId,\n            affiliateState: iframe.config['affiliateState']\n          }\n          postmessage.send('resultCallback', result, params.sender);\n        }\n        break;\n      case 'storeCustomVariables':\n        tp.saveCustomVariablesToLocalStorage(5 * 60); // save for 5 min\n        break;\n      case 'fullRedirectThreeDS':\n        window.location.href = params.params.bankSecureUrl;\n        break;\n      case 'resize':\n        if (params.params.iframeId === params.sender) {\n          let resizingOptions = params.params.width === undefined ? {...params.params, width: jqUtils.getWidth(iframe.container)} : params.params;\n          containerUtils.resizeIframe(iframe, resizingOptions);\n\n          if (iframe.config.displayMode === 'modal') {\n            if (params.params.closeButtonType === 'boilerplate') {\n              containerUtils.hideCloseButton(iframe.container);\n            }\n\n            containerUtils.centerIt(iframe.container);\n          }\n          postmessage.send('afterResize', {}, iframe.iframeId);\n        }\n        eventManager.fireCallbacks(params.event, params.params, params.sender, invokeCallbacksOnFire);\n\n        iframes.forEach((displayedIframe) => {\n          if (shouldCheckVisibilityOnInit(displayedIframe)) {\n            checkVisibleImpression(displayedIframe.iframeId);\n          }\n        })\n        break;\n      case 'startCheckout':\n        params.params.width = null;\n\n        if (params.displayMode === 'inline') {\n          params.params.closeOnLogout = true;\n\n          var startCheckoutConfig: any = merge(params.params, iframe.statParams);\n          startCheckoutConfig.browserId = iframe.browserId;\n          startCheckoutConfig.isOpenedFromInlineCheckout = true;\n          startCheckout(startCheckoutConfig, params.sender);\n        }\n\n        if (params.params.iframeId === params.sender) {\n          eventManager.fireCallbacks(params.event, params.params, params.sender, invokeCallbacksOnFire);\n\n          sendGAEvent(params.event, params);\n        } else {\n          _setTrackedIframeValue(params.params.iframeId, {\n            isVisibleImpressionEventSent: true,\n          })\n\n          if (visibleImpressionTrackedIframes.get(params.sender)?.isVisibleImpressionEventSent) {\n            removeScrollListener(iframes.find((item) => item.iframeId === params.sender)?.displayMode);\n          }\n        }\n\n        break;\n      case 'showAuthForm':\n        const { params: pianoIdParams = {} } = params;\n\n        pn.pianoId.show({\n          closedCallback: () => {\n            postmessage.send('authFormClosed', {}, params.sender)\n          },\n          ...pianoIdParams,\n        });\n\n        break;\n      case 'callLinkTermSelectedCallback':\n      case 'callLinkedTermSelectedCallback':\n        if (!params.params || !tp.linkedTermSelectedCallbacks.length) {\n          return;\n        }\n\n        const { params: { linkedTermData, linkTermData, offerStatData, pageViewData, ...restData } } = params;\n        const linkedTermParams = linkedTermData || linkTermData;\n        const linkedTermPassedData = getLinkedTermDataToPass(linkedTermParams) || restData;\n        const dataType = linkedTermPassedData.linkedTermData\n          ? LINKED_TERM_PASSED_DATA_TYPE.COMMON\n          : LINKED_TERM_PASSED_DATA_TYPE.SIGNED;\n        const externalTermId = getLinkedTermExternalTermId(linkedTermPassedData[dataType], dataType);\n\n        Promise.all<[Promise<IResponseData<string>>, Promise<IResponseData<boolean>>]>([\n          createSession(offerStatData, pageViewData),\n          hasActiveSubscriptionToLinkedTerm(tp.aid, externalTermId),\n        ])\n          .then(([{ data: sessionId }, { data: userHasActiveSubscriptionToTerm }]): void => {\n            if (containerUtils.hasModalIframe()) {\n              containerUtils.closeModalContainer();\n            }\n\n            tp.linkedTermSelectedCallbacks.forEach((callback) => {\n              if (typeof callback === 'function') {\n                callback(\n                    sessionId || '',\n                    {\n                      ...linkedTermPassedData,\n                      [dataType]: {\n                        ...linkedTermPassedData[dataType],\n                        userHasActiveSubscriptionToTerm,\n                      }\n                    }\n                );\n              }\n            });\n          })\n          .catch(util.debug);\n\n        break;\n      case 'loaded':\n        if (params.params.iframeId === params.sender) {\n\n          postmessage.send('setupCustomVariables', customVariablesPerIframe[params.params.iframeId], params.params.iframeId);\n          postmessage.send('setupEVTFields', iframe.config['externalVerificationFields'], params.params.iframeId);\n\n          /**\n           * Pass cookie consents before trackStat call because these consents are needed in trackShow's payload in vx\n           */\n          passCookieConsents(iframe);\n          passUserSegments(iframe);\n          passUserState(iframe);\n\n          if (iframe.config.deferredContextLoading) {\n            _castUserDataContextLoadedEvent(iframe, params);\n          }\n\n          if (iframe.waitFinishProcesses) {\n            containerUtils.__protected__.closeAndRemoveIframe(iframe);\n            return;\n          }\n\n          if (user.getProvider().name === 'pianoId') {\n            pn.pianoId.__protected__.executePostMessagesBatch();\n          }\n\n          if (iframe.config.displayMode === 'modal') {\n            containerUtils.resizeIframe(iframe, params.params);\n            if (!iframe.config.isPreload) {\n              containerUtils.checkBackdropAndContainer(iframe, true);\n            }\n          }\n          if (iframe.config.displayMode === 'popup') {\n            containerUtils.resizeIframe(iframe, params.params);\n          }\n          if (!iframe.config.isPreload && !iframe.config.trackStatsOnShow || iframe.config.forceTrackStat) {\n            trackStat(iframe);\n          }\n\n          // TODO should be refactored to use \"afterLoaded\" postmessage (TPWEBAPP-28182)\n          passBrowserId(iframe);\n          passPcidBrowserId(iframe);\n          passPageViewContext(iframe);\n\n          eventManager.fireCallbacks(params.event, params.params, params.sender, invokeCallbacksOnFire);\n          if (iframe.config.displayMode === 'inline') {\n            if (!iframe.containerReady) {\n              //Waiting dom ready and container exists for append Iframe.\n              //This only works for offers that are operating with displayMode: inline\n              containerUtils.operationWithContainer(iframe.iframeParams.containerSelector, (container: HTMLElement) => {\n                const tempContainer = jqUtils.queryEl('#temp-inline-' + iframe.iframeId);\n                if (tempContainer) {\n                  container.innerHTML = tempContainer.innerHTML;\n                  jqUtils.remove(tempContainer);\n                }\n                //noinspection JSValidateTypes\n                iframe.element = jqUtils.queryEl('iframe', container);\n                iframe.containerReady = true;\n                containerUtils.resizeIframe(iframe, params.params);\n              });\n            } else {\n              containerUtils.resizeIframe(iframe, params.params);\n            }\n          }\n          const {offerId, templateId, initTime, logType} = iframe.iframeParams;\n          logging.setTime(logType, Math.floor(performance.now() - initTime), {offer_id: offerId === \"fakeOfferId\" ? undefined : offerId, template_id: templateId});\n\n          _releaseConfig(iframe.config);\n          util.doneCall('offerCreate');\n        }\n        break;\n      case 'downForMaintenance':\n        containerUtils.resizeIframe(iframe, { width: 300, height: 200 });\n        if (iframe.config.displayMode === 'modal') {\n          if (!iframe.config.isPreload) {\n            containerUtils.checkBackdropAndContainer(iframe);\n          }\n        }\n        break;\n      case 'removeQueryParamByName':\n        if (params && params.params && Array.isArray(params.params.paramsToRemove)) {\n          params.params.paramsToRemove.forEach((name: string) => {\n            util.removeQueryParamByName(name);\n          });\n        }\n        break;\n      case 'purge':\n        if (!evFromChildrenToParent) {\n          if (params && params.params && params.params.alreadyPurchased) {\n            closeState = 'alreadyHasAccess';\n          }\n\n          if (params && params.params && params.params.completePayment) {\n            closeState = 'checkoutCompleted';\n          }\n\n          if (shouldRemoveScrollListener()) {\n            removeScrollListener(iframe?.config.displayMode);\n          }\n\n          containerUtils.purgeIframe(params.sender, iframe.config.parent);\n\n          acp.handleAcpEvent(eventManager.fireCallbacks, params, iframe.config, invokeCallbacksOnFire);\n\n          _releaseConfig(iframe.config);\n\n          sendGAEvent(params.event, params);\n        }\n\n        break;\n      case 'close':\n        if (!evFromChildrenToParent) {\n          if (params && params.params && params.params.alreadyPurchased) {\n            closeState = 'alreadyHasAccess';\n          }\n          if (params && params.params && params.params.completePayment) {\n            closeState = 'checkoutCompleted';\n          }\n\n          if (util.hasQueryParamByName('voucher_code')) {\n            closeState = 'voucherRedemptionCompleted';\n          }\n\n          containerUtils.closeContainer(params.sender, iframe.config.parent);\n          _releaseConfig(iframe.config);\n        }\n\n        break;\n      case 'closeAndRefresh':\n        var url = params.params;\n        if (url) {\n          window.location.assign(url);\n        } else {\n          window.location.reload();\n        }\n\n        break;\n      case 'selectTerm':\n      case 'selectChangeOption':\n        if (params && params.params && params.params.alreadyPurchased) {\n          closeState = 'alreadyHasAccess';\n        } else {\n          closeState = 'close';\n        }\n        break;\n      case 'submitPayment':\n        eventManager.fireCallbacks(params.event,\n          merge(params.params, { offerId: iframe.iframeParams.offerId }),\n          params.sender,\n          invokeCallbacksOnFire);\n        break;\n      case 'complete':\n        if (typeof (params.params.token_list) !== 'undefined') {\n          const userToken = user.getProvider().getToken();\n          util.setAccessTokenListCookie(\n            { value: params.params.token_list, cookie_domain: params.params.cookie_domain },\n            userToken\n          );\n        }\n        var callbackParams = merge(params.params, { offerId: iframe.iframeParams.offerId });\n        eventManager.fireCallbacks(params.event, callbackParams, params.sender, invokeCallbacksOnFire);\n        closeState = 'checkoutCompleted';\n        break;\n      case 'checkoutSelectTerm':\n      case 'checkoutSelectChangeOption':\n        eventManager.fireCallbacks(params.event,\n          merge(params.params, { offerId: iframe.iframeParams.offerId }),\n          params.sender,\n          invokeCallbacksOnFire);\n        break;\n      case 'checkoutStateChange':\n        _setTrackedIframeValue(iframe.iframeId, {previousState: visibleImpressionTrackedIframes.get(iframe.iframeId)?.currentState});\n        _setTrackedIframeValue(iframe.iframeId, {currentState: params.params.stateName});\n        eventManager.fireCallbacks(params.event, params.params, params.sender, invokeCallbacksOnFire);\n        sendGAEvent(params.event, params);\n        break;\n      case 'checkoutPaymentError':\n      case 'alreadyPurchased':\n      case 'startThreeDBankSecure':\n      case 'cancel':\n      case 'error':\n      case 'completeUpgradePurchase':\n        eventManager.fireCallbacks(params.event, params.params, params.sender, invokeCallbacksOnFire);\n\n        sendGAEvent(params.event, params);\n        break;\n      case 'customEvent':\n        acp.handleAcpEvent(eventManager.fireCallbacks, params, iframe.config, invokeCallbacksOnFire);\n\n        sendGAEvent(params.event, params);\n        break;\n      case 'loginRequired':\n        needReloadOnStartCheckout = true;\n\n        eventManager.fireCallbacks(\n          params.event,\n          mergeLoginRequiredParamsWithConfig(iframe, params.params, params.sender),\n          params.sender,\n          invokeCallbacksOnFire\n        );\n\n        sendGAEvent(params.event, params);\n        break;\n      case 'logout':\n        _logout(params.event, params.params, params.sender, iframe.config.parent, invokeCallbacksOnFire);\n\n        sendGAEvent(params.event, params);\n        break;\n      case 'loginSuccess':\n        _loginSuccess(params.event, params.params, params.sender, invokeCallbacksOnFire);\n        break;\n      case 'inputFocus':\n        const tpModalEl = jqUtils.queryEl('.tp-modal');\n        if (tpModalEl) {\n          tpModalEl.style.zIndex = pn.zIndexes.modal + 1 + '';\n          tpModalEl.style.zIndex = pn.zIndexes.modal + '';\n        }\n        break;\n      case 'inputBlur':\n        const tpModalElBlur = jqUtils.queryEl('.tp-modal');\n        if (tpModalElBlur) {\n          tpModalElBlur.style.zIndex = pn.zIndexes.modal + 1 + '';\n          tpModalElBlur.style.zIndex = pn.zIndexes.modal + '';\n        }\n        break;\n      case 'getLocation':\n        if (params.params && params.params.resultCallbackId) {\n          params.params.result = window.location.href;\n          postmessage.send('resultCallback', params.params, params.sender);\n        }\n        break;\n      case 'setLocationHash':\n        if (params.params && params.params.hash) {\n          window.location.hash = params.params.hash;\n        }\n        break;\n      case 'langChangedWithinOffer':\n        if (pn.pianoId.isConfigured()) {\n          pn.pianoId.updateLang(params.params.lang);\n        }\n        if (RTL_LOCALES.indexOf(params.params.lang) >= 0) {\n          containerUtils.turnOnRTL(iframe);\n        } else {\n          containerUtils.turnOffRTL(iframe);\n        }\n        break;\n      case 'loginStart':\n        viewportExit.disable();\n        break;\n      case 'loginEnd':\n        viewportExit.enable();\n        break;\n      case 'pianoIdEvent':\n        if (params.params.iframeId === params.sender) {\n          if (params.params.event === 'closed') {\n            containerUtils.closeContainer(params.sender);\n          }\n          pn.pianoId.__protected__.offerMessageReceiver(params);\n        }\n        _handleSuccessDOI(params.params, params.sender);\n        break;\n      case 'swgCheckoutStart':\n        break;\n      case 'sharedAccountsSuccessfullyAdded':\n        postmessage.broadcast('refreshMyAccount', { userToken: user.getProvider().getToken() });\n        break;\n      case 'newsletterSignupImpression':\n      case 'newsletterSignupSubmission':\n        pn.pianoEsp.__protected__.offerMessageReceiver(params);\n        eventManager.fireCallbacks(params.event, params.params, params.sender, invokeCallbacksOnFire);\n        break;\n      case 'parentSize':\n        const winSize = jqUtils.winSize();\n        var sizes = {\n          width: winSize.width,\n          height: winSize.height\n        };\n\n        postmessage.send('parentSize', sizes, params.sender);\n\n        break;\n      case 'gigyaPasswordlessLogin':\n        if (params.params.iframeId === params.sender) {\n          loginRequiredIframeId = params.params.iframeId;\n          pn.gigya.loginByPasswordless(params.params)\n        }\n        break;\n      case GA_EVENT_TYPE.EMIT_GA_EVENT:\n        !evFromChildrenToParent\n        && analytics.ga.event({\n          eventType: GA_EVENT_TYPE.EMIT_GA_EVENT,\n          payload: {\n            iframeId: params.sender,\n            ...params.params,\n          },\n        });\n        return;\n      case GA_EVENT_TYPE.EMIT_METRICS_EVENT:\n        !evFromChildrenToParent\n        && analytics.ga.event({\n          eventType: GA_EVENT_TYPE.EMIT_METRICS_EVENT,\n          payload: params.params,\n        });\n        break;\n      case 'bannerInit':\n        iframe.config.singleContainer.classList.add('tp-banner');\n        break;\n      case 'bannerDestroy':\n        iframe.config.singleContainer.classList.remove('tp-banner');\n        break;\n      case 'redeemCredit':\n        let res = eventManager.fireCallbacks('onStartCreditRedemption', params.params, params.sender, invokeCallbacksOnFire);\n\n        if (res && res.then) {\n          res.then(\n            function (p: any) {\n              postmessage.send('successfullyCreditRedeem', p, params.sender);\n            },\n            function (p: any) {\n              postmessage.send('creditRedeemFailed', p, params.sender);\n            }\n          )\n        }\n        break;\n      case 'scrollModalTo':\n        if (params.displayMode === 'modal') {\n          var tpModalContainer = jqUtils.queryEl('.tp-modal');\n          if (tpModalContainer) {\n            var x = params.params.x || 0;\n            var y = params.params.y || 0;\n            tpModalContainer.scrollTo(x, y);\n          }\n        }\n        break;\n      case 'frequencyEvent':\n        var payload = {\n          event_name: 'piano_frequency_event',\n          event_type: params.params.eventType === 'closeClick' ? 'close_click' : 'visible_impression',\n          experience_Id: params.params.experienceId,\n          experience_action_Id: params.params.experienceActionId,\n        }\n\n        if ((params.params.eventType !== 'closeClick' && !isVisibleImpressionEventSent(iframe.iframeId)) || params.params.eventType === 'closeClick') {\n          eventManager.fireCallbacks('piano_frequency_event', payload, params.sender, invokeCallbacksOnFire);\n        }\n\n      default:\n        util.debug('Received invalid event type: ' + params.event);\n        return;\n    }\n  };\n\n  const _setTrackedIframeValue = (key: string, value: IVisibleImpressionTrackedIframeData): void => {\n    visibleImpressionTrackedIframes.set(key, {\n      ...visibleImpressionTrackedIframes.get(key),\n      ...value,\n    });\n  }\n\n  const _handleSuccessDOI = (params: any, sender: string): void => {\n    if (params.event !== 'successDOI') {\n      return;\n    }\n\n    if (params.iframeId !== sender) {\n      containerUtils.closeContainer(params.iframeId);\n    }\n\n    postmessage.send('afterSuccessDOI', params.params, sender);\n  }\n\n  const _castUserDataContextLoadedEvent = (iframe: any, params: any) : void => {\n    iframe.config.contextLoadingPromise.then((userContext:any) => {\n      const userDataContext = {\n        iframeParams : iframe.iframeParams,\n        userContext : userContext\n      };\n\n      // We passed origin as a url to be able to receive postmessages, but some logic is based on params in original url\n      // So we should restore original url\n      userDataContext.iframeParams.url = util.prepareUrlParameter(window.location.href);\n\n      postmessage.send('userDataContextLoaded', userDataContext, params.params.iframeId);\n    });\n  }\n\n  const _logout = (event: any, params: any, sender: string, parent: string, invokeCallbacksOnFire?: boolean) => {\n    user.logout(() => {\n      var config: any = {};\n      const offerType = iframes.find((iframe) => iframe.iframeId === sender)?.config?.offerType;\n\n      if (isUpgradeOffer(offerType)) {\n        containerUtils.closeContainer(sender, parent);\n        return;\n      }\n\n      config.userProvider = user.getProvider().getName();\n      config.userToken = user.getProvider().getToken() && user.getProvider().getToken().length > 0 ? user.getProvider().getToken() : '';\n      config.noNeedStartCheckout = true;\n      _reloadAll(config);\n    }, LOGIN_LOGOUT_SOURCE);\n\n    if (params.closeOnLogout) {\n      containerUtils.closeModalContainer(sender, parent);\n    }\n  }\n\n  const _loginSuccess = (event: any, params: any, sender: string, invokeCallbacksOnFire: boolean) => {\n    params.source = LOGIN_LOGOUT_SOURCE;\n    user.getProvider().onLoginSuccess(params);\n    eventManager.fireCallbacks('loginSuccess', params, sender, invokeCallbacksOnFire);\n\n    if (!isAddedUserProviderCallbacks) {\n      var altConfig = {\n        userToken: params.user_token,\n        user: params.user,\n        reloadAfterLogin: true\n      };\n      _reloadAll(altConfig, sender);\n    }\n  }\n\n  const _getTpConfigurationParameters = (iframeParams: any) => {\n    var propsToCopy = [\n      'debug',\n      'aid',\n      'gaClientId',\n      'tags',\n      'contentSection',\n      'contentAuthor',\n      'debug',\n      'zone'\n    ];\n    propsToCopy.forEach((value: string) => {\n      // @ts-ignore\n      if (pn[value]) {\n        // @ts-ignore\n        iframeParams[value] = pn[value];\n      }\n    });\n\n    if (pn.customVariables) {\n      customVariablesPerIframe[iframeParams.iframeId] = JSON.stringify(pn.customVariables);\n      iframeParams.customVariables = customVariablesPerIframe[iframeParams.iframeId];\n    }\n\n    //iframeParams[\"isUserValid\"] = tp.user.isUserValid() === true;//because function returns true, null or \"\" Was used to catch incorrect integration.\n\n    var contentCreated = pn.contentCreated;\n    if (contentCreated) {\n      iframeParams.contentCreated = contentCreated;\n    }\n\n    if (pn && pn.main) {\n      iframeParams['visitId'] = pn.main.fetchVisitId();\n    }\n    if (pn && pn.util) {\n      const { pageTitle, pageViewId } = pn.util.getPageViewContext();\n      iframeParams['browserId'] = pn.util.getBrowserId();\n      iframeParams['pageViewId'] = pageViewId;\n      iframeParams['pageTitle'] = pageTitle;\n      iframeParams['userState'] = pn.util.getUserState();\n    }\n\n    return iframeParams;\n  }\n\n  const _getConfigurationParameters = (c: any) => {\n    var iframeParams: any = {};\n\n    //transform single id to array\n    if (c.termIds) {\n      if (!(c.termIds instanceof Array)) c.termIds = [c.termIds];\n    }\n\n    var genericProperties: string[] = [\n      'displayMode',\n      'containerSelector',\n      'templateId',\n      'templateVariantId',\n      'offerId',\n      'termId',\n      'termIds',\n      'rid',\n      'aid',\n      'isCheckout',\n      'isOpenedFromInlineCheckout',\n      'pw_id',\n      'paywallId',\n      'width',\n      'preview',\n      'previewUncached',\n      'previewTemplateType',\n      'previewTemplateVersion',\n      'tokenType',\n      'janrainCaptureToken',\n      'closeOnLogout',\n      'voucherCode',\n      'isRedemption',\n      'allowReturnToStartState',\n      'startFromInlineCheckout',\n      'formNameByTermId',\n      'hideCompletedFields',\n      'startFromInlineCheckout',\n      'reloadAfterLogin',\n      'preventReloadAfterLogin',\n      'isAuth',\n      'authStartScreen',\n      'showCloseButton',\n      'closeButtonType',\n      'checkoutFlowId',\n      'offerState',\n      'oid',\n      'promoCode',\n      'promoCodeId',\n      'promoCodeTermId',\n      'rurl_3ds',\n      'thirdPartyParams',\n      'termId3ds',\n      'providerId',\n      'deploymentItemId',\n      'sharedAccountCode',\n      'targetedTermId',\n      'widget',\n      'linkTermCheckoutState',\n      'linkedTermCheckoutState',\n      'purchasedLinkTermData',\n      'purchasedLinkedTermData',\n      'subscriptionId',\n      'experienceActionId',\n      'continuation',\n      'offerType',\n      'termChangeOptionId',\n    ];\n\n    var composerProperties = [\n      'trackingId',\n      'experienceId',\n      // experienceExecutionId,  that parameter is filled in backend from trackingId\n      'experienceActionId',\n      'activeMeters',\n      'directCheckout',\n    ];\n\n    var additionalParamNames = c.additionalParamNames ? c.additionalParamNames : [];\n\n    var propsToCopy = genericProperties.concat(composerProperties, additionalParamNames);\n\n    propsToCopy.forEach((value: string) => {\n      if (c[value]) {\n        iframeParams[value] = c[value];\n      }\n\n      if (value === 'showCloseButton') {\n        if (c[value] === undefined) {\n          iframeParams[value] = true;\n        } else {\n          iframeParams[value] = c[value];\n        }\n      }\n    });\n\n    // override trackingId from query parameter (for loose conversion flow)\n    var trackingId = decodeURIComponent(util.getQueryParamByName('_ptid'));\n    if (trackingId) {\n      iframeParams.trackingId = trackingId;\n      setTrackingIdToGa(trackingId);\n    }\n\n    if (c.preview) {\n      iframeParams.activeMeters = JSON.stringify([{\n        meterName: 'preview-meter',\n        views: 10,\n        viewsLeft: 5,\n        maxViews: 20,\n        totalViews: 20\n      }]);\n    }\n\n    return iframeParams;\n  }\n\n  const _compactConfig = (config: any) => {\n    var displayMode = config.displayMode || 'modal';\n    return [config.offerId, displayMode, config.containerSelector].join('|');\n  }\n\n  const _isLockedConfig = (config: any) => {\n    var jsonConfig = _compactConfig(config);\n    return !!lockedConfigs[jsonConfig];\n  }\n\n  const _lockConfig = (config: any) => {\n    var jsonConfig = _compactConfig(config);\n    lockedConfigs[jsonConfig] = true;\n  }\n\n  const _releaseConfig = (config: any) => {\n    var jsonConfig = _compactConfig(config);\n    delete lockedConfigs[jsonConfig];\n  }\n\n  /**\n   * Creates an offer iframe.\n   *\n   * Look at tp.offer.show for documentation for parameters\n   *\n   * @param c     The configuration for the offer.\n   * @returns {*}\n   * @const\n   */\n  const createOfferIframe = (c: any): IframeInfoInterface => {\n    closeState = 'close';\n\n    readConfigParamsFromHostUrl(c);\n\n    if (typeof (c.displayMode) === 'undefined') {\n      c.displayMode = 'modal';\n    } else if (c.displayMode !== 'modal' && c.displayMode !== 'inline' && c.displayMode !== 'popup') {\n      util.log('Invalid offer displayMode; must be one of: modal, inline, popup');\n      _releaseConfig(c);\n\n      // @ts-ignore\n      return;\n    }\n\n    if (c.displayMode === 'modal' && !c.isPreload && containerUtils.hasModalIframe()) {\n      util.log('Modal offer is already shown; must be one modal offer per time');\n      _releaseConfig(c);\n\n      // @ts-ignore\n      return;\n    }\n\n    // var singleContainer;\n    if (c.displayMode !== 'modal') {\n      const containers = jqUtils.qa(c.containerSelector);\n      if (!c.isPreload) {\n        let iframe: IframeInfoInterface;\n\n        containers.forEach((el: HTMLElement) => {\n          const _c: any = merge({}, c);\n          _c.singleContainer = el;\n          iframe = _createIframe(_c);\n        })\n\n        // @ts-ignore\n        if (iframe) {\n          return iframe; // returns last created iframe\n        }\n      }\n\n      const singleContainer = containers[containers.length - 1];\n      if (singleContainer) {\n        c.singleContainer = singleContainer;\n      }\n    }\n\n    return _createIframe(c);\n  };\n\n  function prepareStatsParams(config: any, params: any) {\n    const { pageTitle, url, referrerUrl, contentType } = util.getPageViewContext();\n\n    params.pageTitle = pageTitle;\n    params.url = url;\n    params.referrerUrl = referrerUrl;\n    params.contentType = contentType;\n  }\n\n  /**\n   * Create iframe with params\n   *\n   * @param config\n   * @const\n   */\n  function _createIframe (config: any, containerWrapper?: any): IframeInfoInterface {\n    var iframeParams = _getConfigurationParameters(config);\n    const initTime = performance.now();\n\n    if (!iframeParams.widget) {\n      iframeParams.widget = 'offer'; // used to tag widget error\n    }\n\n    var tbc = util.getTbcCookie();\n    if (tbc && tbc.length > 0) {\n      iframeParams['tbc'] = tbc;\n    }\n\n    if (config.deferredContextLoading) {\n      iframeParams.iframeId = generateIframeIdFn(config);\n      iframeParams.url = window.location.origin;\n    } else {\n      iframeParams.iframeId = 'offer-' + (frameIdCount++) + '-' + util.randomString();\n      iframeParams.url = util.prepareUrlParameter(window.location.href);\n    }\n\n    const winSize = jqUtils.winSize();\n\n    iframeParams.parentDualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;\n    iframeParams.parentDualScreenTop = window.screenTop !== undefined ? window.screenTop : screen.top;\n    iframeParams.parentWidth = winSize.width ? winSize.width : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;\n    iframeParams.parentHeight = winSize.height ? winSize.height : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;\n    iframeParams.parentOuterHeight = window.outerHeight;\n\n    if (config.previewNonLoggedUser) {\n      iframeParams.previewNonLoggedUser = config.previewNonLoggedUser;\n    }\n\n    if (config.isPreload) {\n      iframeParams.preload = 1;\n    }\n\n    if (pn.locale) {\n      iframeParams.lang = pn.locale;\n    }\n\n    if (!!gaService.getClientId()) {\n      iframeParams.gaClientId = gaService.getClientId();\n    }\n\n    if (!!gaService.getGAAccount()) {\n      iframeParams.gaAccount = gaService.getGAAccount();\n    }\n\n    _getTpConfigurationParameters(iframeParams);\n\n    var hasLoginRequiredCallback = eventManager.hasCallback('loginRequired');\n\n    // we can not detect loginRequired event which was added as tp.addHandler(\"loginRequired\", function(){})\n    // because composer adds empty loginRequired and we can not use this type of event.\n    if (pn.janrain.isConfigured() && (typeof (config.loginRequired) === 'undefined' || !config.loginRequired)) {\n      var hiddenIframes: string[] = [];\n\n      pn.janrain.addEventHandler('onModalClose', () => {\n        containerUtils.activateContainers(hiddenIframes);\n      });\n\n      setUpJanrainCallbacks();\n\n      config.loginRequired = (params: any) => {\n        hiddenIframes = containerUtils.hideModalContainer();\n        loginRequiredAllowReturnToStartState = params.allowReturnToStartState;\n        needReloadOnStartCheckout = false;\n\n        loginRequiredTermId = params.termId;\n        loginRequiredIframeId = iframeParams.iframeId;\n\n        util.waitCall('refreshUserToken', () => {\n          pn.janrain.login(undefined, params);\n        });\n\n        return false;\n      }\n    } else if (pn.gigya.isConfigured() && (typeof (config.loginRequired) === 'undefined' || !config.loginRequired)) {\n      var hiddenIframes: string[] = [];\n\n      pn.gigya.registerCallback('onHide', (params: any) => {\n        if (params && params.afterLogin) {\n          containerUtils.activateContainers(hiddenIframes);\n        } else {\n          pn.offer.close();\n        }\n\n        postmessage.send('gigyaHide', params, loginRequiredIframeId);\n      });\n\n      setUpGigyaCallbacks();\n\n      config.loginRequired = (params: any) => {\n        loginRequiredAllowReturnToStartState = params.allowReturnToStartState;\n        needReloadOnStartCheckout = false;\n        hiddenIframes = containerUtils.hideModalContainer();\n        loginRequiredTermId = params.termId;\n        loginRequiredIframeId = iframeParams.iframeId;\n\n        util.waitCall('refreshUserToken', () => {\n          pn.gigya.login();\n        });\n\n        return false;\n      };\n    } else if (pn.pianoId.isConfigured()) {\n      if ((typeof (config.loginRequired) === 'undefined' || !config.loginRequired)) {\n        config.loginRequired = (params: any) => {\n          if (params.preventExternalLogin) {\n            return;\n          }\n          loginRequiredTermId = params.termId;\n          loginRequiredIframeId = iframeParams.iframeId;\n\n          pn.pianoId.show({screen: params.startScreen});\n          return false;\n        };\n      }\n\n      setUpPianoIdCallbacks();\n\n      iframeParams.pianoIdUrl = pn.pianoId.getIframeUrl();\n      iframeParams.pianoIdStage = pn.pianoId.__protected__.getStage();\n\n      if (config.isGmSso) {\n        iframeParams.isGmSso = config.isGmSso;\n      }\n\n      if (pn.staticDomain) {\n        iframeParams.staticDomain = pn.staticDomain;\n      }\n\n      var lang = pn.pianoId.getLang();\n      if (lang) {\n        iframeParams.lang = lang;\n      }\n      pn.pianoId.onLangChange((lang: string) => {\n        postmessage.send('langChanged', { lang: lang }, iframeParams.iframeId);\n      }, iframeParams.iframeId);\n    } else if (pn.pianoIdLite.isConfigured()) {\n      iframeParams.pianoIdUrl = pn.pianoId.getIframeUrl();\n    }\n\n    iframeParams.userProvider = user.getProvider().getName();\n    if (config.userToken) {\n      iframeParams.userToken = config.userToken;\n    } else {\n      iframeParams.userToken = user.getProvider().getToken() && user.getProvider().getToken().length > 0 ? user.getProvider().getToken() : '';\n    }\n\n    util.getCampaigns(iframeParams);\n    iframeParams.customCookies = JSON.stringify(util.getCustomCookies());\n\n    eventManager.registerCallback(config, iframeParams.iframeId);\n\n    iframeParams.hasLoginRequiredCallback = eventManager.hasIframeCallback('loginRequired', iframeParams.iframeId) || hasLoginRequiredCallback;\n    iframeParams.initMode= \"context\";\n\n    setIframeParamsFromQueryParams(iframeParams);\n\n    var iframeUrl = config.iframeUrl ? config.iframeUrl : (iframeParams.isCheckout ? _getCheckoutBaseUrl() : _getOfferBaseUrl());\n    var postMessageUrl = config.postMessageUrl ? config.postMessageUrl : _getOfferBaseUrl();\n\n    if (config.deferredContextLoading) {\n      var statParams_ = getStatsParams(iframeParams);\n      prepareStatsParams(config, statParams_);\n      config.initContextLoadPromise(config, statParams_);\n    }\n\n    var statParams = extractStatParams(iframeParams, config);\n\n    // Pass Self-serve sessions parameters for Piano ID\n    if (pn.pianoId.__protected__.isSssEnabled()) {\n      const sssParams = pn.pianoId.__protected__.getSssParams();\n      iframeParams.sss_mode = sssParams.sss_mode;\n      iframeParams.sss_callback_url = sssParams.sss_callback_url;\n      iframeParams.sss_origin_url = sssParams.sss_origin_url;\n    }\n\n    // Pass affiliate program params to template to social auth with piano ID\n    if (config.splitTestIds){\n      iframeParams.abTestIds = config.splitTestIds;\n    }\n\n    if (config.socialName) {\n      iframeParams.socialName = config.socialName;\n    }\n\n    if (config.responseType) {\n      iframeParams.responseType = config.responseType;\n    }\n\n    /**\n     * Pass tinypass flag to iframe before checkout initialization.\n     */\n    iframeParams.requestUserAuthForLinkedTerm = tp.requestUserAuthForLinkedTerm;\n\n    iframeParams.initTime = initTime;\n\n    const logType: LogActionType = iframeUrl.indexOf('/offer/') >= 0 ? 'offerShow' : 'templateShow';\n    iframeParams.logType = logType;\n\n    var iframe: IframeInfoInterface = containerUtils.createContainer({\n      url: iframeUrl,\n      config: config,\n      parent: config.parent,\n      postMessageUrl: postMessageUrl,\n      receive: _receive,\n      iframeParams: iframeParams,\n      singleContainer: config.singleContainer,\n      close: () => {\n        eventManager.fireCallbacks('close', { state: closeState }, iframeParams.iframeId, true);\n      }\n    });\n\n    templateIframeParams = iframeUrl.indexOf('/template/') >= 0 && iframeParams.offerId === containerUtils.fakeOfferId ? iframeParams : templateIframeParams;\n\n    setGaParams(\n      iframeParams,\n      'offerId',\n      'width',\n      'termId',\n      'displayMode',\n      'experienceId',\n      'iframeId',\n      'templateId',\n      'templateVariantId'\n    );\n\n    iframe.statParams = statParams;\n    iframe.browserId = config.browserId;\n    iframes.push(iframe);\n\n    return iframe;\n  }\n\n  const checkVisibleImpression = (iframeId: string) => {\n    if (isVisibleImpressionEventSent(iframeId)) {\n      return;\n    }\n\n    if (document.getElementById(iframeId) && !visibleImpressionTrackedIframes.get(iframeId)?.initiatedFirstCheckVisibleImpression) {\n      _setTrackedIframeValue(iframeId, {initiatedFirstCheckVisibleImpression: true});\n      calculateIframeVisibility(iframeId);\n    }\n\n    const iframe = iframes.find((iframe) => iframe.iframeId === iframeId);\n\n    if (iframe?.config.displayMode === 'modal') {\n      modalScrollListener(iframeId);\n    } else {\n      inlineScrollListener(iframeId);\n    }\n  }\n\n  const inlineScrollListener = (iframeId: string): void => {\n    currentIframeId = iframeId;\n    document.addEventListener('scroll', scrollListenerCallback);\n  }\n\n  const scrollListenerCallback = () => {\n    if (shouldRemoveScrollListener()) {\n      document.removeEventListener('scroll', scrollListenerCallback);\n      return;\n    }\n\n    iframes.filter((iframe) => iframe.iframeParams.displayMode === 'inline')?.forEach((iframe) => {\n      calculateIframeVisibility(iframe.iframeId);\n    })\n  };\n\n  const modalScrollListener = (iframeId: string): void => {\n    currentIframeId = iframeId;\n    document.getElementsByClassName('tp-modal')[0]?.addEventListener('scroll', modalScrollListenerCallback);\n  }\n\n  const modalScrollListenerCallback = () => {\n    if (shouldRemoveScrollListener()) {\n      document.getElementsByClassName('tp-modal')[0]?.removeEventListener('scroll', modalScrollListenerCallback);\n      return;\n    }\n\n    iframes.filter((iframe) => iframe.iframeParams.displayMode !== 'inline')?.forEach((iframe) => {\n      calculateIframeVisibility(iframe.iframeId);\n    })\n  };\n\n  const removeScrollListener = (displayMode: string) => {\n    if (displayMode === 'modal') {\n      document.getElementsByClassName('tp-modal')[0]?.removeEventListener('scroll', modalScrollListenerCallback);\n    } else {\n      document.removeEventListener('scroll', scrollListenerCallback);\n    }\n  };\n\n  const shouldRemoveScrollListener = (): boolean => {\n    return iframes.every((item) => !!visibleImpressionTrackedIframes.get(item.iframeId)?.isVisibleImpressionEventSent);\n  }\n\n  const calculateIframeVisibility = (iframeId: string) => {\n    const calculateParams = getCalculateParams(iframeId);\n    if (isVisibleImpressionReached(calculateParams)) {\n      checkPositionAndSendEvent(calculateParams, iframeId);\n    }\n  }\n\n  const getCalculateParams = (iframeId: string): IVisibilityImpressionCalculateData => {\n    const iframeBoundingClientRect = document.getElementById(iframeId)?.getBoundingClientRect();\n\n    return {\n      top: iframeBoundingClientRect?.top || 0,\n      bottom: iframeBoundingClientRect?.bottom || 0,\n      left: iframeBoundingClientRect?.left || 0,\n      right: iframeBoundingClientRect?.right || 0,\n      iframeHeight: iframeBoundingClientRect?.height || 0,\n      iframeWidth: iframeBoundingClientRect?.width || 0,\n      viewportHeight: window.visualViewport?.height || 0,\n      viewportWidth: window.visualViewport?.width || 0,\n    }\n  }\n\n  const checkPositionAndSendEvent = (calculateParams: IVisibilityImpressionCalculateData, iframeId: string) => {\n    setTimeout(function () {\n      if (isVisibleImpressionReached(calculateParams)) {\n        fireVisibleImpressionCallbacks(iframeId);\n      }\n    }, visibilityCheckTiming);\n  }\n\n  const isVisibleImpressionReached = (calculateParams: IVisibilityImpressionCalculateData): boolean => {\n    if (calculateParams.iframeHeight === 0 || calculateParams.iframeWidth === 0) {\n      return false;\n    }\n\n    if (calculateParams.iframeHeight > calculateParams.viewportHeight) {\n      return isVisibleImpressionReachedForHighIframe(calculateParams);\n    } else {\n      return isVisibleImpressionReachedForShortIframe(calculateParams);\n    }\n  }\n\n  const isVisibleImpressionReachedForHighIframe = (calculateParams: IVisibilityImpressionCalculateData): boolean => {\n    if (calculateParams.viewportWidth > calculateParams.iframeWidth) {\n      return(\n        ((calculateParams.top < 0 && Math.abs(calculateParams.top) >= (calculateParams.iframeHeight/2 - calculateParams.viewportHeight) && Math.abs(calculateParams.top) <= calculateParams.iframeHeight/2)) &&\n        ((calculateParams.left >= 0 && calculateParams.left <= (calculateParams.viewportWidth - calculateParams.iframeWidth / 2)) ||\n        (calculateParams.left < 0 && calculateParams.right >= calculateParams.iframeWidth / 2))\n      );\n    } else {\n      return(\n        ((calculateParams.top < 0 && Math.abs(calculateParams.top) >= (calculateParams.iframeHeight/2 - calculateParams.viewportHeight) && Math.abs(calculateParams.top) <= calculateParams.iframeHeight/2)) &&\n        ((calculateParams.left <= 0 && Math.abs(calculateParams.left) >= (calculateParams.iframeWidth/2 - calculateParams.viewportWidth) && Math.abs(calculateParams.left) <= calculateParams.iframeWidth/2))\n      );\n    }\n  }\n\n  const isVisibleImpressionReachedForShortIframe = (calculateParams: IVisibilityImpressionCalculateData): boolean => {\n    if (calculateParams.viewportWidth > calculateParams.iframeWidth) {\n      return(\n        ((calculateParams.top >= 0 && calculateParams.top <= (calculateParams.viewportHeight - calculateParams.iframeHeight / 2)) ||\n        (calculateParams.top < 0 && calculateParams.bottom >= calculateParams.iframeHeight / 2)) &&\n        ((calculateParams.left >= 0 && calculateParams.left <= (calculateParams.viewportWidth - calculateParams.iframeWidth / 2)) ||\n        (calculateParams.left < 0 && calculateParams.right >= calculateParams.iframeWidth / 2))\n      );\n    } else {\n      return(\n        ((calculateParams.top >= 0 && calculateParams.top <= (calculateParams.viewportHeight - calculateParams.iframeHeight / 2)) ||\n        (calculateParams.top < 0 && calculateParams.bottom >= calculateParams.iframeHeight / 2)) &&\n        ((calculateParams.left <= 0 && Math.abs(calculateParams.left) >= (calculateParams.iframeWidth/2 - calculateParams.viewportWidth) && Math.abs(calculateParams.left) <= calculateParams.iframeWidth/2))\n      );\n    }\n  }\n\n  const fireVisibleImpressionCallbacks = (iframeId: string) => {\n    const iframe = iframes.find((iframe) => iframe.iframeId === iframeId);\n    var payload = {\n      event_name: 'piano_frequency_event',\n      event_type: 'visible_impression',\n      experience_Id: iframe?.iframeParams?.experienceId,\n      experience_action_Id: iframe?.iframeParams?.experienceActionId,\n    }\n\n    if (iframe && !isVisibleImpressionEventSent(iframeId) && document.getElementById(iframeId)) {\n      eventManager.fireCallbacks('piano_frequency_event', payload, iframeId, true);\n      _setTrackedIframeValue(iframeId, {isVisibleImpressionEventSent: true});\n    }\n  }\n\n  const isVisibleImpressionEventSent = (id: string): boolean  => {\n    return !!visibleImpressionTrackedIframes.get(id)?.isVisibleImpressionEventSent;\n  }\n\n  const setGaParams = (iframeParams: any, ...paramNames: string[]): void => {\n    const params = paramNames.reduce((paramMap, paramName) => ({\n      ...paramMap,\n      [paramName]: iframeParams[paramName],\n    }), {});\n\n    gaCollectingService.setParamMap(params);\n  };\n\n  const setTrackingIdToGa = (id: string): void => {\n    gaCollectingService.setParam('trackingId', id);\n  }\n\n  const generateIframeIdFn = (config: any): string => {\n    var counter = 0;\n    var hash = \"offer_\" + sha1.hash(config.iframeUrl + '?' + config.buildQueryStringFn(config, jqUtils), 20);\n    if (iframeCounterByTemplateParamsMap.has(hash)) {\n      counter = iframeCounterByTemplateParamsMap.get(hash) + 1;\n    }\n    iframeCounterByTemplateParamsMap.set(hash, counter);\n    return hash + '-' + counter;\n  }\n\n  const setIframeParamsFromQueryParams = (iframeParams: any) => {\n    var termId = util.getQueryParamByName('termId');\n    var paySource = util.getQueryParamByName('paySource');\n    if (termId) {\n      iframeParams.termId = termId;\n    }\n    if (paySource) {\n      iframeParams.paySource = paySource;\n    }\n  }\n\n  const getStatsParams = (iframeParams: any) => {\n    var result: any = {};\n\n    var statsParams = [\n      'tbc',\n      'trackingId',\n      'pageViewId',\n      'visitId',\n      'tags',\n      'contentCreated',\n      'contentSection',\n      'contentAuthor',\n      'pageTitle',\n      'referrerUrl'\n    ];\n\n    statsParams.forEach((value: string) => {\n      if (iframeParams[value]) {\n        result[value] = iframeParams[value];\n      }\n    });\n\n    Object.keys(iframeParams).forEach((key: string) => {\n      if (key.indexOf('tpcc_') === 0) {\n        result[key] = iframeParams[key];\n      }\n    });\n\n    return result;\n  }\n\n  const extractStatParams = (iframeParams: any, config: any) => {\n    var result: any = {};\n\n    if (config.trackStatsOnShow || config.deferredContextLoading) {\n      return result;\n    }\n\n    result = getStatsParams(iframeParams);\n    Object.keys(result).forEach((key: string) => {\n      delete iframeParams[key];\n    });\n\n    return result;\n  }\n\n  const trackStat = (iframe: any) => {\n    let params = merge(iframe.iframeParams, iframe.statParams);\n\n    if (iframe.config.affiliateState) {\n      params.affiliateState = iframe.config.affiliateState;\n    }\n\n    prepareStatsParams(iframe.config, params);\n    postmessage.send('trackStat', params, iframe.iframeId);\n  }\n\n  const passBrowserId = (iframe: any) => {\n    var params = {\n      browserId: iframe.browserId\n    };\n\n    postmessage.send('passBrowserId', params, iframe.iframeId);\n  }\n\n  const passPcidBrowserId = (iframe: IframeInfoInterface) => {\n    postmessage.send('passPcidBrowserId', { browser_id: util.getBrowserId() }, iframe.iframeId);\n  }\n\n  const passCookieConsents = (iframe: IframeInfoInterface) => {\n    postmessage.send('passCookieConsents', util.getCookieConsents(), iframe.iframeId);\n  }\n\n  const passUserSegments = (iframe: IframeInfoInterface) => {\n    postmessage.send('passUserSegments', util.getUserSegmentsString(), iframe.iframeId);\n  }\n\n  const passUserState = (iframe: IframeInfoInterface) => {\n    postmessage.send('passUserState', util.getUserState(), iframe.iframeId);\n  }\n\n  const passPageViewContext = (iframe: IframeInfoInterface) => {\n    const { pageTitle, url, pageViewId, referrerUrl, author, created, section, tags, contentType } = util.getPageViewContext();\n\n    postmessage.send(\n      'passPageViewContext',\n      {\n        page_title: pageTitle,\n        url,\n        page_view_id: pageViewId,\n        referrer: referrerUrl,\n        content_author: author,\n        content_created: created?.toString(),\n        content_section: section,\n        tags: tags ? JSON.stringify(tags) : null,\n        content_type: contentType,\n      },\n      iframe.iframeId\n    );\n  }\n\n  const merge = (firstObj: any, secondObj: any) => {\n    var result: any = {};\n    Object.keys(firstObj).forEach((key: string) => {\n      result[key] = firstObj[key];\n    });\n\n    Object.keys(secondObj).forEach((key: string) => {\n      result[key] = secondObj[key];\n    });\n    return result;\n  }\n\n  const setUpGigyaCallbacks = () => {\n    if (!isAddedUserProviderCallbacks) {\n      pn.gigya.registerCallback('userChanged', (result: any) => {\n        if (result && result.user_token) {\n          let params = {\n            token_list: result.access_token.value,\n            user_token: result.user_token,\n            userToken: result.user_token,\n            cookie_domain: result.access_token.cookie_domain,\n            user: result.user,\n            allowReturnToStartState: loginRequiredAllowReturnToStartState,\n            termId: <string | undefined>loginRequiredTermId\n          };\n\n          if (loginRequiredIframeId) {\n            var iframe = containerUtils.getIframe(loginRequiredIframeId);\n\n            if (iframe) {\n              postmessage.send('externalLoginSuccess', params, loginRequiredIframeId);\n              delete params.termId;\n              _reloadAll(params, loginRequiredIframeId);\n            } else {\n              _reloadAll(params);\n            }\n          } else {\n            _reloadAll(params);\n          }\n        }\n      });\n\n      pn.gigya.registerCallback('logout', () => {\n        var config: any = {};\n        config.userProvider = user.getProvider().getName();\n        config.userToken = user.getProvider().getToken() && user.getProvider().getToken().length > 0 ?\n          user.getProvider().getToken() : '';\n        config.noNeedStartCheckout = true;\n\n        var iframe;\n\n        if (loginRequiredIframeId) {\n          iframe = containerUtils.getIframe(loginRequiredIframeId);\n        }\n\n        if (iframe) {\n          if (iframe.config.displayMode === 'inline') {\n            containerUtils.closeModalContainer();\n          }\n        }\n\n        loginRequiredTermId = '';\n        loginRequiredIframeId = '';\n        loginRequiredAllowReturnToStartState = false;\n\n        _reloadAll(config);\n      });\n      isAddedUserProviderCallbacks = true;\n    }\n  }\n\n  const setUpJanrainCallbacks = () => {\n    if (!isAddedUserProviderCallbacks) {\n      pn.janrain.registerCallback('userChanged', (result: any) => {\n        if (result && result.user_token) {\n          var params = {\n            token_list: result.access_token.value,\n            user_token: result.user_token,\n            userToken: result.user_token,\n            cookie_domain: result.access_token.cookie_domain,\n            user: result.user,\n            allowReturnToStartState: loginRequiredAllowReturnToStartState,\n            termId: <string | undefined>loginRequiredTermId\n          };\n\n          if (loginRequiredIframeId) {\n            var iframe = containerUtils.getIframe(loginRequiredIframeId);\n\n            if (iframe) {\n              postmessage.send('externalLoginSuccess', params, loginRequiredIframeId);\n              delete params.termId;\n              _reloadAll(params, loginRequiredIframeId);\n            } else {\n              _reloadAll(params);\n            }\n          } else {\n            _reloadAll(params);\n          }\n        }\n      });\n\n      pn.janrain.addEventHandler('onCaptureSessionEnded', () => {\n        var config: any = {};\n        config.userProvider = user.getProvider().getName();\n        config.userToken = user.getProvider().getToken() && user.getProvider().getToken().length > 0 ?\n          user.getProvider().getToken() : '';\n        config.noNeedStartCheckout = true;\n\n        var iframe;\n\n        if (loginRequiredIframeId) {\n          iframe = containerUtils.getIframe(loginRequiredIframeId);\n        }\n\n        if (iframe) {\n          if (iframe.config.displayMode === 'inline') {\n            containerUtils.closeModalContainer();\n          }\n        }\n\n        loginRequiredTermId = '';\n        loginRequiredIframeId = '';\n        loginRequiredAllowReturnToStartState = false;\n\n        _reloadAll(config);\n      });\n\n      isAddedUserProviderCallbacks = true;\n    }\n  }\n\n  const setUpPianoIdCallbacks = () => {\n    if (!isAddedUserProviderCallbacks) {\n      pn.pianoId.setCallbacks({\n        loggedIn: (data: any) => {\n          util.log('offer.js - piano id user logged in');\n          var params = {\n            user_token: data.token,\n            userToken: data.token,\n            user: data.user,\n            reloadAfterLogin: true,\n            termId: <string | undefined>loginRequiredTermId,\n          };\n\n          if (loginRequiredIframeId) {\n            var iframe = containerUtils.getIframe(loginRequiredIframeId);\n\n            if (iframe) {\n              postmessage.send('externalLoginSuccess', params, loginRequiredIframeId);\n              reload(loginRequiredIframeId, params);\n              delete params.termId;\n              _reloadAll(params, loginRequiredIframeId);\n            } else {\n              _reloadAll(params);\n            }\n          } else {\n            _reloadAll(params);\n          }\n        },\n        loggedOut: (data: any) => {\n          if (data.source !== LOGIN_LOGOUT_SOURCE) {\n            var config: any = {};\n            config.userProvider = user.getProvider().getName();\n            config.userToken = user.getProvider().getToken() && user.getProvider().getToken().length > 0 ? user.getProvider().getToken() : \"\";\n            config.noNeedStartCheckout = true;\n            _reloadAll(config);\n          }\n          loginRequiredTermId = '';\n          loginRequiredIframeId = '';\n        }\n      });\n      isAddedUserProviderCallbacks = true;\n    }\n  }\n\n  function _applyPreloadIframe (iframe: any) {\n    return containerUtils.showPreloadedContainer(iframe);\n  }\n\n  const _fireCallback = (config: any) => {\n    const event = config.offerId === containerUtils.fakeOfferId ? 'showTemplate' : 'showOffer';\n\n    if (eventManager.hasCallback(event)) {\n      eventManager.fireCallbacks(event, config, undefined, true);\n    }\n\n    sendGAEvent(event, { params: config });\n  };\n\n  const readConfigParamsFromHostUrl = (config: any) => {\n    const POSSIBLE_PREDEFINED_PARAMS = [{\n      queryParam: 'promo_code',\n      configParam: 'promoCode',\n    }];\n    POSSIBLE_PREDEFINED_PARAMS.forEach((param) => {\n      const value = util.getQueryParamByName(param.queryParam);\n      if (value.length) {\n        config[param.configParam] = value;\n      }\n    })\n  }\n\n  const getRurl3ds = () => {\n    return util.getQueryParamByName(PROCESS_3DS_RURL);\n  }\n\n  const isModalOpenOnScaStepWithoutRurl3ds = (config: any) => {\n    const rurl_3ds = getRurl3ds();\n    return rurl_3ds && !config.rurl_3ds && config.displayMode === 'modal';\n  }\n\n  /**\n   * Shows an offer.\n   *\n   * Look at tp.offer.show for documentation for the configuration\n   *\n   * @param config\n   * @const\n   */\n  const _show = (config: any) => {\n    if (!config.offerId && config.preview !== true) {\n      util.error('Must specify offerId');\n      return;\n    }\n\n    if (_isLockedConfig(config)) {\n      return false;\n    }\n\n    // There is a case when tp.offer.show({displayMode: 'modal'}}); invoked before\n    // tp.offer.show({displayMode: 'modal', rurl_3ds: rurl_3ds}});\n    // We can't show 2 modal windows at the same time\n    // Some publishers might show extra modal offer on the page\n    // In case of 3ds redirect, invoking tp.offer.show({displayMode: 'modal'}}); before tp.offer.show({displayMode: 'modal', rurl_3ds: rurl_3ds}}); (which will complete the purchase and show the receipt state)\n    // Will raise an error\n\n    // No need to show any modal checkout without rurl_3ds param in case of 3ds redirect\n    if (isModalOpenOnScaStepWithoutRurl3ds(config)) {\n      return;\n    }\n\n    trackingId = config.trackingId;\n    setTrackingIdToGa(trackingId);\n\n    if (!config.preview && !tp.disableLockConfig) {\n      _lockConfig(config);\n    }\n\n    setTimeout(() => {\n      _releaseConfig(config);\n    }, lockTimeout);\n\n    if (isUpgradeOffer(config.offerType)) {\n      createUpgradeOffer(config);\n    } else {\n      _createOffer(config);\n    }\n  };\n\n  function _createOffer (config: any): void {\n    // const _self = this;\n    util.waitCall('refreshUserToken', () => {\n      // util.waitCall(\"pageTrack\", function () {\n      util.waitCall('refreshAccessTokenList', () => {\n        util.waitCall('myAccountLogin', () => {\n          util.startCall('offerCreate');\n          let iframe: any;\n\n          if (config.createIframeFn) {\n            readConfigParamsFromHostUrl(config);\n            iframe = config.createIframeFn(config);\n          } else {\n            iframe = createOfferIframe(config);\n          }\n\n          if (!iframe) {\n            util.doneCall('offerCreate');\n            util.error('Could not initialize offer; check configuration');\n            return;\n          }\n\n          if (_isDirectCheckout(config)) {\n            _setTrackedIframeValue(iframe.iframeId, {isDirectCheckout: true});\n            _startDirectCheckout(iframe.iframeId);\n          }\n\n          _fireCallback(config);\n        })\n      })\n      // });\n    })\n  }\n\n  function _preload (config: any): any {\n    let resolve: any;\n    let reject: any;\n    const promise = new Promise((res, rej) => {\n      resolve = res;\n      reject = rej;\n    })\n    let ilRes: any;\n    let ilRej: any;\n    const iframeLoadPromise = new Promise((res, rej) => {\n      ilRes = res;\n      ilRej = rej;\n    })\n\n    if (config.displayMode !== 'popup' && config.offerId) {\n      util.waitCall('refreshAccessTokenList', () => {\n        config.isPreload = true;\n\n        util.startCall('offerCreate');\n        let iframe: any;\n        if (config.createIframeFn) {\n          readConfigParamsFromHostUrl(config);\n          iframe = config.createIframeFn(config);\n        } else {\n          iframe = createOfferIframe(config);\n        }\n\n        if (!iframe) {\n          util.doneCall('offerCreate');\n          util.error('Could not initialize offer; check configuration');\n          reject();\n        } else {\n          iframe.element.onload = () => {\n            ilRes(iframe);\n          };\n          resolve(iframe);\n        }\n      });\n    } else {\n      // can't preload popup\n      reject();\n    }\n\n    return {\n      promise,\n      show: function () {\n        promise\n          .then(_applyPreloadIframe)\n          .then(() => {\n            return iframeLoadPromise\n          })\n          .then((iframe: any) => {\n            trackStat(iframe);\n\n            if (_isDirectCheckout(config)) {\n              _startDirectCheckout(iframe.iframeId)\n            }\n\n            _fireCallback(config);\n          }, () => {\n            _show(config);\n            delete config.isPreload;\n          });\n      }\n    };\n  };\n\n  const _isDirectCheckout = (config: any) => {\n    return !!config.directCheckout && config.displayMode !== 'inline';\n  };\n\n  const _startDirectCheckout = (iframeId: string) => {\n    util.waitCall('offerCreate', () => {\n      postmessage.send('startDirectCheckout', {}, iframeId);\n    });\n  };\n\n  const shouldInterruptCheckoutStart = (config: any): boolean => {\n    return !config.offerId && !config.isRedemption && !config.preview;\n  }\n\n  const shouldAuthByGmSsoRedirect = (): boolean => {\n    return pn.pianoId.__protected__.isGmSsoRedirectEnabled() && !pn.pianoId.getToken();\n  }\n\n  const processLinkedTermCheckoutAfterExternalLogin = (\n    { token, termId, iframeId }: { token: string; termId: string; iframeId: string}\n  ): void => {\n    postmessage.send('startLinkedTermProcessAfterExternalLogin', { termId }, iframeId);\n\n    if (needReloadOnStartCheckout) {\n      _reloadAll({\n        userProvider: user.getProvider()?.getName(),\n        userToken: token,\n        noNeedStartCheckout: true,\n        noNeedStartCheckoutAfterLogin: true,\n      });\n\n      needReloadOnStartCheckout = false;\n    }\n  }\n\n  const startCheckout = (config: any, sender: string) => {\n    if (shouldInterruptCheckoutStart(config)) {\n      return;\n    }\n\n    const hasLoginRequiredCallback = eventManager.hasCallback('loginRequired');\n    if (config.isSiteLicensing && hasLoginRequiredCallback && (isUserRef() || isAuthSync())) {\n      template.refreshUser(templateIframeParams.iframeId);\n      return;\n    }\n\n    if (containerUtils.hasModalIframe() && !isLinkedTermCheckout(config)) {\n      containerUtils.closeModalContainer();\n    }\n    util.debug('creating checkout: ', config);\n    config.displayMode = config.displayMode === 'popup' ? 'popup' : 'modal';\n    config.isCheckout = true;\n    config.parent = sender;\n\n    util.waitCall('refreshUserToken', () => {\n      util.waitCall('refreshAccessTokenList', () => {\n        if (isLinkedTermCheckout(config) && config.reloadAfterLogin && isAuthSync()) {\n          const token = user.getProvider()?.getToken();\n\n          if (!token || !config[HIDDEN_SENDER_ID_PROPERTY]) {\n            util.log('external checkout cannot be continued.')\n            return;\n          }\n\n          processLinkedTermCheckoutAfterExternalLogin({\n            token,\n            termId: config.termId,\n            iframeId: config[HIDDEN_SENDER_ID_PROPERTY],\n          });\n\n          return;\n        }\n\n        util.startCall('offerCreate');\n\n        var iframe: any;\n        if (pn.pianoId.__protected__.isGmSso()) {\n          if (shouldAuthByGmSsoRedirect()) {\n            pn.pianoId.__protected__.authByGmSsoRedirect(config);\n            return;\n          }\n          config = { ...config, isGmSso: true };\n        }\n\n        if (config.createIframeFn) {\n          iframe = config.createIframeFn(config);\n        } else {\n          iframe = createOfferIframe(config);\n        }\n\n        containerUtils.__protected__.addChildToInlineIframe(iframe, sender);\n\n        if (!iframe) {\n          util.doneCall('offerCreate');\n          util.error('Could not start checkout; check configuration');\n        } else if (needReloadOnStartCheckout) {\n\n          util.waitCall('offerCreate', () => {\n            needReloadOnStartCheckout = false;\n            var reloadConfig: any = {};\n            reloadConfig.userProvider = user.getProvider().getName();\n            if (user.getProvider().getToken() && user.getProvider().getToken().length > 0) {\n              reloadConfig.userToken = user.getProvider().getToken();\n            } else {\n              reloadConfig.userToken =  '';\n            }\n            reloadConfig.noNeedStartCheckout = true;\n            reloadConfig.noNeedStartCheckoutAfterLogin = true;\n\n            _reloadAll(reloadConfig, iframe.iframeId);\n          });\n        }\n      });\n    });\n  };\n\n  /**\n   * Api method to start linked term checkout by tp.offer.startLinkedTermCheckout call\n   * @param termId {string} - linked term id\n   * @param offerId {string} (optional) - id of the offer which linked term checkout we want to start of\n   */\n  const startLinkedTermCheckout = (termId: string, offerId?: string): void => {\n    if (!iframes.length) {\n      util.debug('there are not offer iframes.');\n      return;\n    }\n\n    if (offerId) {\n      const offerIframe = iframes.find((iframe) => iframe?.config?.offerId === offerId || iframe?.iframeParams?.offerId === offerId);\n\n      if (offerIframe) {\n        postmessage.send('tpStartLinkedTermCheckout', { termId }, offerIframe.iframeId);\n      } else {\n        util.debug(`offer iframe ${offerId} was not found`);\n      }\n\n      return;\n    }\n\n    /**\n     * Offer iframe will be check if it has linked term with this id\n     */\n    iframes.forEach((iframe) => {\n      postmessage.send('tpStartLinkedTermCheckout', { termId }, iframe.iframeId);\n    });\n  }\n\n  const startRedeemVoucher = (config: any, sender?: string) => {\n    containerUtils.closeModalContainer();\n    if (!config) {\n      config = {};\n    }\n    config.isRedemption = true;\n    util.debug('starting redeem voucher: ', config);\n    config.displayMode = config.displayMode === 'popup' ? 'popup' : 'modal';\n    config.isCheckout = false;\n    config.parent = sender;\n    util.waitCall('refreshAccessTokenList', () => {\n      util.startCall('offerCreate');\n\n      var iframe: any;\n      if (config.createIframeFn) {\n        iframe = config.createIframeFn(config);\n      } else {\n        iframe = createOfferIframe(config);\n      }\n\n      if (!iframe) {\n        util.doneCall('offerCreate');\n        util.error('Could not start redeem; check configuration');\n      }\n    });\n  };\n\n  /**\n   * Reload offer with specified iframeId\n   * @param iframeId Identifier of offer\n   * @param config Piece of new configuration for offer\n   * @const\n   */\n  const reload = (iframeId: string, config: any) => {\n    postmessage.send('reloadOffer', config, iframeId);\n  };\n\n  /**\n   * Reload all offer except one (if specified)\n   * @param config Piece of new configuration for offers\n   * @param exceptIframeId Identifier of excepted offer\n   * @const\n   */\n  const _reloadAll = (config: any, exceptIframeId?: string) => {\n    postmessage.broadcast('reloadOffer', config, exceptIframeId);\n  };\n\n  const mergeLoginRequiredParamsWithConfig = (iframe: any, params: any, senderId?: string) => {\n    var config: any = {\n      reloadAfterLogin: true\n    };\n\n    Object.assign(config, iframe.config);\n\n    if (config.singleContainer) {\n      delete config.singleContainer;\n    }\n\n    if (params.termId) {\n      config.termId = params.termId;\n    }\n\n    if (params.term) {\n      config.term = {};\n      config.term = merge(config.term, params.term);\n    }\n\n    if (params.startScreen) {\n      config.startScreen = params.startScreen;\n    }\n\n    if (params.isRedemption) {\n      config.isRedemption = params.isRedemption;\n      config.voucherCode = params.redemption && params.redemption.form && params.redemption.form.redeemCode;\n      config.termId = null;\n    }\n\n    if (params && params.currentState && iframe.config.displayMode === 'modal') {\n      config.allowReturnToStartState = true;\n    }\n\n    if (params.preventExternalLogin) {\n      config.preventExternalLogin = params.preventExternalLogin;\n    }\n\n    if (params.sharedAccountCode) {\n      config.sharedAccountCode = params.sharedAccountCode;\n    }\n\n    if (params.isSiteLicensing) {\n      config.isSiteLicensing = params.isSiteLicensing;\n    }\n\n    if (params.campaignCode) {\n      config.campaignCode = params.campaignCode;\n    }\n\n    if (params.campaignGroupId) {\n      config.campaignGroupId = params.campaignGroupId;\n    }\n\n    if (params.termType) {\n      config[HIDDEN_TERM_TYPE_PROPERTY] = params.termType;\n    }\n\n    if (senderId) {\n      config[HIDDEN_SENDER_ID_PROPERTY] = senderId;\n    }\n\n    config.displayMode = 'modal';\n\n    return config;\n  }\n\n  const checkThreeDSRedirect = () => {\n    var rurl_3ds = getRurl3ds();\n\n    if (rurl_3ds) {\n      var additionalParamsNames: any = {\n        offerId: 'pn_offer_id',\n        oid: 'pn_oid',\n        termId3ds: 'pn_term_id',\n        providerId: 'pn_provider_id',\n        thirdPartyParams: 'third_party_params'\n      };\n\n      var parametersForRemove = [PROCESS_3DS_RURL];\n      var additionalParams = Object.keys(additionalParamsNames).reduce((acc, paramKey) => {\n        var nAcc: any = Object.assign({}, acc);\n        nAcc[paramKey] = util.getQueryParamByName(additionalParamsNames[paramKey]);\n        parametersForRemove.push(additionalParamsNames[paramKey]);\n        return nAcc;\n      }, {});\n\n      util.removeQueryParamByName(parametersForRemove);\n\n      _show(Object.assign({\n          displayMode: 'modal',\n          rurl_3ds: rurl_3ds\n        },\n        additionalParams\n      ));\n    }\n  };\n\n  const name = 'offer';\n\n  /**\n   * Shows an offer on the page.\n   *\n   * @param config\n   * The parameters that can get specified are:\n   *\n   *     offerId (required):\n   *         The id of the offer being loaded, found in the publisher dashboard\n   *\n   *     templateId (required):\n   *         The id of the template being loaded, found in the publisher dashboard\n   *\n   *     displayMode (optional; default=modal):\n   *         Configures the display mode of the offer/template. Valid options\n   *         are: inline, modal. Inline requires that a containerSelector is specified.\n   *\n   *         When set to modal, the semi-transparent backdrop will appear and the\n   *         offer and template will appear in an iframe in the middle of the browser.\n   *\n   *         When set to inline, the iframe will get loaded in the\n   *\n   *     containerSelector (conditionally required):\n   *         The jQuery selector that targets a single DOM element on the page that the\n   *         offer and template should appear in. For example a containerSelector of\n   *         \".tp-offer-form\" should be used if there were one, and only one:\n   *\n   *             <div class=\"tp-offer-form\"></div>\n   *\n   *         that resided on the page that the offer+template should appear in.\n   *\n   *         This option is only used when displayMode is inline, and must be a valid\n   *         selector for a single DOM element on the page.\n   *\n   *     close (optional):\n   *         A callback that fires when the user dismisses a modal. This event only fires\n   *         when the user dismisses an iframe that is in modal mode.\n   *\n   *     cancel (optional):\n   *         A callback that fires when the user cancels a transaction.\n   *\n   *     complete (optional):\n   *         A callback that fires when the user completes a transaction.\n   *\n   *     customEvent (optional):\n   *         A callback that fires when the user performs an action in the template that\n   *         the publisher has configured to listen for.\n   *\n   *         For example, a publisher might implement code on their website such as:\n   *\n   *         tp.offer.show({\n   *             // all required fields, plus\n   *             customEvent : function(event) {\n   *                 switch(event.params.eventName) {\n   *                     case \"login\":\n   *                         window.location.href = \"/login\";\n   *                         break;\n   *                 }\n   *             }\n   *         });\n   *\n   *         In their template, their markup would contain:\n   *\n   *             <a href=\"#\" ng-click=\"customEvent('login')\">Login</a>\n   *\n   *         This callback would get fired when the user clicked Login from within template.\n   *\n   *     offerType (optional):\n   *         The offer type of the offer being loaded, can be upgradeOffer or purchaseOffer.\n   *\n   */\n  const show = (config: any): void => {\n    if (config.displayMode === 'inline') {\n      containerUtils.operationWithContainer(config.containerSelector, () => {\n        _show(config);\n      });\n    } else {\n      _show(config);\n    }\n  }\n\n  const deferredShow = (config: any): any => {\n    return _preload(config);\n  }\n\n  const close = () => {\n    containerUtils.closeModalContainer();\n  }\n\n  const closeInline = (selector: string) => {\n    containerUtils.__protected__.closeInlineContainers(selector);\n  }\n\n  const showBackdrop = () => {\n    containerUtils.showBackdrop();\n  }\n\n  const hideBackdrop = () => {\n    containerUtils.hideBackdrop();\n  }\n\n  const centerBackdrop = (container: any) => {\n    containerUtils.centerBackdrop(container);\n  }\n\n  const registerCallback = (callbackName: string, callback: Function) => {\n    eventManager.addEvent(callbackName);\n    eventManager.registerCallback(callbackName, callback);\n  }\n\n  const reloadAll = (config: any, exceptIframeId: string) => {\n    var initConfig = config || {};\n    util.waitCall(\"refreshUserToken\", () => {\n      _reloadAll(Object.assign(initConfig, { userToken: pn.user.getProvider().getToken() }), exceptIframeId);\n    });\n  }\n\n  const resetUserAndReloadAll = (config: any, exceptIframeId: string) => {\n    var initConfig = config || {};\n\n    _reloadAll(Object.assign(initConfig, { userToken: '' }), exceptIframeId);\n  }\n\n  const isUserRef = () => {\n    return user.getProvider().getName() === 'publisher_user_ref';\n  }\n\n  const isAuthSync = () => {\n    return user.getProvider().getName() === 'piano_id_lite';\n  }\n\n  /**\n   * Check if linked term checkout was started through common tp.offer.startCheckout\n   * @param config - startCheckout config with possible hidden keys which are set in loginRequired event\n   * @returns {boolean}\n   */\n  const isLinkedTermCheckout = (config: {\n    [key: string]: unknown;\n    [HIDDEN_TERM_TYPE_PROPERTY]?: LINKED_TERM_TYPES;\n  }): boolean => {\n    const isLinkedTerm = config[HIDDEN_TERM_TYPE_PROPERTY] === LINKED_TERM_TYPES.LINKED;\n    const isLinkedTermBackwardCompatibility = config[HIDDEN_TERM_TYPE_PROPERTY] === LINKED_TERM_TYPES.LINK;\n\n    return isLinkedTerm || isLinkedTermBackwardCompatibility;\n  }\n\n  const shouldCheckVisibilityOnInit = (iframe: any): boolean => {\n    return iframe?.iframeParams?.experienceId && iframe?.iframeParams?.experienceActionId && getCalculateParams(iframe.iframeId).iframeWidth !== 0 && getCalculateParams(iframe.iframeId).iframeHeight !== 0;\n  }\n\n  const isUpgradeOffer = (offerType: string): boolean => {\n    return offerType === OFFER_TYPES.UPGRADE;\n  }\n\n  const shouldCreateUpgradeOffer = (config: any): Promise<boolean> => {\n    const upgradeOfferParams = user.getUserInfoParams(config);\n    upgradeOfferParams.user_provider = user.getProvider().getName();\n    upgradeOfferParams.aid = pn.aid;\n    upgradeOfferParams.offer_id = config.offerId;\n\n    return new Promise((resolve, reject) => {\n      api.callApi(\n        '/anon/term/change/offer/hasData',\n        upgradeOfferParams,\n        ({\n           code,\n           data,\n         }: { code: number, data : boolean  } ) => {\n        if (code === 0) {\n          resolve(data);\n        } else {\n          reject(code);\n        }\n      }, undefined, undefined)\n    })\n  }\n\n  const continueCreateUpgradeOffer = (config: any): void => {\n    shouldCreateUpgradeOffer(config)\n      .then((response : boolean) => {\n        if (response || config.preview) {\n          _createOffer(config);\n        }\n      })\n  }\n\n  const createUpgradeOffer = (config: any): void => {\n    tp.enableDoubleOptInCheckOnAccessCheck();\n\n    if ((user.isUserValid() && user.isUserConfirmed()) || config.preview) {\n      continueCreateUpgradeOffer(config)\n    } else if ((user.isUserValid() && !user.isUserConfirmed())) {\n      showDoubleOptInForm(config);\n    } else {\n      showLoginForm(config);\n    }\n  }\n\n  const showDoubleOptInForm = (config: unknown): void => {\n    pn.doubleOptIn.check();\n    setUserProviderCallbackToPreCheck(config);\n  }\n\n  const showLoginForm = (config: unknown): void => {\n    user.showLogin({});\n    setUserProviderCallbackToPreCheck(config);\n  }\n\n  const setUserProviderCallbackToPreCheck = (config: any): void => {\n    const isNotLoginRequired = typeof (config.loginRequired) === 'undefined' || !config.loginRequired;\n\n    if (pn.janrain.isConfigured() && isNotLoginRequired) {\n      handleJanrainUserChangedForUpgradeOffer(config);\n      return;\n    }\n\n    if (pn.gigya.isConfigured() && isNotLoginRequired) {\n      handleGigyaUserChangedForUpgradeOffer(config);\n      return;\n    }\n\n    if (pn.pianoId.isConfigured()) {\n      handlePianoIdUserChangedForUpgradeOffer(config);\n      return;\n    }\n  }\n\n  const handleJanrainUserChangedForUpgradeOffer = (config: unknown): void => {\n    pn.janrain.registerCallback('userChanged', (result: { user_token: string }) => {\n      if (result && result.user_token) {\n        continueCreateUpgradeOffer(config);\n      }\n    });\n  }\n\n  const handleGigyaUserChangedForUpgradeOffer = (config: unknown): void => {\n    pn.janrain.registerCallback('userChanged', (result: { user_token: string }) => {\n      if (result && result.user_token) {\n        continueCreateUpgradeOffer(config);\n      }\n    });\n  }\n\n  const handlePianoIdUserChangedForUpgradeOffer = (config: unknown): void => {\n    pn.pianoId.setCallbacks({\n      loggedIn: (data: { user: { confirmed: boolean } }) => {\n        if (user.isUserValid() && data.user?.confirmed) {\n          continueCreateUpgradeOffer(config);\n        }\n      },\n    });\n  }\n\n  return {\n    name,\n    /**\n     * Shows an offer on the page.\n     *\n     * @param config\n     * The parameters that can get specified are:\n     *\n     *     offerId (required):\n     *         The id of the offer being loaded, found in the publisher dashboard\n     *\n     *     templateId (required):\n     *         The id of the template being loaded, found in the publisher dashboard\n     *\n     *     displayMode (optional; default=modal):\n     *         Configures the display mode of the offer/template. Valid options\n     *         are: inline, modal. Inline requires that a containerSelector is specified.\n     *\n     *         When set to modal, the semi-transparent backdrop will appear and the\n     *         offer and template will appear in an iframe in the middle of the browser.\n     *\n     *         When set to inline, the iframe will get loaded in the\n     *\n     *     containerSelector (conditionally required):\n     *         The jQuery selector that targets a single DOM element on the page that the\n     *         offer and template should appear in. For example a containerSelector of\n     *         \".tp-offer-form\" should be used if there were one, and only one:\n     *\n     *             <div class=\"tp-offer-form\"></div>\n     *\n     *         that resided on the page that the offer+template should appear in.\n     *\n     *         This option is only used when displayMode is inline, and must be a valid\n     *         selector for a single DOM element on the page.\n     *\n     *     close (optional):\n     *         A callback that fires when the user dismisses a modal. This event only fires\n     *         when the user dismisses an iframe that is in modal mode.\n     *\n     *     cancel (optional):\n     *         A callback that fires when the user cancels a transaction.\n     *\n     *     complete (optional):\n     *         A callback that fires when the user completes a transaction.\n     *\n     *     customEvent (optional):\n     *         A callback that fires when the user performs an action in the template that\n     *         the publisher has configured to listen for.\n     *\n     *         For example, a publisher might implement code on their website such as:\n     *\n     *         tp.offer.show({\n     *             // all required fields, plus\n     *             customEvent : function(event) {\n     *                 switch(event.params.eventName) {\n     *                     case \"login\":\n     *                         window.location.href = \"/login\";\n     *                         break;\n     *                 }\n     *             }\n     *         });\n     *\n     *         In their template, their markup would contain:\n     *\n     *             <a href=\"#\" ng-click=\"customEvent('login')\">Login</a>\n     *\n     *         This callback would get fired when the user clicked Login from within template.\n     *\n     */\n    show,\n    deferredShow,\n    close,\n    closeInline,\n    startCheckout,\n    startLinkedTermCheckout,\n    startRedeemVoucher,\n    createOfferIframe,\n    showBackdrop,\n    hideBackdrop,\n    centerBackdrop,\n    registerCallback,\n    reload,\n    reloadAll,\n    resetUserAndReloadAll,\n    checkThreeDSRedirect,\n    passUserSegments,\n    passCookieConsents,\n    passUserState,\n  };\n\n});\n\npn.container.register('offer', {\n  useValue: offer()\n});\npn.offer = pn.container.resolve<OfferInterface>('offer');\n", "import { UtilInterface } from \"./util\";\nimport { PianoIdInterface } from \"./pianoId\";\nimport { PostmessageInterface } from \"./postmessage\";\nimport { OfferInterface } from \"./offer\";\nimport { UserInterface } from \"./user\";\nimport { ContainerUtilsInterface, IframeInfoInterface, IframesInfoMapInterface } from \"./containerUtils\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { LoggingInterface } from \"./logging\";\nimport { MicrosoftQuickAuth } from \"./pianoId/features\";\nimport { ACP_MYACCOUNT_EVENTS, AcpInterface } from \"./acp\";\n\nexport interface MyaccountInterface {\n  name: string;\n\n  show(config: any): void;\n\n  registerCallback(callbackName: string, callback: Function): void;\n}\n\nconst myaccount = ((): MyaccountInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const offer = pn.container.resolve<OfferInterface>('offer');\n  const user = pn.container.resolve<UserInterface>('user');\n  const containerUtils = pn.container.resolve<ContainerUtilsInterface>('containerUtils');\n  const pianoId = pn.container.resolve<PianoIdInterface>('pianoId');\n  const logging = pn.container.resolve<LoggingInterface>('logging');\n  const msqa = pn.container.resolve<MicrosoftQuickAuth>(\"microsoftQuickAuth\");\n  const acp = pn.container.resolve<AcpInterface>('acp');\n\n  const name = 'myaccount';\n\n  const VERIFICATION_CODE_QUERY = 'verification_code';\n\n  const iframes: IframesInfoMapInterface = {};\n\n  let tooTall = false;\n\n  const callbacks: any = {\n    loginRequired: [],\n    loginSuccess: [],\n    autoRenewalDisabled: [],\n    subscriptionCancellation: [],\n  };\n\n  const _getBaseUrl = () => {\n    return pn.getEndpointRoot() + '/checkout/myaccount/show';\n  };\n\n  const _createContainer = (): HTMLElement => {\n    var container = document.createElement('div');\n    jqUtils.addClass('tp-modal', container);\n    var close = document.createElement('div');\n    jqUtils.addClass('tp-close', close);\n    jqUtils.append(container, close);\n    jqUtils.append(document.body, container);\n    return container;\n  };\n\n  const _resizeIframe = (iframe: any, params: any) => {\n    iframe.element.style.height = (iframe.config.maxHeight ?\n        Math.min(params.height, iframe.config.maxHeight)\n        : params.height) + 'px';\n    iframe.container.style.height = (iframe.config.maxHeight ?\n        Math.min(params.height, iframe.config.maxHeight)\n        : params.height) + 'px';\n    iframe.element.style.width = params.width + 'px';\n    if (iframe.config.displayMode === 'modal') {\n      iframe.container.style.width = params.width + 'px';\n    }\n    postmessage.send('resized', {\n      height: (iframe.config.maxHeight ?\n        Math.min(params.height, iframe.config.maxHeight)\n        : params.height),\n      width: params.width\n    }, iframe.iframeId);\n  };\n\n  let dialog: HTMLElement;\n\n  const _createDialog = (params: any, onClose: Function) => {\n    const container = document.createElement('div');\n    jqUtils.addClass('tp-modal', container);\n    const close = document.createElement('div');\n    jqUtils.addClass('tp-close', close);\n    const message = document.createElement('div');\n    jqUtils.addClass('tp-message', message);\n    container.style.width = (params.width ? params.width : 400) + 'px';\n\n    message.innerHTML = params.message;\n\n    const btnContainer = document.createElement('div');\n    jqUtils.addClass('tp-btn-container', btnContainer);\n\n    // var okBtn = $(document.createElement('button')).addClass('tp-btn').addClass('tp-ok-btn');\n    const okBtn = document.createElement('button');\n    jqUtils.addClass('tp-btn', okBtn);\n    jqUtils.addClass('tp-ok-btn', okBtn);\n    okBtn.innerHTML = (params.ok ? params.ok : 'Ok');\n    // var cancelBtn = $(document.createElement('button')).addClass('tp-btn').addClass('tp-cancel-btn');\n    const cancelBtn = document.createElement('button');\n    jqUtils.addClass('tp-btn', cancelBtn);\n    jqUtils.addClass('tp-cancel-btn', cancelBtn);\n    cancelBtn.innerHTML = (params.cancel ? params.cancel : 'Cancel');\n\n    jqUtils.on(close, 'click', _closeDialog(onClose, params, 'cancel'));\n    jqUtils.on(cancelBtn, 'click', _closeDialog(onClose, params, 'cancel'));\n    jqUtils.on(okBtn, 'click', _closeDialog(onClose, params, 'ok'));\n\n    jqUtils.append(container, close);\n    jqUtils.append(container, message);\n    jqUtils.append(btnContainer, okBtn);\n    jqUtils.append(btnContainer, cancelBtn);\n    jqUtils.append(container, btnContainer);\n\n    jqUtils.append(document.body, container);\n\n    offer.showBackdrop();\n    // container.addClass('tp-active');\n    jqUtils.addClass('tp-active', container);\n    _centerIt(container);\n\n    dialog = container;\n  };\n\n  const _closeDialog = (onClose: Function, params: any, result: any) => {\n    return () => {\n      if (dialog) {\n        jqUtils.removeClass('tp-active', dialog);\n        offer.hideBackdrop();\n        window.setTimeout(() => {\n          // @ts-ignore\n          jqUtils.remove(dialog);\n        }, 250);\n        params.result = result;\n        onClose(params);\n      }\n    };\n  };\n\n  const _centerIt = (container: HTMLElement) => {\n    const winSize = jqUtils.winSize();\n    if (container.offsetHeight > winSize.height) {\n      if (tooTall === false) {\n        container.style.position = 'absolute';\n        tooTall = true;\n      }\n      container.style.marginTop = (window.scrollY - (winSize.height * .5)) + '';\n      // container.css({ marginTop: $(window).scrollTop() - ($(window).height() * .5) });\n    } else {\n      if (tooTall === true) {\n        container.style.position = 'fixed';\n        tooTall = false;\n      }\n      container.style.marginTop = (0 - (container.offsetHeight * .5)) + '';\n      // container.css({ marginTop: 0 - (container.outerHeight() * .5) });\n    }\n    offer.centerBackdrop(container);\n    // container.css({ marginLeft: 0 - (container.outerWidth() * .5) });\n    container.style.marginLeft = (0 - (container.offsetWidth * .5)) + '';\n  }\n\n  const _openDialog = (event: any, params: any) => {\n    _createDialog(params.params, (result: any) => {\n      postmessage.send('closeDialog', result, iframes[params.sender].iframeId);\n    });\n  };\n\n  /**\n   * This registers a callback for a certain event. When _fireCallbacks() is\n   * called, every callback that has been registered via this method will get\n   * called.\n   *\n   * @param event     The event name, e.g. onMeterExpired\n   * @param callback  The callback function to be executed\n   * @const\n   */\n  const registerCallback = (event: string, callback: Function) => {\n    callbacks[event] = callbacks[event] || [];\n    callbacks[event].push(callback);\n  };\n\n  /**\n   * Fires events for a specific callback. Will call every callback registered\n   * using _registerCallback()\n   *\n   * @param event   The event that has fired\n   * @param object  An object to pass to the callback\n   * @const\n   */\n  const _fireCallbacks = (event: string, object: any, iframeId: string) => {\n    util.debug('received event: ' + event, object);\n    if (typeof (callbacks[event]) === 'undefined') {\n      return;\n    }\n    for (var i = 0; i < callbacks[event].length; ++i) {\n      util.debug('firing callback for event: ' + event);\n      var result = callbacks[event][i](object);\n\n      if (object && object.resultCallbackId) {\n        object.result = result;\n        object.event = event;\n        postmessage.send('resultCallback', object, iframeId);\n      }\n    }\n\n    if (!callbacks[event].length && object && object.resultCallbackId) {\n      object.callbackNotFound = true;\n      object.event = event;\n      postmessage.send('resultCallback', object, iframeId);\n    }\n  };\n\n  const _receive = (params: any) => {\n    util.log('*** My account event received', params.event, params.params);\n    switch (params.event) {\n      case 'resize':\n        util.debug('*** Resize event', params.params.width, params.params.height);\n        _resizeIframe(iframes[params.sender], params.params);\n        if (iframes[params.sender].config.displayMode === 'modal') {\n          _centerIt(iframes[params.sender].container);\n        }\n        break;\n      // case 'startCheckout':\n      //   _startCheckout(params.params);\n      //   break;\n      case 'loaded':\n          const loadedIframe = iframes[params.sender];\n        postmessage.send('initMaxHeight', {\n          height: loadedIframe.config.maxHeight\n        }, loadedIframe.iframeId);\n\n        pn.offer.passCookieConsents(loadedIframe);\n        pn.offer.passUserSegments(loadedIframe);\n        pn.offer.passUserState(loadedIframe);\n\n        _resizeIframe(loadedIframe, params.params);\n\n        if (user.getProvider().name === 'pianoId') {\n          pianoId.__protected__.executePostMessagesBatch();\n        }\n\n        if (loadedIframe.config.displayMode === 'modal') {\n          // backdrop.show();\n          window.setTimeout(() => {\n            // backdrop.addClass('tp-active');\n            jqUtils.addClass('tp-active', loadedIframe.container);\n            _centerIt(loadedIframe.container);\n          }, 25);\n        }\n\n        logging.setTime('myAccountShow', Math.floor(performance.now() - loadedIframe.config.initTime));\n\n        break;\n      // case 'close':\n      //   _closeContainer();\n      //   break;\n      case 'cancel':\n      case 'complete':\n      case 'error':\n      case 'loginRequired':\n      case 'customEvent':\n      case 'completeUpgradePurchase':\n        _fireCallbacks(params.event, params.params, params.sender);\n        break;\n      case 'openDialog':\n        _openDialog(params.event, params);\n        break;\n      case 'pianoIdProfileUpdated':\n        pianoId.onProfileUpdate(params.params, () => {\n          var object = params.params;\n          if (object && object.resultCallbackId) {\n            postmessage.send('resultCallback', object, params.sender);\n          }\n          const config = {\n            userToken: params.params.token,\n            user: params.params.user\n          }\n          _reload(config);\n        });\n        break;\n      case 'extendedUserLoginRequired':\n        pianoId.onExtendedUserLoginRequired();\n        break;\n      case 'loginSuccess':\n        user.getProvider().onLoginSuccess(params.params);\n\n        var config = {\n          reloadAfterLogin: true,\n          userToken: params.params.user_token,\n          user: params.params.user\n        };\n        _reload(config);\n        _fireCallbacks(params.event, params.params, params.sender);\n        break;\n      case 'logout':\n        user.logout(() => {\n          var config: any = {};\n          config.userProvider = user.getProvider().getName();\n          config.userToken = user.getProvider().getToken() && user.getProvider().getToken().length > 0 ? user.getProvider().getToken() : '';\n          _reload(config);\n        });\n        _fireCallbacks(params.event, params.params, params.sender);\n        break;\n      case 'userProfileUpdateSuccess':\n        var message = params;\n\n        var messageEvent = message.event;\n        var messageParams = message.params;\n        var messageSender = message.sender;\n\n        user.getProvider().onLoginSuccess(messageParams);\n\n        var reloadConfig = {\n          userProvider: messageParams.user_provider,\n          userToken: messageParams.user_token\n        };\n\n        _reload(reloadConfig);\n\n        _fireCallbacks(messageEvent, messageParams, messageSender);\n\n        for (var key in iframes) {\n          if (iframes.hasOwnProperty(key)) {\n            var iframe = iframes[key];\n\n            var iframeConfig = iframe.config;\n\n            if (iframeConfig.hasOwnProperty('userToken')) {\n              delete iframeConfig.userToken;\n            }\n\n            show(iframeConfig);\n          }\n        }\n\n        break;\n      case 'langChangedWithinMyAccount':\n        if (pianoId.isConfigured()) {\n          pianoId.updateLang(params.params.lang);\n        }\n        break;\n      case 'requestScrollData':\n        _returnScrollData(params.sender);\n        break;\n      case 'downForMaintenance' :\n        _resizeIframe(iframes[params.sender], { width: 300, height: 200 });\n        break;\n      case 'removeQueryParamByName':\n        if (Array.isArray(params.params.paramsToRemove)) {\n          params.params.paramsToRemove.forEach((name: string) => {\n            util.removeQueryParamByName(name);\n          });\n        }\n        break;\n      case 'getTrackingData':\n        postmessage.send('getTrackingDataResponseEvent', { pageViewId: pn.main.fetchPageViewId(), tbc: util.getTbcCookie() }, params.sender);\n        break;\n      case 'redirect':\n        document.location.href = params.params.url;\n        break;\n      case 'getTemplateInteractionConfig':\n        acp.sendTemplateInteractionActive(iframes[params.sender].config);\n        break;\n      case ACP_MYACCOUNT_EVENTS.autoRenewalDisabled:\n      case ACP_MYACCOUNT_EVENTS.subscriptionCancellation:\n        acp.handleAcpEvent(_fireCallbacks, params, iframes[params.sender].config, true);\n        break;\n      default:\n        util.log('Received invalid event type: ' + params.event);\n        return;\n    }\n  };\n\n  const _reload = (config: any) => {\n    postmessage.broadcast('reloadOffer', config);\n  };\n\n  const _handleKeystroke = (event: any) => {\n    // if (event.keyCode === 27 && $.map(iframes, util.mapArrayIndex).length > 0) {\n    //   _closeContainer();\n    // }\n  };\n\n  const _returnScrollData = (senderId: string) => {\n\n    var myAccountRect = iframes[senderId].element.getBoundingClientRect();\n    var data = {\n      iframeRect: {\n        // `ClientRect` object is not passed directly because in Edge it becomes an empty\n        // object when passed via post message.\n        bottom: myAccountRect.bottom,\n        height: myAccountRect.height,\n        left: myAccountRect.left,\n        right: myAccountRect.right,\n        top: myAccountRect.top,\n        width: myAccountRect.width\n      }\n    };\n\n    postmessage.send('returnScrollData', data, senderId);\n  };\n\n  const _checkIframeSizes = () => {\n    for (var iframeId in iframes) {\n      var iframe = iframes[iframeId];\n      var needToSend = false;\n      const iframeContainerWidth = jqUtils.getWidth(iframe.container);\n      if (iframeContainerWidth !== iframe.containerWidth) {\n        iframe.element.style.width = iframeContainerWidth + '';\n        iframe.containerWidth = iframeContainerWidth;\n        needToSend = true;\n      }\n      const iframeContainerHeight = jqUtils.getHeight(iframe.container);\n      if (iframeContainerHeight !== iframe.containerHeight) {\n        // iframe.element.css('height', iframe.container.height());\n        iframe.element.style.height = iframeContainerHeight + '';\n        iframe.containerHeight = iframeContainerHeight;\n        needToSend = true;\n      }\n      if (needToSend) {\n        postmessage.send('resize', {\n          width: iframeContainerWidth,\n          height: iframeContainerHeight\n        }, iframeId);\n      }\n    }\n  };\n\n  function _createIframe (config: any): Promise<IframeInfoInterface> {\n    config.initTime = performance.now();\n    var iframeParams: any = {\n      widget: 'myaccount' // used to tag the widget errors;\n    };\n\n    if (pn.staticDomain) {\n      iframeParams.staticDomain = pn.staticDomain;\n    }\n\n    if (config.templateId) {\n      iframeParams.templateId = config.templateId;\n    }\n\n    if (typeof (config.displayMode) === 'undefined') {\n      config.displayMode = 'inline';\n    } else {\n      if (config.displayMode !== 'modal' && config.displayMode !== 'inline') {\n        util.log('Invalid offer displayMode; must be one of: modal, inline');\n        // @ts-ignore\n        return;\n      }\n    }\n    iframeParams.displayMode = config.displayMode;\n    iframeParams.iframeId = util.randomString(16);\n    iframeParams.url = window.location.href;\n    iframeParams.initialWidth = config.width;\n    iframeParams.initialHeight = config.height;\n    iframeParams.maxHeight = config.maxHeight;\n    iframeParams.v3ApiEndpoint = pn.getApiEndpoint();\n\n    // Self-serve session feature\n    if (user.getProvider().getName() === pianoId.getName() && pianoId.__protected__.isSssEnabled()) {\n      const params = pianoId.__protected__.getSssParams();\n      iframeParams.piano_id_sss_mode = params.sss_mode;\n      iframeParams.piano_id_sss_callback_url = params.sss_callback_url;\n      iframeParams.piano_id_sss_origin_url = params.sss_origin_url;\n    }\n\n    if(pn.locale){\n      iframeParams.lang = pn.locale;\n    }\n\n    if (pn.janrain.isConfigured() && (typeof (config.loginRequired) === 'undefined' || !config.loginRequired)) {\n      var hiddenIframes: string[] = [];\n      var savedOfferConfig = config;\n\n      pn.janrain.addEventHandler('onModalClose', () => {\n        containerUtils.activateContainers(hiddenIframes);\n        util.doneCall('myAccountLogin');\n      });\n\n      pn.janrain.registerCallback('userChanged', (result: any) => {\n        if (result && result.user_token) {\n          var loginSuccessResult;\n          if (config.loginSuccess) {\n            loginSuccessResult = config.loginSuccess(result);\n          }\n          if (typeof (loginSuccessResult) === 'undefined' || loginSuccessResult) {\n            savedOfferConfig.userToken = result.user_token;\n            show(savedOfferConfig);\n          }\n        }\n      });\n\n      pn.janrain.addEventHandler('onCaptureSessionEnded', (result: any) => {\n        var loginSuccessResult;\n        if (config.loginSuccess) {\n          loginSuccessResult = config.loginSuccess(result);\n        }\n        if (typeof (loginSuccessResult) === 'undefined' || loginSuccessResult) {\n          savedOfferConfig.userToken = null;\n          show(savedOfferConfig);\n        }\n      });\n\n      config.loginRequired = () => {\n        // util.waitCall(\"pageTrack\", function () {\n        util.waitCall('refreshAccessTokenList', () => {\n          util.waitCall('offerCreate', () => {\n            util.startCall('myAccountLogin');\n\n            hiddenIframes = containerUtils.hideModalContainer();\n            pn.janrain.login();\n          });\n        });\n        // });\n\n        return false;\n      };\n    } else if (pn.gigya.isConfigured() && (typeof (config.loginRequired) === 'undefined' || !config.loginRequired)) {\n      var hiddenIframes: string[] = [];\n\n      pn.gigya.registerCallback('onHide', () => {\n        containerUtils.activateContainers(hiddenIframes);\n        util.doneCall('myAccountLogin');\n      });\n\n      config.loginRequired = () => {\n        var savedOfferConfig = config;\n        util.waitCall('refreshAccessTokenList', () => {\n          util.waitCall('offerCreate', () => {\n            util.startCall('myAccountLogin');\n            hiddenIframes = containerUtils.hideModalContainer();\n            pn.gigya.login((result: any) => {\n              var loginSuccessResult;\n              if (config.loginSuccess) {\n                loginSuccessResult = config.loginSuccess(result);\n              }\n              if (typeof (loginSuccessResult) === 'undefined' || loginSuccessResult) {\n                savedOfferConfig.userToken = result.user_token;\n                show(savedOfferConfig);\n              }\n            });\n          });\n        });\n      };\n    } else if (pn.pianoId.isConfigured()) {\n      var savedOfferConfig = config;\n      pn.pianoId.setCallbacks({\n        loggedIn: (result: any) => {\n          if (iframeParams.userToken === result.token) {\n            return;\n          }\n          var loginSuccessResult;\n          if (config.loginSuccess) {\n            loginSuccessResult = config.loginSuccess(result);\n          }\n          if (typeof (loginSuccessResult) === 'undefined' || loginSuccessResult) {\n            savedOfferConfig.userToken = result.token;\n            show(savedOfferConfig);\n          }\n        },\n        loggedOut: () => {\n          var config: any = {};\n          config.userProvider = user.getProvider().getName();\n          config.userToken = user.getProvider().getToken() && user.getProvider().getToken().length > 0 ? user.getProvider().getToken() : '';\n          _reload(config);\n        }\n      });\n      if (pn.pianoId.getToken() !== null) {\n        // Confirmation parameters should be cleared if user was authorized by another source\n        // E.g. user have two same tabs and initiated authorization in both\n        // After first authorization second one tab will be authorized too and confirmation flow won't be completed\n        msqa.clearConfirmationParameters();\n      }\n      if ((typeof (config.loginRequired) === 'undefined' || !config.loginRequired)) {\n        var countOfLogins = 0;\n        config.loginRequired = () => {\n          countOfLogins++;\n          if (countOfLogins > 10) {\n            util.log('Too many attemps to login for myAccount');\n            return;\n          }\n\n          var verificationCode = util.getQueryParamByName(VERIFICATION_CODE_QUERY);\n\n          const pianoIdUrlString = util.getQueryParamByName(\"internal_redirect_uri\");\n          const responseId = util.getQueryParamByName(\"response_id\");\n          const isMsqaAuthConfirmationFlow = pianoIdUrlString && responseId;\n\n          const { isGmSso, isGmSsoRedirectEnabled } = pn.pianoId.__protected__;\n          const shouldShowAuthModal = !(isGmSso() && isGmSsoRedirectEnabled()) && !isMsqaAuthConfirmationFlow;\n          if (shouldShowAuthModal) {\n            pn.pianoId.show({verificationCode: verificationCode});\n          } else {\n            pn.pianoId.init();\n          }\n        };\n      }\n      iframeParams.pianoIdUrl = pn.pianoId.getIframeUrl();\n      var lang = pn.pianoId.getLang();\n      if (lang) {\n        iframeParams.lang = lang;\n      }\n      pn.pianoId.onLangChange( (lang: string) => {\n        postmessage.send('langChanged', { lang: lang }, iframeParams.iframeId);\n      }, iframeParams.iframeId);\n    } else if (pn.pianoIdLite.isConfigured()) {\n      iframeParams.pianoIdUrl = pn.pianoId.getIframeUrl();\n    }\n\n    return new Promise(function (resolve) {\n      util.waitCall('refreshUserToken', function () {\n        let container: any;\n        let params: Record<string, string> = {};\n        if (config.displayMode === 'inline') {\n          if (!config.containerSelector) {\n            util.log('My account must have a valid containerSelector');\n            return;\n          }\n          container = jqUtils.queryEl(config.containerSelector);\n          if (!container) {\n            util.log('My account must have a valid containerSelector');\n            return;\n          }\n          // container = $(config.containerSelector);\n          iframeParams.width = jqUtils.getWidth(container);\n        } else {\n          // create backdrop if it doesn't exist\n          container = _createContainer();\n        }\n\n        const { pageTitle, pageViewId } = util.getPageViewContext();\n        iframeParams.pageViewId = pageViewId;\n        iframeParams.tbc = util.getTbcCookie()\n        iframeParams.browserId = util.getBrowserId();\n        iframeParams.contentType = util.getPageViewContext().contentType;\n        iframeParams.pageTitle = pageTitle;\n        iframeParams.userState = util.getUserState();\n\n        iframeParams.userProvider = user.getProvider().getName();\n        if (config.userToken) {\n          iframeParams.userToken = config.userToken;\n        } else {\n          iframeParams.userToken = user.getProvider().getToken();\n        }\n\n        for (var cb in callbacks) {\n          if (typeof (config[cb]) === 'function') {\n            util.debug('Registering ' + cb + ' callback for iframe ' + iframeParams.iframeId);\n            registerCallback(cb, config[cb]);\n          }\n        }\n        iframeParams.aid = pn.aid;\n\n        if (pn.isSensitiveDataProtectionEnabled) {\n          params = {\n            userToken: iframeParams.userToken,\n            iframeId: iframeParams.iframeId\n          }\n\n          delete iframeParams.userToken;\n        }\n\n        var iframeSrc = _getBaseUrl() + '?' + jqUtils.param(iframeParams);\n        var iframe = document.createElement('iframe');\n\n        const attrs: Record<string, any> = {\n          scrolling: 'no',\n          allowtransparency: 'true',\n          name: iframeParams.iframeId,\n          id: iframeParams.iframeId,\n          allow: 'payment',\n          // unfortunately we cannot use sandbox because of braintree 3ds implementation (nested iframes with navigations)\n          // sandbox: 'allow-forms allow-popups allow-top-navigation-by-user-activation allow-scripts allow-same-origin',\n        };\n\n        if (!pn.isSensitiveDataProtectionEnabled) {\n          attrs.src = iframeSrc;\n        }\n\n        Object.keys(attrs).forEach((key: string) => {\n          jqUtils.setAttr(key, attrs[key], iframe);\n        })\n        const cssMap: any = {\n          overflow: 'hidden',\n          border: '0',\n          height: '0',\n        };\n        if (config.displayMode === 'inline') {\n          cssMap.width = iframeParams.width + 'px';\n          // iframe.css('width', iframeParams.width + 'px');\n        } else {\n          cssMap.width = 0;\n          // iframe.css('width', '0px');\n        }\n\n        Object.keys(cssMap).forEach((key: string) => {\n          // @ts-ignore\n          iframe.style[key] = cssMap[key];\n        })\n\n        iframes[iframeParams.iframeId] = {\n          iframeId: iframeParams.iframeId,\n          config: config,\n          element: iframe,\n          container: container,\n          containerWidth: jqUtils.getWidth(container),\n          containerHeight: jqUtils.getHeight(container)\n        };\n        postmessage.init({\n          postMessageUrl: _getBaseUrl(),\n          receive: _receive,\n          iframe: iframes[iframeParams.iframeId]\n        });\n        jqUtils.on(window, 'keyup', (event: any) => _handleKeystroke(event));\n\n        if (config.displayMode === 'modal') {\n          jqUtils.on(window, 'resize', function () {\n            _centerIt(container);\n          });\n        }\n\n        if (config.displayMode === 'modal') {\n          _centerIt(container);\n        } else {\n          jqUtils.empty(container);\n        }\n\n        if (pn.isSensitiveDataProtectionEnabled) {\n          params.iframeSrc = iframeSrc;\n\n          const form = containerUtils.getForm(params);\n          jqUtils.append(container, iframe);\n          jqUtils.append(container, form);\n\n          form.submit();\n        } else {\n          jqUtils.append(container, iframe);\n        }\n\n        jqUtils.on(window, 'resize', () => {\n          _checkIframeSizes();\n        });\n\n        if (config.displayMode === 'inline') {\n          if (window.ResizeObserver) {\n            const resizeObserver = new ResizeObserver(entries => {\n              const width = jqUtils.getWidth(container);\n              if (width > 0) {\n                _resizeIframe(iframes[iframeParams.iframeId], {\n                  width: width\n                });\n              }\n            });\n\n            resizeObserver.observe(container);\n            iframes[iframeParams.iframeId].resizeObserver = resizeObserver;\n          }\n        }\n\n\n        if (pn.offer) {\n          pn.offer.registerCallback('complete', () => {\n            postmessage.send('refreshNow', {}, iframeParams.iframeId);\n          });\n        }\n        resolve(iframes[iframeParams.iframeId]);\n      });\n    });\n  };\n\n  const show = (config: any): void => {\n    util.waitCall('offerCreate', () => {\n      util.waitCall('refreshAccessTokenList', () => {\n        _createIframe(config)?.then((iframe: any) => {\n          if (!iframe) {\n            util.log('Could not initialize my account; check configuration');\n          }\n        });\n      });\n    });\n  };\n\n  return {\n    name,\n    show,\n    registerCallback,\n  };\n\n})();\n\npn.container.register('myaccount', {\n  useValue: myaccount\n});\npn.myaccount = pn.container.resolve<MyaccountInterface>('myaccount');\n", "// TODO: Remove 3+ months after this release\nexport interface MeterInterface {\n  name: string;\n\n  init(config: any): void;\n\n  isExpired(): boolean;\n\n  isExpiredNextClick(): boolean;\n\n  checkMeter(targetElem: any): void;\n\n  showCurtain(c: any): void;\n\n  last(): any;\n\n  registerCallback(event: string, callback: Function): void;\n}\n\nconst meter = ((): MeterInterface => {\n  const DEPRECATION_MSG = 'This functionality is deprecated and code will be deleted soon, get rid of its usage';\n\n  const name = 'meter';\n\n  const last = (): any => {\n    console.warn(DEPRECATION_MSG);\n    return {};\n  }\n\n  const isExpired = (): boolean => {\n    console.warn(DEPRECATION_MSG);\n    return false;\n  };\n\n  const isExpiredNextClick = (): boolean => {\n    console.warn(DEPRECATION_MSG);\n    return false;\n  };\n\n  const showCurtain = (c?: any): void => {\n    console.warn(DEPRECATION_MSG);\n  };\n\n  const init = (c: any): void => {\n    console.warn(DEPRECATION_MSG);\n  };\n\n  const checkMeter = (targetElem: any): void => {\n    console.warn(DEPRECATION_MSG);\n  }\n\n  const registerCallback = (event: string, callback: Function): void => {\n  }\n\n  return {\n    name,\n    init,\n    isExpired,\n    isExpiredNextClick,\n    checkMeter,\n    showCurtain,\n    last,\n    registerCallback,\n  };\n})();\n\npn.container.register('meter', {\n  useValue: meter\n});\npn.meter = pn.container.resolve<MeterInterface>('meter');\n", "import { UtilInterface } from \"./util\";\nimport { SHA1Interface } from \"./sha1\";\n\nexport interface FingerprintInterface {\n  name: string;\n\n  getFingerprint(): string;\n}\n\nconst fingerprint = ((): FingerprintInterface => {\n\n  const util = pn.container.resolve<UtilInterface>('util');\n  const sha1 = pn.container.resolve<SHA1Interface>('sha1');\n\n  const name = 'fingerprint';\n\n  let fingerprint = '';\n\n  const _getLocality = () => {\n    'use strict';\n    try {\n      var fpOffset, language;\n      language = window.navigator.userLanguage || window.navigator.language;\n      fpOffset = new Date().getTimezoneOffset();\n      return fpOffset + ':' + language;\n    } catch (e) {\n      return '';\n    }\n  };\n\n  const _getBrowserPlugin = () => {\n    'use strict';\n    if (window.ActiveXObject) {\n      return _getIEBrowserPluginValue();\n    } else {\n      try {\n        var retVal = '';\n        var numPlugins = navigator.plugins.length;\n        if (numPlugins > 0) {\n          for (var i = 0; i < numPlugins; i++) {\n            retVal += navigator.plugins[i].name + '|';\n          }\n        }\n        return retVal;\n      } catch (e) {\n        return '';\n      }\n    }\n  };\n\n  const _getIEBrowserPluginValue = () => {\n    var plugins = [\n      //            'ShockwaveFlash.ShockwaveFlash', // Flash\n      //            'ShockwaveFlash.ShockwaveFlash.1',\n      //            'ShockwaveFlash.ShockwaveFlash.3',\n      //            'ShockwaveFlash.ShockwaveFlash.4',\n      //            'ShockwaveFlash.ShockwaveFlash.5',\n      'ShockwaveFlash.ShockwaveFlash.6',\n      'ShockwaveFlash.ShockwaveFlash.7',\n      //            'SWCt1.SWCt1.7', // ShockWave Player\n      //            'SWCt1.SWCt1.8',\n      'SWCt1.SWCt1.9',\n      'SWCtl.SWCtl',\n      'Adobe.SVGCtl',\n      'WMPlayer.OCX', // Windows Media Player\n      //            'MediaPlayer.MediaPlayer.1',\n      'AgControl.AgControl', // SilverLight\n      'AcroPDF.PDF', // Adobe PDF Reader >= 7\n      'PDF.PdfCtrl', // Adobe PDF Reader <= 6\n      //            'QuickTime.QuickTime', // QuickTime\n      //            'rmocx.RealPlayer G2 Control', // RealPlayer\n      //            'rmocx.RealPlayer G2 Control.1', // RealPlayer\n      'RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)', // RealPlayer\n      //            'RealVideo.RealVideo(tm) ActiveX Control (32-bit)', // RealPlayer\n      'RealPlayer', // RealPlayer\n      'Skype.Detection', // Skype\n      '3dmlw.IEPlugin',\n      //            'DjVuControl.DjVuCtl',\n      'GoogleTalk.Plugin',\n      'GoogleTalk.Plugin.1'\n      //            'XaraRender.XaraDocument',\n      //            'XaraRender.XaraDocument.1'\n    ];\n\n    var retVal = '';\n    plugins.map(function (plugin) {\n      try {\n        new window.ActiveXObject(plugin);\n        retVal += plugin + '|';\n      } catch (e) {\n      }\n    });\n    return retVal;\n  };\n\n  // var _getInstalledFonts = function () {\n  //   'use strict';\n  //   // TODO use here document.fonts\n  //   try {\n  //     //var fontsArr = [\"AngsanaUPC\", \"MS PGothic\", \"ISOCTEUR\", \"Freehand521 BT\", \"Cambria\", \"Times New Roman Greek\", \"Papyrus\", \"Informal Roman\", \"Arial Rounded MT Bold\", \"Harrington\", \"Edwardian Script ITC\", \"Bookshelf Symbol 7\", \"GothicE\", \"Adobe Fan Heiti Std B\", \"IrisUPC\", \"Vineta BT\", \"Miriam Fixed\", \"Technic\", \"JasmineUPC\", \"Vani\", \"Roman\", \"Kozuka Gothic Pro EL\", \"Arial CE\", \"WP Arabic Sihafa\", \"Minion Pro\", \"Microsoft Yi Baiti\", \"Garamond Premr Pro Smbd\", \"UniversalMath1 BT\", \"Symath\", \"Minion Pro SmBd\", \"Proxy 7\", \"DotumChe\", \"Vijaya\", \"Malgun Gothic\", \"MoolBoran\", \"Leelawadee\", \"Microsoft YaHei UI\", \"Viner Hand ITC\", \"Playbill\", \"Lucida Fax\", \"DejaVu Serif\", \"Swis721 LtCn BT\", \"Heather Script One\", \"Tekton Pro Ext\", \"Bradley Hand ITC\", \"Agency FB\", \"Microsoft Himalaya\", \"Script MT Bold\", \"GulimChe\", \"Calibri\", \"WP Greek Helve\", \"Kokila\", \"Goudy Stout\", \"Tw Cen MT Condensed\", \"Cooper Std Black\", \"Minion Pro Med\", \"Perpetua Titling MT\", \"Webdings\", \"Century\", \"Swis721 Hv BT\", \"Microsoft New Tai Lue\", \"Niagara Solid\", \"Algerian\", \"Kozuka Mincho Pr6N H\", \"Gigi\", \"Clarendon BT\", \"Georgia\", \"Tekton Pro Cond\", \"Raavi\", \"OpenSymbol\", \"Meiryo\", \"Bodoni MT\", \"WP MultinationalB Helve\", \"MS Serif\", \"Footlight MT Light\", \"Adobe Song Std L\", \"RomanC\", \"Charlemagne Std\", \"Adobe Caslon Pro Bold\", \"Simplex\", \"WST_Czec\", \"Txt\", \"Chaparral Pro\", \"Symap\", \"Aharoni\", \"Terminal\", \"Gill Sans MT\", \"CordiaUPC\", \"Shonar Bangla\", \"Birch Std\", \"WP CyrillicB\", \"DilleniaUPC\", \"Swis721 Cn BT\", \"Mangal\", \"Franklin Gothic Demi\", \"Minion Pro Cond\", \"Bernard MT Condensed\", \"WST_Fren\", \"Eras Bold ITC\", \"Fixedsys\", \"Futura Md BT\", \"Myriad Arabic\", \"Myriad Hebrew\", \"Candara\", \"Modern\", \"Adobe Fangsong Std R\", \"WP MultinationalB Roman\", \"Adobe Kaiti Std R\", \"AMGDT\", \"Adobe Ming Std L\", \"Bell MT\", \"Curlz MT\", \"Aparajita\", \"Giddyup Std\", \"Constantia\", \"Plantagenet Cherokee\", \"Segoe UI Semibold\", \"Myriad Pro\", \"Myriad Web Pro\", \"Kozuka Mincho Pr6N M\", \"WP Greek Century\", \"NSimSun\", \"Square721 BT\", \"Eurostile\", \"OCR A Std\", \"Berlin Sans FB\", \"Copperplate Gothic Light\", \"WP ArabicScript Sihafa\", \"TechnicBold\", \"Kozuka Mincho Pr6N R\", \"Snap ITC\", \"Kozuka Mincho Pr6N L\", \"Franklin Gothic Heavy\", \"MingLiU-ExtB\", \"Kozuka Mincho Pro L\", \"Myriad Pro Light\", \"LilyUPC\", \"Parchment\", \"Proxy 4\", \"Arno Pro SmText\", \"CommercialScript BT\", \"Poor Richard\", \"Adobe Naskh Medium\", \"Simplified Arabic Fixed\", \"Adobe Caslon Pro\", \"Arno Pro Light Display\", \"Times New Roman Cyr\", \"Gentium Book Basic\", \"Bodoni MT Condensed\", \"Courier New\", \"Arno Pro\", \"Engravers MT\", \"Lucida Handwriting\", \"Book Antiqua\", \"Dutch801 XBd BT\", \"Latha\", \"Kozuka Gothic Pr6N H\", \"Monospac821 BT\", \"Segoe UI Light\", \"Verdana\", \"Bookman Old Style\", \"High Tower Text\", \"Showcard Gothic\", \"Lao UI\", \"OCR-B 10 BT\", \"KodchiangUPC\", \"Franklin Gothic Book\", \"Kozuka Gothic Pro R\", \"French Script MT\", \"Calisto MT\", \"Rage Italic\", \"Letter Gothic Std\", \"ScriptC\", \"Courier\", \"Bell Gothic Std Light\", \"BankGothic Lt BT\", \"Tw Cen MT Condensed Extra Bold\", \"SansSerif\", \"Franklin Gothic Medium\", \"Ariston\", \"Symbol\", \"ZWAdobeF\", \"Wingdings\", \"TechnicLite\", \"Segoe UI\", \"Times New Roman CYR\", \"Times New Roman Baltic\", \"GungsuhChe\", \"Lucida Sans\", \"Gisha\", \"Ouverture script\", \"Marlett\", \"Ravie\", \"Bickham Script Pro Semibold\", \"ISOCPEUR\", \"Jokerman\", \"Cooper Black\", \"Alexandra Script\", \"Gadugi\", \"FreesiaUPC\", \"Lucida Console\", \"Microsoft JhengHei UI\", \"Swis721 Blk BT\", \"Segoe UI Symbol\", \"OCR-A BT\", \"Rockwell\", \"Courier New Baltic\", \"OCR A Extended\", \"Courier New TUR\", \"Arial CYR\", \"Calligraph\", \"Levenim MT\", \"Maiandra GD\", \"Batang\", \"RomanT\", \"Colonna MT\", \"GreekC\", \"DejaVu Sans Light\", \"Adobe Garamond Pro Bold\", \"Eras Medium ITC\", \"Estrangelo Edessa\", \"Bickham Script One\", \"Microsoft Sans Serif\", \"Symeteo\", \"Microsoft PhagsPa\", \"ScriptS\", \"Bodoni MT Black\", \"Adobe Devanagari\", \"Kalinga\", \"MS Reference Specialty\", \"Freestyle Script\", \"WST_Ital\", \"Orator Std\", \"PMingLiU\", \"Chaparral Pro Light\", \"Kozuka Gothic Pro L\", \"Arno Pro Smbd Caption\", \"Dotum\", \"Adobe Gothic Std B\", \"Haettenschweiler\", \"EuroRoman\", \"MS Mincho\", \"Cordia New\", \"Microsoft YaHei\", \"Arial Black\", \"MS Outlook\", \"WST_Engl\", \"Symusic\", \"Bauhaus 93\", \"GDT\", \"Californian FB\", \"Berlin Sans FB Demi\", \"Lucida Bright\", \"Narkisim\", \"Arno Pro Display\", \"Euphemia\", \"David\", \"ItalicT\", \"AIGDT\", \"Gill Sans Ultra Bold\", \"Palatino Linotype\", \"Kartika\", \"Modern No. 20\", \"Gautami\", \"Kozuka Gothic Pro H\", \"Traditional Arabic\", \"Kunstler Script\", \"Niagara Engraved\", \"Courier New Greek\", \"Nirmala UI\", \"DejaVu Sans Condensed\", \"Brush Script MT\", \"Rockwell Extra Bold\", \"MS UI Gothic\", \"Clarendon Blk BT\", \"Proxy 3\", \"Ebrima\", \"Utsaah\", \"Segoe Print\", \"Consolas\", \"Courier New CE\", \"Kozuka Gothic Pr6N R\", \"Arial TUR\", \"BatangChe\", \"RomanD\", \"Franklin Gothic Medium Cond\", \"GreekS\", \"Sakkal Majalla\", \"DejaVu Serif Condensed\", \"CountryBlueprint\", \"Ceremonious Two\", \"Blackoak Std\", \"Kozuka Mincho Pro EL\", \"Times New Roman TUR\", \"Syastro\", \"WST_Germ\", \"Iskoola Pota\", \"ISOCT2\", \"Hobo Std\", \"Adobe Myungjo Std M\", \"Romantic\", \"WST_Span\", \"Old English Text MT\", \"Proxy 1\", \"Harlow Solid Italic\", \"Felix Titling\", \"Tw Cen MT\", \"Tekton Pro\", \"Swis721 BdOul BT\", \"Gulim\", \"Comic Sans MS\", \"Rosewood Std Regular\", \"Bodoni MT Poster Compressed\", \"KaiTi\", \"Arno Pro Caption\", \"Eccentric Std\", \"Kozuka Gothic Pro M\", \"Gloucester MT Extra Condensed\", \"Tahoma\", \"Swis721 BT\", \"MS Sans Serif\", \"Small Fonts\", \"Swis721 BlkEx BT\", \"Proxy 2\", \"DejaVu Sans\", \"Swis721 Ex BT\", \"Bickham Script Pro Regular\", \"Tunga\", \"Swis721 Lt BT\", \"Arno Pro Smbd\", \"Copperplate Gothic Bold\", \"Swis721 LtEx BT\", \"Vivaldi\", \"ISOCT\", \"Times New Roman\", \"Prestige Elite Std\", \"MingLiU\", \"Arno Pro Smbd Subhead\", \"Rod\", \"Arial Baltic\", \"Kozuka Gothic Pro B\", \"Dutch801 Rm BT\", \"Andalus\", \"Imprint MT Shadow\", \"WP Greek Courier\", \"Stencil\", \"Trebuchet MS\", \"Swis721 BdCnOul BT\", \"WP Hebrew David\", \"Arabic Transparent\", \"Adobe Hebrew\", \"MS Gothic\", \"Wingdings 3\", \"Gill Sans MT Condensed\", \"Lucida Sans Typewriter\", \"Elephant\", \"Wingdings 2\", \"Broadway\", \"Poplar Std\", \"TeamViewer8\", \"Franklin Gothic Demi Cond\", \"Lithos Pro Regular\", \"Mistral\", \"Kozuka Mincho Pro H\", \"Magneto\", \"CommercialPi BT\", \"GENISO\", \"PanRoman\", \"Gill Sans MT Ext Condensed Bold\", \"Bell Gothic Std Black\", \"DokChampa\", \"Script\", \"Mesquite Std\", \"Swis721 BlkCn BT\", \"EucrosiaUPC\", \"Gungsuh\", \"Corbel\", \"Nueva Std Cond\", \"Kozuka Mincho Pr6N B\", \"FangSong\", \"Gill Sans Ultra Bold Condensed\", \"WST_Swed\", \"Arno Pro Subhead\", \"SuperFrench\", \"Gabriola\", \"Monotxt\", \"Garamond\", \"Complex\", \"DFKai-SB\", \"Century Gothic\", \"Kozuka Mincho Pro B\", \"Decor\", \"Kozuka Mincho Pr6N EL\", \"DaunPenh\", \"Clarendon Lt BT\", \"Wide Latin\", \"WP CyrillicA\", \"Miriam\", \"Kozuka Gothic Pr6N L\", \"Liberation Sans Narrow\", \"ItalicC\", \"Amadeus\", \"Stylus BT\", \"Meiryo UI\", \"CityBlueprint\", \"MingLiU_HKSCS-ExtB\", \"RomanS\", \"Nueva Std\", \"Khmer UI\", \"Centaur\", \"Arial Cyr\", \"Microsoft Tai Le\", \"WP MultinationalA Helve\", \"SimHei\", \"Arial\", \"Simplified Arabic\", \"Microsoft Uighur\", \"WP MultinationalB Courier\", \"AcadEref\", \"Forte\", \"Copyist\", \"Kozuka Mincho Pro R\", \"Vrinda\", \"AmdtSymbols\", \"Carolina\", \"ISOCP\", \"ISOCT3\", \"Nyala\", \"BrowalliaUPC\", \"Proxy 6\", \"DejaVu Sans Mono\", \"MV Boli\", \"Adobe Heiti Std R\", \"Arabic Typesetting\", \"Vladimir Script\", \"Brush Script Std\", \"System\", \"Juice ITC\", \"Tempus Sans ITC\", \"Kristen ITC\", \"GothicG\", \"Impact\", \"Trajan Pro\", \"Rockwell Condensed\", \"Century Schoolbook\", \"MingLiU_HKSCS\", \"Arial Unicode MS\", \"Kozuka Gothic Pr6N EL\", \"AnastasiaScript\", \"Arno Pro Smbd Display\", \"MT Extra\", \"Adobe Arabic\", \"WP MultinationalA Courier\", \"Segoe UI Semilight\", \"Segoe Script\", \"SimSun-ExtB\", \"Microsoft JhengHei\", \"Courier New CYR\", \"Eras Light ITC\", \"Kozuka Gothic Pr6N M\", \"Bickham Script Two\", \"MS PMincho\", \"Perpetua\", \"Mongolian Baiti\", \"Arial Narrow\", \"Gentium Basic\", \"Palace Script MT\", \"Chiller\", \"Kozuka Mincho Pro M\", \"Goudy Old Style\", \"Arial Greek\", \"Onyx\", \"Baskerville Old Face\", \"Sylfaen\", \"Lucida Sans Unicode\", \"Matura MT Script Capitals\", \"Annabelle\", \"Lucida Calligraphy\", \"Cambria Math\", \"Calibri Light\", \"Eras Demi ITC\", \"Helvetica\", \"Kozuka Gothic Pr6N B\", \"Pristina\", \"Stencil Std\", \"Britannic Bold\", \"Garamond Premr Pro\", \"Shruti\", \"GothicI\", \"PMingLiU-ExtB\", \"Courier New Cyr\", \"FrankRuehl\", \"Proxy 9\", \"SimSun\", \"Arno Pro Smbd SmText\", \"Swis721 BlkOul BT\", \"MS Reference Sans Serif\", \"Adobe Garamond Pro\", \"Blackadder ITC\", \"WP MultinationalA Roman\", \"Monotype Corsiva\", \"Proxy 8\", \"Castellar\", \"BankGothic Md BT\", \"Browallia New\", \"Angsana New\", \"Times New Roman CE\", \"Proxy 5\", \"Myriad Pro Cond\", \"ISOCP3\", \"ISOCP2\", \"Italic\"];\n  //     var fontsArr = ['AcadEref', 'Adobe Garamond Pro Bold', 'Aharoni', 'Arial Baltic', 'Arno Pro', 'BatangChe', 'Blackoak Std', 'Castellar', 'CityBlueprint', 'Colonna MT', 'Courier New Baltic', 'Curlz MT', 'DilleniaUPC', 'Dotum', 'Dutch801 Rm BT', 'Edwardian Script ITC', 'EucrosiaUPC', 'Eurostile', 'Felix Titling', 'Footlight MT Light', 'FrankRuehl', 'Hobo Std', 'KodchiangUPC', 'Maiandra GD', 'Mangal', 'Matura MT Script Capitals', 'Nirmala UI', 'OCR-A BT', 'Plantagenet Cherokee', 'Pristina', 'Raavi', 'Rage Italic', 'Ravie', 'Rod', 'Segoe UI', 'Shonar Bangla', 'Trajan Pro', 'Tunga', 'Wingdings 3', 'Wingdings'];\n  //     var container = document.createElement('span');\n  //     container.style.setProperty('font-family', 'sans-serif', 'important');\n  //     container.style.position = 'fixed';\n  //     container.style.top = '-5000';\n  //     container.style.left = '-5000';\n  //     container.style.zIndex = '-5000';\n  //     container.style.fontSize = '80px';\n  //     container.innerHTML = 'abcdefghijklmnopqrstuvwxyz';\n  //     document.body.insertBefore(container, document.body.firstChild);\n  //     var defaultSize = { width: container.offsetWidth, height: container.offsetHeight };\n  //\n  //     var foundFonts = '';\n  //     for (var i = 0; i < fontsArr.length; i++) {\n  //       container.style.setProperty('font-family', fontsArr[i] + ',sans-serif', 'important');\n  //       if (container.offsetWidth !== defaultSize.width || container.offsetHeight !== defaultSize.height) {\n  //         foundFonts += fontsArr[i] + '|';\n  //       }\n  //     }\n  //     $(container).remove();\n  //     return foundFonts;\n  //   } catch (e) {\n  //     return '';\n  //   }\n  // };\n\n  const _getScreen = () => {\n    'use strict';\n    try {\n      return screen.height + 'x' + screen.width + '+' + screen.colorDepth;\n    } catch (e) {\n      return '';\n    }\n  };\n\n  const _getUserAgent = () => {\n    'use strict';\n    return navigator.userAgent;\n    var browser;\n\n    //maybe just use the browser name instead of entire user agent in case of browser version # change,etc\n    try {\n      if (/Opera[\\/\\s](\\d+\\.\\d+)/.test(navigator.userAgent)) {\n        browser = 'Opera';\n      } else if (/MSIE (\\d+\\.\\d+);/.test(navigator.userAgent)) {\n        browser = 'MSIE';\n      } else if (/Navigator[\\/\\s](\\d+\\.\\d+)/.test(navigator.userAgent)) {\n        browser = 'Netscape';\n      } else if (/Chrome[\\/\\s](\\d+\\.\\d+)/.test(navigator.userAgent)) {\n        browser = 'Chrome';\n      } else if (/Safari[\\/\\s](\\d+\\.\\d+)/.test(navigator.userAgent)) {\n        browser = 'Safari';\n      } else if (/Firefox[\\/\\s](\\d+\\.\\d+)/.test(navigator.userAgent)) {\n        browser = 'Firefox';\n      }\n      return browser;\n    } catch (e) {\n      return '';\n    }\n  };\n\n  const _getBrowserObjects = () => {\n    'use strict';\n    var retStr = '';\n    try {\n      retStr += (document.getElementById) ? 1 : 0;\n      retStr += (window.getComputedStyle) ? 1 : 0;\n      retStr += (screen.globalStorage) ? 1 : 0;\n      //in some browsers, localStorage and sessionStorage can be disabled in const mode\n      retStr += (window.localStorage) ? 1 : 0;\n      retStr += (window.sessionStorage) ? 1 : 0;\n      retStr += (document.getElementsByClassName) ? 1 : 0;\n      retStr += (document.querySelector) ? 1 : 0;\n      retStr += (document.all) ? 1 : 0;\n      retStr += (window.attachEvent) ? 1 : 0;\n      retStr += (window.createPopup) ? 1 : 0;\n      retStr += (window.XMLHttpRequest) ? 1 : 0;\n      retStr += (window.ActiveXObject) ? 1 : 0;\n      retStr += (window.XDomainRequest) ? 1 : 0;\n      retStr += (window.msPerformance) ? 1 : 0;\n      retStr += (document.documentMode) ? 1 : 0;\n      retStr += (navigator.cpuClass) ? 1 : 0;\n      retStr += (navigator.browserLanguage) ? 1 : 0;\n      retStr += (window.opera) ? 1 : 0;\n      retStr += (window.chrome) ? 1 : 0;\n    } catch (e) {\n    }\n    return retStr;\n  };\n\n  /**\n   * Gets the current browser fingerprint.\n   * @returns {string}\n   */\n  const getFingerprint = (): string => {\n    if (fingerprint) {\n      return fingerprint;\n    }\n    var fingerprint_raw = _getLocality();\n    fingerprint_raw += _getBrowserPlugin();\n    // commented because of it takes around 22 ms\n    // fingerprint_raw += _getInstalledFonts();\n    fingerprint_raw += _getScreen();\n    fingerprint_raw += _getUserAgent();\n    fingerprint_raw += _getBrowserObjects();\n    fingerprint = sha1.hash(fingerprint_raw);\n    util.debug('Current browser fingerprint is: ' + fingerprint);\n    return fingerprint;\n  };\n\n  getFingerprint();\n\n  return {\n    name,\n    /**\n     * Gets the current browser fingerprint.\n     * @returns {string}\n     */\n    getFingerprint,\n  };\n\n})();\n\npn.container.register('fingerprint', {\n  useValue: fingerprint\n});\npn.fingerprint = pn.container.resolve<FingerprintInterface>('fingerprint');\n", "import { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface ScrollDepthInterface {\n  name: string;\n\n  initialize(duration?: number): void;\n\n  getMaxScrollDepth(): number;\n\n  getMaxDocumentHeight(): number;\n\n  addListener(callback: Function, options: any, consumeEventFn: Function): void;\n\n  removeListeners(): void;\n\n  clearMaxScrolledPosition(): void;\n}\n\nconst scrollDepth = ((): ScrollDepthInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n\n  const name = 'scrollDepth';\n\n  let maxDocumentHeight = 0;\n  let maxScrollDepth = 0;\n  let checkDuration = 200;\n  let _timer: any;\n\n  let maxScrolledPosition = 0;\n  let listeners: any[] = [];\n\n    jqUtils.on(window, 'scroll', function () {onScroll()});\n\n  const initialize = (duration?: number): void => {\n    var D = document;\n\n    if (duration && duration > 0) {\n      checkDuration = duration || checkDuration;\n    }\n\n    const updateMaxDepthAndHeight = () => {\n      var body = D.body || {};\n      var documentElement = D.documentElement || {};\n      var newHeight = Math.max(\n        body.scrollHeight, documentElement.scrollHeight,\n        body.offsetHeight, documentElement.offsetHeight,\n        body.clientHeight, documentElement.clientHeight\n      );\n      if (newHeight > maxDocumentHeight) {\n        maxDocumentHeight = newHeight;\n      }\n      var newScroll = jqUtils.scrollTop() + jqUtils.winSize().height;\n      if (newScroll > maxScrollDepth) {\n        maxScrollDepth = newScroll;\n        if (maxScrollDepth > maxDocumentHeight) {\n          maxDocumentHeight = maxScrollDepth;\n        }\n      }\n      if (_timer) {\n        clearTimeout(_timer);\n      }\n      _timer = setTimeout(updateMaxDepthAndHeight, checkDuration);\n    };\n    updateMaxDepthAndHeight();\n  }\n\n  const getMaxScrollDepth = (): number => {\n    return maxScrollDepth;\n  }\n\n  const getMaxDocumentHeight = (): number => {\n    return maxDocumentHeight;\n  }\n\n  /**\n   * @param {Function} callback\n   * @param {Object} options  - condition for callbacks run\n   * @param {String} options.scrollDepth  - value after callback run\n   * @param {String} options.measureType  - the types of measures px or %\n   * @param {Function} consumeEventFn - function returning boolean, should we consume event or not. Not consumed event can be triggered again\n   */\n  const addListener = (callback: Function, options: any, consumeEventFn: Function): void => {\n    if (typeof consumeEventFn !== 'function') {\n      consumeEventFn = function () {\n        return true;\n      };\n    }\n\n    listeners.push({\n      callback: callback,\n      position: options.scrollDepth,\n      measureType: options.measureType,\n      repeat: 'once',\n      consumeEventFn: consumeEventFn\n    });\n    updateMaxScrolledPosition();\n    processListeners();\n  }\n\n  const clearMaxScrolledPosition = (): void => {\n    maxScrolledPosition = 0;\n    maxScrollDepth = 0;\n    maxDocumentHeight = 0;\n  }\n\n  const removeListeners = (): void => {\n    listeners = [];\n  }\n\n  const updateMaxScrolledPosition = () => {\n    //noinspection JSValidateTypes\n    var currentScroll = jqUtils.scrollTop();\n    if (currentScroll > maxScrolledPosition) {\n      maxScrolledPosition = currentScroll;\n    }\n  }\n\n  const onScroll = () => {\n    updateMaxScrolledPosition();\n    processListeners();\n  }\n\n  const listenerShouldFire = (listener: any) => {\n    if (!listener.consumeEventFn()) {\n      return;\n    }\n\n    if (listener.measureType === 'pixels') {\n      return listener.position <= maxScrolledPosition;\n    } else if (listener.measureType === 'percentage') {\n      return maxScrolledPosition / (maxDocumentHeight - jqUtils.winSize().height) >= listener.position / 100;\n    }\n  }\n\n  const processListeners = () => {\n    var execute = [];\n    var noExecute = [];\n    var listener;\n\n    for (var i = 0; i < listeners.length; i++) {\n      listener = listeners[i];\n      if (listenerShouldFire(listener)) {\n        execute.push(listener);\n      } else {\n        noExecute.push(listener);\n      }\n    }\n\n    listeners = noExecute;\n\n    for (var i = 0; i < execute.length; i++) {\n      execute[i].callback();\n    }\n  }\n\n  return {\n    name,\n    initialize,\n    getMaxScrollDepth,\n    getMaxDocumentHeight,\n    addListener,\n    removeListeners,\n    clearMaxScrolledPosition,\n  };\n\n})();\n\npn.container.register('scrollDepth', {\n  useValue: scrollDepth\n});\npn.scrollDepth = pn.container.resolve<ScrollDepthInterface>('scrollDepth');\n", "import { UtilInterface } from \"./util\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface IdleInterface {\n  name: string;\n\n  initialize(): void;\n\n  addListener(callback: Function, idleTimeInSeconds: number, consumeEventFn: Function): void;\n\n  removeListeners(): void;\n}\n\nconst idle = ((): IdleInterface => {\n\n  const util = pn.container.resolve<UtilInterface>('util');\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n\n  const name = 'idle';\n\n  let initialized = false;\n  let listeners: any[] = [];\n  let _timer: any;\n  const interval = 200;\n\n  function initialize(): void {\n    if (initialized) return;\n    initialized = true;\n\n    jqUtils.on(document, 'mousemove', () => resetTimer());\n    jqUtils.on(document, 'keypress', () => resetTimer());\n    jqUtils.on(window, 'scroll', () => resetTimer());\n  }\n\n  function updateInactiveTime() {\n    if (listeners.length) {\n      fire();\n    }\n\n    if (_timer) {\n      clearTimeout(_timer);\n    }\n\n    if (listeners.length) {\n      _timer = setTimeout(() => updateInactiveTime(), interval);\n    }\n  }\n\n  function resetTimer() {\n    var currentTime = Date.now();\n    for (var i = 0; i < listeners.length; i++) {\n      listeners[i].startTime = currentTime;\n    }\n\n    clearTimeout(_timer);\n    if (listeners.length) {\n      _timer = setTimeout(() => updateInactiveTime(), interval);\n    }\n  }\n\n  function fire() {\n    var listener;\n    var execute = [];\n    var noExecute = [];\n    var waitingTime;\n    var isEventConsumed;\n    var currentTime = Date.now();\n    for (var i = 0; i < listeners.length; i++) {\n      listener = listeners[i];\n      waitingTime = currentTime - listener.startTime;\n\n      isEventConsumed = false;\n      if (waitingTime >= listener.idleTime) {\n        if (listener.consumeEventFn()) {\n          isEventConsumed = true;\n        } else {\n          // reset listener's startTime to prevent it from triggering every checking interval\n          listener.startTime = currentTime;\n        }\n      }\n\n      if (isEventConsumed) {\n        execute.push(listener);\n      } else {\n        noExecute.push(listener);\n      }\n    }\n\n    if (execute.length) {\n      util.debug('idle: run fire');\n    }\n\n    listeners = noExecute;\n    for (var i = 0; i < execute.length; i++) {\n      listener = execute[i];\n      listener.callback();\n    }\n  }\n\n  function addListener(callback: Function, idleTimeInSeconds: number, consumeEventFn: Function): void {\n    initialize();\n\n    if (typeof consumeEventFn !== 'function') {\n      consumeEventFn = function () {\n        return true;\n      };\n    }\n\n    listeners.push({\n      callback: callback,\n      idleTime: idleTimeInSeconds * 1000,\n      startTime: Date.now(),\n      consumeEventFn: consumeEventFn\n    });\n\n    if (!_timer) {\n      _timer = setTimeout(() => updateInactiveTime(), interval);\n    }\n  }\n\n  function removeListeners(): void {\n    listeners = [];\n  }\n\n  return {\n    name,\n    initialize,\n    addListener,\n    removeListeners,\n  };\n\n})();\n\npn.container.register('idle', {\n  useValue: idle\n});\npn.idle = pn.container.resolve<IdleInterface>('idle');\n", "import { UtilInterface } from \"./util\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface InteractionInterface {\n  name: string;\n\n  bind(callback: Function, interactions: any[], consumeEventFn: Function): void;\n\n  unbindAll(): void;\n}\n\nconst interaction = ((): InteractionInterface => {\n\n  const util = pn.container.resolve<UtilInterface>('util');\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n\n  const name = 'interaction';\n\n  let boundInteractions: any[] = [];\n\n  const bind = (callback: Function, interactions: any[], consumeEventFn: Function): void => {\n    var actionsToJqueryEvents = (actions: string[]) => {\n      var actionToEvents: any = {\n        'click': 'click',\n        'doubleClick': 'dblclick',\n        'rightClick': 'contextmenu',\n        'mouseOut': 'mouseout',\n        'mouseIn': 'mouseover'\n      };\n      var events = [];\n      for (var i = 0; i < actions.length; i++) {\n        var action = actions[i];\n        events.push(actionToEvents[action]);\n      }\n      return events;\n    };\n\n    if (typeof consumeEventFn !== 'function') {\n      consumeEventFn = function () {\n        return true;\n      }\n    }\n\n    util.__protected__.documentReady(() => {\n      for (var i = 0; i < interactions.length; i++) {\n        var interaction = interactions[i];\n        var actionsString = actionsToJqueryEvents(interaction.elementActions).join(' ');\n        var elementSelector = interaction.elementSelector;\n        var isRepetitive = interaction.repetitive;\n        if (actionsString.trim().length) {\n          ((selector, action, isRepetitive) => {\n            var interactionEventHandler = () => {\n              if (!consumeEventFn()) {\n                return;\n              }\n\n              if (!isRepetitive) {\n                jqUtils.undelegate(document.body, selector);\n              }\n              callback();\n            };\n\n            jqUtils.delegate(document.body, selector, action, interactionEventHandler);\n            boundInteractions.push({\n              action: actionsString,\n              selector: elementSelector,\n              func: interactionEventHandler\n            });\n          })(elementSelector, actionsString, isRepetitive);\n        }\n      }\n    });\n  }\n\n  const unbindAll = (): void => {\n    boundInteractions.forEach((value: any) => {\n      jqUtils.undelegate(document.body, value.selector);\n    });\n\n    boundInteractions = [];\n  }\n\n  return {\n    name,\n\n    bind,\n\n    unbindAll,\n  }\n\n})();\n\npn.container.register('interaction', {\n  useValue: interaction\n});\npn.interaction = pn.container.resolve<InteractionInterface>('interaction');\n", "import { UtilInterface } from \"./util\";\nimport { ContainerUtilsInterface } from \"./containerUtils\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\ninterface WidgetInterface {\n  element?: HTMLElement;\n  container?: HTMLElement;\n  uuid: string;\n  widgetId: string;\n  placeholder: HTMLElement;\n  trackingId: string;\n  config: any;\n}\n\nexport interface RecWidgetServiceInterface {\n  name: string;\n\n  __protected__: {\n    getInstance(): {\n      showRecommendation: Function,\n      fireWidgetCallback: Function,\n      findWidget: Function,\n      clearWidgets: Function,\n      closeWidget: Function,\n      fixWidgetModalWidth: Function\n    };\n    insertWidgetLib(config: any): void;\n  }\n}\n\nconst recWidgetService = ((): RecWidgetServiceInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const containerUtils = pn.container.resolve<ContainerUtilsInterface>('containerUtils');\n\n  const name = 'recWidgetService';\n\n  const isInline = (config: any) => {\n    return config.displayMode === 'inline';\n  };\n\n  const isModal = (config: any) => {\n    return config.displayMode === 'modal';\n  };\n\n  const configureWidget = (widgetConfig: any): WidgetInterface => {\n    var wrapper = jqUtils.queryEl(widgetConfig.containerSelector);\n    var uuid = 'widget-id-' + util.randomString();\n    var config = {\n      singleContainer: wrapper ? wrapper : undefined,\n      displayMode: widgetConfig.displayMode || 'modal',\n      showCloseButton: widgetConfig.showCloseButton,\n      iframeParams: {\n        iframeId: uuid,\n        containerSelector: widgetConfig.containerSelector,\n        width: widgetConfig.width,\n        height: widgetConfig.height\n      }\n    };\n\n    return {\n      uuid: uuid,\n      widgetId: widgetConfig.widgetId,\n      placeholder: widgetConfig.placeholder,\n      trackingId: widgetConfig.trackingId,\n      config: config\n    };\n  };\n\n  const getWidgetContainer = (iframeConfig: any, closeCallback?: Function): HTMLElement => {\n    var container;\n\n    if (isInline(iframeConfig)) {\n      var inlineContainer = containerUtils.initInlineContainer(iframeConfig);\n\n      container = inlineContainer.container;\n    } else if (isModal(iframeConfig)) {\n      container = containerUtils.getModalContainer(iframeConfig, function () {\n        (closeCallback instanceof Function) && closeCallback();\n      });\n    }\n\n    // @ts-ignore\n    return container;\n  };\n\n  const setWidgetCallbacks = (widget: any, callbacks: any = {}) => {\n    Object.keys(callbacks).forEach((callbackKey) => {\n      if (jqUtils.isFunction(callbacks[callbackKey])) {\n        widget[callbackKey] = callbacks[callbackKey](widget);\n      }\n    })\n  };\n\n  function getInstance (): any {\n    var widgets: any[] = [];\n    var modalWidget: any;\n\n    function _showRecommendation (recConfig: any): WidgetInterface {\n      var widgetConfig = recConfig.widgetConfig || {};\n      var createPlaceholderFn = recConfig.createPlaceholderFn;\n      var widgetId = widgetConfig.widgetId;\n\n      if (!widgetId) {\n        throw new Error('widgetId should be specified');\n      }\n\n      if (_findWidget(widgetId)) {\n        util.log('widget with id ' + widgetConfig.widgetId + ' already initialize');\n        // @ts-ignore\n        return;\n      }\n\n      if (isModal(widgetConfig) && modalWidget) {\n        util.log('modal widget already shown');\n        // @ts-ignore\n        return;\n      }\n\n      var widget: WidgetInterface = configureWidget(widgetConfig);\n      var iframeConfig = widget.config;\n      var element: HTMLElement = createPlaceholderFn();\n\n      widget.container = getWidgetContainer(iframeConfig, function () {\n        _closeWidget({\n          widget: widget,\n          experienceId: widgetConfig.experienceId,\n          experienceActionId: widgetConfig.experienceActionId\n        });\n      });\n      if (widget.container) {\n        jqUtils.append(widget.container, element);\n      } else {\n        util.log(`widget has invalid selector \"${iframeConfig.iframeParams.containerSelector}\"`);\n        // @ts-ignore\n        return;\n      }\n      widget.element = element;\n\n      if (isModal(iframeConfig)) {\n        modalWidget = widget;\n      }\n\n      setWidgetCallbacks(widget, recConfig.widgetCallbacks);\n\n      widgets.push(widget);\n\n      return widget;\n    };\n\n    function _fireWidgetCallback (eventName: string, widgetId: string, eventData: any) {\n      widgets.forEach((widget) => {\n        if (widget.widgetId !== widgetId.toString()) {\n          return;\n        }\n\n        var eventCallback = widget['on' + eventName];\n\n        if (jqUtils.isFunction(eventCallback)) {\n          eventCallback(eventData);\n        }\n      });\n    };\n\n    function _closeWidget (closeConfig: any) {\n      var config = closeConfig || {};\n      var widget = config.widget || {};\n\n      if (isInline(widget.config)) {\n        jqUtils.empty(widget.container);\n      } else if (isModal(widget.config)) {\n        _closeModalContainer(widget);\n        jqUtils.remove(widget.container);\n      }\n\n      if (!config.skipOnclose && jqUtils.isFunction(widget.onclose)) {\n        widget.onclose();\n      }\n\n      if (config.experienceActionId && config.experienceId) {\n        window.postMessage(\n          JSON.stringify({\n            event_name: 'piano_frequency_event',\n            event_type: 'close_click',\n            experience_Id: config.experienceId,\n            experience_action_Id: config.experienceActionId\n          }),\n          '*'\n        );\n      }\n\n      widgets = widgets.filter(function (_widget) {\n        return _widget.uuid !== widget.uuid;\n      });\n    };\n\n    function _clearWidgets () {\n      widgets = [];\n      modalWidget = null;\n    };\n\n    function _findWidget (widgetId: string) {\n      return widgets.filter(function (widget) {\n        return widgetId === widget.widgetId;\n      })[0];\n    };\n\n    function _closeModalContainer (widget?: any) {\n      if (!modalWidget) {\n        return;\n      }\n\n      containerUtils.closeModal(modalWidget);\n      jqUtils.empty(modalWidget.container);\n\n      var mobileModalFix = containerUtils.__private__.mobileModalFix;\n\n      if (mobileModalFix.isIphoneCaretFixed) {\n        mobileModalFix.modalClosed();\n      }\n\n      modalWidget = null;\n    };\n\n    function _fixWidgetModalWidth (widget: any, hasIframe: boolean) {\n      if (widget && !isModal(widget.config)) {\n        return;\n      }\n\n      var container = widget.container;\n      var widgetPlaceholder: HTMLElement | null = hasIframe\n        ? jqUtils.queryEl('iframe', container)\n        : jqUtils.queryEl('.tp-widget-placeholder', container);\n\n      containerUtils.checkBackdropAndContainer(widget, true, true);\n\n      setTimeout(function () {\n        if (widgetPlaceholder) {\n          containerUtils.__protected__.setElementSizes(container, {\n            width: jqUtils.getWidth(widgetPlaceholder)\n          });\n        }\n      }, 100);\n    };\n\n    return {\n      showRecommendation: _showRecommendation,\n      fireWidgetCallback: _fireWidgetCallback,\n      findWidget: _findWidget,\n      clearWidgets: _clearWidgets,\n      closeWidget: _closeWidget,\n      fixWidgetModalWidth: _fixWidgetModalWidth\n    };\n  };\n\n  const insertWidgetLib = (config: any): void => {\n    var documentScript = document.getElementsByTagName('script')[0];\n    var scriptElement = document.createElement('script');\n\n    if (config.id) {\n      scriptElement.setAttribute('id', config.id);\n    }\n\n    if (jqUtils.isFunction(config.onerror)) {\n      scriptElement.onerror = config.onerror;\n    }\n\n    if (jqUtils.isFunction(config.onload)) {\n      scriptElement.onload = config.onload;\n    }\n\n    if (config.defer) {\n      scriptElement.defer = true;\n    }\n\n    scriptElement.type = 'text/javascript';\n    scriptElement.src = config.src;\n\n    if (documentScript && documentScript.parentNode) {\n      documentScript.parentNode.insertBefore(scriptElement, documentScript);\n    }\n  };\n\n  return {\n    name,\n    __protected__: {\n      getInstance,\n      insertWidgetLib,\n    }\n  };\n\n})();\n\npn.container.register('recWidgetService', {\n  useValue: recWidgetService\n});\npn.recWidgetService = pn.container.resolve<RecWidgetServiceInterface>('recWidgetService');\n", "import { PredefinedOptionsInterface } from \"./predefine\";\n\nexport interface PianoInterface {\n  testPianoOption: string;\n}\n\nconst piano = ((): PianoInterface => {\n\n  const predefinedOptions = pn.container.resolve<PredefinedOptionsInterface>('predefinedOptions');\n\n  let testPianoOption: string = '';\n\n  return {\n    testPianoOption\n  }\n\n})();\n\npn.container.register('piano', {\n  useValue: piano\n});\n\nconst pianoInst = pn.container.resolve<PianoInterface>('piano');\n\nfor(let keyField in pianoInst) {\n  // @ts-ignore\n  pn[keyField] = pianoInst[keyField];\n}\n", "import { UtilInterface } from \"./util\";\nimport { EventType, LOG_EVENT_TYPE } from \"./log\";\nimport { UserInterface } from \"./user\";\nimport { APIInterface } from \"./api\";\nimport { RecWidgetServiceInterface } from \"./recWidgetService\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { ConsentInterface } from \"./consent\";\nimport { AnalyticsInterface } from \"./analytics\";\nimport { TCookieOptions } from \"@piano-sdk/storage\";\n\nexport interface PianoEspInterface {\n  name: string;\n\n  __protected__: {\n    init(): any;\n\n    setVisitorId(visitorId: string): void;\n\n    showRecommendation(widgetConfig: any): any;\n\n    showPushSignup(pushSignupConfig: any): void;\n\n    getNotificationStatus(): string | undefined;\n\n    showNewsletterSignup(config: any): void;\n\n    offerMessageReceiver(message: any): void;\n\n    loadCompleteMailingLists(): void,\n  },\n  __private__: {\n\n    removeWidgetsAndSdk(): void;\n\n    getWidgetCallbacks(): any;\n\n    onInit(callback?: Function): void;\n  }\n\n}\n\nexport const pianoEsp = ((container = pn.container): PianoEspInterface => {\n\n  const util = container.resolve<UtilInterface>('util');\n  const user = container.resolve<UserInterface>('user');\n  const api = container.resolve<APIInterface>('api');\n  const jqUtils = container.resolve<JqUtilsInterface>('jqUtils');\n  const consent = container.resolve<ConsentInterface>('consent');\n  const analytics = container.resolve<AnalyticsInterface>('analytics');\n  const recWidgetService = container.resolve<RecWidgetServiceInterface>('recWidgetService');\n\n  const name = 'pianoEsp';\n\n  const MAILING_LIST_KEY = '__pnml';\n  const NOTIFICATION_PERMISSION_DENIED = '_pnpd';\n  let initPromise: any;\n  const USER_PROVIDERS_INIT_TIMEOUT = 300;\n  const NOTIFICATION_STATUS = {\n    granted: 'ALLOWED',\n    default: 'UNKNOWN',\n    denied: 'FORBIDDEN'\n  } as const;\n\n  const recWidget = recWidgetService.__protected__.getInstance();\n\n  setTimeout(() => {\n    // logout listener for tinypassLogin\n    pn.addHandler('logout', () => {\n      saveCompleteMailingLists([]);\n    });\n\n    // logout listener for other providers\n    var provider = user.getProvider();\n\n    if (provider.registerCallback) {\n      provider.registerCallback('logout', () => {\n        saveCompleteMailingLists([]);\n      });\n    }\n  }, USER_PROVIDERS_INIT_TIMEOUT);\n\n  function requestPianoEspSdk(): Promise<unknown> {\n    return new Promise<unknown>((resolve, reject) => {\n      window.PianoESPConfig = {\n        ...(window.PianoESPConfig || {}),\n        onload: resolve,\n        widget_init_on_event: {\n          'rec': true,\n          'opt-in': false\n        },\n        onclick: (data: any) => {\n          recWidget.fireWidgetCallback('click', data.widgetId, data);\n        },\n        onwidgetinit: (data: any) => {\n          recWidget.fireWidgetCallback('init', data.widgetId, data);\n        },\n        onrecsloaded: (data: any) => {\n          recWidget.fireWidgetCallback('recsloaded', data.widgetId, data);\n        }\n      }\n\n      util.debug('pianoESP: loading PianoESP with config:', window.PianoESPConfig);\n\n      recWidgetService.__protected__.insertWidgetLib({\n        id: 'pnesplucidsdksel',\n        src: _getRootEndpoint() + '/public/sdk/v04/sdk.js?v=' + (localStorage && localStorage.lucidsdkver || 'xxx'),\n        onerror: reject,\n      });\n    });\n  }\n\n  function init (): any {\n    if (initPromise) {\n      return initPromise;\n    }\n\n    initPromise = new Promise((resolve, reject) => {\n      const onLoad = () => resolve(null);\n\n      // window.PianoESPConfig.id - it's the fusionId in ESP sdk\n      if (window.PianoESPConfig?.id) {\n        requestPianoEspSdk().then(onLoad, reject);\n      } else {\n        const MAX_WAITING_TIME_FOR_FUSION_ID = 5000;\n        const INTERVAL_FOR_FUSION_ID_CHECK = 500;\n        let counter = 0;\n\n        const intervalId = setInterval(() => {\n          if (window.PianoESPConfig?.id) {\n            requestPianoEspSdk().then(onLoad, reject);\n            clearInterval(intervalId);\n\n            return;\n          }\n\n          if (counter >= MAX_WAITING_TIME_FOR_FUSION_ID) {\n            clearInterval(intervalId);\n            reject();\n\n            return;\n          }\n\n          counter += INTERVAL_FOR_FUSION_ID_CHECK;\n        }, INTERVAL_FOR_FUSION_ID_CHECK);\n      }\n    });\n\n    return initPromise;\n  }\n\n  const setVisitorId = (visitorId: string): void => {\n    window.PianoESPConfig = Object.assign({}, window.PianoESPConfig, {\n      visitor: visitorId\n    });\n  };\n\n  const _getRootEndpoint = () => {\n    var rootEndpoint = '//api-esp.piano.io';\n\n    if (pn.espEndpoint) {\n      rootEndpoint = pn.espEndpoint.replace(/^http[s]*:/, '');\n    } else if (pn.isSandbox()) {\n      rootEndpoint = '//sandbox-api-esp.piano.io';\n    }\n\n    return (window.location.protocol === 'https:' ? 'https:' : 'http:') + rootEndpoint;\n  };\n\n  const showRecommendation = (widgetConfig: any): any => {\n    var widgetCallbacks = getWidgetCallbacks();\n\n    recWidget.showRecommendation({\n      widgetConfig: widgetConfig,\n      widgetCallbacks: widgetCallbacks,\n      createPlaceholderFn: getPlaceholderFn(widgetConfig.placeholder)\n    });\n\n    return init().then(() => {\n      window.PianoESP.initWidget(parseInt(widgetConfig.widgetId));\n    });\n  };\n\n  const _requestPushNotifyPermission = (pushListId: string, trackingId: string) => {\n    init()\n      .then(() => {\n        window.PianoESP.getCurrentPushState().then((state: string) => {\n          if (state === 'prompt') {\n            analytics.log.event({\n              eventType: LOG_EVENT_TYPE.LOG_MICRO_CONVERSION,\n              payload: {\n                trackingId,\n                eventGroupId: 'showPrompt'\n              }\n            });\n          }\n        });\n        window.PianoESP.subscribeToPushSquads([pushListId])\n          .then((response: any) => {\n            var resp = response || {}\n            if (resp.result === true) {\n              util.setPushListsCookie(pushListId);\n              util.debug('pianoESP: Push notification was set:', resp);\n              analytics.log.event({\n                eventType: LOG_EVENT_TYPE.LOG_MICRO_CONVERSION,\n                payload: {\n                  trackingId,\n                  eventGroupId: 'enrollPushCampaign'\n                }\n              });\n            } else if (resp.result === false) {\n              if (resp.reason === 'closed') {\n                analytics.log.event({\n                  eventType: LOG_EVENT_TYPE.LOG_MICRO_CONVERSION,\n                  payload: {\n                    trackingId,\n                    eventGroupId: 'closePrompt'\n                  }\n                });\n              } else {\n                analytics.log.event({\n                  eventType: LOG_EVENT_TYPE.LOG_MICRO_CONVERSION,\n                  payload: {\n                    trackingId,\n                    eventGroupId: 'declineEnrollPushCampaign'\n                  }\n                });\n              }\n            }\n          })\n          .catch((err: any) => {\n            util.log('pianoESP: Push notification error:', err);\n          });\n      });\n  }\n\n  const composerNotification = (() => {\n    const _getCookieOptions = () => {\n      const options: TCookieOptions = {\n        expires: 730,\n        path: '/'\n      };\n\n      if (pn.cookieDomain) {\n        options.domain = pn.cookieDomain;\n      }\n      if (pn.cookiePath) {\n        options.path = pn.cookiePath;\n      }\n\n      return options;\n    }\n    const _reset = () => util.deleteCookie(NOTIFICATION_PERMISSION_DENIED, pn.cookieDomain, pn.cookiePath);\n    const _block = () => {\n      const windowPermission = getWindowNotificationPermission();\n\n      if (windowPermission !== 'denied') {\n        util.__protected__.setCookieConsent(\n          'composer',\n          NOTIFICATION_PERMISSION_DENIED,\n          windowPermission,\n          _getCookieOptions());\n      } else {\n        _reset();\n      }\n    }\n\n    const _get = (): NotificationPermission | null => util.__protected__.getCookie(NOTIFICATION_PERMISSION_DENIED) || null;\n\n    setTimeout(() => {\n      const prevPermission = _get();\n      if (!prevPermission) {\n        return;\n      }\n      // only for case allowed -> unknown, unknown -> allowed\n      if (getWindowNotificationPermission() !== prevPermission) {\n        _reset();\n      }\n    }, 100);\n\n    return {\n      block: _block,\n      reset: _reset,\n      get: _get,\n    }\n  })();\n  const showPushSignup = (pushSignupConfig: any): void => {\n    var config = pushSignupConfig || {};\n\n    if (config.templateId) {\n      analytics.log.event({\n        eventType: LOG_EVENT_TYPE.LOG_CUSTOM_FORM_IMPRESSION,\n        payload: {\n          trackingId: config.trackingId,\n          formName: 'pushSignup',\n          source: 'show_form'\n        }\n      });\n      pn.template.show({\n        ...config,\n        customEvent: (event: any) => {\n          switch (event.eventName) {\n            case 'push-allow':\n              analytics.log.event({\n                eventType: LOG_EVENT_TYPE.LOG_MICRO_CONVERSION,\n                payload: {\n                  trackingId: config.trackingId,\n                  eventGroupId: 'allowSoftEnrollPushCampaign'\n                }\n              });\n              composerNotification.reset();\n              _requestPushNotifyPermission(config.pushListId, config.trackingId);\n              break;\n            case 'push-dont-allow':\n              analytics.log.event({\n                eventType: LOG_EVENT_TYPE.LOG_MICRO_CONVERSION,\n                payload: {\n                  trackingId: config.trackingId,\n                  eventGroupId: 'declineSoftEnrollPushCampaign'\n                }\n              });\n              composerNotification.block();\n              break;\n            case 'push-close':\n              analytics.log.event({\n                eventType: LOG_EVENT_TYPE.LOG_MICRO_CONVERSION,\n                payload: {\n                  trackingId: config.trackingId,\n                  eventGroupId: 'close'\n                }\n              });\n              composerNotification.block();\n              break;\n          }\n        }\n      });\n    } else {\n      _requestPushNotifyPermission(config.pushListId, config.trackingId);\n    }\n  };\n\n  const getWindowNotificationPermission = (): NotificationPermission => {\n    if (!window.Notification) {\n      return 'default';\n    }\n\n    return window.Notification.permission;\n  }\n  const getNotificationStatus = (): string | undefined => {\n    const customStatus = composerNotification.get() ? NOTIFICATION_STATUS.denied : null;\n    const permission = getWindowNotificationPermission();\n\n    return customStatus || NOTIFICATION_STATUS[permission];\n  };\n\n  const saveCompleteMailingLists = (mailingLists: any) => {\n    try {\n      var data = JSON.stringify(mailingLists);\n\n      if (consent.composer) {\n        consent.composer.localStorage.set(MAILING_LIST_KEY, data);\n      } else {\n        localStorage.setItem(MAILING_LIST_KEY, data);\n      }\n    } catch (e) {\n      util.debug('can\\'t save mailing lists to storage', e);\n    }\n  };\n\n  const loadCompleteMailingLists = () => {\n    var data = [];\n\n    try {\n      const strMailingListKey = localStorage.getItem(MAILING_LIST_KEY);\n      if (!strMailingListKey) {\n        return [];\n      }\n      data = JSON.parse(strMailingListKey);\n\n      if (!Array.isArray(data)) {\n        throw new Error('MAINLING_LIST should be array');\n      }\n    } catch (e) {\n      util.debug('can\\'t load mailing lists from storage', e);\n    }\n\n    return data || [];\n  };\n\n  const showNewsletterSignup = (config: any): void => {\n    if (!config || !config.mailingListIds) {\n      util.log('mailingListIds should be specified');\n      return;\n    }\n\n    var storedMailingLists = loadCompleteMailingLists();\n    var IfFilled = storedMailingLists.indexOf(config.mailingListIds) > -1;\n\n    if (config.notShowIfFilled && IfFilled) {\n      util.log('Mailing list with ids ' + config.mailingListIds + ' already shown');\n    } else {\n      pn.template.show(config);\n    }\n  };\n\n  function offerMessageReceiver(message: any): void {\n    switch (message.event) {\n      case \"newsletterSignupSubmission\":\n        var storedMailingLists = loadCompleteMailingLists();\n        if (storedMailingLists.indexOf(message.params.mailingListIds) === -1) {\n          storedMailingLists.push(message.params.mailingListIds);\n          saveCompleteMailingLists(storedMailingLists);\n        }\n        break;\n    }\n  };\n\n  const getPlaceholderFn = (holdername: string): Function => {\n    return (): HTMLElement => {\n      const pnespwgtplaceholder = document.createElement('pnespwgtplaceholder');\n      jqUtils.setAttr('holdername', holdername, pnespwgtplaceholder);\n      return pnespwgtplaceholder;\n    };\n  };\n\n  function getWidgetCallbacks(): any {\n    return {\n      onrecsloaded: function (widget: any) {\n        return function (data: any) {\n          if (data.countOfRecs === 0) {\n            recWidget.closeWidget({ widget: widget, skipOnclose: true });\n            return;\n          }\n\n          recWidget.fixWidgetModalWidth(widget, true);\n\n          analytics.log.event({\n            eventType: LOG_EVENT_TYPE.LOG_ESP_MICRO_CONVERSION,\n            payload: {\n              trackingId: widget.trackingId,\n              espWidgetId: widget.widgetId,\n              eventGroupId: 'init',\n              eventType: EventType.EXTERNAL_EVENT\n            }\n          });\n          util.debug('creating recommendation widget: ', widget.config);\n        }\n      },\n      onclick: function (widget: any) {\n        return function (data: any) {\n          var event_params = {\n            href: data.url\n          };\n\n          analytics.log.event({\n            eventType: LOG_EVENT_TYPE.LOG_ESP_MICRO_CONVERSION,\n            payload: {\n              trackingId: widget.trackingId,\n              espWidgetId: widget.widgetId,\n              eventGroupId: 'click',\n              eventType: EventType.EXTERNAL_LINK,\n              customParams: event_params\n            }\n          });\n        }\n      },\n      onclose: function (widget: any) {\n        return () => {\n          var event_params = {\n            event: 'widgetClosed'\n          };\n\n          analytics.log.event({\n            eventType: LOG_EVENT_TYPE.LOG_ESP_MICRO_CONVERSION,\n            payload: {\n              trackingId: widget.trackingId,\n              espWidgetId: widget.widgetId,\n              eventGroupId: 'close',\n              eventType: EventType.EXTERNAL_EVENT,\n              customParams: event_params\n            }\n          });\n        }\n      }\n    };\n  }\n\n  function removeWidgetsAndSdk(): void {\n    recWidget.clearWidgets();\n    initPromise = null;\n    delete window.PianoESP;\n  };\n\n  function onInit(callback?: Function): void {\n    if (!initPromise) {\n      return;\n    }\n\n    if (typeof callback === 'function') {\n      initPromise.then(callback);\n    }\n  };\n\n  return {\n    name,\n    __protected__: {\n      init,\n      setVisitorId,\n      showRecommendation,\n      showPushSignup,\n      getNotificationStatus,\n      showNewsletterSignup,\n      offerMessageReceiver,\n      loadCompleteMailingLists,\n    },\n    __private__: {\n      removeWidgetsAndSdk,\n      getWidgetCallbacks,\n      onInit,\n    }\n  };\n\n});\n\npn.container.register('pianoEsp', {\n  useValue: pianoEsp()\n});\npn.pianoEsp = pn.container.resolve<PianoEspInterface>('pianoEsp');\n", "import { PostmessageInterface } from \"./postmessage\";\nimport { UserInterface } from \"./user\";\nimport { UtilInterface } from \"./util\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { ISwgResponse } from \"../models/swg/swg-response\";\nimport { IGoogleEntitlement } from \"../models/swg/google-entitlement\";\nimport { ContainerUtilsInterface } from \"./containerUtils\";\n\nexport interface SwgInterface {\n  name: string;\n\n  __protected__: {\n    injectMarkup(markupData: any): void;\n    addLibrary(): void;\n    initSwgFlow(): void;\n  }\n\n  registerCallback(event: string, callback: Function): void;\n}\n\nconst swg = ((): SwgInterface => {\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const user = pn.container.resolve<UserInterface>('user');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const eventUtils = pn.container.resolve<EventUtilsInterface>('eventUtils');\n  const containerUtils = pn.container.resolve<ContainerUtilsInterface>('containerUtils');\n\n  const name = 'swg';\n\n  const EXTERNAL_CHECKOUT_COMPLETE_EVENT = 'externalCheckoutComplete';\n  const SwgUiFlows = {\n    LOGIN_PROMPT: 'loginPrompt',\n    DEFERRED_ACCOUNT_CREATION: 'deferredAccountCreation',\n    BUY: 'buy'\n  };\n\n  const eventManager = eventUtils.createEventManager([\n    EXTERNAL_CHECKOUT_COMPLETE_EVENT\n  ]);\n  const modalOpenCookieName = '__gom';\n\n  let entitlementsLoaded = false;\n  let onPaymentResponseTriggered = false;\n  let swgTermId: string;\n  let saveSubscriptionProcessStarted = false;\n  let allEntitlements: IGoogleEntitlement[] = []\n\n  window.SWG = window.SWG || [];\n\n  window.SWG.push((subscriptions: any) => {\n    subscriptions.setOnPaymentResponse((subscriptionPromise: any) => {\n      if (onPaymentResponseTriggered) {\n        return;\n      }\n\n      util.debug('swg: onPaymentResponse is triggered');\n      onPaymentResponseTriggered = true;\n\n      subscriptionPromise.then((response: any) => {\n        util.debug('swg: onPaymentResponse', response);\n\n        if (!swgTermId) {\n          return;\n        }\n        completeSubscribeResponse(response, response.purchaseData, response.userData, subscriptions, swgTermId, SwgUiFlows.BUY);\n      }).catch(function (e: any) {\n        util.log(\"swg: onPaymentResponse failed\", e);\n      });\n    });\n  });\n\n  postmessage.subscribe('swgCheckoutStart', (event: any) => {\n    if (!entitlementsLoaded) {\n      util.log('swg: incorrect SwG configuration. Please make sure that Experience user segment is configured properly. ' +\n        'Details at https://docs.piano.io/subscribe-with-google/#SwGscript');\n    }\n\n    var sku = event.params.sku;\n    swgTermId = event.params.termId;\n\n    window.SWG.push(function (subscriptions: any) {\n      subscriptions.subscribe(sku);\n    });\n  });\n\n  const setOpenedModalCookie = (eventType: string): void => {\n    util.__protected__.setCookieConsent('vx', modalOpenCookieName, eventType, {\n      expires: 30,\n      path: '/',\n    });\n  };\n\n  const isModalCookieSet = (eventType: string): boolean => {\n    return util.__protected__.getCookie(modalOpenCookieName) &&\n      util.__protected__.getCookie(modalOpenCookieName).includes(eventType);\n  }\n\n  const initSwgFlow = (): void => {\n    window.SWG.push((subscriptions: any) => {\n      subscriptions.getEntitlements().then((entitlements: any) => {\n        entitlementsLoaded = true;\n        util.debug('swg: getEntitlements', entitlements);\n\n        if (entitlements.enablesThis()) {\n          const entitlementInGoogle = entitlements.getEntitlementForSource('google');\n          allEntitlements = entitlements.entitlements;\n\n          if (!entitlementInGoogle) {\n            if (allEntitlements) {\n              checkExternalEntitlement(allEntitlements).then(() => {\n                util.debug('swg: checkExternalEntitlement');\n                entitlements.ack();\n              }, () => {\n                util.log('swg: checkExternalEntitlement failed');\n              });\n            }\n            return;\n          }\n          checkSubscription(entitlementInGoogle).then((response: any) => {\n            if (onPaymentResponseTriggered) {\n              // in case of subscribe flow based on redirects (e.g. in Edge), user will be redirected back to the site\n              // after purchase and \"onPaymentResponse\" callback should be triggered when page is loaded. In this case\n              //  we should just complete subscribe flow and should not trigger any other flows.\n              util.debug('swg: onPaymentResponse is already triggered. Skipping entitlements flow.');\n              return;\n            }\n\n            if (!response) {\n              return;\n            }\n\n            switch (response.type) {\n              case 'USER_FOUND':\n                if (user.isUserValid()) {\n                  util.error('swg: user found, but not valid');\n                  return;\n                }\n\n                util.debug('swg: user found, initiate login prompt');\n\n                var userToken = response.user_token;\n\n                if (isModalCookieSet(response.type)) {\n                  return;\n                }\n\n                subscriptions.showLoginPrompt().then(() => {\n                  loginByToken(userToken);\n                  fireExternalCheckoutCompleteCallback(SwgUiFlows.LOGIN_PROMPT);\n                }).catch((e: any) => {\n                  setOpenedModalCookie(response.type);\n                  util.log('swg: showLoginPrompt failed', e);\n                });\n                break;\n              case 'TERM_FOUND':\n                util.debug('swg: term found, initiate deferred account creation');\n\n                var termId = response.term_id;\n                subscriptions.completeDeferredAccountCreation({\n                  entitlements: entitlements,\n                  consent: true\n                }).then((response: any) => {\n                  util.debug('swg: completeDeferredAccountCreation', response);\n\n                  completeSubscribeResponse(response, response.purchaseData, response.userData, subscriptions, termId,\n                    SwgUiFlows.DEFERRED_ACCOUNT_CREATION);\n                }).catch((e: any) => {\n                  util.log('swg: completeDeferredAccountCreation failed', e);\n                });\n                break;\n              default:\n                util.debug('swg: check subscription response type ' + response.type + '. Nothing to do');\n            }\n          }, () => {\n            util.log('swg: checkSubscription failed');\n          });\n\n          entitlements.ack();\n        }\n      }).catch((e: any) => {\n        util.log('swg: get entitlements failed', e);\n      });\n    });\n\n    saveSubscriptionOnCheckoutEvents();\n  };\n\n  const fireExternalCheckoutCompleteCallback = (uiFlow: any) => {\n    if (eventManager.hasCallback(EXTERNAL_CHECKOUT_COMPLETE_EVENT)) {\n      var params = {\n        type: 'swg',\n        flow: uiFlow\n      };\n      eventManager.fireCallbacks(EXTERNAL_CHECKOUT_COMPLETE_EVENT, params, undefined, true);\n    }\n  }\n\n  const getPianoSubscriptions = (token: string): Promise<ISwgResponse> => {\n    let method = '/swg/sync';\n\n    if (user.getProvider().getName() === 'piano_id_lite') {\n      method += '/external';\n    }\n\n    return new Promise((resolve, reject) => {\n      pn.api.callApi(method, {\n        aid: pn.aid,\n        'access_token': token,\n      },\n        (response: any) => {\n          if (response.code !== 0) {\n            reject();\n          }\n\n          resolve(response.SwgResponse ?? { products: [] });\n        });\n    });\n  }\n\n  const sendSaveSubscriptionRequest = (token: string): void => {\n    window.SWG.push((subscriptions: any) => {\n      subscriptions.saveSubscription(() => ({ token }))\n        .then((result: boolean) => {\n          !result && util.log('swg: save subscription process was stopped');\n        });\n    });\n  };\n\n  const getProductsInGoogle = (): string[] => {\n    return allEntitlements.reduce((acc: string[], entitlement) => {\n      return acc.concat(entitlement.products);\n    }, []);\n  }\n\n  const getAccessDiff = (pianoProducts: string[]): boolean => {\n    let hasDiff = false;\n    const productsInGoogle = getProductsInGoogle();\n\n    for (let i = 0; i < pianoProducts.length; i++) {\n      if (productsInGoogle.indexOf(pianoProducts[i]) === -1) {\n        hasDiff = true;\n        break;\n      }\n    }\n\n    return hasDiff;\n  }\n\n  const saveSubscription = (userToken?: string): void => {\n    if (!entitlementsLoaded || saveSubscriptionProcessStarted) {\n      return;\n    }\n\n    const token = userToken || user.getProvider().getToken();\n\n    if (!token) {\n      return;\n    }\n\n    saveSubscriptionProcessStarted = true;\n\n    getPianoSubscriptions(token)\n      .then((accessList) => accessList.products && getAccessDiff(accessList.products))\n      .then((hasAccessDiff) => {\n        hasAccessDiff && sendSaveSubscriptionRequest(token);\n        saveSubscriptionProcessStarted = false;\n      })\n      .catch((error: any) => {\n        util.log('swg: save subscription flow failed with error - ', error);\n        saveSubscriptionProcessStarted = false;\n      });\n  }\n\n  const saveSubscriptionOnModalClose = () => {\n    saveSubscription();\n\n    postmessage.unsubscribe('purge', saveSubscriptionOnModalClose);\n  }\n\n  const saveSubscriptionOnCheckoutEvents = (): void => {\n    postmessage.subscribe('loginSuccess', (event: any) => {\n      if (containerUtils.hasModalIframe()) {\n        postmessage.subscribe('purge', saveSubscriptionOnModalClose);\n\n        return;\n      }\n\n      const userToken = event.params.token || event.params.user_token;\n\n      saveSubscription(userToken);\n    });\n\n    postmessage.subscribe('purge', (event: any) => {\n      if (event.params && event.params.completePayment) {\n        saveSubscription();\n      }\n    });\n  }\n\n  const checkSubscription = (entitlement: any) => {\n    return new Promise((resolve, reject) => {\n      pn.api.callApi('/swg/check', {\n        entitlement: JSON.stringify(entitlement)\n      }, (rspData: any) => {\n        if (rspData.code !== 0) {\n          util.log('swg: check subscription response - ' + rspData.message);\n          reject();\n        }\n        resolve(rspData.CheckSubscriptionResponse);\n      });\n    })\n  }\n\n  const checkExternalEntitlement = (entitlements: any) => {\n    return new Promise((resolve, reject) => {\n      pn.api.callApi('/swg/check/external', {\n        entitlements: JSON.stringify(entitlements)\n      }, (rspData: any) => {\n        if (rspData.code !== 0) {\n          util.log('swg: check external entitlement response - ' + rspData.message);\n          reject();\n        }\n        var data = rspData.data;\n        if (!data) {\n          util.log('swg: check external entitlement empty response');\n          reject();\n        }\n        resolve(data);\n      });\n    })\n  }\n\n  const reloadEntitlements = (subscriptions: any): void => {\n    subscriptions.reset()\n      .then(() => subscriptions.getEntitlements())\n      .then((entitlements: any) => {\n        util.debug('swg: reload entitlements - ', entitlements.entitlements);\n      })\n      .catch((reason: Error) => {\n        util.debug('swg: entitlements reload failed - ', reason);\n      });\n  };\n\n  const completeSubscribeResponse = (response: any, purchaseData: any, userData: any, subscriptions: any, termId: string, uiFlow: any) => {\n    pn.api.callApi('/swg/subscribe', {\n      term_id: termId,\n      purchase_data: JSON.stringify(purchaseData),\n      user_data: JSON.stringify(userData)\n    }, (rspData: any) => {\n      if (!rspData) {\n        util.log('swg: empty response');\n      } else if (rspData.code !== 0) {\n        reloadEntitlements(subscriptions);\n        util.log('swg: subscribe response - ' + rspData.message);\n        return;\n      } else if (rspData.data) {\n        loginByToken(rspData.data);\n      }\n\n      postmessage.broadcast('swgCheckoutComplete');\n      response.complete().then(() => {\n        fireExternalCheckoutCompleteCallback(uiFlow);\n      }).catch((e: any) => {\n        util.log('swg: complete failed:', e);\n      });\n    });\n  }\n\n  const loginByToken = (token: string) => {\n    if (token && user.getProvider().loginByToken) {\n      user.getProvider().loginByToken(token);\n    }\n  }\n\n  let markupIsInjected = false;\n\n  const injectMarkup = (markupData: any): void => {\n    if (markupIsInjected) {\n      return;\n    }\n    if (markupData) {\n      util.debug('swg: rendering swg markup with config:', markupData);\n\n      var markup = '{\\n' +\n        '   \"@context\": \"http://schema.org\",\\n' +\n        '   \"@type\": \"CreativeWork\",\\n' +\n        '   \"isAccessibleForFree\": ' + markupData.isAccessibleForFree;\n\n      if (markupData.isAccessibleForFree === false && markupData.productId) {\n        markup = markup +\n          ',\\n' +\n          '   \"isPartOf\": {\\n' +\n          '       \"@type\": [\"CreativeWork\", \"Product\"],\\n' +\n          '       \"name\" : \"' + markupData.resourceName + '\",\\n' +\n          '       \"productID\": \"' + markupData.productId + '\"\\n' +\n          '   }';\n      }\n\n      if (markupData.publisherName) {\n        markup += ',\\n' +\n        '   \"publisher\": {\\n' +\n        '       \"@type\": \"Organization\",\\n' +\n        `       \"name\": \"${markupData.publisherName}\"\\n` +\n        '   }';\n      }\n\n      markup = markup + '\\n}';\n\n      var markupScriptElement = document.createElement('script');\n      markupScriptElement.type = 'application/ld+json';\n      markupScriptElement.innerHTML = markup;\n\n      document.getElementsByTagName('script')[0].parentNode?.appendChild(markupScriptElement);\n      markupIsInjected = true;\n    }\n  };\n\n  let libraryIsAdded = false;\n\n  const addLibrary = (): void => {\n    if (libraryIsAdded) {\n      return;\n    }\n    util.debug('swg: adding swg.js library');\n\n    var libraryScriptElement = document.createElement('script');\n    libraryScriptElement.type = 'text/javascript';\n    libraryScriptElement.setAttribute('subscriptions-control', 'manual');\n    libraryScriptElement.async = true;\n    libraryScriptElement.src = 'https://news.google.com/swg/js/v1/swg.js';\n\n    document.getElementsByTagName('script')[0].parentNode?.appendChild(libraryScriptElement);\n    libraryIsAdded = true;\n  };\n\n  const registerCallback = (event: string, callback: Function) => {\n    eventManager.addEvent(event);\n    eventManager.registerCallback(event, callback);\n  }\n\n  return {\n    name,\n    __protected__: {\n      injectMarkup,\n      addLibrary,\n      initSwgFlow,\n    },\n    registerCallback,\n  };\n\n})();\n\npn.container.register('swg', {\n  useValue: swg\n});\npn.swg = pn.container.resolve<SwgInterface>('swg');\n", "import { UtilInterface } from \"./util\";\nimport { OfferInterface } from \"./offer\";\nimport { UserInterface } from \"./user\";\nimport { APIInterface } from \"./api\";\nimport { FB_PIXEL_EVENT_TYPE } from \"./fbpixel\";\nimport { AnalyticsInterface } from \"./analytics\";\n\nexport interface FbsubscriptionsInterface {\n  name: string;\n\n  checkUserAccessAndRedirectToFb(): void;\n\n  isInitialized(): boolean;\n\n  __private__: {\n    isInitialized(): boolean;\n  };\n\n  __protected__: {\n    init(): void;\n  };\n}\n\nconst fbsubscriptions = ((): FbsubscriptionsInterface => {\n\n  const util = pn.container.resolve<UtilInterface>('util');\n  const analytics = pn.container.resolve<AnalyticsInterface>('analytics');\n  const offer = pn.container.resolve<OfferInterface>('offer');\n  const user = pn.container.resolve<UserInterface>('user');\n  const api = pn.container.resolve<APIInterface>('api');\n\n  const name = 'fbsubscriptions';\n\n  let _isInitialized = false;\n  let signedSubscriptionPayload = '';\n  const sentEvents: any = {};\n  const sentCustomEvents: any = {};\n\n  const init = (): void => {\n    if (_isInitialized) {\n      return;\n    }\n\n    analytics.fbpixel.initialize();\n\n    offer.registerCallback('loaded', () => {\n      var surfaceParameter = util.getQueryParamByName('surface');\n      if ((surfaceParameter === 'meter_limit_reached' || surfaceParameter === 'locked_article') && !pn.inappBrowserReturn) {\n        trackCustomEvent('ViewPaywall', { surface: 'IA' });\n      }\n    });\n\n    var loginSuccessCallback = (params: any) => {\n      _generateAndSignSubscriptionPayload().then(() => {\n        if (params.registration) {\n          trackCustomEvent('CreateAccount');\n        } else {\n          trackCustomEvent('LogIntoAccount', { is_subscriber: !!signedSubscriptionPayload });\n        }\n        if (!!signedSubscriptionPayload) {\n          // wait for the pixel to complete according to\n          // https://developers.facebook.com/docs/mediaguide/pixel-and-analytics?locale=ru_RU\n          setTimeout(() => {\n            _redirectToFacebook();\n          }, 200);\n        }\n      });\n    };\n\n    var experienceExecuteActionHandler = () => {\n      if (user.isUserValid()) {\n        _redirectIfUserHasAccess();\n      }\n    };\n\n    pn.addHandler('loginSuccess', loginSuccessCallback);\n    pn.addHandler('experienceExecute', experienceExecuteActionHandler);\n\n    offer.registerCallback('alreadyPurchased', (params: any) => {\n      _checkResourceAccess(params.rid);\n    });\n\n    offer.registerCallback('startCheckout', (params: any) => {\n      trackEvent('InitiateCheckout',\n        {\n          offer_code: params.offerId,\n          campaign_code: params.termId\n        });\n    });\n\n    offer.registerCallback('complete', (params: any) => {\n      if (params.hasOwnProperty('chargeCurrency') && params.hasOwnProperty('chargeAmount')) {\n        trackEvent('Purchase',\n          {\n            currency: params.chargeCurrency,\n            value: params.chargeAmount,\n            offer_code: params.offerId,\n            campaign_code: params.termId\n          });\n      }\n      _checkResourceAccess(params.rid);\n    });\n\n    offer.registerCallback('close', () => {\n      _redirectToFacebook();\n    });\n\n    _isInitialized = true;\n  }\n\n  function resolveTimeout() {\n    return new Promise(function (resolve) {\n      setTimeout(function () {\n        resolve(null);\n      }, pn.redirectToFbTimeout * 1000);\n    })\n  }\n\n  function _generateAndSignSubscriptionPayload(rid?: string): any {\n\n    return new Promise(function (resolve) {\n\n      var requestParams = {\n        aid: pn.aid,\n        rid: '',\n        account_linking_token: util.getQueryParamByName('account_linking_token'),\n        user_token: user.getProvider().getToken(),\n        user_provider: user.getProvider().getName()\n      };\n\n      if (rid) {\n        requestParams.rid = rid;\n      }\n\n      api.callApi('/fbia/subscriptionPayload/generate', requestParams,\n        function (response: any) {\n          if (response && response.data) {\n            signedSubscriptionPayload = response.data;\n          }\n          resolve(null);\n        }\n      );\n    });\n  }\n\n  const _redirectIfUserHasAccess = () => {\n    _generateAndSignSubscriptionPayload().then(() => {\n      if (signedSubscriptionPayload) {\n        _redirectToFacebook();\n      }\n    });\n  }\n\n  const _checkResourceAccess = (rid: string) => {\n    if (!rid) {\n      util.error('fbsubscriptions: \\'rid\\' could not be empty on generating subscription payload');\n      return;\n    }\n\n    var timerPromise = resolveTimeout();\n    var generatePayloadPromise = _generateAndSignSubscriptionPayload(rid);\n    util.__protected__.waitAllPromises([timerPromise, generatePayloadPromise]).then(() => {\n      _redirectToFacebook();\n    });\n  }\n\n  const _redirectToFacebook = () => {\n    var accountLinkingToken = util.getQueryParamByName('account_linking_token');\n    var redirectUri = util.getQueryParamByName('redirect_uri') + \"?account_linking_token=\" + encodeURIComponent(accountLinkingToken);\n    if (signedSubscriptionPayload) {\n      redirectUri += '&subscription_payload=' + encodeURIComponent(signedSubscriptionPayload);\n    }\n    window.location.href = redirectUri;\n  }\n\n  /**\n   * Fire this method after loginRequired in case user_ref\n   *\n   * tp.push([\"addHandler\", \"loginRequired\", function(params){\n   *   mysite.showLoginRegistration(function() {\n   *     tp.push([\"setUserRef\", pianoUserRef]);\n   *     tp.fbsubscriptions.checkUserAccessAndRedirectToFb();\n   *   });\n   *\n   *   return false;\n   * }\n   */\n  const checkUserAccessAndRedirectToFb = (): void => {\n    _generateAndSignSubscriptionPayload().then(() => {\n      _redirectToFacebook();\n    });\n  }\n\n  const trackEvent = (eventName: string, eventParams?: any) => {\n    if (sentEvents[eventName]) {\n      return;\n    }\n    sentEvents[eventName] = true;\n\n    analytics.fbpixel.event({ eventType: FB_PIXEL_EVENT_TYPE.TRACK_EVENT, payload: { eventName, eventParams } });\n  }\n\n  const trackCustomEvent = (eventName: string, eventParams?: any) => {\n    if (sentCustomEvents[eventName]) {\n      return;\n    }\n    sentCustomEvents[eventName] = true;\n\n    analytics.fbpixel.event({ eventType: FB_PIXEL_EVENT_TYPE.TRACK_CUSTOM_EVENT, payload: { eventName, eventParams } });\n  }\n\n  const isInitialized = (): boolean => {\n    return _isInitialized;\n  };\n\n  return {\n    name,\n    /**\n     * Fire this method after loginRequired in case user_ref\n     *\n     * tp.push([\"addHandler\", \"loginRequired\", function(params){\n     *   mysite.showLoginRegistration(function() {\n     *     tp.push([\"setUserRef\", pianoUserRef]);\n     *     tp.fbsubscriptions.checkUserAccessAndRedirectToFb();\n     *   });\n     *\n     *   return false;\n     * }\n     */\n    checkUserAccessAndRedirectToFb,\n    isInitialized,\n    __private__: {\n      isInitialized,\n    },\n    __protected__: {\n      init,\n    }\n  };\n\n})();\n\npn.container.register('fbsubscriptions', {\n  useValue: fbsubscriptions\n});\npn.fbsubscriptions = pn.container.resolve<FbsubscriptionsInterface>('fbsubscriptions');\n", "import { UtilInterface } from \"./util\";\nimport { RecWidgetServiceInterface } from \"./recWidgetService\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { dataLayer } from '@piano-sdk/data-layer';\nimport { TPropertiesSet } from \"@piano-sdk/data-layer/properties\";\nimport { EventType, LOG_EVENT_TYPE } from \"./log\";\nimport { AnalyticsInterface } from \"./analytics\";\n\nexport interface CxenseInterface {\n  name: string;\n  __protected__: {\n    showRecommendation(config: any): void;\n    clearWidgets(): void;\n    sendPageViewEvent(config: any): void;\n    isActivated(): boolean;\n    isCustomerPrefixConfigured(config: any): boolean;\n    isConfiguredPollingAsync(ignoreCCE: boolean, pollingInterval: number, retryCount: number): any;\n    invokeCxenseFn(fn: Function): void;\n    getC1XIntegrationVersion(): string;\n    loadCxLibIfNeeded(): void;\n    loadCxLibIfNeeded(): void;\n  }\n}\n\nexport const cxense = ((container = pn.container): CxenseInterface => {\n  const jqUtils = container.resolve<JqUtilsInterface>('jqUtils');\n  const util = container.resolve<UtilInterface>('util');\n  const analytics = container.resolve<AnalyticsInterface>('analytics');\n  const recWidgetService = container.resolve<RecWidgetServiceInterface>('recWidgetService');\n\n  const name = 'cxense';\n\n  const recWidget = recWidgetService.__protected__.getInstance();\n\n  /**\n   * we should keep already displayed recommendations,\n   * cuz cxense does not handle the last element of array\n   * Also, cxense does not remember previous displayed recommendations,\n   * each runMulti will work as new handler\n   */\n  const alreadyDisplayed: any[] = [];\n\n  const setSiteId = () => {\n    const siteId = pn.cxenseSiteId;\n    util.debug('c1x: setting siteId: ', siteId);\n    window.cX.setSiteId(siteId);\n  }\n\n  const getC1XIntegrationVersion = (): string => {\n    if ((typeof pn.c1XIntegrationVersion !== \"undefined\") && (pn.cxenseSiteId !== '')) {\n      return pn.c1XIntegrationVersion;\n    } else {\n      return \"N/A\";\n    }\n  }\n\n  const getCxCdnUrl = () => {\n    if ((typeof pn.cxCdnUrl !== \"undefined\") && (pn.cxCdnUrl !== '')) {\n      return pn.cxCdnUrl;\n    } else {\n      return \"https://cdn.cxense.com\";\n    }\n  }\n\n  const isActivated = (): boolean => {\n    return ((typeof pn.cxenseSiteId !== \"undefined\") && (pn.cxenseSiteId !== ''));\n  }\n\n  const _isConfigured = (ignoreCCE?: boolean): boolean => {\n    return (typeof window.cX !== 'undefined' && typeof window.cX.library !== \"undefined\") &&\n      (ignoreCCE || (typeof window.cX.CCE !== 'undefined' && typeof window.cX.CCE.library !== \"undefined\"));\n  }\n\n  const isCustomerPrefixConfigured = (config: any) => {\n    return ((typeof config.cxenseCustomerPrefix !== \"undefined\") && (config.cxenseCustomerPrefix !== ''));\n  }\n\n  const sendPageViewEvent = (config: any): void => {\n    let cxAllow = true;\n    if (!isActivated() && !isCustomerPrefixConfigured(config)) {\n      cxAllow = false;\n    }\n    if (!isActivated() && isCustomerPrefixConfigured(config)) {\n      util.debug('cxense: can not send pageview because siteId is not configured using `setCxenseSiteId`');\n      cxAllow = false;\n    }\n    if (isActivated() && !isCustomerPrefixConfigured(config)) {\n      util.debug('cxense: can not send pageview because customer prefix is not configured in app settings');\n      cxAllow = false;\n    }\n\n    sendPageViewEventAndInjectIds(config, cxAllow);\n  };\n\n  // TODO rename this method after dataLayer migration\n  const sendPageViewEventAndInjectIds = (config: any, cxAllow: boolean) => {\n    let userState: TPropertiesSet['userStatus'] = 'anon';\n    let debug = (...args: [val1: any, val2?: any, val3?: any, val4?: any, val5?: any, val6?: any, val7?: any, val8?: any]) => {\n      if (cxAllow) {\n        util.debug.apply(util, args);\n      }\n    }\n\n    if (config.uid && config.uid !== 'anon' && config.uid !== '') {\n      const hasActiveAccess: boolean = !!(config.eventExecutionContext?.accessList?.length);\n\n      userState = hasActiveAccess ? 'hasActiveAccess' : 'registered';\n      debug('c1x: adding externalId', {uid: config.uid, prefix: config.cxenseCustomerPrefix});\n    }\n\n    debug('c1x: adding CustomParameters userState', {userState: userState});\n    debug('c1x: sending pageview event');\n\n    // accumulate registered users\n    if (userState !== 'anon') {\n      util.__protected__.setVxUsersToDataLayer({\n        [config.uid]: {\n          prefix: config.cxenseCustomerPrefix || '',\n          type: 'VX'\n        }\n      });\n    } else {\n      // reset all VX users\n      util.__protected__.setVxUsersToDataLayer(null);\n    }\n    dataLayer.set('userStatus', userState);\n    if (cxAllow) {\n      dataLayer.set('siteId', pn.cxenseSiteId); // can be removed\n      const cX = window.cX = window.cX || {};\n\n      cX.callQueue = cX.callQueue || [];\n      cX.callQueue.push(['sendPageViewEvent', { location: pn.customPageUrl || undefined }]);\n    }\n  }\n\n  const loadCxLibIfNeeded = (): void => {\n    const callName = 'cxLibLoading';\n    util.waitCall(callName, () => {\n      if (isActivated() && _isConfigured(true)) {\n        return;\n      }\n      util.startCall(callName);\n      var onLoadTimer: NodeJS.Timeout;\n      var documentScript = document.getElementsByTagName('script')[0];\n      var scriptElement = document.createElement('script');\n\n      scriptElement.onerror = (e) => {\n        if (onLoadTimer) {\n          clearTimeout(onLoadTimer);\n        }\n        util.doneCall(callName);\n        util.debug('c1x: error during load of cx.js. ', e);\n      };\n      scriptElement.onload = () => {\n        onLoadTimer = setTimeout(() => {\n          util.doneCall(callName);\n        }, 500);\n        util.debug('c1x: cx.js has been successfully loaded');\n      };\n\n      scriptElement.async = true;\n      scriptElement.type = 'text/javascript';\n      if (pn.c1XLoadCce) {\n        scriptElement.src = getCxCdnUrl() + \"/\" + \"cx.cce.js\";\n      } else {\n        scriptElement.src = getCxCdnUrl() + \"/\" + \"cx.js\";\n      }\n\n      util.debug('c1x: start loading cx.js on the page...');\n      documentScript.parentNode?.insertBefore(scriptElement, documentScript);\n    });\n  };\n\n  /**\n   * _showRecommendation triggers sync\n   * we need to collect all calls and handle them as a single\n   */\n  const _collector = function (fn: any) {\n    let timer: ReturnType<typeof setTimeout> | null = null;\n    let batch: any[] = [];\n\n    function exec() {\n      if (timer) {\n        clearTimeout(timer);\n      }\n      timer = null;\n      fn(batch);\n      batch = [];\n    }\n\n    return function collect(config: any) {\n      if (!timer) {\n        timer = setTimeout(exec, 10);\n      }\n      batch.push(config);\n    }\n  }\n\n  const _showRecommendation = (configs: any[]): void => {\n    if (!isActivated()) {\n      util.debug('c1x: can not show recommendation because siteId is not configured using `setCxenseSiteId`');\n      return;\n    }\n\n    const widgets: any = [];\n\n    for (var index = 0; index < configs.length; index++) {\n      const widgetConfig = configs[index] || {};\n      const widgetResult = recWidget.showRecommendation({\n        widgetConfig: widgetConfig,\n        createPlaceholderFn: getPlaceholderFn(widgetConfig.widgetId, widgetConfig.displayMode)\n      });\n      widgetResult && widgets.push({\n        widgetParams: {\n          widgetId: widgetConfig.widgetId,\n          targetElementId: 'cxense-' + widgetConfig.widgetId,\n          experienceId: widgetConfig.experienceId,\n          experienceActionId: widgetConfig.experienceActionId,\n          trackingId: widgetConfig.trackingId,\n        },\n        widgetCallback: (cxenseHttpResponse: any) => {\n          var response = cxenseHttpResponse && cxenseHttpResponse.response;\n          if (response && !cxenseHttpResponse.response.error) {\n            if (widgetConfig.displayMode === 'modal') {\n              recWidget.fixWidgetModalWidth(\n                recWidget.findWidget(widgetConfig.widgetId)\n              );\n            }\n\n            for (var index = 0; index < response.items.length; index++) {\n              // alreadyDisplayed populates inside cxense, but\n              //  - cxense ignores the last item of array\n              //  - alreadyDisplayed will not consider in future calls\n              // We take it to our side\n              const element = response.items[index].id;\n              if (alreadyDisplayed.indexOf(element) === -1) {\n                alreadyDisplayed.push(element);\n              }\n            }\n\n            analytics.log.event({\n              eventType: LOG_EVENT_TYPE.LOG_AUTO_MICRO_CONVERSION,\n              payload: {\n                trackingId: widgetConfig.trackingId,\n                eventGroupId: 'init',\n                eventType: EventType.EXTERNAL_EVENT,\n                customParams: {\n                  source: 'CX',\n                },\n              }\n            });\n          }\n        }\n      });\n    }\n\n    invokeCxenseFn(() => {\n      setSiteId();\n      // each call runMulti (includes future calls) must consider already\n      // displayed recommendations to ignore duplicates\n      window.cX.CCE.runMulti(widgets, ['id'], alreadyDisplayed);\n    });\n  };\n\n  const showRecommendation = _collector(_showRecommendation);\n\n  const clearWidgets = () => {\n    recWidget.clearWidgets();\n  }\n\n  const getPlaceholderFn = (widgetId: string, displayMode: string) => {\n    return () => {\n      const sxensePlaceholder = document.createElement('div');\n      jqUtils.addClass(`tp-cxense-placeholder-${displayMode}`, sxensePlaceholder);\n      jqUtils.addClass('tp-widget-placeholder', sxensePlaceholder);\n      const cxenseWidget = document.createElement('div');\n      cxenseWidget.id = `cxense-${widgetId}`;\n      sxensePlaceholder.appendChild(cxenseWidget);\n      return sxensePlaceholder;\n    };\n  };\n\n  const invokeCxenseFn = (fn: Function): void => {\n    window.cX = window.cX || {};\n    window.cX.CCE = window.cX.CCE || {};\n    window.cX.CCE.callQueue = window.cX.CCE.callQueue || [];\n    window.cX.CCE.callQueue.push(['invoke', fn]);\n  };\n\n  const isConfiguredSync = (ignoreCCE: boolean) => {\n    return _isConfigured(ignoreCCE);\n  };\n\n  const isConfiguredPollingAsync = (ignoreCCE: boolean, pollingInterval: number, retryCount: number): any => {\n    pollingInterval = pollingInterval || 0;\n    retryCount = retryCount || 0;\n\n    var retries = 0;\n\n    return new Promise((resolve, reject) => {\n      const pollingFunc = () => {\n        if (isConfiguredSync(ignoreCCE)) {\n          resolve(true);\n        } else {\n          if (retries >= retryCount) {\n            reject(\n              ignoreCCE\n                ? 'c1x: cX object is not found after ' + retryCount + ' retries with '\n                + pollingInterval + 'ms interval'\n                : 'c1x: cX and cX.CCE objects are not found after ' + retryCount + ' retries with '\n                + pollingInterval + 'ms interval'\n            );\n          } else {\n            retries++;\n            setTimeout(pollingFunc, pollingInterval)\n          }\n        }\n      };\n\n      if (isConfiguredSync(ignoreCCE)) {\n        resolve(true);\n      } else {\n        setTimeout(pollingFunc, pollingInterval);\n      }\n    });\n\n  };\n\n  return {\n    name,\n    __protected__: {\n      showRecommendation,\n      clearWidgets,\n      sendPageViewEvent,\n      isActivated,\n      isCustomerPrefixConfigured,\n      isConfiguredPollingAsync,\n      invokeCxenseFn,\n      getC1XIntegrationVersion,\n      loadCxLibIfNeeded,\n    }\n  }\n});\n\npn.container.register('cxense', {\n  useValue: cxense()\n});\npn.cxense = pn.container.resolve<CxenseInterface>('cxense');\n", "// Template interaction\n\nconst FormEventTypeMap = {\n  5: 'customFormSubmitted',\n  6: 'customFormSubmitted',\n  7: 'customFormClosed'\n} as const;\n\nexport const EventTypeMap = {\n  1: 'autoRenewalDisabled',\n  2: 'subscriptionCancellation',\n  3: 'dismissTemplate',\n  4: 'customEvent',\n  ...FormEventTypeMap\n} as const;\n\nexport const TEMPLATE_INTERACTION_EVENT = 'templateInteractionEvent';\nexport const FORM_INTERACTION_EVENT = 'formInteractionEvent';\n\nexport const INTERACTION_METHOD_NAME = 'executeTemplateInteraction';\nexport const INTERACTION_END_POINT = '/xbuilder/experience/' + INTERACTION_METHOD_NAME;\n\nexport type InteractionEventCode = keyof typeof EventTypeMap;\nexport type InteractionEventName = typeof EventTypeMap[InteractionEventCode];\n\nexport const FinalConfirmation = 'finalConfirmation';\n\nexport const TemplateTypesMap = [1] as const;\n\nexport type ExecuteInteractionConfig = {\n  template_type: 1; // //todo what does it mean?\n}\n\nexport type ExecuteInteractionResult = {\n  registeredEvents: InteractionEventName[]\n}\n\nexport type InteractionConfig = {\n  templateType?: TemplateTypes;\n}\n\nexport type ExecuteTemplateInteraction = {\n  executeTemplateInteraction: (config?: InteractionConfig) => Promise<ExecuteInteractionResult>\n}\n\nexport type TemplateTypes = typeof TemplateTypesMap[number];\n\nexport type RegisterCb<T = void> = (\n  event: EventCondition<T>,\n  onEvent: (continuation: Function | null) => void,\n  onError: (errMsg: string) => void,\n) => void;\n\nexport type EventCondition<T = {}> = {\n  type: string;\n  eventType: number;\n  parentId: string;\n  moduleId: string;\n  customEventName?: string;\n} & T;\n\nexport type InteractionContext = {\n  endpoint: string;\n  name: 'executeTemplateInteraction'\n  isDenied: () => boolean;\n  add: (event: EventCondition, events: EventCondition[]) => void;\n  get: () => InteractionEventName[];\n  getEventsByModelId: (moduleId?: string) => string[];\n}\n\nexport type ContinuationFn = Function & { subscriptionId: string; done?: boolean; forceTrackStat?: boolean };\n\nexport type HandlerConfig<T = {\n  [x in string]?: any\n}> = {\n  experienceActionId?: string,\n  continuation?: Function,\n} & T;\n\nexport type TemplateInteractionParam = string | Error | undefined;\n", "import {\n    ContinuationFn,\n    EventCondition,\n    EventTypeMap,\n    FORM_INTERACTION_EVENT,\n    InteractionEventCode,\n    TEMPLATE_INTERACTION_EVENT\n} from \"./types\";\n\n\ntype CB = {\n    cb: Function;\n    check: (...args: any[]) => boolean;\n    skip?: boolean;\n    res?: null | any;\n};\n\nconst createCbsById = () => {\n    let map: Record<string, Record<string, CB[]>> = {};\n\n    const add = (id: string, name: string, cb: CB) => {\n        if (!map[id]) {\n            map[id] = {};\n        }\n        if (!map[id][name]) {\n            map[id][name] = [];\n        }\n\n        map[id][name].push(cb);\n    }\n\n    const get = (id: string, name: string): CB[] | null => {\n        return map[id]?.[name] || null;\n    }\n\n    const clear = () => {\n        map = {};\n    }\n\n    return {\n        add,\n        get,\n        clear,\n    }\n}\n/**\n * RegisterCallback is called only once per module and proceeds internal node events\n * If callback returns true then the callback will be removed from wrapper\n */\nexport const createCustomRegister = <T extends string>(registerCallback: (eventName: T, cb: Function) => void) => {\n    let cbsByName: Record<string, CB[]> = {};\n    const cbsById = createCbsById();\n\n    const getCbName = (type: number | string) => EventTypeMap[type as InteractionEventCode] || type as string;\n\n    const on = (\n        type: number | string,\n        id: string | null,\n        registeredCb: Function,\n        verifyCb: (...args: any[]) => boolean = (() => true),\n        skipFirstCall = false,\n    ) => {\n        const cbName = getCbName(type);\n        const cb: CB = {\n            cb: registeredCb,\n            check: verifyCb,\n            skip: skipFirstCall,\n        };\n\n        if (!cbsByName[cbName]) {\n            cbsByName[cbName] = [];\n            registerCallback(cbName as T, (...args: any[]) => {\n                // reset is done flag for all registered callbacks\n                cbsByName[cbName]!.forEach(cbWrapper => cbWrapper.res = null);\n                cbsByName[cbName]!.forEach((cbWrapper) => {\n                    const { cb, check, skip } = cbWrapper;\n                    if (check(...args)) {\n                        if (skip) {\n                            cbWrapper.skip = false;\n                        } else {\n                            cbWrapper.res = cb(...args) ?? null;\n                        }\n                    }\n                });\n            });\n        }\n        if (id) {\n            cbsById.add(id, cbName, cb);\n        }\n        cbsByName[cbName]!.push(cb);\n    }\n\n    const skipOne = (\n        id: string,\n        type: number | string,\n    ): boolean => {\n        const cbName = getCbName(type);\n        const cbs = cbsById.get(id, cbName);\n\n        cbs?.forEach(cb => {\n            cb.skip = true;\n        });\n\n        return !!cbs;\n    }\n\n    const get = (\n        id: string,\n        type: number | string\n    ): CB[] | null => cbsById.get(id, getCbName(type));\n\n    const has = (\n        id: string,\n        type: number | string\n    ): boolean => !!get(id, type);\n\n    return {\n        clear: () => {\n            Object.keys(cbsByName).forEach(cbName => {\n                cbsByName[cbName] = [];\n            })\n            cbsById.clear();\n        },\n        on,\n        has,\n        get,\n        skipOne,\n    }\n};\n\nexport const closeModalWrapper = (\n    closeModal: () => void,\n    closeInline: (selector: string) => void\n) => (selector: string | null) => selector !== null ? closeInline(selector) : closeModal();\n\n// Args selectors\nexport const getContinuationFromArg = (args: any): ContinuationFn | null => (args || {}).continuation || null;\nexport const getTrackingIdFromArg = (args: any): ContinuationFn | null => (args || {}).trackingId || null;\nexport const getExperienceActionIdFromArg = (args: any): string | null => (args || {}).experienceActionId || null;\n\nconst interactionEvents = [TEMPLATE_INTERACTION_EVENT, FORM_INTERACTION_EVENT];\n\nexport const isInteractionEvent = (name: string): boolean => interactionEvents.includes(name);\n\nexport const isRootEventType = (eventLocal: EventCondition): boolean => eventLocal.eventType === 1\n  || eventLocal.eventType === 2;\n\nexport const isRootEvent = (eventLocal: EventCondition): boolean => isInteractionEvent(eventLocal.type)\n  && isRootEventType(eventLocal);\n\nexport const getRootEvent = (events?: EventCondition[]): EventCondition | null => events && events.find(isRootEvent) || null;\n", "export enum CustomFieldOperator {\n  EQUALS = 'equals',\n  NOT_EQUALS = 'notEquals',\n  GREATER = 'greater',\n  LESS = 'less',\n  MATCHES = 'matches',\n  CONTAINS = 'contains',\n  NOT_CONTAINS = 'notContains',\n  OCCURS_BEFORE = 'occursBefore',\n  OCCURS_AFTER = 'occursAfter',\n  OCCURS_ON = 'occursOn',\n  OCCURS_WITHIN = 'occursWithin',\n  NOT_OCCURS_WITHIN = 'notOccurWithin',\n  ANY_OF = 'anyOf',\n  EMPTY = 'empty',\n  NOT_EMPTY = 'notEmpty',\n}\n\nexport enum DataType {\n  TEXT = 'TEXT',\n  ISO_DATE = 'ISO_DATE',\n  BOOLEAN = 'BOOLEAN',\n  NUMBER = 'NUMBER',\n  SINGLE_SELECT_LIST = 'SINGLE_SELECT_LIST',\n  MULTI_SELECT_LIST = 'MULTI_SELECT_LIST',\n}\n\nexport enum ValueType {\n  VOID = \"void\",\n  STRING_LIST = \"stringList\",\n  NUMBER = \"number\",\n  BOOLEAN = \"boolean\",\n  DATE = \"date\",\n  RELATIVE_DATE = \"relativeDate\",\n  DATE_RANGE = \"dateRange\",\n  RELATIVE_DATE_RANGE = \"relativeDateRange\",\n}\n\nexport enum TimeUnit {\n  DAYS = 'days',\n  WEEKS = 'weeks',\n  MONTHS = 'months',\n  YEARS = 'years',\n}\n\nexport enum TimeType {\n  AGO = 'ago',\n  FROM_NOW = 'fromNow',\n}\n\ntype RuleValueGeneric<Type extends ValueType, Value = never> = {\n  valueType: Type,\n  value?: Value | null\n}\n\ntype RuleValueCustom<Type extends ValueType, Fields extends Record<string, any>> = {\n  valueType: Type,\n} & Fields;\n\nexport type VoidValue = RuleValueGeneric<ValueType.VOID>;\nexport type StringListValue = RuleValueGeneric<ValueType.STRING_LIST, string[]>;\nexport type NumberValue = RuleValueGeneric<ValueType.NUMBER, number>;\nexport type BooleanValue = RuleValueGeneric<ValueType.BOOLEAN, boolean>;\nexport type DateValue = RuleValueGeneric<ValueType.DATE, string>;\nexport type RelativeDateValue = RuleValueCustom<ValueType.RELATIVE_DATE, {\n  timeUnitNumber?: number;\n  timeUnit?: TimeUnit;\n  timeType?: TimeType;\n  regardlessOfYears?: boolean;\n}>;\nexport type DateRangeValue = RuleValueCustom<ValueType.DATE_RANGE, {\n  from?: string;\n  to?: string;\n}>;\nexport type RelativeDateRangeValue = RuleValueCustom<ValueType.RELATIVE_DATE_RANGE, {\n  fromTimeUnitNumber?: number,\n  fromTimeUnit?: TimeUnit,\n  fromTimeType?: TimeType,\n  toTimeUnitNumber?: number,\n  toTimeUnit?: TimeUnit,\n  toTimeType?: TimeType,\n  regardlessOfYears?: boolean\n}>;\n\nexport type RuleValue = VoidValue\n| StringListValue\n| NumberValue\n| BooleanValue\n| DateValue\n| RelativeDateValue\n| DateRangeValue\n| RelativeDateRangeValue;\n\nexport type CustomFieldRule = {\n  fieldName?: String,\n  operator?: CustomFieldOperator,\n  ruleValue?: RuleValue,\n  historyPolicy?: never;\n}\n\nexport type CustomFieldValue = {\n  fieldName?: string | null,\n  value?: string | null,\n  created?: string | null,\n  emailCreator?: string | null,\n  dataType?: string | null\n}\n\nexport type EmptinessResult = {\n  result: boolean;\n  proceed: boolean;\n}\n\nexport type CustomFieldPredicate = (\n  rule: CustomFieldRule,\n  value: any,\n  debug: (msg: string) => void,\n) => boolean\n", "import { TimeUnit } from \"./custom-fields.types\";\n\n// shor utils\n\nconst getYear = (d: Date): number => d.getFullYear();\nconst getMonth = (d: Date): number => d.getMonth();\nconst getDay = (d: Date): number => d.getDate();\nconst setYear = (d: Date, year: number) => d.setFullYear(year);\nconst number = (v: any): number => Number(v);\n\nconst yearsBetween = (date1: Date, date2: Date): number => {\n  const oneYear = 1000 * 60 * 60 * 24 * 365;\n  const diff = date1.getTime() - date2.getTime();\n\n  return Math.floor(diff / oneYear);\n}\n\nconst getFirstDateOfYear = (date: Date): Date => new Date(getYear(date), 0, 1);\nconst getLastDateOfYear = (date: Date): Date => new Date(getYear(date), 11, 31);\n\nconst checkInRangeWithinYear = (\n  fromDate: Date,\n  toDate: Date,\n  userDate: Date\n): boolean => {\n  const year = getYear(userDate);\n\n  const fromDateWithYear = new Date(fromDate);\n  setYear(fromDateWithYear, year);\n\n  const toDateWithYear = new Date(toDate);\n  setYear(toDateWithYear, year);\n\n  return userDate <= toDateWithYear && userDate >= fromDateWithYear;\n}\n\nexport const inRangeRegardlessOfYears = (\n  fromDate: Date,\n  toDate: Date,\n  userDate: Date\n): boolean => {\n  if (fromDate > toDate) {\n    return false\n  }\n  if (yearsBetween(fromDate, toDate) >= 1) {\n    return true\n  }\n  if (getYear(fromDate) == getYear(toDate)) {\n    return checkInRangeWithinYear(fromDate, toDate, userDate)\n  } else {\n    let firstDay = getFirstDateOfYear(toDate);\n    let lastDay = getLastDateOfYear(fromDate);\n    let checkRange1 = checkInRangeWithinYear(fromDate, lastDay, userDate)\n    let checkRange2 = checkInRangeWithinYear(firstDay, toDate, userDate)\n    return checkRange1 || checkRange2\n  }\n}\n\n\nexport const equalsRegardlessOfYear = (d1: Date, d2: Date): boolean => {\n  const year = getYear(d1);\n  const fromDateWithYear = new Date(d1);\n  setYear(fromDateWithYear, year);\n\n  const toDateWithYear = new Date(d2);\n  setYear(toDateWithYear, year);\n\n  return fromDateWithYear.getTime() === toDateWithYear.getTime()\n}\n\nexport const timeUnitPlus = (timeUnit: TimeUnit | null | undefined, d: Date, units: number): Date | null=> {\n  if (!timeUnit) {\n    return null;\n  }\n\n  const date = new Date(d);\n  switch (timeUnit) {\n    case TimeUnit.DAYS:\n      date.setDate(getDay(date) + units);\n      break;\n    case TimeUnit.MONTHS:\n      date.setMonth(getMonth(date) + units);\n      break;\n    case TimeUnit.YEARS:\n      date.setFullYear(getYear(date) + units);\n      break;\n    case TimeUnit.WEEKS:\n      date.setDate(getDay(date) + units * 7);\n      break;\n    default:\n      break;\n  }\n  return date;\n}\n\nconst DATE = /^(\\d{4})(?:-(\\d{2}))?(?:-(\\d{2}))?$/;\n\nexport const parseDateISO = (date: string | null | undefined, defaultValue: Date | null): Date | null => {\n  if (!date) {\n    return defaultValue ? new Date(defaultValue) : null;\n  }\n  let result;\n\n  if (DATE.test(date)) {\n    const [, year, month = '1', day = '1'] = date.match(DATE) || [];\n    result = new Date(number(year), number(month) - 1, number(day));\n  } else {\n    result = new Date(date);\n  }\n\n  if (isNaN(result.getTime())) {\n    return null;\n  }\n\n  return result;\n}\n\nexport const getDateNowWithoutTZ = (): Date => {\n  const localDate = new Date();\n\n  return new Date(getYear(localDate), getMonth(localDate), getDay(localDate));\n}\n", "/*\n * The code was moved from module/src/main/kotlin/io/piano/c2/execution/module/customfields/service/CustomFieldsCheckerService.kt\n */\nimport {\n  BooleanValue,\n  CustomFieldOperator,\n  CustomFieldPredicate,\n  CustomFieldRule,\n  CustomFieldValue,\n  DataType,\n  DateRangeValue,\n  DateValue,\n  EmptinessResult,\n  NumberValue,\n  RelativeDateRangeValue,\n  RelativeDateValue,\n  StringListValue,\n  TimeType,\n  ValueType\n} from \"./custom-fields.types\";\nimport {\n  equalsRegardlessOfYear,\n  getDateNowWithoutTZ,\n  inRangeRegardlessOfYears,\n  parseDateISO,\n  timeUnitPlus\n} from './custom-fields.util';\nimport {EventCondition, HandlerConfig, RegisterCb} from \"./types\";\nimport {getContinuationFromArg} from \"./utils\";\n\nconst notSupported = (operator: any, type: string) => `Not supported operator '${operator}' for ${type}`\n\nexport const checkCustomFields = (\n  userCustomFields: CustomFieldValue[],\n  rules: CustomFieldRule[],\n  debug: (msg: string) => void = () => {\n  }\n): boolean => rules.every(rule => {\n  let filteredCustomFields: CustomFieldValue[] = filterCustomFields(rule, userCustomFields);\n\n  if (!filteredCustomFields.length) {\n    debug(`Values of custom fields ${rule.fieldName} is not found`);\n    return false;\n  } else {\n    const ruleResult = filteredCustomFields.some(customField => checkRule(rule, customField, debug));\n\n    if (!ruleResult) {\n      const fieldName = rule.fieldName;\n      const fieldValues = filteredCustomFields.map(field => field.value).join(', ');\n      const ruleMath = `\"${rule.operator}\": ${JSON.stringify(rule.ruleValue)}`;\n\n      debug(`field \"${fieldName}\":[${fieldValues}] does not match a rule ${ruleMath}`);\n      return false;\n    }\n  }\n\n  return true;\n});\n\nconst typeCheckerMap = {\n  [DataType.TEXT]: createTextFieldRuleChecker(),\n  [DataType.NUMBER]: createNumberFieldRuleChecker(),\n  [DataType.ISO_DATE]: createDateFieldRuleChecker(),\n  [DataType.BOOLEAN]: createBooleanValueFieldRuleChecker(),\n  [DataType.SINGLE_SELECT_LIST]: createSingleSelectListValueFieldRuleChecker(),\n  [DataType.MULTI_SELECT_LIST]: createMultiSelectListValueFieldRuleChecker()\n}\n\nfunction checkRule(rule: CustomFieldRule, customField: CustomFieldValue, debug: (msg: string) => void,): boolean {\n  if (!(customField.dataType! in DataType)) {\n    return false;\n  }\n\n  const dataType = customField.dataType as DataType;\n  const typeChecker = typeCheckerMap[dataType];\n\n  if (!typeChecker) {\n    debug(`dataType: ${dataType} is not supported`);\n    return false;\n  }\n  let fieldValue: string | null = '';\n\n  try {\n    fieldValue = JSON.parse(customField.value || '');\n  } catch (e) {\n    fieldValue = customField.value || null;\n  }\n\n  try {\n    return typeChecker(rule, fieldValue, debug);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction filterCustomFields(rule: CustomFieldRule, customFields: CustomFieldValue[]): CustomFieldValue[] {\n  try {\n    return customFields.filter(field => field.fieldName === rule.fieldName);\n  } catch (e) {\n    return [];\n  }\n}\n\nfunction logIncorrectValueTypeIfNeed(\n  rule: CustomFieldRule,\n  allowedTypes: ValueType[],\n  debug: (msg: string) => void,\n) {\n  if (allowedTypes.some((type) => type === rule.ruleValue?.valueType)) {\n    return;\n  }\n\n  debug(`Incorrect value type '${rule.ruleValue?.valueType}' for operator '${rule.operator}'`);\n}\n\nconst createEmptinessResult = (\n  valueIsEmpty: boolean,\n  operator?: CustomFieldOperator | null,\n): EmptinessResult => {\n  const createResult = (result: boolean, proceed: boolean) => ({\n    result,\n    proceed,\n  });\n\n  if (operator === CustomFieldOperator.EMPTY) {\n    return createResult(valueIsEmpty, false);\n  } else if (operator === CustomFieldOperator.NOT_EMPTY) {\n    return createResult(!valueIsEmpty, false);\n  } else if (valueIsEmpty) {\n    return createResult(valueIsEmpty, true);\n  } else {\n    return createResult(valueIsEmpty, true);\n  }\n}\n\n\nfunction checkEmptiness(value: string | null | undefined, operator?: CustomFieldOperator | null): EmptinessResult {\n  const valueIsEmpty = typeof value === 'string' ? !value.trim() : value === null;\n\n  return createEmptinessResult(valueIsEmpty, operator);\n}\n\nfunction checkEmptinessForArray(value: string[] | null | undefined, operator?: CustomFieldOperator | null): EmptinessResult {\n  const valueIsEmpty = !value || value.length === 0;\n\n  return createEmptinessResult(valueIsEmpty, operator);\n}\n\n// ---------\nfunction createTextFieldRuleChecker(): CustomFieldPredicate {\n  return (rule: CustomFieldRule, value: any, debug) => {\n    const operator: CustomFieldOperator | undefined = rule.operator;\n    const empty = checkEmptiness(value, operator);\n    if (!empty.proceed) {\n      return empty.result;\n    }\n    const userValue: string = String(value!).trim().toLowerCase();\n    logIncorrectValueTypeIfNeed(rule, [ValueType.STRING_LIST], debug);\n    const ruleValues = (rule.ruleValue as StringListValue).value?.map((it: string) => {\n      return it.trim().toLowerCase();\n    }) ?? [];\n    switch (operator) {\n      case CustomFieldOperator.MATCHES:\n        return ruleValues.some((it: string) => {\n          return userValue === it;\n        });\n      case CustomFieldOperator.CONTAINS:\n        return ruleValues.some((it: string) => {\n          return userValue.includes(it);\n        });\n      case CustomFieldOperator.NOT_CONTAINS:\n        return ruleValues.every((it: string) => {\n          return !userValue.includes(it);\n        });\n      default:\n        debug(notSupported(operator, DataType.TEXT));\n        return false;\n    }\n  };\n}\n\nfunction createNumberFieldRuleChecker(): CustomFieldPredicate {\n  return (rule: CustomFieldRule, value: any, debug) => {\n    const operator = rule.operator;\n    const empty = checkEmptiness(value, operator);\n    if (!empty.proceed) {\n      return empty.result;\n    }\n    let userValue: number = parseInt(value, 10);\n    if (isNaN(userValue)) {\n      debug(`${value} is not a number`);\n      return false;\n    }\n    logIncorrectValueTypeIfNeed(rule, [ValueType.NUMBER], debug);\n    const ruleValue: number = (rule.ruleValue as NumberValue).value!;\n    switch (operator) {\n      case CustomFieldOperator.EQUALS:\n        return userValue === ruleValue;\n      case CustomFieldOperator.NOT_EQUALS:\n        return userValue !== ruleValue;\n      case CustomFieldOperator.GREATER:\n        return userValue > ruleValue;\n      case CustomFieldOperator.LESS:\n        return userValue < ruleValue;\n      default:\n        debug(notSupported(operator, DataType.TEXT));\n        return false;\n    }\n  };\n}\n\nfunction createBooleanValueFieldRuleChecker(): CustomFieldPredicate {\n  return (rule: CustomFieldRule, value: any, debug) => {\n    const operator = rule.operator;\n\n    const empty = checkEmptiness(value, operator);\n    if (!empty.proceed) {\n      return empty.result;\n    }\n    logIncorrectValueTypeIfNeed(rule, [ValueType.BOOLEAN], debug);\n\n    const ruleValue = (rule.ruleValue as BooleanValue).value;\n    const userValue = Boolean(value);\n\n    switch (operator) {\n      case CustomFieldOperator.EQUALS:\n        return userValue === ruleValue;\n\n      default:\n        debug(notSupported(operator, DataType.BOOLEAN));\n        return false;\n    }\n  };\n}\n\nfunction createSingleSelectListValueFieldRuleChecker(): CustomFieldPredicate {\n  return (rule: CustomFieldRule, value: any, debug) => {\n    const operator = rule.operator;\n    const userValues: string[] = !value ? [] : value;\n\n    if (!Array.isArray(userValues)) {\n      debug(`${value} is not an array of string`);\n      return false;\n    }\n\n    const empty = checkEmptinessForArray(userValues, operator);\n    if (!empty.proceed) {\n      return empty.result;\n    }\n\n    logIncorrectValueTypeIfNeed(rule, [ValueType.STRING_LIST], debug);\n    const ruleValues = (rule.ruleValue as StringListValue).value;\n\n    switch (operator) {\n      case CustomFieldOperator.EQUALS:\n        return ruleValues?.length === 1 && userValues.length === 1 && userValues[0] === ruleValues[0];\n\n      case CustomFieldOperator.NOT_EQUALS:\n        return userValues.length !== 0 && (!ruleValues || ruleValues.length !== 1 || userValues.length !== 1 || userValues[0] !== ruleValues[0]);\n\n      case CustomFieldOperator.ANY_OF:\n        return userValues.length !== 0 && (ruleValues ? ruleValues.some((rv) => rv === userValues[0]) : false);\n\n      default:\n        debug(notSupported(operator, DataType.SINGLE_SELECT_LIST));\n        return false;\n    }\n  };\n}\n\nfunction createMultiSelectListValueFieldRuleChecker(): CustomFieldPredicate {\n  return (rule, value, debug) => {\n    const operator = rule.operator;\n    let userValues: string[] = !value ? [] : value;\n\n    if (!Array.isArray(userValues)) {\n      debug(`${value} is not an array of string`);\n      return false;\n    }\n\n    const emptinessResult = checkEmptinessForArray(userValues, operator);\n    if (!emptinessResult.proceed) {\n      return emptinessResult.result;\n    }\n\n    logIncorrectValueTypeIfNeed(rule, [ValueType.STRING_LIST], debug);\n    const ruleValues = (rule.ruleValue as StringListValue).value;\n\n    switch (operator) {\n      case CustomFieldOperator.EQUALS:\n        return userValues?.length > 0 &&\n          userValues.length === ruleValues?.length &&\n          userValues.every((val) => ruleValues!.includes(val));\n      case CustomFieldOperator.NOT_EQUALS:\n        return userValues.length > 0 &&\n          (userValues.length !== ruleValues?.length || !userValues.every((val) => ruleValues.includes(val)));\n      case CustomFieldOperator.ANY_OF:\n        return ruleValues ? userValues.some((val) => ruleValues.includes(val)) : false;\n      default:\n        debug(notSupported(operator, DataType.MULTI_SELECT_LIST));\n        return false;\n    }\n  };\n}\n\nfunction createDateFieldRuleChecker(): CustomFieldPredicate {\n  return (rule: CustomFieldRule, value: any, debug) => {\n    const operator = rule.operator;\n    const empty = checkEmptiness(value, operator);\n    if (!empty.proceed) {\n      return empty.result;\n    }\n    const userValue = parseDateISO(value, null);\n    if (!userValue) {\n      debug(`${value} is not an ISO date`);\n      return false;\n    }\n\n    const now = getDateNowWithoutTZ();\n    let singleDate: Date | null = null;\n    let fromDate: Date | null = null;\n    let toDate: Date | null = null;\n    let regardlessOfYear = false;\n    if (operator === CustomFieldOperator.OCCURS_BEFORE || operator === CustomFieldOperator.OCCURS_AFTER) {\n      logIncorrectValueTypeIfNeed(rule, [ValueType.DATE], debug);\n      singleDate = parseDateISO((rule.ruleValue as DateValue)?.value, now);\n    }\n    if (operator === CustomFieldOperator.OCCURS_ON) {\n      logIncorrectValueTypeIfNeed(rule, [ValueType.DATE, ValueType.RELATIVE_DATE], debug);\n      const relativeDateValue = rule.ruleValue as RelativeDateValue;\n      const dateValue = rule.ruleValue as DateValue;\n      if (relativeDateValue.timeUnit || relativeDateValue.regardlessOfYears) {\n        regardlessOfYear = relativeDateValue.regardlessOfYears ?? false;\n        singleDate = timeUnitPlus(\n          relativeDateValue.timeUnit,\n          now,\n          relativeDateValue.timeType === TimeType.AGO\n            ? -relativeDateValue.timeUnitNumber!\n            : +relativeDateValue.timeUnitNumber!\n        );\n      } else {\n        singleDate = parseDateISO(dateValue?.value, now);\n      }\n    }\n\n    if (operator === CustomFieldOperator.OCCURS_WITHIN || operator === CustomFieldOperator.NOT_OCCURS_WITHIN) {\n      logIncorrectValueTypeIfNeed(\n        rule,\n        [ValueType.DATE_RANGE, ValueType.RELATIVE_DATE_RANGE],\n        debug\n      )\n      const relativeDateRangeValue: RelativeDateRangeValue = rule.ruleValue as RelativeDateRangeValue;\n      if (relativeDateRangeValue.fromTimeType || relativeDateRangeValue.toTimeUnit) {\n        regardlessOfYear = relativeDateRangeValue.regardlessOfYears!!\n        fromDate = timeUnitPlus(\n          relativeDateRangeValue.fromTimeUnit,\n          now,\n          relativeDateRangeValue.fromTimeType === TimeType.AGO ?\n            -relativeDateRangeValue.fromTimeUnitNumber!! :\n            +relativeDateRangeValue.fromTimeUnitNumber!!\n        )\n        toDate = timeUnitPlus(\n          relativeDateRangeValue.toTimeUnit,\n          now,\n          relativeDateRangeValue.toTimeType === TimeType.AGO ?\n            -relativeDateRangeValue.toTimeUnitNumber!! :\n            +relativeDateRangeValue.toTimeUnitNumber!!\n        )\n      } else {\n        const dateRangeValue: DateRangeValue = rule.ruleValue as DateRangeValue\n        fromDate = parseDateISO(dateRangeValue?.from, now);\n        toDate = parseDateISO(dateRangeValue?.to, now);\n      }\n    }\n\n    switch (operator) {\n      case CustomFieldOperator.OCCURS_BEFORE:\n        return userValue < singleDate!;\n      case CustomFieldOperator.OCCURS_AFTER:\n        return userValue > singleDate!;\n      case CustomFieldOperator.OCCURS_ON:\n        if (regardlessOfYear) {\n          return equalsRegardlessOfYear(\n            userValue,\n            singleDate!!\n          )\n        } else {\n          return userValue.getTime() === singleDate?.getTime()\n        }\n      case CustomFieldOperator.OCCURS_WITHIN:\n        if (regardlessOfYear) {\n          return inRangeRegardlessOfYears(\n            fromDate!!,\n            toDate!!,\n            userValue\n          )\n        } else {\n          return !(userValue < fromDate! || userValue > toDate!)\n        }\n      case CustomFieldOperator.NOT_OCCURS_WITHIN:\n        if (regardlessOfYear) {\n          return !inRangeRegardlessOfYears(\n            fromDate!!,\n            toDate!!,\n            userValue\n          )\n        } else {\n          return userValue < fromDate! || userValue > toDate!\n        }\n      default: {\n        debug(notSupported(operator, DataType.ISO_DATE));\n        return false;\n      }\n    }\n  };\n}\n\nexport const onCustomFormSubmitted = (\n    event: EventCondition<{fieldRules: {targetRules: any[], ignoreRules: any[]}}>, //todo recheck\n    onDebug: (msg: string) => void,\n    params: {config: HandlerConfig, submittedFields?: any}\n): boolean => {\n  const { submittedFields = null } = params || {};\n  const { fieldRules } = event;\n  const targetResult = submittedFields && checkCustomFields(\n      submittedFields,\n      fieldRules.targetRules || [],\n      onDebug\n  );\n\n  const ignoreResult = submittedFields\n      && !!fieldRules.ignoreRules?.length\n      && checkCustomFields(\n          submittedFields,\n          fieldRules.ignoreRules || [],\n          onDebug\n      );\n\n  if (!submittedFields || !targetResult || ignoreResult) {\n    onDebug('submitted fields are not equal provided rules');\n    return false;\n  }\n\n  return true;\n}\n", "import {\n  EventCondition,\n  EventTypeMap,\n  FinalConfirmation,\n  RegisterCb,\n  ContinuationFn, HandlerConfig, TemplateInteractionParam\n} from \"./types\";\nimport {\n  closeModalWrapper,\n  createCustomRegister,\n  getContinuationFromArg,\n  getExperienceActionIdFromArg,\n  getTrackingIdFromArg\n} from \"./utils\";\nimport {onCustomFormSubmitted} from \"./custom-fields\";\n\n// Event listeners\nconst myAccountRegister = createCustomRegister(pn.myaccount.registerCallback);\nconst offerRegister = createCustomRegister(pn.offer.registerCallback);\nconst templateRegister = createCustomRegister(pn.template.registerCallback);\nconst formRegister = createCustomRegister(pn.pianoId.registerCallback);\n\n// Modal managers\nconst offerClose = closeModalWrapper(pn.offer.close, pn.offer.closeInline);\nconst templateClose = closeModalWrapper(pn.template.close, pn.template.closeInline);\n\n// Offer states\nconst PURCHASE_OFFER_TYPE = 'purchase';\nconst DOWN_GRADE_OFFER = 'upgrade'\n\nconst isFinalState = (currentState: string) => currentState === 'receipt';\nconst isAlreadyHasAccess = (currentState: string) => currentState === 'alreadyHasAccess';\n\n// listen to final confirmation\nexport const finalConfirmationSubscribe = () => {\n  const onConfirm = (firstArg: any) => {\n    const continuation = getContinuationFromArg(firstArg);\n    const trackingId = getTrackingIdFromArg(firstArg) || undefined;\n    const {confirm = null} = firstArg;\n\n    if (continuation) {\n      const templateInteractionParam = (confirm ? trackingId : new Error('Final confirmation: confirm is false')) as TemplateInteractionParam;\n      continuation.apply(this, [templateInteractionParam]);\n      continuation.done = true;\n    }\n  };\n\n  offerRegister.on(FinalConfirmation,null, onConfirm);\n  templateRegister.on(FinalConfirmation, null, onConfirm);\n}\n\n// listen to dismiss template and call finalConfirmation\nexport const dismissTemplateSubscribe = () => {\n  const getContinuation = (firstArg: any) => {\n    const continuation = getContinuationFromArg(firstArg);\n    const experienceActionId = getExperienceActionIdFromArg(firstArg);\n    const trackingId = getTrackingIdFromArg(firstArg);\n\n    if (!experienceActionId || !continuation) {\n      return;\n    }\n\n    return {\n      id: experienceActionId,\n      run: () => {\n        if (!continuation.done) {\n          continuation.done = true;\n\n          return continuation(trackingId);\n        }\n      },\n    }\n  }\n  const onConfirm = (register: typeof offerRegister | typeof templateRegister, firstArg: any) => {\n    const conObj = getContinuation(firstArg);\n\n    // if node doesn't have dismiss handler event\n    if (conObj && !register.has(conObj.id, 3)) {\n      conObj.run();\n    }\n  }\n\n  const onFormConfirm = (first: any) => {\n    const { config, reason } = first;\n    const conObj = getContinuation(config);\n\n    if (!conObj) {\n      return;\n    }\n\n    if (reason === 'customFormSubmitted') {\n      const registeredCB = formRegister.get(conObj.id, 6);\n\n      if (!registeredCB || registeredCB.every(cb => !cb.res)) {\n        conObj.run();\n      }\n\n      return;\n    }\n\n    if (!formRegister.has(conObj.id, 7)) {\n      conObj.run();\n    }\n  }\n\n  // dismiss template all template\n  offerRegister.on(EventTypeMap[3],null, onConfirm.bind(offerRegister));\n  templateRegister.on(EventTypeMap[3], null, onConfirm.bind(templateRegister));\n  formRegister.on(EventTypeMap[7], null, onFormConfirm);\n}\n\nexport const clearTemplateInteractionCallback = () => {\n  myAccountRegister.clear();\n  offerRegister.clear();\n  templateRegister.clear();\n  formRegister.clear();\n}\n/**\n * Register interaction event callback\n * Returns true if registered\n */\nexport const registerInteractionCallback: RegisterCb = (\n  event: EventCondition<any>,\n  onEvent,\n  onError\n): void => {\n  const { eventType, parentId, autoClose } = event;\n  const debugError = (err: string) => onError(`ExpInt: eventType=${eventType}: ${err}`);\n\n  // checking handlers by experienceActionId\n  const checkExperienceActionId = (config: HandlerConfig): boolean => {\n    const experienceActionId = getExperienceActionIdFromArg(config || {});\n\n    return experienceActionId === parentId;\n  }\n\n  const onCallContinuation = (firstArg: any) => {\n    const continuation = getContinuationFromArg(firstArg);\n    const trackingId = getTrackingIdFromArg(firstArg) || undefined;\n\n    // call continuation only for cases where the acp flow is not complete yet\n    if (continuation && !continuation.done) {\n      continuation(trackingId);\n      continuation.done = true;\n    }\n  }\n\n  const onContinuation = (firstArg: any) => {\n    const continuation = getContinuationFromArg(firstArg);\n\n    onEvent(continuation);\n  }\n\n  const onDismissTemplate = (firstArg: any): void => {\n    const { offerType, currentState } = firstArg;\n    const continuation = getContinuationFromArg(firstArg);\n    const trackingId = getTrackingIdFromArg(firstArg) || undefined;\n\n    if (!continuation) {\n      return onContinuation(firstArg);\n    }\n\n    if (offerType === DOWN_GRADE_OFFER && isFinalState(currentState)) {\n      continuation.done = true;\n      return continuation(new Error('Subscription was upgraded'));\n    }\n\n    if (offerType === PURCHASE_OFFER_TYPE) {\n      if (isFinalState(currentState)) {\n        continuation.done = true;\n        return continuation(trackingId)\n      }\n      if (isAlreadyHasAccess(currentState)) {\n        continuation.done = true;\n        return continuation(new Error('Subscription already has access'));\n      }\n    }\n\n    onContinuation(firstArg);\n  }\n\n  const onContinuationForm = (firstArg: any) => {\n    onContinuation(firstArg.config);\n    return true;\n  }\n\n  const checkCustomEvent = (\n      close: (selector: string | null) => void,\n      firstArg: HandlerConfig\n  ): boolean => {\n    const { customEventName = null, containerSelector = null } = firstArg || {};\n    const result = checkExperienceActionId(firstArg) && (event.customEventNames || []).includes(customEventName);\n\n    if (!result) {\n      return false;\n    }\n\n    // if custom event is detected and should close parent template/offer\n    if (autoClose) {\n      // skip dismiss template\n      if (!offerRegister.skipOne(parentId, 3)) {\n        // if there is no such event, then add event on dismiss template and call continuation\n        offerRegister.on(3, parentId, onCallContinuation, checkExperienceActionId, true);\n      }\n      if (!templateRegister.skipOne(parentId, 3)) {\n        templateRegister.on(3, parentId, onCallContinuation, checkExperienceActionId, true);\n      }\n\n      close(containerSelector);\n    }\n\n    return result;\n  }\n\n  const onRootContinuation = (firstArg: any) => {\n    const continuation = getContinuationFromArg(firstArg);\n    const { subscriptionId = null } = firstArg || {};\n\n    if (continuation && subscriptionId) {\n      (continuation as ContinuationFn).subscriptionId = subscriptionId;\n    }\n\n    if (continuation) {\n      (continuation as ContinuationFn).forceTrackStat = true;\n    }\n\n    onEvent(continuation);\n  }\n\n  const checkCustomFromEvents = ({config, reason}: {config: HandlerConfig, reason?: any}): boolean => {\n    // skip closedFormSubmitted event after customFormSubmitted event\n    return checkExperienceActionId(config) && reason !== 'customFormSubmitted';\n  }\n\n  const onCustomFormSubmittedCb = (\n    params: {\n      config: HandlerConfig,\n      submittedFields?: any\n    }) => {\n    const continuation = getContinuationFromArg(params.config);\n\n    if (onCustomFormSubmitted(event, debugError, params)) {\n      onEvent(continuation);\n      return true;\n    }\n\n    return false;\n  }\n\n  switch (Number(eventType)) {\n    case 1: //autoRenewalDisabled\n    case 2: //subscriptionCancellation\n      myAccountRegister.on(eventType, parentId, onRootContinuation);\n      break;\n    case 3: //dismissTemplate\n      offerRegister.on(eventType, parentId, onDismissTemplate, checkExperienceActionId);\n      templateRegister.on(eventType, parentId, onDismissTemplate, checkExperienceActionId);\n      break;\n    case 4: //customEvent\n      offerRegister.on(eventType, parentId, onContinuation, checkCustomEvent.bind(null, offerClose));\n      templateRegister.on(eventType, parentId, onContinuation, checkCustomEvent.bind(null, templateClose));\n      break;\n    case 5: //customFormSubmitted\n    case 7: //customFormClosed\n      formRegister.on(eventType, parentId, onContinuationForm, checkCustomFromEvents);\n      break;\n    case 6: //specificCustomFormSubmitted\n      formRegister.on(eventType, parentId, onCustomFormSubmittedCb, checkCustomFromEvents);\n      break;\n    default:\n      debugError(eventType + 'is not supported');\n      return;\n  }\n}\n", "import {ContinuationFn, EventCondition, InteractionContext} from \"./types\";\nimport {getRootEvent} from \"./utils\";\n\nconst useSegmentNodesArray = [\n  'userSegmentTrue',\n  'userSegmentFalse'\n];\nconst interactionEventTypes = new Set([\n  'showForm',\n  'showOffer',\n  'showTemplate',\n  'showRecommendations',\n  'showZuoraOffer',\n  'showNewscycleOffer',\n  ...useSegmentNodesArray\n]);\n\nconst useSegmentNodes = new Set(useSegmentNodesArray);\n\nconst eventContinuationName = 'continuation';\nexport const bindContinuationToEvent = <T extends Record<string, any>>(\n  e: T,\n  continuation?: ContinuationFn | null,\n): T => continuation ? ({\n  ...e,\n  [eventContinuationName]: continuation\n}) : e;\n\nexport const getContinuationFromEvent = <T extends Record<string, any>>(e: T): ContinuationFn | null =>\n  e[eventContinuationName] || null;\n\nexport const getSubscriptionIdFromEvent = <T extends Record<string, any>>(e: T): string | null => {\n  const continuation = getContinuationFromEvent(e);\n\n  return continuation && continuation.subscriptionId\n}\n\nexport const getForceTrackStatFlagFromEvent = <T extends Record<string, any>>(e: T): boolean | undefined => {\n  const continuation = getContinuationFromEvent(e);\n\n  return continuation?.forceTrackStat;\n}\n\nexport const callContinuationForNonInteractiveNodes = (\n    module: {\n      eventType: string,\n      eventConditions: EventCondition[],\n      eventExecutionContext: {\n        trackingId?: string;\n      }\n    },\n    continuation?: ContinuationFn | null,\n    chainLength?: number,\n    interactionContext?: InteractionContext,\n): void => {\n  const { eventType, eventConditions } = module;\n  const trackingId = module.eventExecutionContext.trackingId;\n  const nonInteractive = !interactionEventTypes.has(eventType);\n  const isBranchDeadEnd = useSegmentNodes.has(eventType) && (chainLength || 0) < 2;\n\n  const invokeContinuationForNonInteractive = (() => {\n    if (!nonInteractive) {\n      return false;\n    }\n    const rootEvent = getRootEvent(eventConditions);\n    const hasOnlyRootEvent = eventConditions.length < 2 && eventConditions[0] === rootEvent;\n    const hasOtherRegisteredEvents = !!interactionContext?.getEventsByModelId(rootEvent?.moduleId)?.length;\n\n    return hasOnlyRootEvent && !hasOtherRegisteredEvents || !hasOnlyRootEvent;\n  })();\n  // for a short experience or noninteractive nodes\n  const shouldInvokeContinuation = isBranchDeadEnd || invokeContinuationForNonInteractive;\n\n  if (continuation && !continuation.done && shouldInvokeContinuation) {\n    continuation(trackingId);\n  }\n}\n", "import {\n  ExecuteInteractionResult,\n  InteractionEventName,\n  InteractionContext,\n  TemplateTypes,\n  InteractionEventCode,\n  TemplateTypesMap,\n  EventTypeMap, EventCondition,\n} from \"./types\";\nimport {clearTemplateInteractionCallback, dismissTemplateSubscribe, finalConfirmationSubscribe} from \"./register\";\nimport {getRootEvent, isInteractionEvent, isRootEventType} from \"./utils\";\n\nexport * from './continuation';\nexport * from './types';\n\nimport {\n  INTERACTION_METHOD_NAME,\n  INTERACTION_END_POINT\n} from './types';\n\nconst getEventTypeName = (\n  eventType: number,\n): InteractionEventName | null => EventTypeMap[eventType as InteractionEventCode] || null;\n\nconst isTemplateType = (val?: TemplateTypes): boolean => !!(val && TemplateTypesMap.includes(val));\n\nconst getInteractionEventName = (eventLocal: EventCondition): InteractionEventName | null => {\n  const name = getEventTypeName(eventLocal.eventType || -1);\n\n  return isInteractionEvent(eventLocal.type) ? name : null;\n}\n\nconst createEventContext = (): InteractionContext => {\n  const registeredEvents: { [x in InteractionEventName]?: boolean } = {};\n  const registeredEventsMap: Record<string, Record<string, InteractionEventName>> = {};\n\n  return {\n    endpoint: INTERACTION_END_POINT,\n    name: INTERACTION_METHOD_NAME,\n    isDenied: () => !!pn.composerControlPolicy?.denyTI,\n    add: (event, events) => {\n      const currentEventName = getInteractionEventName(event);\n      const rootEvent: EventCondition | null = getRootEvent(events);\n      const rootEventModuleId: string | null = rootEvent ? (rootEvent as EventCondition).moduleId : null;\n\n      if (currentEventName) {\n        registeredEvents[currentEventName] = true;\n      }\n\n      if (rootEventModuleId) {\n        registeredEventsMap[rootEventModuleId] = registeredEventsMap[rootEventModuleId] || {};\n\n        events.forEach((eventItem) => {\n          const eventName = getInteractionEventName(eventItem);\n\n          if (eventName && !isRootEventType(eventItem)) {\n            registeredEventsMap[rootEventModuleId][eventItem.moduleId] = eventName;\n          }\n        });\n      }\n    },\n    get: () => Object.keys(registeredEvents) as InteractionEventName[],\n    getEventsByModelId: (moduleId?: string) => {\n      const mapData = registeredEventsMap[moduleId || ''];\n\n      if (!mapData) {\n        return [];\n      }\n\n      return Object.keys(mapData);\n    },\n  }\n}\n\nexport const executeInteraction = async (\n  templateType: TemplateTypes,\n  _executePromise: <T extends any>(eventContext: InteractionContext) => Promise<T>\n): Promise<ExecuteInteractionResult> => {\n  if (!isTemplateType(templateType)) {\n    throw {code: 1};\n  }\n\n  const eventContext = createEventContext();\n  await _executePromise(eventContext);\n\n  finalConfirmationSubscribe();\n  dismissTemplateSubscribe();\n  return {\n    registeredEvents: eventContext.get(),\n  }\n};\n\n\nexport const interactionScope = (() => {\n  let linkedNodes = <any>{};\n  let executedNodes = <any>[];\n  let executedHandlers = <any>{};\n\n  return {\n    linkedNodes,\n    executedNodes,\n    executedHandlers,\n  }\n})();\n\nexport const getInteractionExecutedNodes = () => interactionScope.executedNodes\nexport const clearInteractionExecutedNodes = () => {\n  interactionScope.executedNodes = [];\n};\nexport const resetInteractionScope = () => {\n  clearTemplateInteractionCallback();\n  clearInteractionExecutedNodes();\n  interactionScope.linkedNodes = {};\n  interactionScope.executedHandlers = {};\n}\n", "import { UtilInterface } from \"./util\";\nimport { APIInterface } from \"./api\";\nimport { UserInterface } from \"./user\";\nimport { ScrollDepthInterface } from \"./scrollDepth\";\nimport { ViewportExitInterface } from \"./viewportExit\";\nimport { IdleInterface } from \"./idle\";\nimport { LOG_EVENT_TYPE } from \"./log\";\nimport { PianoEspInterface } from \"./pianoEsp\";\nimport { CxenseInterface } from \"./cxense\";\nimport { EventUtilsInterface } from \"./eventUtils\";\nimport { InteractionInterface } from \"./interaction\";\nimport { SwgInterface } from \"./swg\";\nimport { FbsubscriptionsInterface } from \"./fbsubscriptions\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { AjaxInterface } from \"./ajax\";\nimport { LoggingInterface } from \"./logging\";\nimport { ConsentInterface } from './consent';\nimport { CreditResponseInterface } from \"./credit\";\nimport { ComposeControlPolicy } from \"./composerControlPolicy\";\nimport { AnalyticsInterface } from \"./analytics\";\nimport { IDataLayerConfig } from \"@piano-sdk/data-layer/types/types\";\nimport { dataLayer } from \"@piano-sdk/data-layer\";\nimport {GA_EVENT_TYPE} from \"./googleAnalytics/constants\";\nimport {GaCollectingServiceInterface} from \"./googleAnalytics/gaCollectingService\";\n\nimport {\n  ContinuationFn,\n  ExecuteInteractionResult,\n  ExecuteTemplateInteraction,\n  InteractionConfig,\n  InteractionContext\n} from \"./templateInteraction/types\";\nimport {\n  bindContinuationToEvent,\n  callContinuationForNonInteractiveNodes,\n  clearInteractionExecutedNodes,\n  executeInteraction,\n  FORM_INTERACTION_EVENT,\n  getContinuationFromEvent,\n  getForceTrackStatFlagFromEvent,\n  getInteractionExecutedNodes, getSubscriptionIdFromEvent,\n  interactionScope,\n  resetInteractionScope,\n  TEMPLATE_INTERACTION_EVENT\n} from \"./templateInteraction\";\nimport {\n  registerInteractionCallback\n} from \"./templateInteraction/register\";\nimport {FrequencyEventInterface} from \"./frequency-capping/pcfe\";\n\n\ntype ExecutionOverridesConfig = {\n  handlers: Record<string, Function>,\n  overrides: Record<string, any>,\n};\n\ntype ExecutionInteractionConfig = {\n  interactionContext: any\n}\ntype OneOf<A, B> = A & Partial<B> | B & Partial<A>;\n\ntype ExecutionConfig = OneOf<ExecutionOverridesConfig, ExecutionInteractionConfig>;\n\nexport interface ExperienceInterface extends ExecuteTemplateInteraction {\n  name: string;\n\n  init(): void;\n\n  execute: ReturnType<UtilInterface[\"profile\"]>;\n\n  _getLastExecutionResult(): any;\n\n  __protected__: {\n    sendStatisticsExecutedNodes(source: string): void;\n  };\n\n  __private__: {\n    linkedNodes: any;\n    executedNodes: any;\n    initialized: boolean;\n    handlers: any;\n\n    show(e: any, showFn: Function): Function;\n\n    getTrackingEndpoint(): string;\n\n    processResult(\n      data: any,\n      requestParams: any,\n      executionConfig?: ExecutionConfig\n    ): void;\n\n    registerCallback(event: string, callback: Function): void;\n\n    processErrors(errors?: any): void;\n  };\n  registerCallback(event: string, callback: Function): void;\n}\n\nexport const experience = ((container = pn.container): ExperienceInterface => {\n\n  const jqUtils = container.resolve<JqUtilsInterface>('jqUtils');\n  const util = container.resolve<UtilInterface>('util');\n  const consent = container.resolve<ConsentInterface>('consent');\n  const api = container.resolve<APIInterface>('api');\n  const eventUtils = container.resolve<EventUtilsInterface>('eventUtils');\n  const scrollDepth = container.resolve<ScrollDepthInterface>('scrollDepth');\n  const ajax = container.resolve<AjaxInterface>('ajax');\n  const viewportExit = container.resolve<ViewportExitInterface>('viewportExit');\n  const idle = container.resolve<IdleInterface>('idle');\n  const interaction = container.resolve<InteractionInterface>('interaction');\n  const pianoEsp = container.resolve<PianoEspInterface>('pianoEsp');\n  const swg = container.resolve<SwgInterface>('swg');\n  const fbsubscriptions = container.resolve<FbsubscriptionsInterface>('fbsubscriptions');\n  const user = container.resolve<UserInterface>('user');\n  const cxense = container.resolve<CxenseInterface>('cxense');\n  const logging = container.resolve<LoggingInterface>('logging');\n  const composerControlPolicy = container.resolve<ComposeControlPolicy>('composerControlPolicy');\n  const analytics = container.resolve<AnalyticsInterface>('analytics');\n  const gaCollectingService = container.resolve<GaCollectingServiceInterface>('gaCollectingService');\n  const frequencyEvent = container.resolve<FrequencyEventInterface>('frequencyEvent');\n\n  const name = 'experience';\n\n  let executedNodes = <any>[];\n  let linkedNodes = <any>{};\n  let lastExecutionStatsContext = '';\n  let smallExpereinceMode = false;\n\n  const READER_ID = 'reader_id';\n  const loggedBrowserEvents: { [key: string]: boolean } = {};\n\n  let initialized = false;\n  let executedHandlers = <any>{};\n\n  const handlers = buildHandlers({\n    'applyCss': {\n      fn: _applyCssHandler,\n      isAction: true,\n      shouldFireCallback: true\n    },\n    'runJs': {\n      fn: _runJsHandler,\n      isAction: true,\n      shouldFireCallback: true\n    },\n    'setCookie': {\n      fn: _setCookieHandler,\n      isAction: true,\n      shouldFireCallback: true\n    },\n    'nonSite': {\n      fn: _nonSiteHandler,\n      isAction: true,\n      shouldFireCallback: true\n    },\n    'showForm': {\n      fn: _showFormHandler,\n      isAction: true,\n      shouldFireCallback: true\n    },\n    'showRecommendations': {\n      fn: _showRecommendationsHandler,\n      isAction: true,\n      shouldFireCallback: true\n    },\n    'showOffer': {\n      fn: _showOfferHandler,\n      isAction: true,\n      shouldFireCallback: false // firing in offer.js\n    },\n    'showTemplate': {\n      fn: _showTemplateHandler,\n      isAction: true,\n      shouldFireCallback: false // firing in template.js\n    },\n    'showZuoraOffer': {\n      fn: _showTemplateHandler,\n      isAction: true,\n      shouldFireCallback: false // firing in template.js\n    },\n    'showNewscycleOffer': {\n      fn: _showTemplateHandler,\n      isAction: true,\n      shouldFireCallback: false // firing in template.js\n    },\n    'showNewsletterSignup': {\n      fn: _showNewsletterSignupHandler,\n      isAction: true,\n      shouldFireCallback: false // firing in pianoEsp.js\n    },\n    'showPushSignUp': {\n      fn: _showPushSignupHandler,\n      isAction: true,\n      shouldFireCallback: false // firing in pianoEsp.js\n    },\n    'showLogin': {\n      fn: _showLoginHandler,\n      isAction: true,\n      shouldFireCallback: true\n    },\n    'continueExecution': {\n      fn: _continueExecutionHandler,\n      shouldFireCallback: true\n    },\n    'continueExecutionCompleted': {\n      fn: buildEmptyHandler,\n      shouldFireCallback: true\n    },\n    'meterActive': {\n      fn: buildEmptyHandler,\n      shouldFireCallback: true,\n      ga: (event: any) => ({\n        eventCategory: 'meterActive',\n        eventLabel: 'Meter active',\n        experienceId: event.eventExecutionContext.experienceId,\n        meterName: event.eventExecutionContext.currentMeterName,\n      }),\n    },\n    'meterExpired': {\n      fn: buildEmptyHandler,\n      shouldFireCallback: true,\n      ga: (event: any) => ({\n        eventCategory: 'meterExpired',\n        eventLabel: 'Meter expired',\n        experienceId: event.eventExecutionContext.experienceId,\n        meterName: event.eventExecutionContext.currentMeterName,\n      }),\n    },\n    'userSegmentTrue': {\n      fn: _logIfAfterConditionsHandler,\n      shouldFireCallback: true\n    },\n    'userSegmentFalse': {\n      fn: _logIfAfterConditionsHandler,\n      shouldFireCallback: true\n    },\n    'experienceExecutionFailed': {\n      fn: buildEmptyHandler,\n      shouldFireCallback: true\n    },\n    'log': {\n      fn: _logHandler,\n      shouldFireCallback: false // internal event, don't need to fire callbacks\n    },\n    'experienceExecute': {\n      fn: _experienceExecuteHandler,\n      shouldFireCallback: true,\n      ga: (event: any) => ({\n        eventCategory: 'experienceExecute',\n        eventLabel: 'Experience execute',\n        experienceId: event.eventExecutionContext.experienceId,\n      }),\n    },\n    'setResponseVariable': {\n      fn: _setResponseVariableHandler,\n      isAction: true,\n      shouldFireCallback: true,\n      ga: (event: any) => ({\n        eventCategory: 'setResponseVariable',\n        eventLabel: 'Set response variable',\n        experienceId: event.eventExecutionContext.experienceId,\n        setResponseVariableId: event.eventModuleParams.moduleId,\n        ...event.eventParams.responseVariables,\n      }),\n    },\n    'creditRedeemed': {\n      fn: _creditRedeemedHandler,\n      isAction: true,\n      shouldFireCallback: true\n    },\n  });\n\n  const preloadHandlers: any = {\n    showOffer: _deferredShowOfferHandler,\n    showTemplate: _deferredShowTemplateHandler,\n    showZuoraOffer: _deferredShowTemplateHandler,\n    showNewscycleOffer: _deferredShowTemplateHandler,\n  };\n\n  const executeTemplateInteraction = (\n    interactionConfig: InteractionConfig = {\n      templateType: 1\n    }\n  ): Promise<ExecuteInteractionResult> => executeInteraction(\n      interactionConfig.templateType || 1,\n    interactionContext => _executePromise('manual', {\n        template_type: interactionConfig.templateType || 1,\n      },\n      false,\n      {\n        interactionContext\n      },\n    )\n  );\n\n  const execute = util.profile(((config: any, handlers: any): void => {\n    composerControlPolicy.__private__.checkLS();\n    _executePromise('manual', config, false, {\n      overrides: config,\n      handlers,\n    });\n  }));\n\n  const registerCallback = (event: string, callback: Function) => {\n    eventManager.addEvent(event);\n    eventManager.registerCallback(event, callback);\n  }\n\n  const _getLastExecutionResult = (): any => {\n    return _lastExecutionResult;\n  }\n\n  const XB_COOKIE = 'xbc';\n  const EDGE_RESULT_COOKIE = '_pcer';\n\n  let _lastExecutionResult: any = {};\n\n  let browserId = '';\n\n  let issuerId = '';\n  let itemId = '';\n\n  // array of all timer's id (scrollDepth by timeout, timer card)\n  let timers: any[] = [];\n\n  const linkedNodeTypes = {\n    'HANDLER': 'handler',\n    'EVENT_CONDITION': 'eventCondition',\n    'INNER_EVENT_CONDITION': 'innerEventCondition',\n    'PRELOAD': 'preload'\n  };\n\n  const eventManager = eventUtils.createEventManager([]);\n\n  const eventTypesWithPreload = ['showOffer', 'showZuoraOffer', 'showNewscycleOffer', 'showTemplate'];\n\n  function buildHandlers(conf: any) {\n    var result: any = {};\n\n    const buildHandler = (config: any, name: string) => {\n      return (e: any, requestParams: any, result: any, executionConfig?: ExecutionConfig) => {\n        const isInteractionExecute = isInteraction(executionConfig);\n        if (config.isAction) {\n          var shouldBeConsumed = checkPreActionHandlers(e);\n          if (!shouldBeConsumed) {\n            return;\n          }\n\n          var eventConditionsCount = getEventConditionsCount(e);\n          var inCardCondition = getConditionInPreloadCard(e);\n          if (eventConditionsCount || inCardCondition) {\n            // we should log execution stats only for events behind conditions\n            // events without conditions are logged on backend\n            addModuleToExecuted(e.eventModuleParams.moduleId, e, isInteractionExecute);\n          }\n        }\n\n        var moduleId = e.eventModuleParams.moduleId;\n        const executed = executionConfig?.interactionContext ? interactionScope.executedHandlers : executedHandlers;\n\n        if (!executed[moduleId] && moduleId !== 'N/A') {\n          executed[moduleId] = {\n            experienceId: e.eventExecutionContext.experienceId,\n            moduleName: e.eventModuleParams.moduleName\n          };\n        }\n        const handlers = executionConfig?.handlers || {};\n\n        const handlerName = `on${name[0].toUpperCase()}${name.slice(1)}`;\n\n        if (typeof handlers?.[handlerName] === 'function') {\n          handlers[handlerName](e, requestParams)\n        }\n\n        const eventCopy = Object.assign({}, e);\n        if (eventCopy.eventParams) eventCopy.eventParams = Object.assign({}, e.eventParams);\n\n        config.fn(eventCopy, requestParams, result, executionConfig);\n\n        if (config.ga) {\n          _sendGAEvent(config.ga(eventCopy));\n        }\n\n        if (config.shouldFireCallback) {\n          _buildCallbackEventHandler(name)(eventCopy);\n        }\n      }\n    }\n\n    Object.keys(conf).forEach((key: any) => {\n      if (typeof (conf[key].fn) === 'function') {\n        result[key] = buildHandler(conf[key], key);\n      } else {\n        throw new Error('Unsupported config for ' + key + ' handler');\n      }\n    })\n\n    return result;\n\n  }\n\n  function init (): void {\n    if (initialized || util.__protected__.isCxenseBot()) {\n      return;\n    }\n\n    initialized = true;\n\n    var continueInitialization = true;\n    if (pn.customPreChecks && pn.customPreChecks.length) {\n      var _tempPreCheckRes = null;\n      for (var j = pn.customPreChecks.length; j--;) {\n        try {\n          _tempPreCheckRes = pn.customPreChecks[j]();\n          if (_tempPreCheckRes !== 1 && _tempPreCheckRes !== true) {\n            continueInitialization = false;\n          }\n        } catch (err) {\n        }\n      }\n    }\n\n    if (continueInitialization) {\n      _executePromise('auto').then(() => {\n        logging.setTime('expExec', Math.floor(performance.now() - window.pnInitPerformance));\n      });\n    }\n  }\n\n  const getExecutedNodes = (isInteraction = false) => {\n    return isInteraction ? getInteractionExecutedNodes() : executedNodes;\n  }\n\n  const addEventToExecutedNodes = (eventInfo: any, isInteraction = false) => {\n    (isInteraction ? getInteractionExecutedNodes() : executedNodes).push(eventInfo);\n  }\n\n  const clearExecutedNodes = (isInteraction = false) => {\n    if (isInteraction) {\n      clearInteractionExecutedNodes();\n    } else {\n      executedNodes = [];\n    }\n  }\n\n  const getTrackingEndpoint = (): string => {\n    return pn.getExperienceEndpoint(false) + '/api/v3';\n  }\n\n  const getComposerUrl = (predefinedUrl?: string, controlPolicyDenied?: boolean) => {\n    var endpointPath =  predefinedUrl || null;\n    if (controlPolicyDenied) {\n      return null;\n    }\n\n    if (!endpointPath) {\n      if (util.__protected__.cameFromFbSubscriptions()) {\n        if (!composerControlPolicy.denyFbia) {\n          endpointPath = '/xbuilder/experience/executeFbia';\n          initializeFbSubscriptions();\n        }\n      } else if (!composerControlPolicy.denyWeb) {\n        endpointPath = '/xbuilder/experience/execute';\n      }\n    }\n\n    return endpointPath && (pn.getExperienceEndpoint(false) + endpointPath);\n  }\n\n  const setPianoEspVisitorId = (composerResponse: any) => {\n    pianoEsp.__protected__.setVisitorId(composerResponse.bid);\n  }\n\n  const sendCxensePageViewEvent = (composerResponse: any) => {\n    return cxense.__protected__.sendPageViewEvent({\n      browserId: composerResponse.bid,\n      uid: composerResponse.uid,\n      cxenseCustomerPrefix: composerResponse.cxenseCustomerPrefix,\n      pageViewId: pn.main.fetchPageViewId(),\n      eventExecutionContext: createExperienceExecutionContext(composerResponse.result)\n    });\n  }\n\n  const isCxenseActivated = () => {\n    return cxense.__protected__.isActivated();\n  }\n\n  const loadCxLibIfNeeded = () => {\n    return cxense.__protected__.loadCxLibIfNeeded();\n  }\n\n  const initBrowserId = (composerResponse: any) => {\n    browserId = composerResponse.bid;\n  }\n\n  const initIssuerId = (composerResponse: any) => {\n    if (composerResponse.iss) {\n      issuerId = composerResponse.iss;\n    }\n  }\n\n  const initItemId = (composerResponse: any) => {\n    itemId = composerResponse.itemId;\n  }\n\n  const onContentRestrictedFallback = (composerResponse: any) => {\n    if (!!composerResponse.result?.onContentRestrictedFallback) {\n      util.debug('exp: fire event: contentRestrictedFallback');\n      eventManager.fireCallbacks('contentRestrictedFallback', undefined, 'experience', true);\n    }\n  }\n\n  const injectSwgMarkup = (swgMarkupData: any) => {\n    swg.__protected__.injectMarkup(swgMarkupData);\n  }\n\n  const addSwgLibrary = () => {\n    swg.__protected__.addLibrary();\n  }\n\n  const initSwgFlow = () => {\n    swg.__protected__.initSwgFlow();\n  }\n\n  const initializeFbSubscriptions = () => {\n    fbsubscriptions.__protected__.init();\n  }\n\n  const statisticsRequestInterval = 2000;\n  let sendStatisticsTimerId: any;\n\n  const sendStatisticsExecutedNodes = (source: string, isInteraction: boolean = false): void => {\n    var executedNodes = getExecutedNodes(isInteraction);\n    if (executedNodes.length) {\n      analytics.log.event({\n        eventType: LOG_EVENT_TYPE.LOG_BEACON_REQUEST,\n        payload: {\n          url: getTrackingEndpoint() + '/composer/logExecutionStats',\n          params: {\n            aid: pn.aid,\n            items: JSON.stringify(executedNodes),\n            execution_stats_context: lastExecutionStatsContext,\n            ts: new Date().getTime(),\n            source: source\n          }\n        }\n      });\n      clearExecutedNodes(isInteraction);\n    }\n    window.clearTimeout(sendStatisticsTimerId);\n    sendStatisticsTimerId = window.setTimeout(() => {\n      sendStatisticsExecutedNodes('timer' + sendStatisticsTimerId, isInteraction);\n    }, statisticsRequestInterval);\n  }\n\n  const consentNotProvided = (): boolean => {\n    // @ts-ignore\n    const pdlConfig = (): IDataLayerConfig => (window.pdl || {}) as IDataLayerConfig;\n\n    return Boolean(pdlConfig().requireConsent && !pn.consent.get());\n  }\n\n  const _executePromise = (\n    submitType: string,\n    executionConfig?: any,\n    isContinueExecution?: boolean,\n    executionConfigs?: ExecutionConfig,\n  ): Promise<any> => {\n    if (consentNotProvided()) {\n      util.debug('WARNING: The RequireConsent feature is enabled. The Piano services might be working unstable until user consent provided')\n    }\n    if (pn.main.appHasApplePay() === undefined) {\n      eventManager.fireCallbacks('experienceFlow', null, 'experience', true);\n    }\n\n    const isInteractionExecute = !!executionConfigs?.interactionContext;\n    var maxAllowedTimeout = 30000;\n    const timeoutPromise = new Promise((resolve => {\n      setTimeout(() => {\n        resolve({});\n      }, maxAllowedTimeout);\n    }))\n\n    return Promise.race([\n      pn.main.externalResourcesDelay(),\n      timeoutPromise\n    ])\n      .then((additionalConfig: any) => {\n        if (!jqUtils.isPlainObject(additionalConfig)) {\n          util.error('exp: error get external resources ', additionalConfig);\n          additionalConfig = {};\n        }\n\n        const newBid = {\n          new_bid: dataLayer.get('browserId'),\n        };\n\n        const callExecute = isInteractionExecute ? _executeAsync : _execute;\n        if (isCxenseActivated()) {\n          util.debug('c1x: integration is activated');\n          loadCxLibIfNeeded();\n          const executeConfig = jqUtils.deepExtend(\n            {},\n            executionConfig,\n            additionalConfig,\n            newBid,\n            {\n              c1x_integration_version: 'v2', // only supported version\n            }\n          );\n          return callExecute(\n            submitType,\n            executeConfig,\n            isContinueExecution,\n            executionConfigs,\n          );\n        } else {\n          return callExecute(\n            submitType,\n            jqUtils.deepExtend({}, executionConfig, additionalConfig, newBid),\n            isContinueExecution,\n            executionConfigs,\n          );\n        }\n      })\n      .catch((err: any) => {\n        if (isInteractionExecute) {\n          throw err;\n        }\n      })\n  }\n\n  const _executeAsync = (\n    submitType: string,\n    executionConfig: any,\n    isContinueExecution: any,\n    executionOverrides?: ExecutionConfig,\n  ): Promise<any> => new Promise((resolve, reject) => _execute(\n    submitType,\n    executionConfig,\n    isContinueExecution,\n    executionOverrides,\n    resolve,\n    reject));\n\n  const _execute = (\n    submitType: string,\n    executionConfig: any,\n    isContinueExecution: any,\n    executionOverrides?: ExecutionConfig,\n    resolve?: (e: { code: number }) => void,\n    reject?: (e:  { code: number, message: string }) => void,\n  ) => {\n    const interactionContext = executionOverrides?.interactionContext;\n    executionConfig = executionConfig || {};\n\n    var params = jqUtils.deepExtend({}, { protocol_version: 1 }, executionConfig);\n    _applyCookieParameters(params);\n    _applyPushNotificationParams(params);\n    _applyEspMailingListParams(params);\n    _applyUserSegmentsParams(params);\n\n    // pass reader_id from page to composer\n    if (util.hasQueryParamByName(READER_ID)) {\n      params[READER_ID] = util.getQueryParamByName(READER_ID);\n    }\n\n    util.waitCall('refreshUserToken', () => {// we need wait refresh user token from janrain and gigya\n      if (!isContinueExecution) {// we don't need get/create again request params for continuous execution\n        pn.main.trackPageUnloadIfNecessary.skipLog();\n\n        _applyTpConfigurationParameters(params);\n        api.getCallParams(params, user.getProvider());\n        util.removeAffiliateToken()\n\n        var pageTrackConfig = {\n          url: window.location.href,\n          tags: pn.tags,\n          submitType: submitType,\n          skipPageViewTrack: shouldSkipAction(!!interactionContext)\n        };\n        pn.main.buildPageTrackParams(params, pageTrackConfig);\n      } else {\n        const executed = interactionContext ? interactionScope.executedHandlers : executedHandlers;\n        params['executed_nodes'] = JSON.stringify(executed);\n      }\n\n      consent.__protected__.addConsentsToParams(params);\n      frequencyEvent.__protected__.applyToParams(params);\n\n      util.debug('exp: Experience initialized with params:', params);\n\n      util.waitCall('refreshAccessTokenList', () => {\n        util.startCall(interactionContext?.name || 'experienceExecute');\n\n        var url = getComposerUrl(interactionContext?.endpoint, interactionContext?.isDenied());\n        if (!url) {\n          util.doneCall(interactionContext?.name || 'experienceExecute');\n\n          if (!isContinueExecution) {\n              resetExperienceState(!!interactionContext);\n          }\n          const debugErr = 'execute is denied';\n          util.debug(debugErr);\n\n          reject?.({\n            code: 424,\n\n            message: 'Error: ' + debugErr,\n          });\n          return;\n        }\n\n        var ie9 = navigator.appVersion.indexOf('MSIE 9') !== -1;\n\n        var ajaxSettings: any;\n        if (ie9) {\n          ajaxSettings = {\n            dataType: 'jsonp',\n            url: url + \"?\" + jqUtils.param(params)\n          };\n        } else {\n          var queryString = '?' + jqUtils.param({\n            'aid': params.aid\n          });\n\n          ajaxSettings = {\n            type: 'post',\n            url: url + queryString,\n            data: jqUtils.deepExtend({}, params, executionOverrides?.overrides || {}),\n            xhrFields: {\n              withCredentials: true\n            }\n          };\n        }\n\n        ajaxSettings.success = (result: any) => {\n          util.doneCall(interactionContext?.name || 'experienceExecute');\n          var requestParams = jqUtils.deepExtend({}, params);\n\n          if (!isContinueExecution) {\n            resetExperienceState(!!interactionContext);\n            pn.main.registerTrackUnload.skipLog();\n          }\n\n          processErrors(result.errors);\n          processResult(result.models, requestParams, executionOverrides);\n          resolve?.({code: 0});\n        };\n        ajaxSettings.error = (request: XMLHttpRequest) => {\n          composerControlPolicy.__private__.setPolicyByRequest(request);\n          util.doneCall(interactionContext?.name || 'experienceExecute');\n\n          if (!isContinueExecution) {\n            resetExperienceState(!!interactionContext);\n          }\n\n          var response = {\n            code: 503,\n            message: 'Error: Received error when requesting API response from URL: ' + url\n          };\n          util.debug(response.message);\n          reject?.(response);\n        };\n\n        ajax.request(ajaxSettings);\n      });\n    });\n  }\n\n  const _applyCookieParameters = (params: any) => {\n    var xbc = util.__protected__.getCookie(XB_COOKIE);\n    if (xbc) {\n      params.xbc = xbc;\n    }\n    var tbc = util.getTbcCookie();\n    if (tbc && tbc.length > 0) {\n      params.tbc = tbc;\n    }\n\n    var pcer = util.__protected__.getCookie(EDGE_RESULT_COOKIE);\n\n    if (pcer) {\n      params.edge_result = pcer;\n    }\n\n    util.getCampaigns(params);\n\n    params.custom_cookies = JSON.stringify(util.getCustomCookies());\n  }\n\n  const _applyPushNotificationParams = (params: any) => {\n    var pushListSubscriptions = util.getPushListsCookie();\n    var notificationStatus = pianoEsp.__protected__.getNotificationStatus();\n\n    if (pushListSubscriptions && pushListSubscriptions.length > 0) {\n      params.push_list_subscriptions = JSON.stringify(pushListSubscriptions);\n    }\n\n    if (notificationStatus) {\n      params.push_notification_settings = notificationStatus;\n    }\n  }\n\n  const _applyEspMailingListParams = (params: any) => {\n    params.mailing_lists = JSON.stringify(pianoEsp.__protected__.loadCompleteMailingLists());\n  }\n\n  const _applyTpConfigurationParameters = (params: any) => {\n    var propsToCopy = [\n      { property: 'debug', parameter: 'debug', skipFalse: true },\n      { property: 'trackPageView', parameter: 'increment_pageview_meter' }\n    ];\n\n    propsToCopy.forEach((value: any) => {\n      // @ts-ignore\n      if (pn[value.property] !== undefined && (!value.skipFalse || pn[value.property])) {\n        // @ts-ignore\n        params[value.parameter] = pn[value.property];\n      }\n    })\n\n    return params;\n  }\n\n  const _applyUserSegmentsParams = (params: any) => {\n    const segments = dataLayer.get('userSegments');\n\n    if (segments) {\n      params['previous_user_segments'] = JSON.stringify(segments);\n    }\n  }\n\n  const processErrors = (errors?: any): void => {\n    if (Array.isArray(errors)) {\n      if (errors.length) {\n        util.debug('exp: composer execution has been failed with errors');\n      }\n\n      errors.forEach((value: any) => {\n        util.debug('exp: ' + value.msg);\n      })\n    }\n  }\n\n  const addModuleToExecuted = (moduleId: string, e: any, isInteraction = false) => {\n    addEventToExecutedNodes({\n          mId: moduleId,\n          eId: e.eventExecutionContext.experienceId,\n          eV: e.eventExecutionContext.experienceVersion,\n          eeId: e.eventExecutionContext.executionId\n        },\n        isInteraction\n    );\n  }\n\n  function createLinkedNodeHandler (\n    handler: Function,\n    e: any,\n    requestParams: any,\n    result: any,\n    executionConfig?: ExecutionConfig,\n  ) {\n    return (function() {\n      return {\n        type: linkedNodeTypes.HANDLER,\n        eventType: e.eventType,\n        children: [],\n        run: function(\n          continuation: ContinuationFn,\n          chainLength?: number,\n          interactionContext?: InteractionContext,\n        ) {\n          const copyEvent = bindContinuationToEvent(e, continuation);\n\n          handler.bind(this, copyEvent, requestParams, result, executionConfig)();\n\n          callContinuationForNonInteractiveNodes(\n              e,\n              continuation,\n              chainLength,\n              interactionContext\n          );\n        }\n      };\n    })();\n  }\n\n  const getConditionInPreloadCard = (e: any) => {\n    var delayBy = e.eventParams.delayBy || {};\n    var condition;\n    if (delayBy.value) {\n      if (delayBy.type === 'time') {\n        condition = { type: 'timer', timer: delayBy.value };\n      } else if (delayBy.type === 'scroll') {\n        condition = { type: 'scrollDepth', scrollDepth: delayBy.value, measureType: 'pixels' };\n      }\n    }\n\n    return condition;\n  }\n\n  const getEventConditionsCount = (e: any) => {\n    return e.eventConditions && Array.isArray(e.eventConditions) ? e.eventConditions.length : 0;\n  }\n\n  const createLinkedNodeForPreloadHandler = (preloadHandler: Function, e: any) => {\n    return (() => {\n      var wasExecuted = false;\n      var preloadResult: any;\n\n      return {\n        type: linkedNodeTypes.PRELOAD,\n        eventType: e.eventType,\n        children: [],\n        run: () => {\n          if (wasExecuted === false) {\n            preloadResult = preloadHandler(e);\n            wasExecuted = true;\n          }\n        },\n        getPreloadResult: () => {\n          return preloadResult;\n        }\n      };\n    })();\n  }\n\n  function sendAnalyticForBrowserEvents(eventCondition: any): void {\n    if (loggedBrowserEvents[eventCondition.type]) {\n      return;\n    }\n\n    _sendGAEvent({\n      eventCategory: 'beforeBrowserEvent',\n      eventLabel: 'Before browser event',\n      ...eventCondition,\n    });\n\n    loggedBrowserEvents[eventCondition.type] = true;\n  }\n\n  function subscribeToEventListener (eventCondition: any, executeFollowChain: any) {\n    const consumeEventFn = () => {\n      sendAnalyticForBrowserEvents(eventCondition);\n\n      return eventManager.fireCallbacksAndStopOnFirstFalse('beforeBrowserEvent', eventCondition);\n    };\n\n    switch (eventCondition.type) {\n      case TEMPLATE_INTERACTION_EVENT:\n      case FORM_INTERACTION_EVENT:\n        registerInteractionCallback(eventCondition,\n          (continuation) => consumeEventFn() && executeFollowChain(continuation),\n          err => util.debug(err)\n        )\n        break;\n      case 'viewportExit': {\n        viewportExit.addListener(executeFollowChain, {\n          detectExitMode: eventCondition.detectExitMode,\n          detectBackButtonForMobile: eventCondition.detectBackButtonForMobile,\n          clientDevice: eventCondition.clientDevice\n        }, consumeEventFn);\n        break;\n      }\n      case 'scrollDepth': {\n        scrollDepth.addListener(executeFollowChain, {\n          scrollDepth: eventCondition.scrollDepth,\n          measureType: eventCondition.measureType\n        }, consumeEventFn);\n        break;\n      }\n      case 'timer': {\n        var newTimer = setTimeout(() => {\n          if (consumeEventFn()) {\n            executeFollowChain();\n          }\n        }, 1000 * eventCondition.timer);\n        timers.push(newTimer);\n        break;\n      }\n      case 'interaction': {\n        interaction.bind(executeFollowChain, eventCondition.interactions, consumeEventFn);\n        break;\n      }\n      case 'idle': {\n        idle.addListener(executeFollowChain, eventCondition.idleTime, consumeEventFn);\n        break;\n      }\n    }\n  }\n\n  const canUseNodeInLoop = (node: any) => {\n    var handlersRunningOnce = ['continueExecution', 'meterActive', 'meterExpired'];\n    return node.type === linkedNodeTypes.HANDLER && handlersRunningOnce.indexOf(node.eventType) === -1;\n  }\n\n  function createLinkedNodeEventCondition(eventCondition: any, e: any, interactionContext?: InteractionContext) {\n    return (function () {\n      var wasExecuted = false;\n      const isInteraction = !!interactionContext;\n      const nodes = interactionContext ? interactionScope.linkedNodes : linkedNodes;\n      var executeFollowChain = function (continuation?: Function) {\n        addModuleToExecuted(eventCondition.moduleId, e, isInteraction);\n\n        var chainConditions = nodes[eventCondition.moduleId].children;\n        for (var index = 0; index < chainConditions.length; index++) {\n          var chainConditionId = chainConditions[index];\n          var chainCondition = nodes[chainConditionId];\n          if (wasExecuted === false || canUseNodeInLoop(chainCondition)) {\n            try {\n              chainCondition.run(continuation, chainConditions.length, interactionContext);\n            } catch (ex) {\n              util.error('exp: error execute chain event', chainCondition, ex);\n            }\n          }\n        }\n        wasExecuted = true;\n\n        if (smallExpereinceMode) {\n          sendStatisticsExecutedNodes('chain', isInteraction);\n        }\n      };\n\n      interactionContext?.add(eventCondition, e.eventConditions || []);\n\n      return {\n        type: linkedNodeTypes.EVENT_CONDITION,\n        children: [],\n        run: function () {\n          subscribeToEventListener(eventCondition, executeFollowChain);\n        }\n      };\n    })();\n  }\n\n  function createLinkedNodeForInnerEventCondition (\n      inCardCondition: any,\n      handlerId: string,\n      interactionContext?: InteractionContext\n  ) {\n    return (function () {\n      var wasExecuted = false;\n      const nodes = interactionContext ? interactionScope.linkedNodes : linkedNodes;\n      var executeFollowChain = () => {\n        var chainConditions = nodes[handlerId + linkedNodeTypes.INNER_EVENT_CONDITION].children;\n        for (var index = 0; index < chainConditions.length; index++) {\n          var chainConditionId = chainConditions[index];\n          var chainCondition = nodes[chainConditionId];\n          if (wasExecuted === false || canUseNodeInLoop(chainCondition)) {\n            try {\n              chainCondition.run();\n            } catch (ex) {\n              util.error('exp: error execute chain event', chainCondition, ex);\n            }\n          }\n        }\n        wasExecuted = true;\n      };\n\n      return {\n        type: linkedNodeTypes.INNER_EVENT_CONDITION,\n        children: [handlerId],\n        run: function () {\n          subscribeToEventListener(inCardCondition, executeFollowChain);\n        }\n      };\n    })();\n  }\n\n  const initSwgIfNeeded = (result: any) => {\n    if (result.swgMarkupData) {\n      util.debug(\"exp: swg markup data :\", result.swgMarkupData);\n      injectSwgMarkup(result.swgMarkupData);\n\n      // fix problem with freeAccess. google.swg looking for productId in markup which is null\n      if (!result.swgMarkupData.isAccessibleForFree) {\n        addSwgLibrary();\n      }\n    }\n    if (result.swgEnabled) {\n      initSwgFlow();\n    }\n  }\n\n  const createExperienceExecutionContext = (result: any) => {\n    if (!result) {\n      util.debug('exp: no composer execution result');\n      return;\n    }\n    var executionResult: any = {};\n    for (var index = 0; index < result.events.length; index++) {\n      var e = result.events[index];\n      try {\n        var eventType = e.eventType;\n\n        if (eventType === 'experienceExecute') {\n          executionResult = jqUtils.deepExtend({}, e.eventExecutionContext);\n          executionResult.result = jqUtils.deepExtend({}, result);\n        }\n      } catch (ex) {\n        util.error('exp: error on execute event: ', e, ex);\n      }\n    }\n\n    return executionResult;\n  }\n\n  const shouldSkipAction = (isInteraction: boolean) => {\n    return isInteraction && (initialized || execute.invokeCount !== 0)\n  }\n\n  const processResult = (data: any, requestParams: any, executionConfig?: ExecutionConfig): void => {\n    if (!data) {\n      return;\n    }\n\n    const interactionContext = executionConfig?.interactionContext;\n    const isInteraction = !!interactionContext;\n    const nodes = interactionContext ? interactionScope.linkedNodes : linkedNodes;\n\n    util.setTbcCookieFromResponse(data);\n    util.setTacCookieFromResponse(data);\n    util.setAppTimezoneOffsetFromResponse(data);\n    util.setCurrentDomainFromResponse(data);\n\n    // TemplateInteraction\n    if (!shouldSkipAction(isInteraction)) {\n      sendCxensePageViewEvent(data);\n    }\n    setPianoEspVisitorId(data);\n    initBrowserId(data);\n    initIssuerId(data);\n    initItemId(data);\n    onContentRestrictedFallback(data);\n    frequencyEvent.__protected__.registerEvent(data);\n    util.setXbcCookieFromResponse(data);\n\n    var result = data.result;\n    var executionResult: any = {};\n\n    if (!result) {\n      util.debug('exp: no composer execution result');\n      return;\n    }\n\n    initSwgIfNeeded(result);\n\n    util.debug('exp: processed experiences :', result.experiences);\n\n    lastExecutionStatsContext = data.executionStatsContext;\n    //noinspection JSUnresolvedVariable\n    result.debugMessages.forEach((message: string) => {\n      util.debug('exp: execute :', message);\n    })\n\n    var addEventConditions = function (e: any, handlerId: string, rootEventConditions: any) {\n      var eventConditions = e.eventConditions;\n      for (var index = 0; index < eventConditions.length; index++) {\n        var eventCondition = eventConditions[index];\n        var moduleId = eventCondition.moduleId;\n        var previousCondition = eventConditions[index - 1];\n        var isLastEventCondition = !eventConditions[index + 1];\n\n        if (!nodes[moduleId]) {\n          nodes[moduleId] = createLinkedNodeEventCondition(eventCondition, e, executionConfig?.interactionContext);\n        }\n\n        if (isLastEventCondition) {\n          nodes[moduleId].children.push(handlerId);\n\n          var isEventWithPreload = eventTypesWithPreload.indexOf(e.eventType) !== -1;\n          if (isEventWithPreload) {\n            if (eventCondition.type === 'viewportExit' && !getConditionInPreloadCard(e)) {\n              // preload only if last condition is \"viewportExit\" and there are no \"in-card\" conditions\n\n              var preloadHandler = preloadHandlers[e.eventType];\n              if (!preloadHandler) {\n                util.error('exp: not found preload handler for event: ', e);\n                continue;\n              }\n\n              var preloadHandlerId = handlerId + linkedNodeTypes.PRELOAD;\n              nodes[preloadHandlerId] = createLinkedNodeForPreloadHandler(preloadHandler, e);\n\n              if (previousCondition) {\n                nodes[previousCondition.moduleId].children.push(preloadHandlerId);\n              } else {\n                rootEventConditions.push(preloadHandlerId);\n              }\n            }\n          }\n        }\n\n        if (previousCondition && nodes[previousCondition.moduleId].children.indexOf(moduleId) === -1) {\n          nodes[previousCondition.moduleId].children.push(moduleId);\n        }\n      }\n    };\n\n    var rootEventConditions = [];\n    var moduleId;\n\n    var eventsWithConditions = 0;\n    for (var index = 0; index < result.events.length; index++) {\n      var e = result.events[index];\n      try {\n        //noinspection JSUnresolvedVariable\n        var eventType = e.eventType;\n        var eventModuleParams = e.eventModuleParams || {};\n\n        util.debug('exp: process event \\'' + eventType + '\\'' + ' (' + eventModuleParams.moduleId + ')');\n\n        if (eventType === 'experienceExecute') {\n          executionResult = jqUtils.deepExtend({}, e.eventExecutionContext);\n          executionResult.result = jqUtils.deepExtend({}, result);\n          util.setUserSegments(executionResult);\n        }\n\n        moduleId = eventModuleParams.moduleId;\n\n        if (!moduleId) {\n          util.error('exp: not found moduleId for linked node event: ', e);\n          continue;\n        }\n\n        var handler = handlers[eventType];\n        if (!handler) {\n          util.error('exp: not found handler for event: ', e);\n          continue;\n        }\n\n        nodes[moduleId] = createLinkedNodeHandler(handler, e, requestParams, result, executionConfig);\n\n        var eventConditionsCount = getEventConditionsCount(e);\n        var inCardCondition = getConditionInPreloadCard(e);\n        if (eventConditionsCount || inCardCondition) {\n          var moduleIdToBindConditions = moduleId;\n\n          if (inCardCondition) {\n            var innerEventConditionLinkedNode = createLinkedNodeForInnerEventCondition(\n                inCardCondition,\n                moduleId,\n                interactionContext\n            );\n\n            moduleIdToBindConditions = moduleId + linkedNodeTypes.INNER_EVENT_CONDITION;\n            nodes[moduleIdToBindConditions] = innerEventConditionLinkedNode;\n          }\n\n          if (eventConditionsCount) {\n            if (rootEventConditions.indexOf(e.eventConditions[0].moduleId) === -1) {\n              rootEventConditions.push(e.eventConditions[0].moduleId);\n            }\n          } else if (inCardCondition) {\n            rootEventConditions.push(moduleIdToBindConditions);\n          }\n\n          addEventConditions(e, moduleIdToBindConditions, rootEventConditions);\n          eventsWithConditions++;\n        } else {\n          rootEventConditions.push(moduleId);\n        }\n      } catch (ex) {\n        util.error('exp: error on execute event: ', e, ex);\n      }\n    }\n\n    if (eventsWithConditions <= 3) {\n      smallExpereinceMode = true;\n    }\n\n    // for debugging event conditions structure\n    //_dumpRootEventConditions(rootEventConditions);\n\n    for (var i = 0; i < rootEventConditions.length; i++) {\n      moduleId = rootEventConditions[i];\n      if (nodes[moduleId]) {\n        nodes[moduleId].run();\n      }\n    }\n\n    window.clearTimeout(sendStatisticsTimerId);\n    sendStatisticsTimerId = window.setTimeout(() => {\n      sendStatisticsExecutedNodes('rootTimer' + sendStatisticsTimerId, !!interactionContext);\n    }, statisticsRequestInterval);\n\n    _lastExecutionResult = executionResult;\n  }\n\n  const _dumpElementWithChildren = function (dumpElement: any) {\n    var linkedNode = linkedNodes[dumpElement.moduleId];\n    dumpElement.type = linkedNode.type;\n\n    for (var i = 0; i < linkedNode.children.length; i++) {\n      dumpElement.children.push(_dumpElementWithChildren({\n        moduleId: linkedNode.children[i],\n        children: []\n      }));\n    }\n\n    return dumpElement;\n  }\n\n  //noinspection JSUnusedLocalSymbols\n  const _dumpRootEventConditions = (rootEventConditions: any) => {\n    var dump = [];\n    for (var i = 0; i < rootEventConditions.length; i++) {\n      dump.push(_dumpElementWithChildren({\n        moduleId: rootEventConditions[i],\n        children: []\n      }));\n    }\n\n    util.debug('exp: root event conditions ', dump);\n  }\n\n  function _setCookieHandler(e: any) {\n    var eventParams = e.eventParams;\n    if (eventParams && typeof eventParams.cookieName !== 'undefined' && typeof eventParams.cookieValue !== 'undefined') {\n      util.debug('exp: set cookie with parameters:', eventParams);\n\n      var cookieName = (eventParams.isReadableCookie ? '_pc_' : '') + eventParams.cookieName;\n      var options: any = {\n        domain: eventParams.cookieDomain,\n        path: eventParams.cookiePath,\n      };\n\n      if (!eventParams.isSessionCookie) {\n        var expirationDate = new Date();\n\n        switch (eventParams.expirationUnit) {\n          case 'seconds':\n            expirationDate.setSeconds(expirationDate.getSeconds() + eventParams.expirationValue);\n            break;\n          case 'minutes':\n            expirationDate.setMinutes(expirationDate.getMinutes() + eventParams.expirationValue);\n            break;\n          case 'hours':\n            expirationDate.setHours(expirationDate.getHours() + eventParams.expirationValue);\n            break;\n          case 'days':\n            expirationDate.setDate(expirationDate.getDate() + eventParams.expirationValue);\n            break;\n          case 'months':\n            expirationDate.setMonth(expirationDate.getMonth() + eventParams.expirationValue);\n            break;\n          case 'years':\n            expirationDate.setFullYear(expirationDate.getFullYear() + eventParams.expirationValue);\n            break;\n          default:\n            util.log(\"Wrong eventParams.expirationUnit : \", eventParams.expirationUnit);\n        }\n\n        options.expires = expirationDate;\n      }\n\n      util.__protected__.setCookieConsent('composer', cookieName, eventParams.cookieValue, options);\n    }\n  }\n\n  function _sendGAEvent(params: { [key: string]: unknown }) {\n    analytics.ga.event({\n      eventType: GA_EVENT_TYPE.EMIT_GA_EVENT,\n      payload: {\n        aid: pn.aid,\n        ...params,\n      }\n    })\n  }\n\n  function _runJsHandler(e: any) {\n    //noinspection JSUnresolvedVariable\n    if (e.eventParams && e.eventParams.snippet) {\n      //noinspection JSUnresolvedVariable\n      var snippet = e.eventParams.snippet;\n      util.debug('exp: run js with snippet:', snippet);\n\n      var context = e.eventExecutionContext;\n      util.debug('exp: set publisher\\'s context and custom:', context);\n      var text = 'var context = ' + JSON.stringify(context) + ';\\n' +\n        'var custom = ' + JSON.stringify(pn.customVariables) + ';\\n' + snippet;\n      _runScript(text);\n    }\n  }\n\n  function _nonSiteHandler(e: any) {\n    util.debug('exp: non-site action:', e);\n  }\n\n  function _creditRedeemedHandler(e: any) {\n    util.debug('exp: credit redeemed action:', e);\n  }\n\n  function _logHandler(e: any, reqParam: any, res: any, executionConfig?: ExecutionConfig) {\n    var executeInteraction = isInteraction(executionConfig);\n    addModuleToExecuted(e.eventModuleParams.moduleId, e, executeInteraction);\n  }\n\n  function _logIfAfterConditionsHandler(e: any, reqParam: any, res: any, executionConfig?: ExecutionConfig) {\n    var eventConditionsCount = getEventConditionsCount(e);\n    var executeInteraction = isInteraction(executionConfig);\n    if (eventConditionsCount) {\n      addModuleToExecuted(e.eventModuleParams.moduleId, e, executeInteraction);\n    }\n  }\n\n  function _continueExecutionHandler(e: any, requestParams: any, _?: any, executionConfigs?: ExecutionConfig) {\n    util.debug('exp: continue execution action:', e, 'with requestParameters', requestParams);\n\n    var config = requestParams || {};\n    config.experience_id = e.eventExecutionContext.experienceId;\n    config.experience_version = e.eventExecutionContext.experienceVersion;\n    config.context_data = e.eventParams.contextData;\n\n    _executePromise('auto', config, true, executionConfigs);\n  }\n\n  function _runScript(snippet: string) {\n    try {\n      eval.call(window, '(function () {' + snippet + '\\n})();');\n    } catch (e) {\n      util.log('Error occurred in RunJS\\n', e);\n    }\n  }\n\n  function _applyCssHandler(e: any) {\n    //noinspection JSUnresolvedVariable\n    e.eventParams.ruleList.forEach((rule: any) => {\n      //noinspection JSUnresolvedVariable\n      let classes = rule.classes;\n      const elements = rule.elements;\n\n      if (classes) {\n        classes = classes.replace(/[,.]/g, ' ').split(' ').filter((el: string) => el !== '');\n        if (rule.type === 'add') {\n          const htmlElList = jqUtils.qa(elements);\n          if (htmlElList && htmlElList.length) {\n            htmlElList.forEach((el: HTMLElement) => {\n              classes.forEach((cl: string) => {\n                jqUtils.addClass(cl, el);\n              })\n            })\n          }\n        }\n        if (rule.type === 'remove') {\n          // $(rule.elements).removeClass(classes);\n          const htmlElList = jqUtils.qa(elements);\n          if (htmlElList && htmlElList.length) {\n            htmlElList.forEach((el: HTMLElement) => {\n              classes.forEach((cl: string) => {\n                jqUtils.removeClass(cl, el);\n              })\n            })\n          }\n        }\n      }\n      util.debug('exp: css applied with rule:', rule);\n    });\n  }\n\n  function _showHandler(e: any, showFn: Function, isInteraction: boolean = false) {\n    const nodes = isInteraction ? interactionScope.linkedNodes : linkedNodes;\n    var preloadHandler = nodes[e.eventModuleParams.moduleId + linkedNodeTypes.PRELOAD];\n    if (preloadHandler && preloadHandler.getPreloadResult) {\n      return preloadHandler.getPreloadResult().show();\n    } else {\n      return show(e, showFn);\n    }\n  }\n\n  function isInteraction(executionConfigs?: ExecutionConfig) {\n    return !!executionConfigs?.interactionContext;\n  }\n\n  function _showOfferHandler(e: any, requestParams: any, _?: any, executionConfigs?: ExecutionConfig) {\n    return _showHandler(e, (params: any) => pn.offer.show(params), isInteraction(executionConfigs));\n  }\n\n  function _showTemplateHandler(e: any, requestParams: any, _?: any, executionConfigs?: ExecutionConfig) {\n    return _showHandler(e, (params: any) => pn.template.show(params), isInteraction(executionConfigs));\n  }\n\n  function _showNewsletterSignupHandler(e: any, requestParams: any, _?: any, executionConfigs?: ExecutionConfig) {\n    return _showHandler(e,\n        (params: any) => pianoEsp.__protected__.showNewsletterSignup(params),\n        isInteraction(executionConfigs)\n    );\n  }\n\n  function _showPushSignupHandler(e: any, requestParams: any, _?: any, executionConfigs?: ExecutionConfig) {\n    return _showHandler(e,\n        (params: any) => pianoEsp.__protected__.showPushSignup(params),\n        isInteraction(executionConfigs));\n  }\n\n  function _showLoginHandler(e: any) {\n    user.showLogin({\n      trackingId: e.eventExecutionContext.trackingId,\n    });\n  }\n\n  function _deferredShowHandler(e: any, deferredShowFn: Function) {\n    util.debug('exp: run preloading for:', e);\n    return show(e, (params: any) => deferredShowFn(params));\n  }\n\n  function _deferredShowOfferHandler(e: any) {\n    return _deferredShowHandler(e, (params: any) => pn.offer.deferredShow(params));\n  }\n\n  function _deferredShowTemplateHandler(e: any) {\n    return _deferredShowHandler(e, (params: any) => pn.template.deferredShow(params));\n  }\n\n  function resetExperienceState(isInteraction: boolean = false) {\n    sendStatisticsExecutedNodes('reset', isInteraction);\n\n    if (isInteraction) {\n      resetInteractionScope();\n    } else {\n      removeEventListeners();\n      linkedNodes = {};\n      executedHandlers = {};\n    }\n  }\n\n  function removeEventListeners() {\n    // clear timers\n    timers.forEach((value: number) => {\n      clearTimeout(value);\n    });\n\n    timers = [];\n\n    // clear viewportExit, idle, scrollDepth listeners\n    viewportExit.removeListeners();\n    idle.removeListeners();\n    scrollDepth.removeListeners();\n\n    // clear interactions\n    interaction.unbindAll();\n  }\n\n  function show(e: any, showFn: Function): Function {\n    //noinspection JSUnresolvedVariable\n    var params = jqUtils.deepExtend({}, e.eventParams),\n      splitTests = e.eventExecutionContext.splitTests,\n      activeMeters = e.eventExecutionContext.activeMeters,\n      formNameByTermId = e.eventParams.formNameByTermId,\n      hideCompletedFields = e.eventParams.hideCompletedFields,\n      affiliateState = getAffiliateState(e.eventExecutionContext);\n    const continuation = getContinuationFromEvent(e);\n    const subscriptionId = getSubscriptionIdFromEvent(e);\n    const forceTrackStat = getForceTrackStatFlagFromEvent(e);\n\n    //noinspection JSUnresolvedVariable\n    params.trackingId = e.eventExecutionContext.trackingId;\n    //noinspection JSUnresolvedVariable\n    params.experienceId = e.eventExecutionContext.experienceId;\n    //noinspection JSUnresolvedVariable\n    params.experienceExecutionId = e.eventExecutionContext.executionId;\n    //noinspection JSUnresolvedVariable\n    params.experienceActionId = e.eventModuleParams.moduleId;\n    //noinspection JSUnresolvedVariable\n    params.experienceConditions = e.eventConditions;\n\n    // validate offerType\n    if (e.eventParams.offerType === 'upgrade_or_downgrade') {\n      // value from offer.ts:OFFER_TYPES.UPGRADE\n      params.offerType = 'upgradeOffer';\n    }\n\n    if (continuation) {\n      //noinspection JSUnresolvedVariable\n      params.continuation = continuation;\n      params.subscriptionId = subscriptionId;\n      params.forceTrackStat = forceTrackStat;\n    }\n\n    params.browserId = browserId;\n\n    params.onStartCreditRedemption = (params: object): Promise<CreditResponseInterface> => {\n      const creditParams = jqUtils.deepExtend({}, params);\n      const isPianoId = issuerId === 'https://www.piano.io';\n      const isNonAnon = e.eventExecutionContext.user && e.eventExecutionContext.uid !== 'anon';\n\n      creditParams.trackingId = e.eventExecutionContext.trackingId || undefined;\n\n      if (isPianoId && isNonAnon) {\n        creditParams.uid = e.eventExecutionContext.user.uid || undefined;\n      }\n\n      return pn.credit.redeem(creditParams);\n    }\n\n    if (splitTests && splitTests.length > 0) {\n      var splitTestIdsArray = splitTests.map((e: any) => {\n        return e.variantId;\n      });\n      params.splitTestIds = JSON.stringify(splitTestIdsArray);\n    }\n\n    // NOTE: this parameter is used for copying additional parameters to offer/template iframeParams but since we don't copy\n    // \"additionalParamNames\" itself, all these additional parameters will not be captured on checkout reload!\n    params.additionalParamNames = [];\n\n    if (activeMeters && activeMeters.length > 0) {\n      params.activeMeters = JSON.stringify(activeMeters);\n    }\n\n    if (e.eventType === 'showZuoraOffer') {\n      var ratePlanIds = e.eventParams.ratePlanIds;\n      if (ratePlanIds && ratePlanIds.length > 0) {\n        params.zuoraSelectedRatePlanIds = JSON.stringify(ratePlanIds);\n        params.additionalParamNames.push('zuoraSelectedRatePlanIds');\n      }\n    }\n\n    if (e.eventType === 'showNewscycleOffer') {\n      var ids = e.eventParams.ids;\n      if (ids && ids.length > 0) {\n        params.newscycleSelectedIds = JSON.stringify(ids);\n        params.additionalParamNames.push('newscycleSelectedIds', 'campaignCode', 'campaignGroupId');\n      }\n    }\n\n    if (e.eventType === 'showNewsletterSignup') {\n      var mailingListIds = e.eventParams.mailingListIds;\n      var siteId = e.eventParams.siteId;\n      if (mailingListIds && mailingListIds.length > 0) {\n        params.mailingListIds = JSON.stringify(mailingListIds);\n        params.siteId = siteId;\n        params.additionalParamNames.push('mailingListIds', 'siteId');\n      }\n    }\n\n    if (e.eventType === 'showRecommendations') {\n      params.widgetId = e.eventParams.widgetId;\n      params.placeholder = e.eventParams.placeholder;\n    }\n\n    if (formNameByTermId) {\n      params.formNameByTermId = JSON.stringify(formNameByTermId);\n      params.hideCompletedFields = hideCompletedFields;\n    }\n\n    if (affiliateState) {\n      params.affiliateState = affiliateState;\n    }\n\n    util.debug('exp: show with params:', params);\n    gaCollectingService.setParam('splitTestIds', params.splitTestIds);\n\n    return showFn(params);\n  }\n\n  function _showRecommendationsHandler(e: any, requestParams: any, _?: any, executionConfigs?: ExecutionConfig) {\n    return _showHandler(e, _getShowRecommendationHandler(e.eventParams.type), isInteraction(executionConfigs));\n  }\n\n  function _getShowRecommendationHandler(type: string) {\n    const showRecommendationMap: any = {\n      ESP: pianoEsp.__protected__.showRecommendation.bind(pianoEsp),\n      CXENSE: cxense.__protected__.showRecommendation.bind(cxense),\n    };\n\n    return showRecommendationMap[type] || buildEmptyHandler();\n  }\n\n  function _showFormHandler(e: any) {\n    var eventParams = e.eventParams;\n    if (eventParams && eventParams.formName) {\n      var config = {\n        formName: eventParams.formName,\n        hideIfComplete: eventParams.hideCompletedFields,\n        trackingId: e.eventExecutionContext.trackingId,\n        displayMode: eventParams.displayMode,\n        containerSelector: eventParams.containerSelector,\n        showCloseButton: eventParams.showCloseButton,\n        templateId: eventParams.templateId,\n        variantId: eventParams.templateVariantId,\n        accessToken: user.getProvider().getToken(),\n        experienceActionId: e.eventModuleParams.moduleId,\n        continuation: getContinuationFromEvent(e),\n        subscriptionId: getSubscriptionIdFromEvent(e),\n      };\n      if (eventParams.formWidth && eventParams.formWidth.enabled) {\n        config = jqUtils.deepExtend({}, { width: eventParams.formWidth.width }, config);\n      }\n\n      util.debug('exp: show form with params:', eventParams);\n      pn.pianoId.showForm(config);\n    }\n  }\n\n  function _experienceExecuteHandler(e: any, requestParams: any, result: any) {\n    var params = e.eventParams;\n    params.result = result;\n  }\n\n  function _setResponseVariableHandler(e: any) {\n    return e.eventParams;\n  }\n\n  function _buildCallbackEventHandler(eventName: string) {\n    return (e: any) => {\n      //noinspection JSUnresolvedVariable\n      var callback = e.eventParams.callback,\n        eventParams = e.eventParams,\n        cardParams = e.eventModuleParams,\n        contextParams = e.eventExecutionContext;\n\n      util.debug('exp: fire event ', eventName, ' with eventParams:', eventParams, ', moduleParams:', cardParams, ', context:', contextParams);\n\n      eventManager.fire('experience', eventName, true, eventParams, cardParams, contextParams);\n\n      if (callback) {\n        if (eventName !== callback) {\n          util.debug('exp: execute event ', eventName, ' with callback: ', callback);\n\n          // execute callback script\n          _runScript(callback);\n        }\n      }\n    }\n  }\n\n  function buildEmptyHandler() {\n    return () => {\n    };\n  }\n\n  function checkPreActionHandlers(e: any) {\n    var eventParams = e.eventParams;\n    var cardParams = e.eventModuleParams;\n    var contextParams = e.eventExecutionContext;\n\n    util.debug('exp: fire event \\'beforeComposerAction\\' with eventParams:', eventParams, ', moduleParams:', cardParams, ', context:', contextParams);\n\n    return eventManager.fireCallbacksAndStopOnFirstFalse('beforeComposerAction', eventParams, cardParams, contextParams);\n  }\n\n  function getAffiliateState(eventExecutionContext: any) {\n    if (!issuerId) {\n      return null;\n    }\n\n    var context = eventExecutionContext || {};\n\n    return {\n      issuerId: issuerId,\n      // value wil be a boolean string \"true\"/\"false\"\n      premium: context.user && context.user.premium || null,\n      redemptionCandidateItemId: itemId || null,\n      creditStates: context.creditStates || null,\n      userId: context.user?.uid || null,\n      // TODO It will be extended later\n      targetGroups: {\n        \"l1\": \"target\",\n        \"l2\": null\n      }\n    };\n  }\n\n  return {\n\n    name,\n\n    init,\n\n    execute,\n    executeTemplateInteraction,\n    // execute: function (config: any) {\n    //   _executePromise('manual', config, false);\n    // },\n    _getLastExecutionResult,\n    registerCallback,\n    // _getLastExecutionResult: function () {\n    //   return _lastExecutionResult;\n    // },\n    __private__: {\n      handlers,\n      // preloadHandlers,\n      executedNodes,\n      linkedNodes,\n      // lastExecutionStatsContext,\n      // smallExpereinceMode,\n      processResult,\n      processErrors,\n      // createLinkedNodeHandler,\n      // createLinkedNodeEventCondition,\n      // _applyCssHandler,\n      // _runJsHandler,\n      // _setCookieHandler,\n      // _nonSiteHandler,\n      // _creditRedeemedHandler,\n      // _logHandler,\n      // _continueExecutionHandler,\n      // _experienceExecuteHandler,\n      // _buildCallbackEventHandler,\n      show,\n      // removeEventListeners,\n      // resetExperienceState,\n      // subscribeToEventListener,\n      // checkPreActionHandlers,\n      // getAffiliateState,\n      // getExecutedNodes,\n      // addEventToExecutedNodes,\n      // clearExecutedNodes,\n      // addModuleToExecuted,\n      getTrackingEndpoint,\n      // setPianoEspVisitorId,\n      // sendCxensePageViewEvent,\n      // isCxenseActivated,\n      // isCxenseConfiguredPollingAsync,\n      // createExperienceExecutionContext,\n      // getOrGenerateCxCompatibleBid,\n      // loadCxLibIfNeeded,\n      // initBrowserId,\n      // initIssuerId,\n      // initItemId,\n      // injectSwgMarkup,\n      // addSwgLibrary,\n      // initSwgFlow,\n      // READER_ID,\n      initialized,\n      // executedHandlers,\n      registerCallback,\n      // registerCallback: function (event: any, callback: any) {\n      //   eventManager.addEvent(event);\n      //   eventManager.registerCallback(event, callback);\n      // },\n    },\n    __protected__: {\n      sendStatisticsExecutedNodes,\n    },\n\n  }\n\n});\n\npn.container.register('experience', {\n  useValue: experience()\n});\npn.experience = pn.container.resolve<ExperienceInterface>('experience');\n", "export interface IfVisibleInterface {\n  name: string;\n  setIdleDuration: Function;\n  getIdleDuration: Function;\n  getIdleInfo: Function;\n  wakeup: Function;\n  idle: Function;\n  focus: Function;\n  blur: Function;\n  on: Function;\n  off: Function;\n  onEvery: Function;\n  now: Function;\n}\n\ninterface Document {\n  createEventObject?: any;\n  createEvent?: any;\n  createElement?: any;\n  hidden?: any;\n  mozHidden?: any;\n  msHidden?: any;\n  webkitHidden?: any;\n}\n\nconst ifvisible = ((): IfVisibleInterface => {\n\n  // const addEvent: Function;\n  // const customEvent: { add: Function, remove: Function, fire: Function };\n  let hidden: string;\n  let idleStartedTime = 0;\n  // const ie: any;\n  let visibilityChange: string;\n  const doc: Document = document;\n  let initialized = false;\n  let status = \"active\";\n  let idleTime = 60000;\n\n  const customEvent: { add: Function, remove: Function, fire: Function } = (function () {\n    let S4: Function;\n    let addCustomEvent: Function;\n    let cgid: string;\n    let fireCustomEvent: Function;\n    let guid: Function;\n    let listeners: any;\n    let removeCustomEvent: Function;\n    S4 = function () {\n      return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n    };\n    guid = function () {\n      return S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4();\n    };\n    listeners = {};\n    cgid = '__ceGUID';\n    addCustomEvent = function (obj: any, event: string, callback: Function) {\n      obj[cgid] = undefined;\n      if (!obj[cgid]) {\n        obj[cgid] = \"ifvisible.object.event.identifier\";\n      }\n      if (!listeners[obj[cgid]]) {\n        listeners[obj[cgid]] = {};\n      }\n      if (!listeners[obj[cgid]][event]) {\n        listeners[obj[cgid]][event] = [];\n      }\n      return listeners[obj[cgid]][event].push(callback);\n    };\n    fireCustomEvent = function (obj: any, event: string, memo: any) {\n      var ev, j, len, ref, results;\n      if (obj[cgid] && listeners[obj[cgid]] && listeners[obj[cgid]][event]) {\n        ref = listeners[obj[cgid]][event];\n        results = [];\n        for (j = 0, len = ref.length; j < len; j++) {\n          ev = ref[j];\n          results.push(ev(memo || {}));\n        }\n        return results;\n      }\n    };\n    removeCustomEvent = function (obj: any, event: string, callback: Function) {\n      var cl, i, j, len, ref;\n      if (callback) {\n        if (obj[cgid] && listeners[obj[cgid]] && listeners[obj[cgid]][event]) {\n          ref = listeners[obj[cgid]][event];\n          for (i = j = 0, len = ref.length; j < len; i = ++j) {\n            cl = ref[i];\n            if (cl === callback) {\n              listeners[obj[cgid]][event].splice(i, 1);\n              return cl;\n            }\n          }\n        }\n      } else {\n        if (obj[cgid] && listeners[obj[cgid]] && listeners[obj[cgid]][event]) {\n          return delete listeners[obj[cgid]][event];\n        }\n      }\n    };\n    return {\n      add: addCustomEvent,\n      remove: removeCustomEvent,\n      fire: fireCustomEvent\n    };\n  })();\n\n  const addEvent: Function = (function () {\n    let setListener: Function;\n    return function (el: any, ev: string, fn: Function) {\n      if (!setListener) {\n        if (el.addEventListener) {\n          setListener = function (el: any, ev: string, fn: Function) {\n            return el.addEventListener(ev, fn.bind(ifvisible), false);\n          };\n        } else if (el.attachEvent) {\n          setListener = function (el: any, ev: string, fn: Function) {\n            return el.attachEvent('on' + ev, fn, false);\n          };\n        } else {\n          setListener = function (el: any, ev: string, fn: Function) {\n            return el['on' + ev] = fn;\n          };\n        }\n      }\n      return setListener(el, ev, fn);\n    };\n  })();\n\n  const ie = (function () {\n    let check: Function;\n    let div = doc.createElement(\"div\");\n    let all = div.getElementsByTagName(\"i\");\n    let undef = void 0;\n    let v: number = 3;\n    // undef = void 0;\n    // v = 3;\n    // div = doc.createElement(\"div\");\n    // all = div.getElementsByTagName(\"i\");\n    check = function () {\n      return (div.innerHTML = \"<!--[if gt IE \" + (++v) + \"]><i></i><![endif]-->\", all[0]);\n    };\n    while (check()) {\n      continue;\n    }\n    if (v > 4) {\n      return v;\n    } else {\n      return undef;\n    }\n  })();\n\n  // hidden = false;\n  // visibilityChange = void 0;\n  if (typeof doc.hidden !== 'undefined') {\n    hidden = 'hidden';\n    visibilityChange = 'visibilitychange';\n  } else if (typeof doc.mozHidden !== 'undefined') {\n    hidden = 'mozHidden';\n    visibilityChange = 'mozvisibilitychange';\n  } else if (typeof doc.msHidden !== 'undefined') {\n    hidden = 'msHidden';\n    visibilityChange = 'msvisibilitychange';\n  } else if (typeof doc.webkitHidden !== 'undefined') {\n    hidden = 'webkitHidden';\n    visibilityChange = 'webkitvisibilitychange';\n  }\n\n  // }\n\n  function fireEvent(element: any, event: string) {\n    var evt;\n    if (typeof doc.createEventObject !== 'undefined') {\n      return element.fireEvent('on' + event, evt);\n    } else {\n      evt = doc.createEvent('HTMLEvents');\n      evt.initEvent(event, true, true);\n      return !element.dispatchEvent(evt);\n    }\n  };\n\n  function trackIdleStatus() {\n    let timer: any;\n    let wakeUp: Function;\n    wakeUp = function () {\n      clearTimeout(timer);\n      if (status !== 'active') {\n        wakeup();\n      }\n      idleStartedTime = +(new Date());\n      return timer = setTimeout(() => {\n        if (status === 'active') {\n          return idle();\n        }\n      }, idleTime);\n    };\n    wakeUp();\n    addEvent(doc, \"mousemove\", wakeUp);\n    addEvent(doc, \"mouseup\", wakeUp);\n    addEvent(doc, \"keyup\", wakeUp);\n    addEvent(doc, \"touchstart\", wakeUp);\n    addEvent(window, \"scroll\", wakeUp);\n    addEvent(window, \"resize\", wakeUp);\n    focus(wakeUp);\n    return wakeup(wakeUp);\n  };\n\n  function init() {\n    var _blur: any;\n    if (initialized) {\n      return true;\n    }\n    if (!hidden) {\n      _blur = \"blur\";\n      if (ie && ie < 9) {\n        _blur = \"focusout\";\n      }\n      addEvent(window, _blur, function () {\n        return ifvisible.blur();\n      });\n      addEvent(window, \"focus\", function () {\n        return ifvisible.focus();\n      });\n    } else {\n      addEvent(doc, visibilityChange, function () {\n        if (doc.hidden) {\n          return blur();\n        } else {\n          return focus();\n        }\n      }, false);\n    }\n    initialized = true;\n    return trackIdleStatus();\n  };\n\n  const name = 'ifvisible';\n\n  function setIdleDuration(seconds: number) {\n    return idleTime = seconds * 1000;\n  }\n\n  function getIdleDuration() {\n    return idleTime;\n  }\n\n  function getIdleInfo() {\n    let now: number;\n    let res: any;\n    now = +(new Date());\n    res = {};\n    if (status === \"idle\") {\n      res.isIdle = true;\n      res.idleFor = now - idleStartedTime;\n      res.timeLeft = 0;\n      res.timeLeftPer = 100;\n    } else {\n      res.isIdle = false;\n      res.idleFor = now - idleStartedTime;\n      res.timeLeft = (idleStartedTime + idleTime) - now;\n      res.timeLeftPer = (100 - (res.timeLeft * 100 / idleTime)).toFixed(2);\n    }\n    return res;\n  }\n\n  function focus(callback?: Function) {\n    if (typeof callback === \"function\") {\n      on(\"focus\", function (event: any) {\n        callback(event)\n      });\n    } else {\n      status = \"active\";\n      customEvent.fire(ifvisible, \"focus\");\n      customEvent.fire(ifvisible, \"wakeup\");\n      customEvent.fire(ifvisible, \"statusChanged\", {\n        status\n      });\n    }\n    return ifvisible;\n  }\n\n  function blur(callback?: Function) {\n    if (typeof callback === \"function\") {\n      on(\"blur\", function (event: any) {\n        callback(event)\n      });\n    } else {\n      status = \"hidden\";\n      customEvent.fire(ifvisible, \"blur\");\n      customEvent.fire(ifvisible, \"idle\");\n      customEvent.fire(ifvisible, \"statusChanged\", {\n        status\n      });\n    }\n    return ifvisible;\n  }\n\n  function idle(callback?: Function) {\n    if (typeof callback === \"function\") {\n      on(\"idle\", function (event: any) {\n        callback(event)\n      });\n    } else {\n      status = \"idle\";\n      customEvent.fire(ifvisible, \"idle\");\n      customEvent.fire(ifvisible, \"statusChanged\", {\n        status\n      });\n    }\n    return ifvisible;\n  }\n\n  function wakeup(callback?: Function) {\n    if (typeof callback === \"function\") {\n      on(\"wakeup\", (event: any) => callback(event));\n    } else {\n      status = \"active\";\n      customEvent.fire(ifvisible, \"wakeup\");\n      customEvent.fire(ifvisible, \"statusChanged\", {\n        status\n      });\n    }\n    return ifvisible;\n  }\n\n  function on(name: string, callback: Function) {\n    init();\n    customEvent.add(ifvisible, name, callback);\n    return ifvisible;\n  }\n\n  function off(name: string, callback: Function) {\n    init();\n    customEvent.remove(ifvisible, name, callback);\n    return ifvisible;\n  }\n\n  function onEvery(seconds: number, callback: Function) {\n    let paused = false;\n    let t: any;\n    init();\n    if (callback) {\n      t = setInterval(function () {\n        if (status === 'active' && !paused) {\n          return callback();\n        }\n      }, seconds * 1000);\n    }\n    return {\n      stop: function () {\n        return clearInterval(t);\n      },\n      pause: function () {\n        return paused = true;\n      },\n      resume: function () {\n        return paused = false;\n      },\n      code: t,\n      callback: callback\n    };\n  }\n\n  function now(check: string) {\n    init();\n    return status === (check || 'active');\n  };\n\n  return {\n    name,\n    setIdleDuration,\n    getIdleDuration,\n    getIdleInfo,\n    wakeup,\n    idle,\n    focus,\n    blur,\n    on,\n    off,\n    onEvery,\n    now,\n  }\n\n})();\n\npn.container.register('ifvisible', {\n  useValue: ifvisible\n});\npn.ifvisible = pn.container.resolve<IfVisibleInterface>('ifvisible');\n", "import { IfVisibleInterface } from \"./ifvisible\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface ActiveTimerInterface {\n  name: string;\n\n  setIdleDurationInSeconds(duration: string): void;\n\n  getActiveTimeInSeconds(): number;\n\n  getTotalTimeInSeconds(): number;\n\n  resetRecordedTime(): void;\n\n  startTimer(): void;\n\n  stopTimer(): void;\n\n  initialize(duration?: string): void;\n}\n\nconst activeTimer = ((): ActiveTimerInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const ifvisible = pn.container.resolve<IfVisibleInterface>('ifvisible');\n\n  const name = 'activetimer';\n\n  let minutes = 0;\n  let startStopTimes: any[] = [];\n  let idleTimeout = 60;\n  let idleAfterMediaTimeout = 15;\n  let isPageActive = true;\n  let activeMedia: any;\n\n  const startTimer = () => {\n    resetWaitMediaStopped();\n    var latestStartStopEntry = startStopTimes[startStopTimes.length - 1];\n    if (latestStartStopEntry !== undefined && latestStartStopEntry.stopTime === undefined) {\n      // Can't start new timer until previous finishes.\n      return;\n    }\n    startStopTimes.push({\n      'startTime': new Date(),\n      'startMinute': minutes,\n      'stopTime': undefined\n    });\n  }\n\n  const stopTimer = () => {\n    if (startStopTimes.length === 0) {\n      // Can't stop timer before you've started it.\n      return;\n    }\n    if (isPageActive) {\n      return;\n    }\n    if (isAnyMediaPlayed()) {\n      waitMediaStopped();\n      return;\n    }\n    var latestStartStopEntry = startStopTimes[startStopTimes.length - 1];\n    if (latestStartStopEntry.stopTime === undefined) {\n      latestStartStopEntry.stopTime = new Date();\n      latestStartStopEntry.stopMinute = minutes;\n    }\n  }\n\n  const getActiveTimeInSeconds = (): number => {\n    var timeSpentOnPageInMilliseconds = 0;\n\n    for (var i = 0; i < startStopTimes.length; i++) {\n      var startTime = startStopTimes[i].startTime;\n      var stopTime = startStopTimes[i].stopTime;\n      var startMinute = startStopTimes[i].startMinute;\n      var stopMinute = startStopTimes[i].stopMinute;\n      if (stopTime === undefined) {\n        stopTime = new Date();\n        stopMinute = minutes;\n      }\n      timeSpentOnPageInMilliseconds += getDifference(stopTime, startTime, stopMinute, startMinute);\n    }\n\n    return Math.floor(timeSpentOnPageInMilliseconds / 1000);\n  }\n\n  const getTotalTimeInSeconds = (): number => {\n    var timeFromFirstStartInMilliseconds = 0;\n\n    var firstStartStopEntry = startStopTimes[0];\n    if (firstStartStopEntry !== undefined) {\n      var startTime = firstStartStopEntry.startTime;\n      var startMinute = firstStartStopEntry.startMinute;\n      var stopTime = new Date();\n      var stopMinute = minutes;\n      timeFromFirstStartInMilliseconds = getDifference(stopTime, startTime, stopMinute, startMinute);\n    }\n\n    return Math.floor(timeFromFirstStartInMilliseconds / 1000);\n  }\n\n  const getDifference = (stopTime: Date, startTime: Date, stopMinute: number, startMinute: number) => {\n    var correctionMinutes = 10;\n    var difference = Math.abs(stopTime.getTime() - startTime.getTime());\n    var minutesDifference = stopMinute - startMinute;\n    if (difference > (minutesDifference + correctionMinutes) * 60000) {\n      difference = minutesDifference * 60000;\n    }\n    return difference;\n  }\n\n  const setIdleDurationInSeconds = (duration: string) => {\n    var durationFloat = parseFloat(duration);\n    if (!isNaN(durationFloat)) {\n      ifvisible.setIdleDuration(durationFloat);\n      idleTimeout = durationFloat;\n    } else {\n      throw {\n        name: 'InvalidDurationException',\n        message: 'An invalid duration time (' + duration + ') was provided.'\n      };\n    }\n  }\n\n  const resetRecordedTime = () => {\n    startStopTimes = [];\n    startTimer();\n  }\n\n  const listenForVisibilityEvents = () => {\n    ifvisible.on('blur', () => {\n      isPageActive = false;\n      stopTimer();\n    });\n\n    ifvisible.on('focus', () => {\n      isPageActive = true;\n      startTimer();\n    });\n\n    ifvisible.on('idle', () => {\n      if (idleTimeout > 0) {\n        isPageActive = false;\n        stopTimer();\n      }\n    });\n\n    ifvisible.on('wakeup', () => {\n      if (idleTimeout > 0) {\n        isPageActive = true;\n        startTimer();\n      }\n    });\n  }\n\n  const isAnyMediaPlayed = () => {\n    activeMedia = jqUtils.filter('video,audio', (el: any) => {\n      return !el.paused;\n    });\n\n    return !!activeMedia.length;\n  }\n\n  const stopTimerAfterMedia = () => {\n    setTimeout(() => {\n      stopTimer()\n    }, idleAfterMediaTimeout * 1000);\n  }\n\n  const waitMediaStopped = () => {\n    if (!activeMedia) {\n      return;\n    }\n\n    activeMedia.forEach(function(media: any) {\n      jqUtils.on(media, 'pause', stopTimerAfterMedia);\n    });\n  }\n\n  const resetWaitMediaStopped = () => {\n    if (!activeMedia) {\n      return;\n    }\n\n    activeMedia.forEach(function(media: any) {\n      jqUtils.off(media, 'pause', stopTimerAfterMedia);\n    });\n  }\n\n  const initialize = (duration?: string) => {\n    if (duration) {\n      setIdleDurationInSeconds(duration);\n    }\n    listenForVisibilityEvents();\n    startTimer();\n    setInterval(() => {\n      minutes++;\n    }, 60000);\n  }\n\n  return {\n    name,\n    setIdleDurationInSeconds,\n    getActiveTimeInSeconds,\n    getTotalTimeInSeconds,\n    resetRecordedTime,\n    startTimer,\n    stopTimer,\n    initialize,\n  }\n\n})();\n\npn.container.register('activetimer', {\n  useValue: activeTimer\n});\npn.activetimer = pn.container.resolve<ActiveTimerInterface>('activetimer');\n", "export interface DoubleClickForPublisherInterface {\n  name: string;\n\n  initialize(force?: boolean): void;\n\n  setCustomHandler(fn: Function): void;\n\n  getAds(lastAdsCount?: number): any[];\n\n  resetAds(): void;\n}\n\nconst doubleClickForPublisher = ((): DoubleClickForPublisherInterface => {\n\n  const name = 'doubleClickForPublisher';\n\n  let ads: any = {};\n  let adsIdsStack: string[] = [];\n  let _subscribed = false;\n  let _customHandler: Function;\n\n  const EVENT_SOURCE = {\n    RENDERED_FOR_CURRENT_UNIT: 1,\n    DID_NOT_RENDER_BUT_VIEWED: 2,\n    RECIEVED_FROM_GET_SLOTS: 3\n  };\n\n  function adSubscribe () {\n    if (_subscribed) {\n      return false;\n    }\n    _subscribed = true;\n\n    try {\n      var googletag = window.googletag = window.googletag || {};\n      googletag.cmd = googletag.cmd || [];\n\n      googletag.cmd.push(() => {\n        googletag.pubads().addEventListener('slotRenderEnded', adRendered);\n        googletag.pubads().addEventListener('impressionViewable', adViewable);\n        googletag.companionAds().addEventListener('slotRenderEnded', adRendered);\n        googletag.companionAds().addEventListener('impressionViewable', adViewable);\n      });\n\n      // in some cases googletag already defined and a lot of slots already rendered and viewable\n      if (googletag.apiReady) {\n        googletag.cmd.push(() => {\n          getAdSlots(googletag.pubads().getSlots());\n          getAdSlots(googletag.companionAds().getSlots());\n        });\n      }\n      return true;\n    } catch (e) {\n      error(e);\n      return false;\n    }\n  }\n\n  function initialize (force?: boolean): void {\n    if (force) {\n      resetAds();\n      _subscribed = false;\n    }\n    adSubscribe();\n  }\n  initialize();\n\n  function setCustomHandler (fn: Function): void {\n    _customHandler = fn;\n  }\n\n  function customHandle (ad: string, id: string) {\n    if (typeof _customHandler === 'function') {\n      _customHandler(ad, id);\n    }\n  }\n\n  /**\n   * return captured ads\n   * @returns {Array}\n   */\n  function getAds (lastAdsCount?: number): any[] {\n    var result: any[] = [];\n    var startIndex = 0;\n    var adsIdsStackLength = adsIdsStack.length;\n\n    if (\n      lastAdsCount && isInteger(lastAdsCount)\n      && lastAdsCount > 0\n      && lastAdsCount < adsIdsStackLength\n    ) {\n      startIndex = adsIdsStackLength - lastAdsCount;\n    }\n\n    for (var i = startIndex; i < adsIdsStackLength; i++) {\n      var adsId = adsIdsStack[i];\n\n      if (!hasAdsOwnsProperty(adsId)) {\n        continue;\n      }\n\n      result.push(ads[adsId]);\n    }\n\n    return result;\n  }\n\n  function hasAdsOwnsProperty (id: string) {\n    return id && ads[id] !== undefined && ads[id] !== null && ads.hasOwnProperty(id);\n  }\n\n  function resetAds (): void {\n    ads = {};\n    adsIdsStack = [];\n  }\n\n  function isInteger (value: number) {\n    return typeof value === 'number'\n      && isFinite(value)\n      && Math.floor(value) === value;\n  }\n\n  /**\n   * process already rendered slots\n   * with was not handled by events\n   * @param slots\n   */\n  function getAdSlots (slots: any[]) {\n    for (var i = 0; i < slots.length; i++) {\n      var slot = slots[i];\n      adRendered({\n        eventSource: EVENT_SOURCE.RECIEVED_FROM_GET_SLOTS,\n        slot: slot\n      });\n    }\n  }\n\n  function getSlotInfo (event: any): any {\n    var ad: any;\n    try {\n      var serviceName = event.serviceName;\n      var slot = event.slot;\n      if (!serviceName) {\n        var services = event.slot.getServices();\n        if (services && services.length) {\n          serviceName = services[0].getName();\n        }\n      }\n      var slotInfo = slot.getResponseInformation() || {};\n      var slotId = slot.getSlotId ? slot.getSlotId() : {};\n      var elementId = slot.getSlotElementId ? slot.getSlotElementId() : (slotId.getDomId ? slotId.getDomId() : null);\n      ad = {\n        companion: serviceName ? serviceName === 'companion_ads' : false,\n        adUnit: slot.getAdUnitPath ? slot.getAdUnitPath() : 0,\n        isEmpty: event.isEmpty,\n        elementId: elementId,\n        advertiserId: event.advertiserId || slotInfo.advertiserId,\n        campaignId: event.campaignId || slotInfo.campaignId,\n        lineItemId: event.lineItemId || slotInfo.lineItemId,\n        creativeId: event.creativeId || slotInfo.creativeId,\n        eventSource: event.eventSource || null,\n        size: event.size && event.size.slice(0, 2) || null,\n        viewed: false,\n        position: null\n      };\n      var element = document.getElementById(elementId);\n      if (elementId && element) {\n        ad.position = {\n          top: element.offsetTop,\n          left: element.offsetLeft\n        };\n        if (event.isEmpty === undefined) {\n          ad.isEmpty = element.offsetWidth <= 0 && element.offsetHeight <= 0;\n          if (!ad.isEmpty && !ad.size) {\n            var sizes = slot.getSizes();\n            if (sizes && sizes.length) {\n              ad.size = typeof sizes[0] === 'object' ? [sizes[0].getWidth(), sizes[0].getHeight()] : sizes[0];\n            }\n          }\n        }\n      }\n    } catch (e) {\n      error(e);\n    }\n\n    return ad;\n  }\n\n  function adRendered (event: any) {\n    event.eventSource = event.eventSource || EVENT_SOURCE.RENDERED_FOR_CURRENT_UNIT;\n    var ad = getSlotInfo(event);\n    var id = getAdId(event.slot);\n\n    if (!id) {\n      return;\n    }\n\n    if (ads[id]) {\n      ad.viewed = ads[id].viewed;\n    } else {\n      adsIdsStack.push(id);\n    }\n\n    ads[id] = ad;\n    customHandle(ad, id);\n  }\n\n  function adViewable (event: any) {\n    var id = getAdId(event.slot);\n\n    if (!id) {\n      return;\n    }\n\n    var ad = ads[id] || getSlotInfo(event);\n\n    if (!hasAdsOwnsProperty(id)) {\n      ads[id] = ad;\n      adsIdsStack.push(id);\n    }\n\n    if (ad.companion === undefined) {\n      ad.companion = event.serviceName === 'companion_ads';\n    }\n\n    if (!ad.eventSource || ad.eventSource > EVENT_SOURCE.DID_NOT_RENDER_BUT_VIEWED) {\n      ad.eventSource = EVENT_SOURCE.DID_NOT_RENDER_BUT_VIEWED;\n    }\n\n    ad.viewed = true;\n\n    customHandle(ad, id);\n  }\n\n  function getAdId (slot: any): string | undefined {\n    try {\n      var slotId = slot.getSlotId ? slot.getSlotId() : {};\n      var elementId = slot.getSlotElementId ? slot.getSlotElementId() : (slotId.getDomId ? slotId.getDomId() : null);\n      var instance = slot.getAdUnitPath ? slot.getAdUnitPath() : 0;\n      var id = slotId.getId ? slotId.getId() : 0;\n      return [elementId, id, instance].join(':');\n    } catch (e) {\n      error(e);\n    }\n  }\n\n  function error (e: any) {\n    if (pn && pn.util && pn.util.error) {\n      pn.util.error('DFP module error: ', e);\n    }\n  }\n\n  return {\n    name,\n    initialize,\n    setCustomHandler,\n    getAds,\n    resetAds,\n  }\n})();\n\npn.container.register('doubleClickForPublisher', {\n  useValue: doubleClickForPublisher\n});\npn.doubleClickForPublisher = pn.container.resolve<DoubleClickForPublisherInterface>('doubleClickForPublisher');\n", "import { PostmessageInterface } from \"./postmessage\";\nimport { UtilInterface } from \"./util\";\n\nexport interface ApplePayInterface {\n  name: string;\n}\n\nexport interface PaymentAuthorizedParamsInterface {\n  countryCode: string;\n  zipCode: string;\n  billingZipCode: string;\n  nonce: string;\n  cardType: string;\n  user?: {\n    email: string\n  };\n}\n\nconst applePay = ((): ApplePayInterface => {\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const name = 'applePay';\n\n  const applePayJsApiVersion = 2;\n\n  // errorCode = 100 - Error creating client\n  // errorCode = 101 - Error creating applePayInstance\n  // errorCode = 102 - Apple Pay failed to load\n  // errorCode = 103 - Error tokenizing Apple Pay\n  // errorCode = 104 - Error after applying a new shipping address\n\n  let braintreeClientLoaded = false;\n  let deviceDataCollectorLoaded = false;\n  let braintreeApplePayLoaded = false;\n\n  const clientSrc = 'https://js.braintreegateway.com/web/3.79.1/js/client.min.js';\n  const applePaySrc = 'https://js.braintreegateway.com/web/3.79.1/js/apple-pay.min.js';\n  const deviceDataCollectorSrc = 'https://js.braintreegateway.com/web/3.79.1/js/data-collector.min.js';\n\n  let session: any;\n  let btApplePayInstance: any;\n  let btClientInstance: any;\n  let deviceDataCollectorInstance: any;\n  let paymentRequest: any;\n  let requestEmail: boolean;\n  let requestPostalAddress: boolean;\n  let clientToken: string;\n  let termId = '';\n\n  postmessage.subscribe('loaded', () => {\n    applePayCanMakePayments();\n  });\n\n  postmessage.subscribe('startCheckout', () => {\n    applePayCanMakePayments();\n  });\n\n  postmessage.subscribe('applePayBtClientToken', (data: any) => {\n    initPayment(data.params.clientToken);\n  });\n\n  postmessage.subscribe('applePayBtCheckoutFlowProperties', (data: any) => {\n    requestEmail = data.params.requestEmail;\n    requestPostalAddress = data.params.requestPostalAddress;\n  });\n\n  postmessage.subscribe('applyTaxFailed', (data: any) => {\n    session.abort();\n  });\n\n  postmessage.subscribe('checkApplePayBtInstance', (data: any) => {\n    if (btApplePayInstance) {\n      postmessage.broadcast('applePayInit', {});\n    }\n  });\n\n  postmessage.subscribe('applyTaxCompleted', (data: any) => {\n    completePayment(data.params);\n  });\n\n  postmessage.subscribe('applePayBtBeginSession', (data: any) => {\n    let copiedPostMessageParams: any = {};\n    const postMessageParams = data.params;\n\n    if (postMessageParams.resourceTitle) {\n      copiedPostMessageParams = postMessageParams;\n    }\n\n    if (postMessageParams.termId) {\n      termId = postMessageParams.termId || '';\n    }\n\n    var paymentRequestParams: any = {\n      currencyCode: postMessageParams.currencyCode,\n      total: {\n        label: postMessageParams.resourceTitle,\n        amount: postMessageParams.chargeAmount\n      }\n    };\n\n    requestAdditionalPaymentInfo(paymentRequestParams);\n\n    try {\n      paymentRequest = btApplePayInstance.createPaymentRequest(paymentRequestParams);\n    } catch (msg) {\n      postmessage.broadcast('payment-error', { errorCode: 101 });\n    }\n\n    session = new window.ApplePaySession(applePayJsApiVersion, paymentRequest);\n\n    session.onvalidatemerchant = (event: any) => {\n      btApplePayInstance.performValidation({\n        validationURL: event.validationURL,\n        displayName: postMessageParams.resourceTitle || copiedPostMessageParams.resourceTitle\n      }, (validationErr: any, merchantSession: any) => {\n        if (validationErr) {\n          session.abort();\n          postmessage.broadcast('payment-error', { errorCode: 102 });\n          return;\n        }\n        session.completeMerchantValidation(merchantSession);\n      });\n    };\n\n    session.onpaymentauthorized = (event: any) => {\n      btApplePayInstance.tokenize({\n        token: event.payment.token\n      }, (tokenizeErr: any, payload: any) => {\n        if (tokenizeErr) {\n          postmessage.broadcast('payment-error', { errorCode: 103 });\n          session.completePayment(window.ApplePaySession.STATUS_FAILURE);\n          return;\n        }\n\n        var applePayPayloadData: any = {\n          nonce: payload.nonce,\n          cardType: payload.details.cardType\n        };\n\n        if (requestEmail || requestPostalAddress) {\n          onPaymentAuthorized(event, applePayPayloadData);\n        } else {\n          completePayment(applePayPayloadData);\n        }\n      });\n    };\n\n    session.begin();\n  });\n\n  const applePayCanMakePayments = () => {\n    var canMakePayments = util.__protected__.isApplePayAllowed();\n    postmessage.broadcast('EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS', { canMakePayments: canMakePayments });\n  }\n\n  const requestAdditionalPaymentInfo = (paymentRequestParams: any) => {\n    if (requestEmail) {\n      paymentRequestParams.requiredShippingContactFields = ['email'];\n    }\n\n    if (requestPostalAddress) {\n      paymentRequestParams.requiredBillingContactFields = ['postalAddress'];\n    }\n  }\n\n  const onPaymentAuthorized = (event: any, data: any) => {\n    const billingContact = event.payment.billingContact;\n    \n    let params: PaymentAuthorizedParamsInterface = {\n      countryCode: billingContact.countryCode ? billingContact.countryCode.toUpperCase() : billingContact.countryCode,\n      zipCode: billingContact.postalCode,\n      billingZipCode: billingContact.postalCode,\n      nonce: data.nonce,\n      cardType: data.cardType\n    };\n\n    if (event.payment.shippingContact) {\n      params.user = {\n        email: event.payment.shippingContact.emailAddress,\n      }\n    }\n\n    postmessage.broadcast('applePayPaymentAuthorized' + termId, params);\n  }\n\n  const completePayment = (data: any) => {\n    session.completePayment(window.ApplePaySession.STATUS_SUCCESS);\n    data.deviceData = deviceDataCollectorInstance.deviceData;\n    postmessage.broadcast('applePayNonce' + termId, data);\n  }\n\n  const initPayment = (token: string) => {\n    clientToken = token;\n    addClientScript();\n  }\n\n  const initBraintree = () => {\n    window.braintree.client.create({\n      authorization: clientToken\n    })\n      .then((clientInstance: any) => {\n        btClientInstance = clientInstance;\n        return window.braintree.dataCollector.create({\n          client: clientInstance,\n          kount: true,\n          paypal: true\n        });\n      })\n      .then((dataCollectorInstance: any) => {\n        deviceDataCollectorInstance = dataCollectorInstance;\n        return btClientInstance;\n      })\n      .then((clientInstance: any) => {\n        window.braintree.applePay.create({\n          client: clientInstance\n        }, (applePayErr: any, applePayInstance: any) => {\n          if (applePayErr) {\n            postmessage.broadcast('payment-error', { errorCode: 101 });\n            return;\n          }\n\n          btApplePayInstance = applePayInstance;\n          postmessage.broadcast('applePayInit', {});\n        });\n      })\n      .catch((clientErr: any) => {\n        if (clientErr) {\n          postmessage.broadcast('payment-error', { errorCode: 100 });\n          util.error('[TP] Client error: ' + clientErr.message);\n          return;\n        }\n      });\n  }\n\n  const addClientScript = () => {\n    if (isClientScriptAdded()) {\n      return;\n    }\n\n    addScript(clientSrc, () => {\n      braintreeClientLoaded = true;\n      addDeviceDataCollectorScript();\n    });\n  }\n\n  const addDeviceDataCollectorScript = () => {\n    if (isDeviceDataCollectorScriptAdded()) {\n      return;\n    }\n\n    addScript(deviceDataCollectorSrc, () => {\n      deviceDataCollectorLoaded = true;\n      addApplePayScript();\n    });\n  }\n\n  const addApplePayScript = () => {\n    if (isApplePayScriptAdded()) {\n      return;\n    }\n\n    addScript(applePaySrc, () => {\n      braintreeApplePayLoaded = true;\n      initBraintree();\n    });\n  }\n\n  const addScript = (src: string, onload: any) => {\n    util.addScript(src, onload);\n  }\n\n  const isClientScriptAdded = () => {\n    return util.isScriptAdded(clientSrc);\n  }\n\n  const isDeviceDataCollectorScriptAdded = () => {\n    return util.isScriptAdded(deviceDataCollectorSrc);\n  }\n\n  const isApplePayScriptAdded = () => {\n    return util.isScriptAdded(applePaySrc);\n  }\n\n  return {\n    name,\n  };\n\n})();\n\npn.container.register('applePay', {\n  useValue: applePay\n})\npn.applePay = pn.container.resolve<ApplePayInterface>('applePay');\n", "import { PostmessageInterface } from \"./postmessage\";\nimport { UtilInterface } from \"./util\";\n\nexport interface GoCardlessDropinInterface {\n  name: string;\n}\n\nexport interface InitGoCardlessDropinDataInterface {\n  sender: string;\n  displayMode: string;\n  params: InitGoCardlessDropinInterface;\n}\n\nexport interface InitGoCardlessDropinInterface {\n  environment: string;\n  billingRequestFlowId: string;\n}\n\nexport interface InitGoCardlessDropinUpiInterface {\n  customer: string;\n  mandate: string;\n  bank_name: string;\n  currency: string;\n  bank_account_holder: string;\n  bank_account_ending: string;\n}\n\nconst goCardlessDropin = ((): GoCardlessDropinInterface => {\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const name = 'goCardlessDropin';\n  let sender: string = '';\n\n  let params: InitGoCardlessDropinInterface = {\n    environment: '',\n    billingRequestFlowId: ''\n  };\n\n  let upi: InitGoCardlessDropinUpiInterface = {\n    customer: '',\n    mandate: '',\n    bank_account_ending: '',\n    bank_account_holder: '',\n    bank_name: '',\n    currency: ''\n  };\n\n  let billingRequestFlowPromise: any = null;\n  let isGoCardlessLoaded = false;\n\n  const goCardlessDropinSrc = 'https://pay.gocardless.com/billing/static/dropin/v2/initialise.js';\n\n  postmessage.subscribe('LOAD_GOCARDLESS_DROPIN', (data: InitGoCardlessDropinDataInterface) => {\n    sender = data.sender;\n\n    if (isGoCardlessLoaded) {\n      postmessage.send('GOCARDLESS_DROPIN_LOADED', null, sender);\n      return;\n    }\n\n    addScript(goCardlessDropinSrc, () => {\n      isGoCardlessLoaded = true;\n      postmessage.send('GOCARDLESS_DROPIN_LOADED', null, sender);\n    });\n  });\n\n  postmessage.subscribe('GOCARDLESS_DROPIN_MANDATE_CREATION_INIT', (data: InitGoCardlessDropinDataInterface) => {\n    params = data.params;\n\n    if (isGoCardlessLoaded) {\n      initiatePaymentProcess();\n    }\n  });\n\n  const initiatePaymentProcess = () => {\n    const dropInModalHandler = window.GoCardlessDropin.create({\n      billingRequestFlowID: params.billingRequestFlowId,\n      environment: params.environment,\n      onSuccess: (billingRequest: any) => {\n        const {customer, mandate_request_mandate} = billingRequest.links;\n        const {account_number_ending, account_holder_name, bank_name} = billingRequest.resources.customer_bank_account;\n        const {currency} = billingRequest.mandate_request;\n\n        upi = {\n          customer: customer,\n          mandate: mandate_request_mandate,\n          bank_account_ending: account_number_ending,\n          bank_account_holder: account_holder_name,\n          bank_name: bank_name,\n          currency: currency\n        };\n\n        billingRequestFlowPromise = null;\n        postmessage.send('GOCARDLESS_DROPIN_MANDATE_CREATION_COMPLETE', upi, sender);\n      },\n      onExit: (error: any) => {\n        billingRequestFlowPromise = null;\n\n        if (error) {\n          postmessage.send('payment-error', {message: error}, sender);\n        } else {\n          postmessage.send('GOCARDLESS_DROPIN_ENABLE_PLUGIN', null, sender);\n        }\n      },\n    });\n    dropInModalHandler.open();\n  }\n\n  const addScript = (src: string, onload: any) => {\n    util.addScript(src, onload);\n  }\n\n  return {\n    name,\n  };\n\n})();\n\npn.container.register('goCardlessDropin', {\n  useValue: goCardlessDropin\n})\npn.goCardlessDropin = pn.container.resolve<GoCardlessDropinInterface>('goCardlessDropin');\n", "import {PostmessageInterface} from \"./postmessage\";\nimport {UtilInterface} from \"./util\";\n\nexport interface BraintreeGooglePayInterface {\n  name: string;\n\n  initialize(): void;\n}\n\nexport interface BraintreeGooglePayConfigInterface {\n  clientToken: string;\n  environment: string;\n  merchantId: string;\n}\n\nexport interface BraintreeGooglePayTermConfigInterface {\n  amount: string;\n  currencyCode: string;\n}\n\nconst braintreeGooglePayIntegrationService = ((): BraintreeGooglePayInterface => {\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const name = 'braintreeGooglePayIntegrationService';\n  let isInit = false;\n\n  const clientSrc = 'https://js.braintreegateway.com/web/3.76.4/js/client.min.js';\n  const googlePaymentSrc = 'https://js.braintreegateway.com/web/3.76.4/js/google-payment.min.js';\n  const payJsSrc = 'https://pay.google.com/gp/p/js/pay.js';\n  const deviceDataCollectorSrc = 'https://js.braintreegateway.com/web/3.76.4/js/data-collector.min.js';\n\n  let btClientInstance: any;\n  let deviceDataCollectorInstance: any;\n  let paymentsClient: any;\n  let googlePaymentInstance: any;\n  let googlePayConfig: BraintreeGooglePayConfigInterface;\n\n  const initialize = function () {\n    if (isInit) {\n      return;\n    }\n\n    isInit = true;\n    postmessage.subscribe('braintree-google-pay-initiate-start', initiateStartCallback);\n    postmessage.subscribe('braintree-google-pay-show-pay-window', showPayWindowCallback);\n  }\n\n  const initiateStartCallback = (data: any) => {\n    googlePayConfig = data.params;\n    loadDynamicScript(clientSrc)\n      .then(() => {\n        return loadDynamicScript(deviceDataCollectorSrc);\n      })\n      .then(() => {\n        return loadDynamicScript(googlePaymentSrc);\n      })\n      .then(() => {\n        return loadDynamicScript(payJsSrc);\n      })\n      .then(() => {\n        return init();\n      })\n      .then((params: any) => {\n        postmessage.broadcast('braintree-google-pay-initiate-end', params);\n      })\n      .catch((error) => {\n        util.error(error);\n        postmessage.broadcast('braintree-google-pay-error', error);\n      })\n  }\n\n  const showPayWindowCallback = (data: any) => {\n    makePayment(data.params);\n  }\n\n  const makePayment = (data: BraintreeGooglePayTermConfigInterface) => {\n    const {currencyCode, amount} = data;\n    let paymentDataRequest = googlePaymentInstance.createPaymentDataRequest({\n      transactionInfo: {\n        currencyCode,\n        totalPriceStatus: 'FINAL',\n        totalPrice: amount\n      }\n    });\n\n    let cardPaymentMethod = paymentDataRequest.allowedPaymentMethods[0];\n    cardPaymentMethod.parameters.billingAddressRequired = true;\n    cardPaymentMethod.parameters.billingAddressParameters = {\n      format: 'FULL', phoneNumberRequired: true\n    };\n    paymentDataRequest.callbackIntents = ['PAYMENT_AUTHORIZATION'];\n\n    getPaymentsClient().loadPaymentData(paymentDataRequest)\n      .then(function (paymentData: any) {\n        return paymentData;\n      })\n      .catch(function (error: any) {\n        if (error.statusCode !== 'CANCELED') {\n          util.error(error);\n          postmessage.broadcast('braintree-google-pay-error', error.message || error.statusMessage);\n        }\n      });\n  }\n\n  const init = () => {\n    return createClientInstance()\n      .then(() => {\n        return initDeviceDataCollector();\n      })\n      .then(() => {\n        return initBraintreeGooglePay();\n      });\n  }\n\n  const createClientInstance = () => {\n    return window.braintree.client.create({\n      authorization: googlePayConfig.clientToken\n    })\n      .then(function (client: any) {\n        btClientInstance = client;\n      });\n  }\n\n  const initDeviceDataCollector = () => {\n    return window.braintree.dataCollector.create({\n      client: btClientInstance,\n      kount: true,\n      paypal: true\n    })\n      .then(function (data: any) {\n        deviceDataCollectorInstance = data;\n      });\n  }\n\n  const initBraintreeGooglePay = () => {\n    paymentsClient = null;\n\n    return window.braintree.googlePayment.create({\n      client: btClientInstance,\n      googlePayVersion: 2,\n      googleMerchantId: googlePayConfig.merchantId,\n    })\n      .then(function (instance: any) {\n        googlePaymentInstance = instance;\n\n        return getPaymentsClient().isReadyToPay({\n          apiVersion: 2,\n          apiVersionMinor: 0,\n          allowedPaymentMethods: configureAvailablePaymentMethods(),\n          existingPaymentMethodRequired: true\n        });\n      });\n  }\n\n  const getPaymentsClient = () => {\n    if (paymentsClient) {\n      return paymentsClient;\n    }\n\n    paymentsClient = new window.google.payments.api.PaymentsClient({\n      environment: googlePayConfig.environment,\n      paymentDataCallbacks: {\n        onPaymentAuthorized: function (paymentData: any) {\n          const parsedResponse = parseResponse(paymentData);\n          return parsedResponse.then(function (parsedResponse: any) {\n            postmessage.broadcast('braintree-google-pay-payment-complete', Object.assign({}, parsedResponse, deviceDataCollectorInstance));\n            return {\n              transactionState: 'SUCCESS'\n            };\n          })\n            .catch(function (error: any) {\n              util.error(error);\n              postmessage.broadcast('braintree-google-pay-error', error);\n              return {\n                transactionState: 'ERROR',\n                error,\n              }\n            });\n        },\n      }\n    });\n\n    return paymentsClient;\n  }\n\n  const parseResponse = (paymentData: any) => {\n    return googlePaymentInstance.parseResponse(paymentData);\n  }\n\n  const configureAvailablePaymentMethods = () => {\n    let methods = googlePaymentInstance.createPaymentDataRequest().allowedPaymentMethods;\n    // exclude PayPal methods\n    return methods.filter((m: any) =>  m.type !== 'PAYPAL');\n  }\n\n\n  const loadDynamicScript = (src: string) => {\n    return new Promise(function (resolve) {\n       if (util.isScriptAdded(src)) {\n         resolve(null);\n         return;\n       }\n\n      var a = document.createElement('script');\n      var b = document.getElementsByTagName('script')[0];\n      b.parentNode?.insertBefore(a, b);\n\n      a.type = 'text/javascript';\n      a.async = true;\n      a.onload = function () {\n        resolve(null);\n      };\n      a.src = src;\n    });\n  }\n\n  return {\n    name,\n    initialize,\n  };\n\n})();\n\npn.container.register('braintreeGooglePayIntegrationService', {\n  useValue: braintreeGooglePayIntegrationService\n})\npn.braintreeGooglePayIntegrationService = pn.container.resolve<BraintreeGooglePayInterface>('braintreeGooglePayIntegrationService');\n", "import { UtilInterface } from \"./util\";\nimport { PostmessageInterface } from \"./postmessage\";\n\nexport interface ApplePayIntegrationServiceInterface {\n  name: string;\n\n  initialize(): void;\n\n  __protected__: {\n    applePayCanMakePaymentsWithActiveCard(): any;\n  }\n}\n\nconst applePayIntegrationService = ((): ApplePayIntegrationServiceInterface => {\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  // errorCode = 110 - Payment completion error\n  // errorCode = 111 - Merchant validation error\n  // errorCode = 112 - Error occurred while starting Apple Pay session\n  // errorCode = 113 - Can not receive payment session from server\n\n  const name = 'applePayIntegrationService';\n\n  const applePayJsApiVersion = 3;\n  let resourceName: string;\n  let session: any;\n  let canMakePayments = false;\n  let termId: string;\n\n  const initialize = (): void => {\n    const isTermIdEqual = (idOfTerm: string) => {\n      return termId ? termId === idOfTerm : true;\n    }\n\n    const createRequest = (postMessageParams: any) => {\n      var request = {\n        countryCode: postMessageParams.params.countryCode,\n        currencyCode: postMessageParams.params.currencyCode,\n        supportedNetworks: ['visa', 'masterCard', 'amex', 'discover'],\n        merchantCapabilities: ['supports3DS'],\n        requiredShippingContactFields: postMessageParams.params.requiredShippingContactFields || [],\n        requiredBillingContactFields: postMessageParams.params.requiredBillingContactFields || [],\n        total: {\n          label: postMessageParams.params.resourceName,\n          amount: postMessageParams.params.chargeAmount\n        },\n      };\n      return request;\n    }\n\n    const abortSession = () => {\n      try {\n        session.abort();\n      } catch (e) {\n        util.error(e);\n      }\n    }\n\n    const validateMerchantAndRequestPaymentSession = (validationUrl: string, displayedCaption?: string) => {\n      var request = {\n        validationUrl: validationUrl,\n        displayedCaption: displayedCaption,\n        userToken: null,\n        userProvider: null,\n        userRef: null,\n        janrainCaptureToken: null,\n        domainName: window.location.hostname,\n        aid: null,\n        termId: termId,\n        merchantIdentifier: tp.applePayMerchantId\n      };\n\n      postmessage.broadcast('apple-pay-pay-session-request', request);\n    }\n\n    const initPwApplePay = () => {\n      canMakePayments = util.__protected__.isApplePayAllowed();\n      postmessage.broadcast('EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS', { canMakePayments: canMakePayments });\n    }\n\n    postmessage.subscribe('provider-component-initiated', () => {\n      if (canMakePayments) {\n        postmessage.broadcast('apple-pay-init', {});\n      }\n    });\n\n    postmessage.subscribe('initPwApplePay', () => {\n      initPwApplePay();\n    });\n\n    postmessage.subscribe('startCheckout', () => {\n      initPwApplePay();\n    });\n\n    postmessage.subscribe('pay-session-received', (postMessageParams: any) => {\n      try {\n        session.completeMerchantValidation(postMessageParams.params.applePaySession);\n      } catch (e) {\n        postmessage.broadcast('payment-error', { errorCode: 111, errors: e });\n      }\n    });\n\n    postmessage.subscribe('apple-pay-complete-payment', (postMessageParams: any) => {\n      if (!isTermIdEqual(postMessageParams.params.termId)) {\n        return;\n      }\n\n      session.completePayment(postMessageParams.params.status, postMessageParams.params.errors);\n    });\n\n    postmessage.subscribe('start-purchase', (postMessageParams: any) => {\n      termId = postMessageParams.params.termId || '';\n      resourceName = postMessageParams.params.resourceName;\n      session = new window.ApplePaySession(applePayJsApiVersion, createRequest(postMessageParams));\n\n      session.onvalidatemerchant = (event: any) => {\n        validateMerchantAndRequestPaymentSession(event.validationURL, resourceName);\n      };\n\n      session.onpaymentauthorized = (event: any) => {\n        try {\n          postmessage.broadcast('apple-pay-payment-authorized', {\n            paymentData: event.payment,\n            termId: termId,\n            merchantIdentifier: tp.applePayMerchantId\n          });\n        } catch (e) {\n          postmessage.broadcast('payment-error', { errorCode: 110, error: e });\n        }\n      };\n\n      try {\n        session.begin();\n      } catch (e) {\n        postmessage.broadcast('payment-error', { errorCode: 112, error: e, termId: termId });\n      }\n    });\n\n    postmessage.subscribe('abort-apple-pay-session', () => {\n      abortSession();\n    });\n  }\n\n  const applePayCanMakePaymentsWithActiveCard = (): any => {\n    var rejectResult = {\n      then: function (callbackFn: Function) {\n        return callbackFn(null);\n      },\n      catch: function () {\n      }\n    };\n    if (!pn.applePayMerchantId) {\n      return rejectResult;\n    }\n\n    var ifCanMakePayments = util.__protected__.isApplePayAllowed();\n\n    if (ifCanMakePayments && pn.applePayMerchantId) {\n      return window.ApplePaySession.canMakePaymentsWithActiveCard(pn.applePayMerchantId);\n    } else {\n      return rejectResult;\n    }\n  }\n\n  return {\n    name,\n    initialize,\n    __protected__: {\n      applePayCanMakePaymentsWithActiveCard: applePayCanMakePaymentsWithActiveCard\n    }\n  }\n\n})();\n\npn.container.register('applePayIntegrationService', {\n  useValue: applePayIntegrationService\n})\npn.applePayIntegrationService = pn.container.resolve<ApplePayIntegrationServiceInterface>('applePayIntegrationService');\n", "import { UtilInterface } from \"./util\";\nimport { PostmessageInterface } from \"./postmessage\";\nimport { AjaxInterface } from \"./ajax\";\n\ndeclare namespace PaymentButton {\n  function on(eventName: string, callback: any): any;\n\n  function off(): any;\n\n  function init(config: object): any;\n\n  function create(elemnt: HTMLElement, config: object): any;\n}\n\nexport interface DatatransApplePayIntegrationServiceInterface {\n  name: string;\n\n  initialize(): void;\n}\n\nconst datatransApplePayIntegrationService = ((): DatatransApplePayIntegrationServiceInterface => {\n\n  // 110: 'Apple Pay button init error',\n  // 111: 'Apple Pay button create error',\n  // 112: 'Could not process with Apple Pay. Please, try again.',\n  // 113: 'No payment method is supported',\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const ajax = pn.container.resolve<AjaxInterface>('ajax');\n\n  const name = 'datatransApplePayIntegrationService';\n  const datatransApplePayButtonId = 'datatrans-applepay-button';\n  let isInitialized = false;\n\n  let loadScriptPromise: any = null;\n  let getConfigPromise: any = null;\n  let iframeId: any;\n  let initParams: any;\n  let subscribed = false;\n\n  const initialize = function () {\n    if (!util.__protected__.isApplePayAllowed() && isInitialized) {\n      return;\n    }\n\n    isInitialized = true;\n    postmessage.subscribe('datatrans-applepay-loaded', pianoOnLoaded);\n    postmessage.subscribe('datatrans-applepay-checkout-initiate-purchase', pianoOnCheckoutInitPurchase);\n    postmessage.subscribe('datatrans-applepay-make-purchase', pianoOnApplePayMakePurchase);\n  }\n\n  const pianoOnLoaded = function (postMessageParams: any) {\n    iframeId = postMessageParams.sender;\n    getConfig()\n      .then(loadDynamicScript)\n      .then(subscribeToEvents);\n  }\n\n  const onError = (payload: any) => {\n    postmessage.send('datatrans-applepay-service-error', payload, iframeId);\n  }\n\n  const pianoOnCheckoutInitPurchase = function (postMessageParams: any) {\n    initParams = postMessageParams.params;\n    getConfig()\n      .then(loadDynamicScript)\n      .then(initPaymentButton)\n      .catch(() => {\n        onError({\n          eventName: 'init-error',\n          errorCode: 110\n        });\n      });\n  }\n\n  const initPaymentButton = () => {\n    PaymentButton.init(initParams.applePayConfig)\n  }\n\n  const pianoOnApplePayMakePurchase = () => {\n    var buttonContainer = document.getElementById(datatransApplePayButtonId);\n    if (buttonContainer === null || buttonContainer.firstElementChild === null) {\n      onError({\n        eventName: 'system-error',\n        errorCode: 112\n      });\n      return;\n    }\n\n    // @ts-ignore\n    buttonContainer.firstElementChild.click();\n  }\n\n  const getConfig = () => {\n    if (getConfigPromise !== null) {\n      return getConfigPromise;\n    }\n\n    getConfigPromise = new Promise((resolve) => {\n      ajax.request({\n        url: tp.getApiEndpoint() + '/anon/datatrans/applepay/config',\n        data: {\n          aid: tp.aid\n        },\n        dataType: 'jsonp',\n        jsonpCallback: 'jsonpCallback',\n        success: function (response: any) {\n          const { config } = response;\n          resolve(config.url);\n        }\n      });\n    });\n\n    return getConfigPromise;\n  }\n\n  const loadDynamicScript = (url: any) => {\n    if (loadScriptPromise !== null) {\n      return loadScriptPromise;\n    }\n\n    const scriptId = 'datatrans-apple-pay';\n    let existingScript = document.getElementById(scriptId);\n    if (!existingScript) {\n      loadScriptPromise = new Promise((resolve) => {\n        var script = document.createElement('script');\n        script.addEventListener('load', () => resolve(null));\n        script.src = url;\n        script.id = scriptId;\n        document.body.appendChild(script);\n      });\n      \n      return loadScriptPromise;\n    }\n  }\n\n  const subscribeToEvents = function () {\n    if (subscribed) {\n      return;\n    }\n\n    PaymentButton.on('init', paymentButtonOnInit);\n    PaymentButton.on('create', paymentButtonOnCreate);\n    PaymentButton.on('token', paymentButtonOnToken);\n    PaymentButton.on('abort', () => {\n      onError({\n        eventName: 'abort',\n        errorCode: 0\n      });\n    });\n\n    PaymentButton.on('unsupported', () => {\n      onError({\n        eventName: 'unsupported',\n        errorCode: 113\n      });\n    });\n\n    PaymentButton.on('error', (payload: any) => {\n      if (payload) {\n        util.error('datatransApplePayIntegrationService. apple pay button error: ' + payload);\n        onError({\n          eventName: 'error',\n          errorCode: 112\n        });\n      }\n    });\n\n    subscribed = true;\n  }\n\n  const paymentButtonOnInit = () => {\n    var container = prepareButtonContainer();\n    PaymentButton.create(container, initParams.paymentConfig)\n      .catch(() => {\n        onError({\n          eventName: 'create-error',\n          errorCode: 111\n        });\n      });\n  }\n\n  const paymentButtonOnCreate = () => {\n    util.log('datatransApplePayIntegrationService paymentButtonOnCreate');\n    postmessage.send('datatrans-applepay-service-ready', null, iframeId);\n  }\n\n  const paymentButtonOnToken = (response: any) => {\n    util.log('datatransApplePayIntegrationService paymentButtonOnToken');\n    postmessage.send('datatrans-applepay-service-token', response.token.details.token, iframeId);\n  }\n\n  const prepareButtonContainer = () => {\n    var container = document.getElementById(datatransApplePayButtonId);\n    if (container === null) {\n      container = document.createElement('div');\n      container.setAttribute('id', datatransApplePayButtonId);\n      container.style.display = 'none';\n      document.body.appendChild(container);\n    }\n\n    container.innerHTML = '';\n\n    return container;\n  }\n\n  return {\n    name,\n    initialize,\n  }\n})();\n\npn.container.register('datatransApplePayIntegrationService', {\n  useValue: datatransApplePayIntegrationService\n})\npn.datatransApplePayIntegrationService = pn.container.resolve<DatatransApplePayIntegrationServiceInterface>('datatransApplePayIntegrationService');\n", "import { PostmessageInterface } from \"./postmessage\";\nimport {UtilInterface} from \"./util\";\n\nexport interface StripeApplePayIntegrationServiceInterface {\n  name: string;\n}\n\nconst stripeApplePayIntegrationService = ((): StripeApplePayIntegrationServiceInterface => {\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const name = 'stripeApplePayIntegrationService';\n\n  let loadScriptPromise: any;\n  let stripe: any = null;\n  let paymentRequest: any = null;\n  let canMakePayment = false;\n  let termId = '';\n\n\n  function initPostmessageListeners() {\n    postmessage.subscribe('stripe-applepay-initialized', function () {\n      loadDynamicScript();\n    });\n\n    postmessage.subscribe('stripe-applepay-initiate-purchase', function (postMessageParams: any) {\n      loadDynamicScript()\n        .then(() => {\n          let apiKey = postMessageParams.params.apiKey;\n          let accountId = postMessageParams.params.accountId;\n          if (stripe === null) {\n            if (accountId) {\n              stripe = window.Stripe(apiKey, {stripeAccount: accountId});\n            } else {\n              stripe = window.Stripe(apiKey);\n            }\n          }\n          var paymentRequestPayload = postMessageParams.params.paymentRequestPayload;\n          return stripe.paymentRequest(paymentRequestPayload);\n        })\n        .then((request: any) => {\n          paymentRequest = request;\n          return request.canMakePayment();\n        })\n        .then((payload: any) => {\n          canMakePayment = payload && payload.applePay;\n\n          postmessage.broadcast('stripe-applepay-initiate-purchase-complete', {\n            canMakePayment: canMakePayment\n          });\n\n          if (!canMakePayment) {\n            return;\n          }\n\n          paymentRequest.on('cancel', () => {\n            postmessage.broadcast('stripe-applepay-start-purchase-complete' + termId, {\n              status: 'fail'\n            });\n          });\n\n          paymentRequest.on('paymentmethod', (ev: any) => {\n            var address = ev.paymentMethod.billing_details.address;\n            var billingAddress = {\n              countryCode: address.country,\n              zipCode: address.postal_code,\n              billingZipCode: address.postal_code,\n            };\n\n            var paymentMethodId = ev.paymentMethod.id;\n            postmessage.broadcast('stripe-applepay-start-purchase-complete' + termId, {\n              status: 'success',\n              paymentMethodId: paymentMethodId,\n              payerEmail: ev.payerEmail,\n              billingAddress: billingAddress\n            });\n\n            ev.complete('success');\n          });\n        })\n        .catch((error: any) => {\n          util.error(error);\n          postmessage.broadcast('stripe-applepay-initiate-purchase-complete', {\n            canMakePayment: false\n          });\n        });\n    });\n\n    postmessage.subscribe('stripe-applepay-start-purchase', function (postMessageParams: any) {\n      termId = postMessageParams.params.termId || '';\n      var paymentRequestPayload = postMessageParams.params.paymentRequestPayload;\n      paymentRequest.update(paymentRequestPayload);\n      paymentRequest.show();\n    });\n\n    postmessage.subscribe('stripe-applepay-abort-request', function () {\n      paymentRequest && paymentRequest.abort();\n      postmessage.broadcast('stripe-applepay-reopen-request');\n    });\n  }\n\n  initPostmessageListeners();\n\n  const loadDynamicScript = () => {\n    if (loadScriptPromise != null) {\n      return loadScriptPromise;\n    }\n    var existingScript = document.getElementById('stripe.js');\n    if (!existingScript) {\n      var script = document.createElement('script');\n      script.src = 'https://js.stripe.com/v3/';\n      script.id = 'stripe.js';\n      document.body.appendChild(script);\n      loadScriptPromise = new Promise(function (resolve) {\n        script.onload = () => {\n          resolve(null);\n        };\n      });\n      return loadScriptPromise;\n    }\n  }\n\n  return {\n    name,\n  }\n\n})();\n\npn.container.register('stripeApplePayIntegrationService', {\n  useValue: stripeApplePayIntegrationService\n});\npn.stripeApplePayIntegrationService = pn.container.resolve<StripeApplePayIntegrationServiceInterface>('stripeApplePayIntegrationService');\n", "import { PostmessageInterface } from \"./postmessage\";\nimport { UtilInterface } from \"./util\";\n\nexport interface Obi3DSChallengeInterface {\n  name: string;\n}\n\nconst obi3DSChallenge = ((): Obi3DSChallengeInterface => {\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const name = 'obi3DSChallenge';\n\n  const initPostmessageListeners = () => {\n    postmessage.subscribe('obi-handle-3ds-challenge', (postMessageParams: any) => {\n      var params = postMessageParams.params;\n      if (!window.obick) {\n        const trustedSources = ['https://jsl.qat.obi.aol.com/obipmservice/obick.umd.js', 'https://jsl.prod.obi.aol.com/obipmservice/obick.umd.js'];\n        if (trustedSources.indexOf(params.obickUrl) === -1) {\n          util.error('Untrusted obickUrl detected: ' + params.obickUrl);\n          return;\n        }\n        var script = document.createElement('script');\n        script.src = params.obickUrl;\n        script.id = 'obick.js';\n        document.body.appendChild(script);\n        script.onload = () => {\n          util.log(`${script.id} onload`);\n          handle3DS(params);\n        };\n      } else {\n        handle3DS(params);\n      }\n    });\n  }\n\n  initPostmessageListeners();\n\n  const handle3DS = (params: any) => {\n    if (params.stepUpUrl && params.stepUpUrl.indexOf('http') !== 0) {\n      util.error('There is no link in params.stepUpUrl for OBI');\n      return;\n    }\n\n    var data = {\n      stepUpUrl: params.stepUpUrl,\n      jwt: params.jwt,\n      transactionId: params.transactionId,\n      zIndex: params.zIndex\n    };\n    window.obick.handle3dsChallenge(data)\n      .then((result: any) => {\n        util.debug(result);\n        postmessage.broadcast('obi-3ds-challenge-complete', {\n          threeDSTransactionId: result.threeDSTransactionId,\n          challengeStatus: result.challengeStatus\n        });\n      })\n      .catch((error: any) => {\n        util.error(error);\n        postmessage.broadcast('obi-3ds-challenge-complete', {\n          error: 'challenge-error',\n          payload: error\n        });\n      });\n  }\n\n  return {\n    name\n  };\n})();\n\npn.container.register('obi3DSChallenge', {\n  useValue: obi3DSChallenge\n});\npn.obi3DSChallenge = pn.container.resolve<Obi3DSChallengeInterface>('obi3DSChallenge');\n", "import { UtilInterface } from \"./util\";\nimport { APIInterface } from \"./api\";\nimport { UserInterface } from \"./user\";\nimport { PianoIdInterface } from \"./pianoId\";\nimport { JqUtilsInterface } from \"./jqUtils\";\n\nexport interface AMPInterface {\n  name: string;\n\n  showLogin(config: any): void;\n\n  logout(callback: any): void;\n\n  login(config: any): void;\n}\n\ninterface ILoginConfig {\n  user_transient: boolean;\n  user_provider: any;\n  reader_id?: string;\n  user_token?: string;\n  user_state?: string;\n}\n\ninterface IApiConfig {\n  reader_id?: string;\n}\n\nconst amp = ((): AMPInterface => {\n\n  const jqUtils = pn.container.resolve<JqUtilsInterface>('jqUtils');\n  const util = pn.container.resolve<UtilInterface>('util');\n  const api = pn.container.resolve<APIInterface>('api');\n  const user = pn.container.resolve<UserInterface>('user');\n  const pianoId = pn.container.resolve<PianoIdInterface>('pianoId');\n\n  const name = 'amp';\n  const composerOnlyProvider = 'publisher_user';\n  const globalConfig = {\n    displayMode: 'inline',\n    containerSelector: 'body',\n    loginSuccess: bindUserWithReaderId,\n  };\n\n  const READER_ID = 'reader_id';\n  const RETURN_URL = 'return';\n\n  const _getAmpExecutionUrl = () => {\n    const aid = pn.aid;\n    return '/' + aid + '/execution/amp'\n  };\n  const _getBindURL = () => {\n    return _getAmpExecutionUrl() + '/login';\n  };\n  const _getUnbindURL = () => {\n    return _getAmpExecutionUrl() + '/logout';\n  };\n\n  const goToReturnUrl = () => {\n    window.location.href = util.getQueryParamByName(RETURN_URL) + '#success=true';\n  }\n\n  const validUserState = (config: any) => {\n    if (config && config.userState && jqUtils.isPlainObject(config.userState)) {\n      var keys = Object.keys(config.userState);\n      if (keys.filter(isUserStateNameValid).length !== keys.length) {\n        util.error(\"user_state accept only contain letters, numbers and underscore\");\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function showLogin(config: any) {\n    config = config ? config : {};\n    var provider = user.getProvider();\n    if (provider.getName() === pianoId.getName()) {\n      var onBindUserWithReaderId: Function;\n      if (config.loginSuccess && jqUtils.isFunction(config.loginSuccess)) {\n        onBindUserWithReaderId = config.loginSuccess;\n      } else {\n        onBindUserWithReaderId = goToReturnUrl;\n      }\n      var loginSuccess = () => {\n        bindUserWithReaderId({}, onBindUserWithReaderId);\n      };\n      var showConfig = Object.assign({}, globalConfig, config);\n\n      if (user.isUserValid()) {\n        loginSuccess();\n        return;\n      }\n\n      showConfig.loginSuccess = loginSuccess;\n\n      pianoId.show(showConfig);\n    } else {\n      util.log(\"Current user provider\" + provider.name + \" is not allowed for amp\");\n      return;\n    }\n  }\n\n  function logout(callback: any) {\n    callback = jqUtils.isFunction(callback) ? callback : goToReturnUrl;\n    const provider = user.getProvider();\n    if (provider.getName() === pianoId.getName()) {\n      pianoId.logout(() => {\n        unbindUserWithReaderId(callback);\n      });\n    } else {\n      unbindUserWithReaderId(callback);\n    }\n  }\n\n  const isUserStateNameValid = (name: string) => {\n    return /^\\w+$/i.test(name);\n  }\n\n  const login = (config: any) => {\n    var userProvider = user.getProvider().getName();\n    if (userProvider === pianoId.getName()) {\n      if (!config) {\n        config = {\n          userProvider: userProvider\n        };\n      } else {\n        config = jqUtils.deepExtend({}, config, {\n          userProvider: userProvider\n        });\n      }\n    }\n\n    var loginConfig: ILoginConfig = {\n      user_transient: true,\n      user_provider: composerOnlyProvider,\n    };\n\n    if (config && config.readerId) {\n      loginConfig.reader_id = config.readerId;\n    }\n\n    if (config && config.userToken) {\n      loginConfig.user_token = config.userToken;\n    }\n\n    if (config && config.userProvider) {\n      loginConfig.user_provider = config.userProvider;\n      loginConfig.user_transient = false;\n    }\n\n    if (!validUserState(config)) {\n      return false;\n    }\n\n    if (config && config.userState) {\n      loginConfig.user_state = JSON.stringify(config.userState);\n    }\n\n    var apiCallback = (response: any) => {\n      if (response.code === 0) {\n        if (config.loginSuccess && jqUtils.isFunction(config.loginSuccess)) {\n          config.loginSuccess();\n        }\n      } else {\n        if (config.loginFail && jqUtils.isFunction(config.loginFail)) {\n          config.loginFail();\n        }\n      }\n    };\n\n    bindUserWithReaderId(loginConfig, apiCallback);\n  }\n\n  const unbindUserWithReaderId = (callback: Function) => {\n    var apiConfig: any = {};\n    apiConfig.reader_id = util.getQueryParamByName(READER_ID);\n\n    if (!apiConfig.reader_id) {\n      util.log('reader_id cannot be empty');\n      return;\n    }\n\n    var endpoint = pn.getExperienceEndpoint(false);\n    api.callApi(_getUnbindURL(), apiConfig, callback, endpoint, false);\n  }\n\n  function bindUserWithReaderId(config: any, callback: Function) {\n    var apiConfig: IApiConfig = config || {};\n\n    if (!apiConfig.reader_id) {\n      apiConfig.reader_id = util.getQueryParamByName(READER_ID);\n    }\n\n    if (!apiConfig.reader_id) {\n      util.log('reader_id cannot be empty');\n      return;\n    }\n\n    var endpoint = pn.getExperienceEndpoint(false);\n    api.callApi(_getBindURL(), apiConfig, callback, endpoint, false);\n  }\n\n  return {\n    name,\n    showLogin,\n    logout,\n    login,\n  }\n\n})()\n\npn.container.register('amp', {\n  useValue: amp\n});\n\npn.amp = pn.container.resolve<AMPInterface>('amp');\n", "import { PostmessageInterface } from \"./postmessage\";\n\nexport interface PerformanceMetricsInterface {\n  name: string;\n}\n\nconst performanceMetrics = ((): PerformanceMetricsInterface => {\n\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n\n  const name = 'performanceMetrics';\n\n  const entriesToFollow = [\n    {\n      resourceRegExp: new RegExp('/checkout/offer/show'),\n      label: 'showOffer'\n    },\n    {\n      resourceRegExp: new RegExp('tinypass\\.min\\.js$'),\n      label: 'tinypassMinJS'\n    },\n    {\n      resourceRegExp: new RegExp('/xbuilder/experience/execute'),\n      label: 'experienceExecute'\n    }\n  ];\n\n  let isLoggerReady = false;\n  let loggerIframeId: string;\n  let batch: any[] = [];\n\n  const EVENT_TP_PERFORMANCE_DATA = 'EVENT_TP_PERFORMANCE_DATA';\n  const EVENT_LOGGER_READY = 'EVENT_LOGGER_READY';\n\n  function init() {\n    if (!window.performance || !window.PerformanceObserver) {\n      return;\n    }\n\n    if (!(typeof performance.getEntries === 'function')) {\n      return;\n    }\n\n    var observe = window.PerformanceObserver.prototype.observe;\n    window.PerformanceObserver.prototype.observe = function (...args) {\n      try {\n        observe.apply(this, args);\n      } catch (e) {\n      }\n    };\n\n    // waiting for handshake\n    postmessage.subscribe(EVENT_LOGGER_READY, function (data: any) {\n      loggerIframeId = data.sender;\n      isLoggerReady = true;\n\n      execBatch();\n    });\n\n    // handle existing entries\n    var existingEntries = performance.getEntries();\n    onEntriesArrive(existingEntries);\n\n    // observe future entries\n    var observer = new PerformanceObserver((list) => {\n      onEntriesArrive(list.getEntries());\n    });\n\n    observer.observe({\n      entryTypes: ['measure', 'resource']\n    });\n  }\n\n  init();\n\n  function onEntriesArrive (entries: any[]) {\n    entries.forEach((entry) => {\n      onEntryArrive(entry);\n    })\n  }\n\n  /*\n  * Performance entry\n  * https://developer.mozilla.org/ru/docs/Web/API/Performance\n  * */\n  function onEntryArrive (entry: any) {\n    if (!shouldWatch(entry)) {\n      return;\n    }\n\n    emitEntry(entry);\n  }\n\n  function isReady () {\n    return isLoggerReady && loggerIframeId;\n  }\n\n  function emitEntry (entry: any) {\n    if (!isReady()) {\n      batch.push(entry);\n      return;\n    }\n\n    batch.push(entry);\n    execBatch();\n  }\n\n  function execBatch () {\n    if (!isReady()) {\n      return;\n    }\n\n    batch.forEach((_entry) => {\n      postmessage.send(EVENT_TP_PERFORMANCE_DATA, {\n        entry: _entry\n      }, loggerIframeId);\n    });\n\n    batch = [];\n  }\n\n  function shouldWatch (entry: any) {\n    return entriesToFollow.some((_entryToFollow) => {\n      return entry.name.match(_entryToFollow.resourceRegExp);\n    });\n  }\n\n  return {\n    name,\n  };\n\n})();\n\npn.container.register('performanceMetrics', {\n  useValue: performanceMetrics\n});\npn.performanceMetrics = pn.container.resolve<PerformanceMetricsInterface>('performanceMetrics');\n", "import { APIInterface } from \"./api\";\nimport { PianoIdInterface } from \"./pianoId\";\n\nexport interface DoubleOptInInterface {\n  name: string;\n\n  check(): void;\n}\n\nconst doubleOptIn = ((): DoubleOptInInterface => {\n\n  const api = pn.container.resolve<APIInterface>('api');\n  const pianoId = pn.container.resolve<PianoIdInterface>('pianoId');\n\n  const name = 'doubleOptIn';\n\n  const EMAIL_CONFIRMATION_CHECK_URL = '/email/confirmation/check';\n\n  const checkEmailConfirmed = () => {\n    return new Promise(resolve => {\n      api.callApi(EMAIL_CONFIRMATION_CHECK_URL, {}, (response: any) => {\n        resolve(response);\n      });\n    })\n  }\n\n  const check = (): void => {\n    if (!pn.user.isUserValid()) {\n      return;\n    }\n\n    checkEmailConfirmed().then((response: any) => {\n      if (response && response.data === false) {\n        pianoId.showEmailConfirmationRequired();\n      }\n    });\n  }\n\n  return {\n    name,\n    check\n  };\n\n})();\n\npn.container.register('doubleOptIn', {\n  useValue: doubleOptIn\n});\npn.doubleOptIn = pn.container.resolve<DoubleOptInInterface>('doubleOptIn');\n", "import { PostmessageInterface } from \"./postmessage\";\nimport { APIInterface } from \"./api\";\nimport { UtilInterface } from \"./util\";\n\nexport interface NewscycleInterface {\n  name: string;\n  syncSubscriptions: Function;\n}\n\nconst newscycle = ((): NewscycleInterface => {\n\n  const api = pn.container.resolve<APIInterface>('api');\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const util = pn.container.resolve<UtilInterface>('util');\n\n  const name = 'newscycle';\n  const syncSubscriptions = util.debounce(_syncSubscriptions, 1500);\n  const SYNCHRONIZE_SUBSCRIPTIONS_URL = '/externalVerification/synchronizeSubscriptions';\n\n  const callSynchronization = () => {\n\n    return new Promise((resolve, reject) => {\n\n      var requestParams = {\n        'aid': pn.aid\n      };\n\n      api.callApi(\n        SYNCHRONIZE_SUBSCRIPTIONS_URL,\n        requestParams,\n        (response: any) => {\n          if (response && response.data) {\n            resolve(response.data);\n          }\n\n          reject(response.message);\n        }\n      );\n    })\n  }\n\n  const subscriptionsHasBeenSynchronize = (data: any) => {\n    postmessage.broadcast('NEWSCYCLE_HAS_BEEN_SYNCHRONIZED_SUCCESS', { data: data });\n  }\n\n  const subscriptionsHasNotBeenSynchronize = (errorMessage: string) => {\n    util.error('newscycle module: sync request failed with error: ' + errorMessage);\n  }\n\n  function _syncSubscriptions() {\n    callSynchronization().then(\n      subscriptionsHasBeenSynchronize,\n      subscriptionsHasNotBeenSynchronize\n    );\n  }\n\n  return {\n    name,\n    syncSubscriptions,\n  }\n})();\n\npn.container.register('newscycle', {\n  useValue: newscycle\n});\npn.newscycle = pn.container.resolve<NewscycleInterface>('newscycle');\n", "import { PostmessageInterface } from \"./postmessage\";\nimport {IPostMessageParams} from \"../models/post-message-params\";\n\nexport interface CaptchaV3Interface {\n  name: string;\n  addCaptchaV3(): void;\n}\n\ninterface ICaptchaV3Config {\n  enabled: boolean;\n  captcha3SiteKey: string;\n  aid: string;\n}\n\ndeclare const window: any;\n\nconst captchaV3 = ((): CaptchaV3Interface => {\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n\n  let config: ICaptchaV3Config = {\n    enabled: false,\n    captcha3SiteKey: '',\n    aid: '',\n  };\n\n  const name = 'captchaV3';\n\n  const onCaptchaConfigReceive = (captchaConfig: ICaptchaV3Config) => {\n    if (captchaConfig && captchaConfig.enabled) {\n      config = captchaConfig;\n      appendCaptchaScript();\n    }\n  }\n\n  function onloadCallback(): void {\n    window.grecaptcha.ready(render);\n  }\n\n  const render = (): void => {\n    const widget = document.createElement('div');\n    widget.id = 'tp-recaptcha';\n    document.body.appendChild(widget);\n\n    window.grecaptcha.render('tp-recaptcha', {\n      sitekey: config.captcha3SiteKey,\n      size: 'invisible',\n      'error-callback': () => {\n        widget.style.display = 'none';\n      }\n    });\n  }\n\n  const appendCaptchaScript = (): void => {\n    window.onCaptchaV3Load = onloadCallback;\n\n    const scriptUrl = 'https://www.google.com/recaptcha/api.js?onload=onCaptchaV3Load&render=explicit';\n    const script = document.createElement('script');\n\n    script.src = scriptUrl;\n    script.type = 'text/javascript'\n    script.async = true;\n    script.defer = true;\n\n    document.head.appendChild(script);\n  }\n\n  const initMessageListener = (): void => {\n    postmessage.subscribe('set-captcha-v3-config', (messageParams: IPostMessageParams<{config: ICaptchaV3Config}>) => {\n      onCaptchaConfigReceive(messageParams.params.config);\n    });\n\n    postmessage.subscribe('get-captcha-v3-config', () => {\n      postmessage.broadcast('get-captcha-v3-config-value', { config: config });\n    });\n  }\n\n    postmessage.subscribe('get-captcha-v3-token', (messageParams: IPostMessageParams<{action: string}>) => {\n      window.grecaptcha.ready(() => getToken(messageParams.params.action));\n    });\n\n  const getToken = (action: string): void => {\n    window.grecaptcha.execute({ action: action })\n      .then((token: string) => {\n        postmessage.broadcast('captcha-v3-token', { token: token });\n      })\n      .catch(() => {\n        postmessage.broadcast('captcha-v3-token', { token: '' });\n      });\n  }\n\n  function addCaptchaV3(): void {\n    initMessageListener();\n  }\n\n  return {\n    name,\n    addCaptchaV3,\n  }\n\n})();\n\npn.container.register('captchaV3', {\n  useValue: captchaV3\n});\npn.captchaV3 = pn.container.resolve<CaptchaV3Interface>('captchaV3');\n", "import { PostmessageInterface } from \"./postmessage\";\nimport { APIInterface } from \"./api\";\nimport { LOG_EVENT_TYPE } from \"./log\";\nimport { VersionServiceInterface } from \"./versionService\";\nimport { UtilInterface } from \"./util\";\nimport { AnalyticsInterface } from \"./analytics\";\n\nexport interface TinypassErrorHandlerInterface {\n  name: string;\n\n  initialize(): void;\n\n  addError(error: any, place?: string): void;\n}\n\ninterface ErrorWrapper {\n  details: ErrorDetails;\n  send?: boolean;\n}\n\ninterface ErrorDetails {\n  message?: string;\n  stack?: string;\n  place?: string;\n  userAgent?: string;\n  tags: string[];\n  aid?: string;\n  url?: string;\n  v?: string; // sdk version\n}\n\nexport const tinypassErrorHandler = (\n  container = pn.container\n): TinypassErrorHandlerInterface => {\n  const postmessage = container.resolve<PostmessageInterface>(\"postmessage\");\n  const api = container.resolve<APIInterface>(\"api\");\n  const util = container.resolve<UtilInterface>(\"util\");\n  const analytics = container.resolve<AnalyticsInterface>(\"analytics\");\n  const versionService = container.resolve<VersionServiceInterface>(\"versionService\");\n\n  const name = \"tinypassErrorHandler\";\n\n  const EVENT_TP_ERROR_HANDLER = \"EVENT_TP_ERROR_HANDLER\";\n  const ANON_LOG_ENDPOINT = \"/anon/error/log\";\n  const RANDOM_SENDER_CHANCE = 1000;\n  const SEND_ERRORS_INTERVAL = 15000;\n  const WDGT_ERROR_TAG = \"wgt_err\";\n  const SDK_TAG = \"sdk\";\n  const INIT_ERROR_TAG = \"initError\";\n  const errors: ErrorWrapper[] = [];\n  let isFirstSending = true;\n\n  const apiEndpoint = () => {\n    return api.getEndpoint() + ANON_LOG_ENDPOINT;\n  };\n\n  const initialize = (): void => {\n    try {\n      if (!pn.isSandbox()) {\n        startErrorsListeners();\n        startErrorsSendingWithInterval();\n      }\n    } catch (e) {\n      console.warn(\"Cannot start watching errors\", e);\n    }\n  };\n\n  /* used to log SDK errors */\n  const addError = (error: Error | unknown, place?: string): void => {\n    try {\n      const details: ErrorDetails = {\n        place,\n        tags: [SDK_TAG],\n      };\n\n      if (error instanceof Error) {\n        details.stack = error.stack;\n        details.message = error.message;\n      } else {\n        details.stack = JSON.stringify(error);\n      }\n\n      // mark as initialization error all errors that were added in the first sending interval\n      if (isFirstSending) {\n        details.tags = addTag(details.tags, INIT_ERROR_TAG);\n      }\n\n      addErrorDetails(details);\n    } catch (e) {}\n  };\n\n  const addErrorDetails = (errorDetails: ErrorDetails): void => {\n    if (!isGotChanceToAddError(errorDetails)) {\n      return;\n    }\n\n    // do not allow duplicates\n    if (isDuplicateError(errors, errorDetails)) {\n      return;\n    }\n\n    if (!errorDetails.tags) {\n      errorDetails.tags = [\"unknown\"];\n    }\n\n    errorDetails.aid = pn.aid;\n    errorDetails.v = versionService.getTinypassVersion();\n\n    const errorWrapper = { details: errorDetails };\n    errors.push(errorWrapper);\n  };\n\n  function startErrorsListeners(): void {\n    postmessage.subscribe(EVENT_TP_ERROR_HANDLER, handleErrorFromPostMessage);\n    window.addEventListener?.(\"error\", handleUnhandledError);\n  }\n\n  const handleErrorFromPostMessage = (data: {\n    params: ErrorDetails[];\n    sender: string;\n  }): void => {\n    const errors = data.params;\n\n    if (Array.isArray(errors)) {\n      // tagging errors from another apps\n      errors.forEach((e) => {\n        // add aid in case this is error from a widget\n        e.tags.push(pn.aid);\n\n        addErrorDetails(e);\n      });\n    }\n  };\n\n  function handleUnhandledError(event: ErrorEvent): false {\n    const message = event.message.toLowerCase();\n    const isScriptError = message.indexOf(\"script error\") > -1;\n    if (isScriptError) {\n      addErrorDetails({\n        message: \"Probably that is Piano error.\",\n        url: window.location.href,\n        tags: [SDK_TAG],\n      });\n    } else {\n      const error = event?.error;\n      if (isNotTinypassError(error?.stack)) return false;\n      addErrorDetails({\n        stack: error?.stack ?? \"n/a\",\n        message: error?.message ?? \"n/a\",\n        userAgent: navigator.userAgent,\n        tags: [SDK_TAG],\n      });\n    }\n    return false;\n  }\n\n  const startErrorsSendingWithInterval = (): void => {\n    setInterval(() => {\n      sendErrors();\n      isFirstSending = false;\n    }, SEND_ERRORS_INTERVAL);\n  };\n\n  const sendErrors = (): void => {\n    const unsentErrors = errors.filter((e) => !e.send);\n    if (unsentErrors.length === 0) {\n      return;\n    }\n\n    const errorsDetails = unsentErrors.map((e) => e.details);\n    const errorsInfo = {\n      type: \"console-error-message\",\n      srcType: \"ts\",\n      log_message: JSON.stringify(errorsDetails),\n    };\n\n    analytics.log.event({\n      eventType: LOG_EVENT_TYPE.LOG_BEACON_REQUEST,\n      payload: {\n        url: apiEndpoint(),\n        params: errorsInfo\n      }\n    })\n\n    unsentErrors.forEach((errorWrapper) => (errorWrapper.send = true));\n  };\n\n  const isDuplicateError = (\n    errors: ErrorWrapper[],\n    error: ErrorDetails\n  ): boolean => {\n    const existErrorsAsStrings = errors.map((e) => JSON.stringify(e.details));\n    const errorAsString = JSON.stringify(error);\n    return existErrorsAsStrings.indexOf(errorAsString) !== -1;\n  };\n\n  const isNotTinypassError = (stack: string | undefined): boolean => {\n    return stack?.indexOf(\"tinypass\") === -1;\n  };\n\n  const isGotChanceToAddError = (errorDetails: ErrorDetails): boolean => {\n    const isTestingMode = !!util.__protected__.getLocalStorageItem(\n      \"tinypassErrorHandlerTestMode\"\n    );\n    return (\n      errorDetails.tags.indexOf(WDGT_ERROR_TAG) >= 0 ||\n      isTestingMode ||\n      getRandomInteger(0, RANDOM_SENDER_CHANCE) === 0\n    );\n  };\n\n  const getRandomInteger = (min: number, max: number): number => {\n    const rand = min - 0.5 + Math.random() * (max - min + 1);\n    return Math.round(rand);\n  };\n\n  const addTag = (tags: string[] = [], tag: string): string[] => {\n    return tag ? tags.concat(tag) : tags;\n  };\n\n  return {\n    name,\n    addError,\n    initialize,\n  };\n};\n\npn.container.register(\"tinypassErrorHandler\", {\n  useValue: tinypassErrorHandler(),\n});\npn.tinypassErrorHandler = pn.container.resolve(\n  \"tinypassErrorHandler\"\n) as TinypassErrorHandlerInterface;\n", "import { UtilInterface } from \"./util\";\nimport { OfferInterface } from \"./offer\";\nimport { UserInterface } from \"./user\";\nimport { PianoIdInterface } from \"./pianoId\";\nimport { APIInterface } from \"./api\";\nimport { FingerprintInterface } from \"./fingerprint\";\nimport { SHA1Interface } from \"./sha1\";\nimport { ActiveTimerInterface } from \"./activetimer\";\nimport { ScrollDepthInterface } from \"./scrollDepth\";\nimport { DoubleClickForPublisherInterface } from \"./doubleClickForPublisher\";\nimport { ViewportExitInterface } from \"./viewportExit\";\nimport { IdleInterface } from \"./idle\";\nimport { EventType, LOG_EVENT_TYPE } from \"./log\";\nimport { PianoEspInterface } from \"./pianoEsp\";\nimport { ApplePayIntegrationServiceInterface } from \"./applePayIntegrationService\";\nimport { DatatransApplePayIntegrationServiceInterface } from \"./datatransApplePayIntegrationService\";\nimport { CxenseInterface } from \"./cxense\";\nimport { ExperienceInterface } from \"./experience\";\nimport { JqUtilsInterface } from \"./jqUtils\";\nimport { CookieInterface } from \"./cookie\";\nimport { LoggingInterface } from \"./logging\";\nimport { TinypassErrorHandlerInterface } from \"./tinypassErrorHandler\";\nimport { CaptchaV3Interface } from \"./captchaV3\";\nimport { PostmessageInterface } from \"./postmessage\";\nimport { dataLayer } from '@piano-sdk/data-layer';\nimport { ComposeControlPolicy } from \"./composerControlPolicy\";\nimport { LocalStorageOptions } from \"@piano-sdk/storage\";\nimport { AnalyticsInterface } from \"./analytics\";\nimport { DeprecatedMethods, deprecatedMethods } from \"./deprecated\";\nimport { ConsentInterface } from \"./consent\";\nimport {BraintreeGooglePayInterface} from \"./braintreeGooglePayIntegrationService\";\n\nexport interface MainInterface extends DeprecatedMethods<{\n  unregisterTrackUnload(): void;\n  registerTrackUnload(): void;\n  trackPageUnloadIfNecessary(): void,\n  trackPageUnload(sync?: boolean): void;\n  isRegisteredTrackUnload(): boolean;\n}> {\n  name: string;\n\n  appHasApplePay(): boolean | undefined;\n\n  fetchVisitId(): string;\n\n  externalResourcesDelay(): any;\n\n  // const methods\n  pageTrack(url: string, tags: string[]): void;\n\n  trackPage(url?: any, tags?: string[]): void;\n\n  buildPageTrackParams(params: any, url?: any, tags?: string[] | string): any;\n\n  fetchPageViewId(): string | undefined;\n\n  resetTimer(): void;\n\n  resetAds(): void;\n\n  trackAd(type: string, id: string, ad: any): void;\n\n  init(): void;\n\n  checkToRunWidgetImmediately(): void;\n\n  trackAds(ads: any, sync?: boolean, requestType?: string): void;\n\n  __private__: DeprecatedMethods<{\n    buildPageUnloadParams(): any;\n    unloadHandler(): void;\n    unloadAction(): void;\n  }> & {\n    VISIT_ID_COOKIE: string;\n    VOUCHER_QUERY: string;\n    PASSWORDLESS_TOKEN_QUERY: string;\n    collectedAds: any;\n    unloadRegistered: boolean;\n    unloadTriggered: boolean;\n    getPageView(): any;\n    getVisitContainer(): any;\n    checkVoucher(): void;\n    setPageViewId(params: any): void;\n    currentEnvironmentSupportsPageTrack(): boolean;\n    invalidateLastVisit(): void;\n    getCurrentDomain(): string;\n    loadLastVisit(): any;\n    setVisitCurrentDomain(value: string): void;\n    saveVisitCookie(visit: any, options: any): void;\n    getVisitCookieOptions(domain?: string): any;\n    isTimeExpired(visit: any): boolean;\n    refreshVisit(): void;\n    generatePageViewId(): string;\n    track(path: string, params: any, callback?: Function, sync?: boolean): void;\n    trackCollectedAds(sync: boolean, requestType?: string): void;\n    buildPageCustomParams(params: any): any;\n    hasExternalReferrer(): boolean;\n  }\n}\n\ninterface ITermsPaymentMethodsIDsPostMessageResponse {\n  [key: string]: any;\n  params?: number[];\n}\n\nexport const main = ((container = pn.container): MainInterface => {\n\n  const api = container.resolve<APIInterface>('api');\n  const cookie = container.resolve<CookieInterface>('cookie');\n  const jqUtils = container.resolve<JqUtilsInterface>('jqUtils');\n  const util = container.resolve<UtilInterface>('util');\n  const logging = container.resolve<LoggingInterface>('logging');\n  const fingerprint = container.resolve<FingerprintInterface>('fingerprint');\n  const user = container.resolve<UserInterface>('user');\n  const sha1 = container.resolve<SHA1Interface>('sha1');\n  const activetimer = container.resolve<ActiveTimerInterface>('activetimer');\n  const scrollDepth = container.resolve<ScrollDepthInterface>('scrollDepth');\n  const doubleClickForPublisher = container.resolve<DoubleClickForPublisherInterface>('doubleClickForPublisher');\n  const offer = container.resolve<OfferInterface>('offer');\n  const viewportExit = container.resolve<ViewportExitInterface>('viewportExit');\n  const idle = container.resolve<IdleInterface>('idle');\n  const experience = container.resolve<ExperienceInterface>('experience');\n  const pianoId = container.resolve<PianoIdInterface>('pianoId');\n  const pianoEsp = container.resolve<PianoEspInterface>('pianoEsp');\n  const applePayIntegrationService = container.resolve<ApplePayIntegrationServiceInterface>('applePayIntegrationService');\n  const datatransApplePayIntegrationService = container.resolve<DatatransApplePayIntegrationServiceInterface>('datatransApplePayIntegrationService');\n  const braintreeGooglePayIntegrationService = container.resolve<BraintreeGooglePayInterface>('braintreeGooglePayIntegrationService');\n  const cxense = container.resolve<CxenseInterface>('cxense');\n  const tinypassErrorHandler = container.resolve<TinypassErrorHandlerInterface>('tinypassErrorHandler');\n  const captchaV3 = container.resolve<CaptchaV3Interface>('captchaV3');\n  const postmessage = pn.container.resolve<PostmessageInterface>('postmessage');\n  const composerControlPolicy = container.resolve<ComposeControlPolicy>('composerControlPolicy');\n  const analytics = container.resolve<AnalyticsInterface>('analytics');\n  const consent = container.resolve<ConsentInterface>('consent');\n\n  const name = 'main';\n\n  const EXTERNAL_RESOURCES = 'exrs';\n  const EXTERNAL_RESOURCES_TTL: LocalStorageOptions['expires'] = { minutes: 120 }; // 2 hours\n  let externalResourcesDef: any = null;\n\n  // local usage in the module\n  const BEACON_REQUEST = 'beacon_request';\n  // const initPianoEsp = pianoEsp.init;\n\n  const VOUCHER_QUERY = 'voucher_code';\n  const PASSWORDLESS_TOKEN_QUERY = \"passwordless_token\";\n  const VISIT_ID_COOKIE = '__pvi';\n  let unloadRegistered = false;\n  let unloadTriggered = false;\n  let collectedAds: any = {};\n  let lastReferrer: any = null;\n\n  const APPLE_PAY_PROVIDERS_IDS = {\n    APPLE_PAY_BT: 25,\n    APPLE_PAY_SS: 38,\n    APPLE_PAY_STRIPE: 41,\n    APPLE_PAY_PW: 42,\n    DATATRANS_APPLE_PAY: 61,\n  };\n\n  const APPLE_PAY_PROVIDERS_IDS_SET = new Set(Object.values(APPLE_PAY_PROVIDERS_IDS));\n\n  let _appHasApplePay: boolean | undefined = undefined;\n  let termsPaymentMethodsIDs: number[] = [];\n  let wasApplePayInitialized: boolean = false;\n\n  const IS_WK_WEB_VIEW = isWKWebView();\n\n\n  function isWKWebView(): boolean {\n    if (navigator.platform.substr(0,2) === 'iP'){\n      //iOS (iPhone, iPod or iPad)\n      // @ts-ignore\n      var lte9 = /constructor/i.test(window.HTMLElement);\n      var nav = window.navigator, ua = nav.userAgent, idb = !!window.indexedDB;\n      // @ts-ignore\n      if (ua.indexOf('Safari') !== -1 && ua.indexOf('Version') !== -1 && !nav.standalone){\n        //Safari (WKWebView/Nitro since 6+)\n      } else if ((!idb && lte9) || !window.statusbar.visible) {\n        //UIWebView\n        // @ts-ignore\n      } else if ((window.webkit && window.webkit.messageHandlers) || !lte9 || idb){\n        //WKWebView\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  const loadLastVisit = () => {\n    return util.parseJSON(util.__protected__.getCookie(VISIT_ID_COOKIE), true) || {};\n  }\n\n  // const methods\n  const trackPage = (url?: any, tags?: string[]) => {\n    return pageTrack(url, tags);\n  }\n\n  const getCurrentDomain = (): string => {\n    return util.getCurrentDomainFromCookie(VISIT_ID_COOKIE, true);\n  }\n\n  const trackCollectedAds = (sync: boolean, requestType?: string) => {\n    var tempAds = collectedAds;\n    collectedAds = {};\n\n    var ads: any = {};\n    for (var type in tempAds) {\n      if (tempAds.hasOwnProperty(type)) {\n        ads[type] = ads[type] || [];\n        for (var id in tempAds[type]) {\n          if (tempAds[type].hasOwnProperty(id)) {\n            ads[type].push(tempAds[type][id]);\n          }\n        }\n      }\n    }\n    trackAds(ads, sync, requestType);\n  }\n\n  let debouncedTrackAds: any;\n  let visitContainer: any;\n  let pageView: any;\n\n  const getVisitContainer = (): any => {\n    return visitContainer;\n  }\n\n  const getPageView = (): any => {\n    return pageView;\n  }\n\n  const getOrGeneratePageViewId = (): any => {\n    if (experience.execute.invokeCount > 0) {\n      dataLayer.refresh(); // generate all random params that do not depends on cookie\n    }\n    cxense.__protected__.clearWidgets(); // reset widgets\n    return dataLayer.get('pageViewId') as string;\n  }\n\n  function generatePageViewId(): any {\n    function pad(n: number, width: number, z?: string): string {\n      z = z || '0';\n      const nn = String(n);\n      return nn.length >= width ? nn : new Array(width - nn.length + 1).join(z) + nn;\n    }\n\n    if (isCxenseActivated()) {\n      return generateCxCompatibleRandomId();\n    } else {\n      var random = util.randomString(16);\n      var hash = sha1.hash([fingerprint.getFingerprint(), window.location.href].join(''));\n      var now = new Date();\n      var time = [pad(now.getFullYear(), 4), pad(now.getMonth() + 1, 2), pad(now.getDate(), 2), pad(now.getHours(), 2), pad(now.getMinutes(), 2), pad(now.getSeconds(), 2), pad(now.getMilliseconds(), 3)].join('-');\n      var id = [time, random, hash].join('-');\n      return id;\n    }\n  }\n\n  const getVisitCookieOptions = (domain?: string) => {\n    var options = {\n      path: '/',\n      expires: 1,\n      domain: visitContainer.currentDomain\n    };\n    if (domain) {\n      options.domain = domain;\n    }\n    return options;\n  }\n\n  const saveVisitCookie = (visit: any, options: any) => {\n    visit.domain = options.domain;\n    visit.time = (new Date()).getTime();\n    util.__protected__.setCookieConsent(\"vx\", VISIT_ID_COOKIE, util.toJSON(visit, true), options);\n  }\n\n  const saveLastVisit = (visit: any) => {\n    var options = getVisitCookieOptions();\n\n    if (!visit.domain && !visitContainer.currentDomain) {\n      util.waitCall('domainIsReceived', (domainName: string) => {\n        // setVisitCurrentDomain(domainName);\n        setVisitCurrentDomain(domainName);\n        options.domain = domainName;\n        // saveVisitCookie(visit, options);\n        saveVisitCookie(visit, options);\n      });\n    } else {\n      // saveVisitCookie(visit, options);\n      saveVisitCookie(visit, options);\n    }\n  }\n\n  const isTimeExpired = (visit: any) => {\n    var time = (new Date()).getTime();\n    var msInDay = 86400000; // 24 * 60 * 60 * 1000;\n    var msInMin = 60000; // 60 * 1000;\n    var visitExpireTime = 1800000; // 30 * msInMin;\n\n    var browserTimezoneOffset = util.getBrowserTimezoneOffset() * msInMin;\n    var appTimezoneOffset = util.getAppTimezoneOffset();\n    var midnight = new Date(visit.time).setHours(0, 0, 0, 0) + msInDay - browserTimezoneOffset - appTimezoneOffset;\n\n    return visit.time + visitExpireTime < time || time >= midnight;\n  }\n\n  const hasExternalReferrer = () => {\n    if (util.__protected__.cameFromFbSubscriptions()) {\n      // workaround for Facebook Subscriptions flow\n      // when user is redirected from Facebook application in iOS, link is opening through \"link shim\" (lm.facebook.com)\n      // this is considered as external referrer, but we don't want it in our case\n      return false;\n    }\n\n    if (!visitContainer.currentDomain) {\n      return false;\n    }\n    var referrer = util.getReferrer();\n    if (lastReferrer && lastReferrer === referrer) {\n      return false;\n    }\n\n    var referrerDomain = util.getHostname(referrer);\n    var thisIsSameDomains = (new RegExp(visitContainer.currentDomain.replace(/\\./g, '\\\\.').replace(/^\\\\./, '\\\\.?') + '$')).test(referrerDomain);\n\n    return Boolean(referrerDomain) && !thisIsSameDomains;\n  }\n\n  const refreshVisit = () => {\n    var visit = loadLastVisit();\n    var thisIsFirstVisit = !visit || !visit.id || !visit.time;\n\n    if (thisIsFirstVisit || isTimeExpired(visit) || hasExternalReferrer()) {\n      visit.id = 'v-' + generatePageViewId();\n    }\n\n    saveLastVisit(visit);\n    visitContainer.visit = visit;\n  }\n\n  const buildPageTrackParams = (params: any, url?: any, tags?: string[] | string): any => {\n    var pageTrackSubmitType = 'manual';\n    let skipPageViewTrack = false;\n\n    if (typeof (url) === 'undefined') {\n      url = window.location.href;\n    } else if (typeof (url) === 'object') {\n      var pageTrackConfig: any = url;\n      if (typeof (pageTrackConfig.url) === 'undefined') {\n        throw new Error('Must supply url property');\n      }\n      url = pageTrackConfig.url;\n      if (typeof (pageTrackConfig.tags) !== 'undefined') {\n        tags = pageTrackConfig.tags;\n      }\n      if (typeof (pageTrackConfig.submitType) !== 'undefined') {\n        pageTrackSubmitType = pageTrackConfig.submitType;\n      }\n      skipPageViewTrack = pageTrackConfig.skipPageViewTrack;\n    } else {\n      throw new Error('First parameter to track page must be a URL or an object');\n    }\n\n    if (!tags) {\n      tags = pn.tags;\n    }\n\n    if (pn.customPageUrl) {\n      params['custom_page_url'] = util.prepareUrlParameter(pn.customPageUrl);\n    }\n\n    if (typeof (tags) !== 'undefined') {\n      if (Object.prototype.toString.call(tags) !== '[object Array]' && Object.prototype.toString.call(tags) !== '[object String]') {\n        util.log('Tags must be an array or a comma-separated string, ignoring supplied tags');\n        tags = '';\n        // } else if (Object.prototype.toString.call(tags) === '[object Array]') {\n      } else if (tags instanceof Array) {\n        tags = tags.join(',');\n      }\n    } else {\n      tags = '';\n    }\n\n    if (!skipPageViewTrack) {\n      pageView.track();\n    }\n\n    params['page_session_id'] = pageView.pageSessionId;\n    params['track_count'] = pageView.trackCount;\n\n    setPageViewId(params);\n\n    var contentCreatedTime;\n    if (pn.contentCreated) {\n      contentCreatedTime = pn.contentCreated;\n    } else if (pn.contentCreatedSelector && jqUtils.queryEl(pn.contentCreatedSelector)) {\n      contentCreatedTime = jqUtils.queryEl(pn.contentCreatedSelector)?.innerHTML;\n    }\n    if (contentCreatedTime) {\n      if (!pn.contentCreated) {\n        pn.contentCreated = contentCreatedTime; // update content created in DL\n      }\n      params['content_created'] = contentCreatedTime;\n    }\n    if (typeof pn.contentIsNative === 'boolean') {\n      params['content_is_native'] = pn.contentIsNative;\n    }\n    if (pn.zone) {\n      params['zone'] = pn.zone;\n    }\n    if (pn.itemId) {\n      params['item_id'] = pn.itemId;\n    }\n    var contentSection = pn.contentSection || getMetaTagContent('section');\n    if (contentSection) {\n      params['content_section'] = contentSection;\n    }\n\n    var contentAuthor = pn.contentAuthor || getMetaTagContent('author');\n    if (contentAuthor) {\n      params['content_author'] = contentAuthor;\n    }\n\n    var contentId = pn.contentId || getMetaTagContent('id');\n    if (contentId) {\n      params['content_id'] = contentId;\n    }\n\n    var sailthruHid = util.__protected__.getCookie('sailthru_hid');\n    if (sailthruHid) {\n      params['sailthru_hid'] = sailthruHid;\n    }\n\n    var referrer;\n    if (lastReferrer && lastReferrer === util.getReferrer()) {\n      // last referrer is set and the same as document.referrer => pass empty referrer\n      referrer = '';\n    } else {\n      referrer = util.getReferrer();\n      lastReferrer = referrer;\n    }\n    params['referer'] = util.prepareUrlParameter(referrer);\n\n    if (tags) {\n      params['tags'] = tags;\n    }\n    params['url'] = util.prepareUrlParameter(url);\n    params['fingerprint'] = fingerprint.getFingerprint();\n    params['adblocker'] = util.getAdblockStatus();\n\n    if (params['adblocker'] === util.ADBLOCKER_STATUS.ENABLED_AFTER_DISABLED ||\n      params['adblocker'] === util.ADBLOCKER_STATUS.ENABLED) {\n      // adblocker reason\n      pn.setCustomParam('_abr', util.getAdblockerStatusReason(), 'user', true);\n      // adblocker status history\n      pn.setCustomParam('_absh', util.getAdblockerHistoryCookieInfo().cookieValue + '', 'user', true);\n    }\n\n    params['timezone_offset'] = util.getBrowserTimezoneOffset();\n    params['submit_type'] = pageTrackSubmitType;\n\n    var visitId = fetchVisitId();\n    params['visit_id'] = visitId;\n    params['new_visit'] = checkIfNewVisitAndUpdateLastTrackedVisitId(visitId);\n\n    const getContent = () => dataLayer.get('content') || {};\n\n    params['keywords'] = getContent().keywords?.join(',') || '';\n    params['title'] = getContent().title || '';\n    params['description'] = getContent().description || '';\n    params['content_type'] = getContent().type || '';\n\n    ['keywords', 'title', 'description', 'content_type'].forEach((val) => {\n      params[val] = params[val].substr(0, 8192);\n    })\n\n    params['custom_variables'] = JSON.stringify(pn.customVariables);\n    buildPageCustomParams(params);\n\n    consent.__protected__.addConsentsToParams(params);\n\n    return params;\n  }\n\n  const buildPageUnloadParams = () => {\n    markVisitToCheckForRefresh();\n    return {};\n  }\n\n  const buildPageCustomParams = (params: any): any => {\n    var customParams = {};\n    if (pn.customParams) {\n      customParams = jqUtils.deepExtend({}, pn.customParams);\n    }\n\n    if (!jqUtils.isEmptyObject(customParams)) {\n      params['custom_params'] = JSON.stringify(customParams);\n    }\n    return params;\n  }\n\n  const fetchPageViewId = (): string | undefined => {\n    return pageView.id;\n  }\n\n  const checkIfNewVisitAndUpdateLastTrackedVisitId = (visitId: string) => {\n    var isNewVisit = visitContainer.lastTrackedVisitId !== visitId;\n    visitContainer.lastTrackedVisitId = visitId;\n\n    return isNewVisit;\n  }\n\n  const markVisitToCheckForRefresh = () => {\n    visitContainer.checkForRefresh = true;\n  }\n\n  const fetchVisitId = (): string => {\n    if (visitContainer.checkForRefresh) {\n      refreshVisit();\n      visitContainer.checkForRefresh = false;\n    }\n\n    return visitContainer.visit.id;\n  }\n\n  const getMetaTagContent = (name: string) => {\n    var metaTag = document.head.querySelector('meta[name=' + name + ']');\n    // @ts-ignore\n    return (metaTag || {}).content;\n  }\n\n  const setVisitCurrentDomain = (value: string) => {\n    visitContainer.currentDomain = value;\n  }\n\n  const invalidateLastVisit = () => {\n    var options = getVisitCookieOptions();\n    cookie.remove(VISIT_ID_COOKIE, options);\n  }\n\n  const currentEnvironmentSupportsPageTrack = () => {\n    return !(pn.endpoint && pn.endpoint.match(/sandbox/));\n  }\n\n  const track = (path: string, params: any, callback?: Function, sync?: boolean): void => {\n    if (!pn.aid || pn.aid.length === 0) {\n      util.log('Must supply a valid tp.aid before calling tp.init()');\n      return;\n    }\n\n    if (!currentEnvironmentSupportsPageTrack()) {\n      return;\n    }\n\n    logging.setTime('track', Math.floor(performance.now() - window.pnInitPerformance));\n\n    util.waitCall('refreshAccessTokenList', () => {\n      util.waitCall('offerCreate', () => {\n        util.startCall('pageTrack');\n\n        const cbk = function (response: any) {\n          util.doneCall('pageTrack');\n          if (callback) {\n            callback(response);\n          }\n        };\n\n        api.callApi(path, params, cbk, pn.getExperienceEndpoint(false)  + '/api/v3', sync);\n      })\n    });\n  }\n\n  const trackPageUnloadIfNecessary = (): void => {\n    if (unloadRegistered && pageView.trackCount > 0) {\n      trackPageUnload();\n      resetTimer();\n    }\n  }\n\n  const trackPageUnload = (sync?: boolean): void => {\n    if (!currentEnvironmentSupportsPageTrack() || composerControlPolicy.denyAll) {\n      return;\n    }\n\n    try {\n      buildPageUnloadParams();\n\n      if (viewportExit.isInitialized()) {\n        viewportExit.resetSumOfCodesDirectionToDefault();\n      }\n\n      unregisterTrackUnload();\n    } catch (e) {\n      util.error('main: error on tracking page unload event: ', e);\n    }\n  }\n\n  const unloadAction = () => {\n    if (!unloadTriggered) {\n      unloadTriggered = true;\n      trackPageUnload(true);\n    }\n  }\n\n  const registerTrackUnload = () => {\n    unloadRegistered = true;\n  }\n\n  const isRegisteredTrackUnload = (): boolean => {\n    return unloadRegistered;\n  }\n\n  const unregisterTrackUnload = () => {\n    unloadRegistered = false;\n  }\n\n  const unloadHandler = () => {\n    if (unloadRegistered) {\n      unloadAction();\n    }\n    trackCollectedAds(true, BEACON_REQUEST);\n\n    experience.__protected__.sendStatisticsExecutedNodes('unload');\n  }\n\n  const resetTimer = () => {\n    activetimer.resetRecordedTime();\n  }\n\n  const resetAds = () => {\n    doubleClickForPublisher.resetAds();\n  }\n\n  const setPageViewId = (params: any) => {\n    if (params) {\n      params['pageview_id'] = fetchPageViewId();\n    }\n  }\n\n  const pageTrack = (url?: string, tags?: string[]): void => {\n    if (!currentEnvironmentSupportsPageTrack() || composerControlPolicy.denyAll) {\n      return;\n    }\n\n    try {\n      trackPageUnloadIfNecessary();\n\n      var params = buildPageTrackParams({}, url, tags);\n      track('/page/track', params);\n\n      registerTrackUnload();\n    } catch (e) {\n      util.error('main: error on page tracking event: ', e);\n    }\n  }\n\n  const trackAds = (ads: any, sync?: boolean, requestType?: string): void => {\n    // TPWEBAPP-19885: we don't need to track ad events separately from page unloads until they are really use for any report\n    return;\n\n    if (jqUtils.isEmptyObject(ads)) {\n      return;\n    }\n    var params: any = {\n      ads: JSON.stringify(ads),\n      url: util.prepareUrlParameter(window.location.href),\n      aid: pn.aid,\n    };\n    var tbc = util.getTbcCookie();\n    if (tbc) {\n      params.tbc = tbc;\n    }\n\n    setPageViewId(params);\n    if (requestType === BEACON_REQUEST) {\n      return analytics.log.event({\n        eventType: LOG_EVENT_TYPE.LOG_BEACON_REQUEST,\n        payload: {\n          url: pn.getTrackingEndpoint() + '/api/v3/page/ads/track',\n          params\n        }\n      });\n    }\n    return track('/page/ads/track', params, undefined, sync);\n  }\n\n  const trackAd = (type: string, id: string, ad: any): void => {\n    if (!collectedAds[type]) {\n      collectedAds[type] = {};\n    }\n    collectedAds[type][id] = ad;\n    debouncedTrackAds();\n  }\n\n  const checkVoucher = () => {\n    const voucher = util.getQueryParamByName(VOUCHER_QUERY);\n    const passwordlessToken = util.getQueryParamByName(PASSWORDLESS_TOKEN_QUERY);\n\n    if (voucher && !passwordlessToken) {\n      offer.startRedeemVoucher({\n        voucherCode: voucher,\n      });\n    }\n  }\n\n  const checkVerificationCode = () => {\n    if (user.getProvider().name !== 'pianoId') {\n      return;\n    }\n\n    util.waitCall('offerCreate', () => {\n      pianoId.__protected__.checkVerificationCode();\n    });\n  }\n\n  const externalResourcesDelay = (): any => {\n    if (externalResourcesDef) {\n      return externalResourcesDef;\n    } else {\n      externalResourcesDef = new Promise((resolve => {\n        if (util.__protected__.getLocalStorageItem(EXTERNAL_RESOURCES) !== null) {\n          resolve({\n            has_active_apple_pay_card: util.__protected__.getLocalStorageItem(EXTERNAL_RESOURCES)\n          });\n        }\n\n        if (!pn.applePayMerchantId) {\n          resolve({ has_active_apple_pay_card: null });\n          return externalResourcesDef;\n        }\n\n        isApplePayExistOnExternalResourcesSetting().then((hasApplePay) => {\n          const completeExternalResourcesSetting = (hasActiveApplePayCard: boolean | null) => {\n            resolve({ has_active_apple_pay_card: hasActiveApplePayCard });\n            util.__protected__.setLocalStorageItem(\n              \"vx\",\n              EXTERNAL_RESOURCES,\n              hasActiveApplePayCard,\n              EXTERNAL_RESOURCES_TTL\n            );\n          }\n\n          if (hasApplePay) {\n            applePayIntegrationService.__protected__.applePayCanMakePaymentsWithActiveCard()\n              .then(completeExternalResourcesSetting);\n          } else {\n            completeExternalResourcesSetting(null);\n          }\n        });\n\n\n        // applePayIntegrationService.__protected__.applePayCanMakePaymentsWithActiveCard()\n        //   .then((hasActiveApplePayCard: any) => {\n        //     resolve({ has_active_apple_pay_card: hasActiveApplePayCard });\n        //     util.__protected__.setLocalStorageItem(\n        //       EXTERNAL_RESOURCES,\n        //       hasActiveApplePayCard,\n        //       EXTERNAL_RESOURCES_TTL\n        //     );\n        //   });\n      }));\n    }\n\n    return externalResourcesDef;\n  }\n\n  function isCxenseActivated(): boolean {\n    return cxense.__protected__.isActivated();\n  }\n\n  const generateCxCompatibleRandomId = () => {\n    return util.__protected__.randomStringCxCompatible();\n  }\n\n  function hasApplePay(termsPaymentMethodsIDs?: number[]): boolean {\n    if (!Array.isArray(termsPaymentMethodsIDs) || !termsPaymentMethodsIDs.length) {\n      return false;\n    }\n\n    for (let paymentMethodID of termsPaymentMethodsIDs) {\n      if (APPLE_PAY_PROVIDERS_IDS_SET.has(paymentMethodID)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  function getOnPaymentMethodsIDsReceiveHandler(onReceive: Function) {\n    return function ({ params: paymentMethods }: ITermsPaymentMethodsIDsPostMessageResponse) {\n      if (_appHasApplePay === undefined) {\n        _appHasApplePay = hasApplePay(paymentMethods);\n      }\n\n      termsPaymentMethodsIDs = paymentMethods || [];\n\n      onReceive(_appHasApplePay);\n    }\n  }\n\n  function isApplePayExistOnInit(): Promise<boolean> {\n    return isApplePayExist((resolve: Function) => {\n      postmessage.subscribe('ACTIVE_PAYMENT_METHODS_IDS_INITIALIZED', getOnPaymentMethodsIDsReceiveHandler(resolve));\n      postmessage.subscribe('MY_ACCOUNT_ACTIVE_PAYMENT_METHODS_IDS_INITIALIZED', getOnPaymentMethodsIDsReceiveHandler(resolve));\n    });\n  }\n\n  function isApplePayExistOnExternalResourcesSetting(): Promise<boolean> {\n    return isApplePayExist((resolve: Function) => {\n      experience.registerCallback('experienceFlow', () => {\n        _appHasApplePay = true;\n        resolve(true);\n      });\n    });\n  }\n\n  function isApplePayExist(callback: Function): Promise<boolean> {\n    if (_appHasApplePay !== undefined) {\n      return Promise.resolve(_appHasApplePay);\n    }\n\n    if (IS_WK_WEB_VIEW) {\n      _appHasApplePay = false;\n      return Promise.resolve(false);\n    }\n\n    return new Promise((resolve) => {\n      callback(resolve);\n    })\n  }\n\n  function appHasApplePay(): boolean | undefined {\n    return _appHasApplePay;\n  }\n\n  const initializeBraintreeGooglePay = (): void => {\n    if (jqUtils.isFunction(braintreeGooglePayIntegrationService.initialize)) {\n      braintreeGooglePayIntegrationService.initialize();\n    }\n  }\n\n  const initializeApplePay = (): void => {\n    isApplePayExistOnInit().then((hasApplePay) => {\n      if (!hasApplePay) {\n        return;\n      }\n\n      if (!wasApplePayInitialized && jqUtils.isFunction(applePayIntegrationService.initialize)) {\n        wasApplePayInitialized = true;\n        applePayIntegrationService.initialize();\n      }\n\n      initPaymentProvidersAfterMethodsIDChanged(termsPaymentMethodsIDs);\n    });\n  }\n\n  const initPaymentProvidersAfterMethodsIDChanged = (paymentMethodsIDs: number[]) => {\n    const isDataTransApplePayExist = paymentMethodsIDs.indexOf(APPLE_PAY_PROVIDERS_IDS.DATATRANS_APPLE_PAY) !== -1;\n\n    if (jqUtils.isFunction(datatransApplePayIntegrationService.initialize) && isDataTransApplePayExist) {\n      datatransApplePayIntegrationService.initialize();\n    }\n  }\n\n  function init(): void {\n    if (!dataLayer.isReady) {\n      util.log('DataLayer should be initialized while calling tp.init()');\n      util.log('DataLayer was initialized by default configs');\n      dataLayer.init();\n    }\n    if (!pn.aid || pn.aid.length === 0) {\n      util.log('Must supply a valid tp.aid before calling tp.init()');\n      return;\n    }\n\n    debouncedTrackAds = util.debounce(trackCollectedAds, 3000);\n\n    visitContainer = {\n      currentDomain: getCurrentDomain(),\n      lastTrackedVisitId: loadLastVisit().id,\n      visit: <any>{},\n      checkForRefresh: false,\n    }\n\n    pageView = {\n      id: getOrGeneratePageViewId(),\n      pageSessionId: 's-' + generatePageViewId(),\n      trackCount: 0,\n      tracked: false,\n      track: () => {\n        if (pageView.tracked) {\n          pageView.id = getOrGeneratePageViewId();\n        } else {\n          pageView.tracked = true;\n        }\n        pageView.trackCount++;\n      }\n    };\n\n    if (isCxenseActivated()) {\n      pn.cxenseSiteId && dataLayer.set('siteId', pn.cxenseSiteId);\n    }\n\n    refreshVisit();\n\n    if (!pn.isMockMode) {\n      if (jqUtils.isFunction(doubleClickForPublisher.initialize)) {\n        doubleClickForPublisher.initialize();\n      }\n      if (jqUtils.isFunction(activetimer.initialize)) {\n        activetimer.initialize();\n      }\n      if (jqUtils.isFunction(scrollDepth.initialize)) {\n        scrollDepth.initialize();\n      }\n    }\n\n    if (jqUtils.isFunction(idle.initialize)) {\n      idle.initialize();\n    }\n\n    initializeApplePay();\n    initializeBraintreeGooglePay();\n\n    if (jqUtils.isFunction(pianoEsp.__protected__.init)) {\n      pianoEsp.__protected__.init().catch(() => {\n      });\n    }\n\n    if (jqUtils.isFunction(user.refreshAccessToken)) {\n      user.refreshAccessToken();\n    }\n\n    externalResourcesDelay();\n\n    const provider = user.getProvider() as PianoIdInterface;\n    if (provider.getName() === pianoId.getName()) {\n      provider.__protected__.extendUserToken()\n    }\n\n    captchaV3.addCaptchaV3();\n\n    const param = 'cxTrackingId';\n    const cxTrackingId = util.getQueryParamByName(param);\n\n    if (cxTrackingId) {\n      util.removeQueryParamByName(param);\n\n      analytics.log.event({\n        eventType: LOG_EVENT_TYPE.LOG_AUTO_MICRO_CONVERSION,\n        payload: {\n          trackingId: cxTrackingId,\n          eventGroupId: 'click',\n          eventType: EventType.EXTERNAL_LINK,\n          customParams: {\n            href: location.href,\n            source: 'CX',\n          }\n        }\n      });\n    }\n  }\n\n  // special method to check voucher code in url to run widget or continue 3ds etc.\n  const checkToRunWidgetImmediately = (): void => {\n    checkVoucher();\n    checkVerificationCode();\n    pianoId.checkAndShowEmailIsNotConfirmed();\n    if (jqUtils.isFunction(offer.checkThreeDSRedirect)) {\n      offer.checkThreeDSRedirect();\n    }\n  }\n\n  return {\n    name,\n    fetchVisitId,\n\n    ...(deprecatedMethods({\n      trackPageUnloadIfNecessary,\n      trackPageUnload,\n      unregisterTrackUnload,\n      isRegisteredTrackUnload,\n      registerTrackUnload,\n    })),\n\n    externalResourcesDelay,\n\n    // const methods\n    pageTrack,\n\n    trackPage,\n\n    buildPageTrackParams,\n\n    fetchPageViewId,\n\n    resetTimer,\n\n    resetAds,\n\n    trackAd,\n\n    init,\n\n    checkToRunWidgetImmediately,\n\n    trackAds,\n\n    appHasApplePay,\n\n    '__private__': {\n      VISIT_ID_COOKIE,\n      VOUCHER_QUERY,\n      PASSWORDLESS_TOKEN_QUERY,\n      collectedAds,\n      unloadRegistered,\n      unloadTriggered,\n      getPageView,\n      getVisitContainer,\n      track,\n      checkVoucher,\n      setPageViewId,\n      currentEnvironmentSupportsPageTrack,\n      invalidateLastVisit,\n      getCurrentDomain,\n      loadLastVisit,\n      setVisitCurrentDomain,\n      saveVisitCookie,\n      getVisitCookieOptions,\n      isTimeExpired,\n      refreshVisit,\n      generatePageViewId,\n      trackCollectedAds,\n      ...(deprecatedMethods({\n        buildPageUnloadParams,\n        unloadHandler,\n        unloadAction,\n      })),\n      buildPageCustomParams,\n      hasExternalReferrer,\n    },\n  }\n\n});\n\npn.container.register('main', {\n  useValue: main()\n});\npn.main = pn.container.resolve<MainInterface>('main');\n", "export interface PublicSDKModuleDescInterface {\n  n: string;\n  hM: boolean;\n}\n\n// n- name,  hM - hasModule\nexport const publicSDKModuleList: PublicSDKModuleDescInterface[] = [\n  { n: 'polyfill', hM: false },\n  { n: 'predefine', hM: false },\n  { n: 'predefineTinypass', hM: false },\n  { n: 'checkTinypass', hM: false },\n  { n: 'css', hM: true },\n  { n: 'ajax', hM: true },\n  { n: 'jqUtils', hM: true },\n  { n: 'cookie', hM: true },\n  { n: 'localStorage', hM: true },\n  { n: 'versionService', hM: true },\n  { n: 'itp', hM: true },\n  { n: 'util', hM: true },\n  { n: 'api', hM: true },\n  { n: 'postmessage', hM: true },\n  { n: 'eventUtils', hM: true },\n  { n: 'janrain', hM: true },\n  { n: 'sha1', hM: true },\n  { n: 'containerUtils', hM: true },\n  { n: 'tinypassLogin', hM: true },\n  { n: 'tinypassAccounts', hM: true },\n  { n: 'condeUserProvider', hM: true },\n  { n: 'gigya', hM: true },\n  { n: 'jwtDecode', hM: true },\n  { n: 'log', hM: true },\n  { n: 'logging', hM: true },\n  { n: 'observer', hM: true },\n  { n: 'gaCollectingService', hM: true },\n  { n: 'gaService', hM: true },\n  { n: 'ga4Service', hM: true },\n  { n: 'acp', hM: true },\n  { n: 'pianoIdLite', hM: true },\n  { n: 'pianoId', hM: true },\n  { n: 'user', hM: true },\n  { n: 'viewportExit', hM: true },\n  { n: 'template', hM: true },\n  { n: 'offer', hM: true },\n  { n: 'myaccount', hM: true },\n  { n: 'meter', hM: true },\n  { n: 'fingerprint', hM: true },\n  { n: 'scrollDepth', hM: true },\n  { n: 'idle', hM: true },\n  { n: 'interaction', hM: true },\n  { n: 'recWidgetService', hM: true },\n  { n: 'piano', hM: true },\n  { n: 'pianoEsp', hM: true },\n  { n: 'swg', hM: true },\n  { n: 'fbpixel', hM: true },\n  { n: 'fbsubscriptions', hM: true },\n  { n: 'cxense', hM: true },\n  { n: 'experience', hM: true },\n  { n: 'ifvisible', hM: true },\n  { n: 'activetimer', hM: true },\n  { n: 'doubleClickForPublisher', hM: true },\n  { n: 'applePay', hM: true },\n  { n: 'goCardlessDropin', hM: true },\n  { n: 'braintreeGooglePayIntegrationService', hM: true },\n  { n: 'applePayIntegrationService', hM: true },\n  { n: 'datatransApplePayIntegrationService', hM: true },\n  { n: 'stripeApplePayIntegrationService', hM: true },\n  { n: 'obi3DSChallenge', hM: true },\n  { n: 'amp', hM: true },\n  { n: 'performanceMetrics', hM: true },\n  { n: 'doubleOptIn', hM: true },\n  { n: 'newscycle', hM: true },\n  { n: 'captchaV3', hM: true },\n  { n: 'main', hM: true },\n  { n: 'tinypassErrorHandler', hM: true },\n  { n: 'tinypass', hM: true },\n  { n: 'postProcessing', hM: false },\n  { n: 'clientConfiguration', hM: true },\n  { n: 'microsoftQuickAuth', hM: true },\n  { n: 'frequencyEvent', hM: true },\n];\n\nexport default publicSDKModuleList;\n", "import { CssInterface } from \"./css\";\nimport {\n  PublicSDKModuleDescInterface,\n  publicSDKModuleList,\n} from \"../config/sdk-modules\";\nimport { TinypassErrorHandlerInterface } from \"./tinypassErrorHandler\";\nimport { GaServiceInterface } from \"./googleAnalytics/gaService\";\nimport { UtilInterface } from \"./util\";\nimport { dataLayer } from \"@piano-sdk/data-layer\";\nimport { IDataLayerConfig } from \"@piano-sdk/data-layer/types/types\";\nimport { ConsentInterface } from \"./consent\";\nimport {Ga4Config, Ga4ServiceInterface} from \"./googleAnalytics/ga4Service\";\nimport { TPropertiesSet } from \"@piano-sdk/data-layer/properties\";\nimport {ExcludedEvents, GaCollectingServiceInterface} from \"./googleAnalytics/gaCollectingService\";\nimport * as url from \"url\";\n\ntype TContent = NonNullable<TPropertiesSet['content']>;\n\nconst dlContent = (() => {\n  let cached: TPropertiesSet['content'] = null;\n  const send = (data: TPropertiesSet['content']) => {\n    cached = data && {\n      ...cached,\n      ...data\n    }\n\n    if (dataLayer.isReady && data) {\n      dataLayer.set('content', cached);\n      cached = null;\n    }\n  }\n\n  return {\n    set: <N extends keyof TContent>(name: N, value: TContent[N]) => send({[name]: value}),\n    get: <N extends keyof TContent>(name: N): TContent[N] => {\n      return dataLayer.isReady ? dataLayer.get('content')?.[name] : cached?.[name];\n    },\n    init: () => send(cached),\n  }\n})();\n\nexport interface TPPredefinedOptionsInterface {\n  aid?: string;\n  predefineValues: any[];\n  somePredefinedOption?: string;\n\n  somePredefinedCallback?(): void;\n}\n\nexport interface ZIndexesInterface {\n  backdrop: number;\n  modal: number;\n  close: number;\n}\n\ninterface ILinkedTermDataInterface {\n  [key: string]: unknown;\n}\n\ninterface ISessionInterface {\n  tracking_id?: string;\n  tbc?: string;\n  pcid?: string;\n}\n\ntype ILinkedTermSelectedCallbackInterface = (sessionId: string, termData: ILinkedTermDataInterface) => void;\n\nexport interface TinypassInterface {\n  fullTPVersion: boolean;\n\n  isInitialized: boolean;\n\n  push: Function;\n\n  offerBaseUrl?: string;\n\n  aid: string;\n\n  setAid(aid: string): void;\n\n  isSensitiveDataProtectionEnabled: boolean;\n\n  enableSensitiveDataProtection(isEnabled: boolean): void;\n\n  initTp(): void;\n\n  reload(): void;\n\n  removeSharedAccountCodeFromUrl(): void;\n\n  gaClientId: string;\n\n  setGAClientId(gaClientId: string): void;\n\n  getGAClientId(): string | void;\n\n  gaCrossDomainLinking: boolean;\n\n  enableGACrossDomainLinking(savedUA: string): void;\n\n  setGA4Config(config: Ga4Config): void;\n\n  setExcludedGAEvents(events: ExcludedEvents): void;\n\n  tags: string[] | string;\n\n  setCookieDomain(value: string): void;\n  cookieDomain?: string;\n\n  setStaticDomain(value: string): void;\n  staticDomain?: string;\n\n  setCookiePath(value: string): void;\n  cookiePath?: string;\n\n  setTags(tags: string[] | string): void;\n\n  dontScrollTopModal: boolean;\n\n  setDontScrollTopModal(val: boolean): void;\n\n  useExperience: boolean;\n\n  setUseExperience(val: boolean): void;\n\n  experimentalIosModal: boolean;\n\n  setExperimentalIosModal(val: boolean): void;\n\n  applePayMerchantId: string;\n\n  setApplePayMerchantId(val: string): void;\n\n  contentIsNative: boolean;\n\n  setContentIsNative(val: boolean): void;\n\n  composerHost: string;\n\n  setComposerHost(val: string): void;\n\n  endpoint: string;\n\n  setEndpoint(val: string): void;\n\n  espEndpoint: string;\n\n  setEspEndpoint(val: string): void;\n\n  cxCdnUrl: string;\n\n  setCxCdnUrl(val: string): void;\n\n  c1XLoadCce: boolean;\n\n  setC1XLoadCce(val: boolean): void;\n\n  c1XIntegrationVersion: string;\n\n  setC1XIntegrationVersion(val: string): void;\n\n  cxenseSiteId: string;\n\n  setCxenseSiteId(val: string): void;\n\n  cxenseLibAwaitingTimeout: number;\n\n  setCxenseLibAwaitingTimeout(val: number): void;\n\n  cxenseLibAwaitingRetryCount: number;\n\n  setCxenseLibAwaitingRetryCount(val: number): void;\n\n  contentId: string;\n\n  setContentId(val: string): void;\n\n  trackPages: boolean;\n\n  setTrackPages(val: boolean): void;\n\n  debug: boolean;\n\n  setDebug(val: boolean): void;\n\n  userRef: string;\n\n  setUserRef(val: string): void;\n\n  usePianoIdLiteUserProvider: boolean;\n\n  setUsePianoIdLiteUserProvider(val: boolean): void;\n\n  externalJWT: string;\n\n  setExternalJWT(val: string): void;\n\n  getExternalJWT(): string;\n\n  useTinypassAccounts: boolean;\n\n  setUseTinypassAccounts(val: boolean): void;\n\n  useCondeUserProvider: boolean;\n\n  setUseCondeUserProvider(val: boolean): void;\n\n  useGigyaUserProvider: boolean;\n\n  setUseGigyaUserProvider(val: boolean): void;\n\n  usePianoIdUserProvider: boolean;\n\n  setUsePianoIdUserProvider(val: boolean): void;\n\n  pianoIdUrl: string;\n\n  setPianoIdUrl(val: string): void;\n\n  itemId: string;\n\n  setItemId(val: string): void;\n\n  useAidSpecifiedCookies: boolean;\n\n  setUseAidSpecifiedCookies(val: boolean): void;\n\n  sandbox: boolean;\n\n  setSandbox(val: boolean): void;\n\n  contentCreatedSelector: string;\n\n  setContentCreatedSelector(val: string): void;\n\n  contentCreated: string;\n\n  setContentCreated(val: string): void;\n\n  contentAuthor: string;\n\n  setContentAuthor(val: string): void;\n\n  contentSection: string;\n\n  setContentSection(val: string): void;\n\n  zone?: string;\n\n  setZone(val: string): void;\n\n  zIndexes: ZIndexesInterface;\n\n  setZIndexes(val: ZIndexesInterface): void;\n\n  isNonProdEndpoint(): boolean;\n\n  customPreChecks: Function[];\n\n  setCustomPreCheck(handler: Function): void;\n\n  linkedTermSelectedCallbacks: ILinkedTermSelectedCallbackInterface[];\n\n  setLinkTermSelected(handler: ILinkedTermSelectedCallbackInterface): void;\n\n  setLinkedTermSelected(handler: ILinkedTermSelectedCallbackInterface): void;\n\n  requestUserAuthForLinkedTerm: boolean;\n\n  setRequestUserAuthForLinkedTerm(val: boolean): void;\n\n  disableLockConfig?: boolean;\n\n  setDisableLockConfig(val: boolean): void;\n\n  customParams: any;\n\n  setCustomParam(\n    name: string,\n    value: any,\n    scope?: string,\n    override?: boolean\n  ): void;\n\n  resetCustomParam(scope?: string): void;\n\n  externalLibraries: string[];\n  externalLibrariesCallbacks: Function[];\n\n  addExternalLibrary(libraries: string | string[], callback?: Function): void;\n\n  customVariables: any;\n\n  setCustomVariable(name: string, value: any): void;\n  saveCustomVariablesToLocalStorage(time: number): void;\n  restoreCustomVariablesFromLocalstorage(): void;\n\n  trackPageView: boolean;\n\n  setTrackPageview(val: boolean): void;\n\n  locale: string;\n  setLocale(value: string): void;\n\n  customPageUrl: string;\n\n  setPageURL(val: string): void;\n\n  adblockerCookieName: string;\n\n  setAdblockerCookieName(val: string): void;\n\n  maxCookieExpirationInDays: number;\n\n  setMaxCookieExpirationInDays(val: number): void;\n\n  getMaxCookieExpirationInDays(): number;\n\n  fbPixelId: string;\n\n  setFbPixelId(val: string): void;\n\n  getFbPixelId(): string;\n\n  redirectToFbTimeout: number;\n\n  setRedirectToFbTimeout(val: number): void;\n\n  isDoubleOptInCheckOnAccessCheckEnabled: boolean;\n\n  enableDoubleOptInCheckOnAccessCheck(): void;\n\n  cloudflareWorkerUrl: string;\n\n  setCloudflareWorkerUrl(val: string): void;\n\n  isMockMode: boolean;\n  inappBrowserReturn: boolean;\n\n  events: Function[];\n\n  appList: string[];\n  initCallbacks: Function[];\n  mainModuleInited: boolean;\n\n  pageTrack(url: string, tags: string[]): void;\n\n  trackPage(url: string, tags: string[]): void;\n\n  trackPageUnload(): void;\n\n  trackAds(ads: any[]): void;\n\n  trackAd(type: string, id: string, ad: any): void;\n\n  onLoad(callback: Function): void;\n\n  getEndpointRoot(attemptToGetSecureUrl?: boolean): string;\n\n  getExperienceEndpoint(attemptToGetSecureUrl: boolean): string;\n\n  getApiEndpoint(): string;\n\n  getTrackingEndpoint(sourceUrl?: string): string;\n\n  isSandbox(): boolean;\n\n  addHandler(handlerName: string, handler: Function): void;\n\n  getListOfAddedHandlers(): string[];\n\n  tpPredefinedOptions: TPPredefinedOptionsInterface;\n\n  cacheableShowTemplate: boolean;\n\n  setCacheableShowTemplate(enabled: boolean): void;\n  getCacheableShowTemplate(): boolean;\n\n  sssAccessToken?: string;\n  setSssAccessToken(token: string | undefined): void;\n\n  sssMode?: string;\n  setSssMode(mode: string): void;\n\n  sssCallbackUrl?: string;\n  setSssCallbackUrl(url: string): void;\n\n  sssOriginUrl?: string;\n  setSssOriginUrl(url: string): void;\n\n  isDataLayerEnabled: boolean;\n  setDataLayerEnabled(enabled: boolean): void;\n\n  verifySignature(payload: string, signatureB64: string, publicKeyB64: string): Promise<boolean>;\n}\n\nconst tpPredefinedOptions: TPPredefinedOptionsInterface = {\n  predefineValues: [],\n};\n// tpPredefinedOptions.predefineValues = (window.tp as any || []) as any[];\n// @ts-ignore\nif (window.tp && window.tp.length) {\n  // @ts-ignore\n  tpPredefinedOptions.predefineValues = [\n    ...((window.tp as any) || []),\n  ] as any[];\n}\n\npn.tpPredefinedOptions = tpPredefinedOptions;\npn.container.register(\"tpPredefinedOptions\", {\n  useValue: tpPredefinedOptions,\n});\n\n@pn.singleton()\nclass Tinypass implements TinypassInterface {\n  isDataLayerEnabled = true; // to support some publishers\n  fullTPVersion = false;\n\n  isInitialized = false; // tp.main.init complete\n  aid: string = \"\";\n  isSensitiveDataProtectionEnabled: boolean = false;\n  gaClientId!: string;\n\n  gaCrossDomainLinking!: boolean;\n  //tags!: string[] | string;\n  get tags(): string {\n    return dlContent.get(\"tags\")?.join(\",\") as string;\n  }\n  set tags(val: string | string[] | any) {\n    let newVal: string[] | null;\n\n    if (Array.isArray(val)) {\n      newVal = val;\n    } else {\n      newVal = typeof val === \"string\" ? val.split(','): null;\n    }\n    dlContent.set(\"tags\", newVal);\n  }\n  cookieDomain?: string;\n  staticDomain?: string;\n  cookiePath?: string;\n  dontScrollTopModal!: boolean;\n  useExperience!: boolean;\n  // @deprecated in this version\n  experimentalIosModal!: boolean;\n  applePayMerchantId!: string;\n  //contentIsNative!: boolean;\n  get contentIsNative(): boolean {\n    return dlContent.get(\"isNative\") as boolean;\n  }\n  set contentIsNative(val: boolean) {\n    dlContent.set(\"isNative\", val);\n  }\n  composerHost!: string;\n  endpoint!: string;\n  affiliateTokenName = \"affiliateToken\";\n  espEndpoint!: string;\n  cxCdnUrl = \"https://cdn.cxense.com\";\n  c1XLoadCce = true;\n  c1XIntegrationVersion = \"v2\";\n  cxenseSiteId!: string;\n  cxenseLibAwaitingTimeout = 0;\n  cxenseLibAwaitingRetryCount = 0;\n  //contentId!: string;\n  get contentId(): string {\n    return dlContent.get(\"id\")!;\n  }\n  set contentId(val: string) {\n    dlContent.set(\"id\", val);\n  }\n  trackPages = true;\n  debug = false;\n  userRef = \"\";\n  usePianoIdLiteUserProvider = false;\n  externalJWT!: string;\n  useTinypassAccounts = false;\n  useCondeUserProvider = false;\n  useGigyaUserProvider = false;\n  usePianoIdUserProvider = false;\n  pianoIdUrl!: string;\n  itemId!: string;\n  useAidSpecifiedCookies = false;\n  sandbox = false;\n  contentCreatedSelector!: string;\n  //contentCreated!: string;\n  get contentCreated(): string {\n    return dlContent.get(\"createdAt\")?.toString() || \"\";\n  }\n  set contentCreated(val: string) {\n    dlContent.set(\"createdAt\", val);\n  }\n  //contentAuthor!: string;\n  get contentAuthor(): string {\n    return dlContent.get(\"authors\")?.join(\",\") || \"\";\n  }\n  set contentAuthor(val: string) {\n    dlContent.set(\"authors\", [val]);\n  }\n  //contentSection!: string;\n  get contentSection(): string {\n    return dlContent.get(\"section\")!;\n  }\n  set contentSection(val: string) {\n    dlContent.set(\"section\", val);\n  }\n  //zone!: string;\n  get zone(): string {\n    return dlContent.get(\"zone\")!;\n  }\n  set zone(val: string) {\n    dlContent.set(\"zone\", val);\n  }\n  zIndexes = {\n    backdrop: 300000,\n    modal: 300050,\n    close: 300100,\n  };\n  linkedTermSelectedCallbacks: ILinkedTermSelectedCallbackInterface[] = [];\n  requestUserAuthForLinkedTerm = true;\n\n  customPreChecks: Function[] = [];\n  customParams: any = {};\n\n  externalLibraries: string[] = [];\n  externalLibrariesCallbacks: Function[] = [];\n\n  customVariables: any = {};\n\n  locale = \"\";\n\n  trackPageView = true;\n  customPageUrl!: string;\n\n  adblockerCookieName!: string;\n\n  maxCookieExpirationInDays!: number;\n\n  fbPixelId!: string;\n\n  redirectToFbTimeout = 3;\n\n  isDoubleOptInCheckOnAccessCheckEnabled = false;\n\n  cloudflareWorkerUrl!: string;\n\n  isMockMode = false;\n  inappBrowserReturn = false;\n\n  events: Function[] = [];\n\n  appList: string[] = []; //applications list which were initialised\n  cacheableShowTemplate = true;\n\n  // Self-serve sessions feature\n  sssAccessToken?: string;\n  sssMode?: string;\n  sssCallbackUrl?: string;\n  sssOriginUrl?: string;\n\n  disableLockConfig = false;\n\n  public initCallbacks: Function[] = [];\n  public mainModuleInited = false;\n  private restCallbacks: Function[] = [];\n  private initTries = 0;\n  private listOfAddedHandlers: string[] = [];\n\n  constructor(\n    @pn.inject(\"tpPredefinedOptions\")\n    public tpPredefinedOptions: TPPredefinedOptionsInterface,\n    @pn.inject(\"css\") public css: CssInterface,\n    @pn.inject(\"tinypassErrorHandler\")\n    public tinypassErrorHandler: TinypassErrorHandlerInterface,\n    @pn.inject(\"gaService\") public gaService: GaServiceInterface,\n    @pn.inject(\"ga4Service\") public ga4Service: Ga4ServiceInterface,\n    @pn.inject(\"gaCollectingService\")\n    public gaCollectingService: GaCollectingServiceInterface,\n    @pn.inject(\"util\") public utilService: UtilInterface,\n    @pn.inject(\"consent\") public consent: ConsentInterface\n  ) {\n    css.loadOfferCss();\n  }\n\n  initTp() {\n    try {\n      const predefineValues = this.tpPredefinedOptions.predefineValues;\n      this.tpPredefinedOptions.predefineValues = [];\n\n      predefineValues.forEach((predefineValue: any) => {\n        if (typeof predefineValue[1] === \"function\") {\n          if (predefineValue[0] === \"init\") {\n            this.initCallbacks.push(predefineValue[1]);\n          } else {\n            this.restCallbacks.push(predefineValue);\n          }\n          // hack for support old tricky implementation\n        } else if (\n          predefineValue[1] === \"init\" &&\n          typeof predefineValue[2] === \"function\"\n        ) {\n          this.initCallbacks.push(predefineValue[2]);\n        } else {\n          this.push(predefineValue);\n        }\n      });\n\n      if (!this.aid && this.initTries < 10) {\n        this.initTries++;\n        setTimeout(() => this.initTp(), 50);\n        return;\n      }\n\n      if (!this.aid) {\n        return; // we should initialize only when specified `aid` parameter\n      }\n\n      this.tinypassErrorHandler.initialize();\n\n      while (this.restCallbacks.length) {\n        try {\n          const predefineValue: any = this.restCallbacks.shift();\n          this.push(predefineValue);\n        } catch (error) {\n          console.error(error);\n          pn.tinypassErrorHandler.addError(error);\n        }\n      }\n\n      this._init();\n\n      if (this.externalLibraries.length) {\n        this.realizeExternalLibraries();\n      }\n\n      this.isInitialized = true;\n\n      // back compatibility\n      window.___tp = () => {};\n    } catch (e) {\n      pn.tinypassErrorHandler.addError(e, \"initTP\");\n      console.error(\"init PN process error\", e);\n    }\n  }\n\n  realizeExternalLibraries() {\n    const extLibrariesPromiseList: any[] = [];\n    this.externalLibraries.forEach((extLibrary: string) => {\n      const loadJsPromise = this.utilService.requireJsFile(extLibrary);\n      extLibrariesPromiseList.push(loadJsPromise);\n    });\n    Promise.all(extLibrariesPromiseList).then(() => {\n      this.externalLibraries = [];\n      if (this.externalLibrariesCallbacks) {\n        for (let i = 0; i < this.externalLibrariesCallbacks.length; ++i) {\n          tp.externalLibrariesCallbacks[i]();\n        }\n      }\n      tp.externalLibrariesCallbacks = [];\n    });\n  }\n\n  push(...args: any[]) {\n    let i, f, parameterArray;\n    for (i = 0; i < args.length; i++) {\n      parameterArray = args[i];\n      f = parameterArray.shift();\n      if (typeof f === \"string\" || f instanceof String) {\n        // @ts-ignore\n        if (!this[f]) {\n          console.error(\"Undefined method \" + f);\n          return;\n        }\n        // @ts-ignore\n        this[f].apply(this, parameterArray);\n      } else {\n        f.apply(this, parameterArray);\n      }\n    }\n  }\n\n  // method only for resolve callbacks from integration code\n  private init(callback?: Function): void {\n    if (this.isInitialized) {\n      if (!this.mainModuleInited) {\n        this.mainModuleInited = true;\n        this.initMainModuleAfterInitCbk();\n      }\n\n      if (callback) {\n        callback();\n      }\n    } else {\n      if (callback) {\n        this.tpPredefinedOptions.predefineValues.push([\"init\", callback]);\n      }\n      this.initTp();\n    }\n  }\n\n  private _init(): void {\n    const config: IDataLayerConfig = {};\n\n    if (this.cookieDomain || this.cookiePath) {\n      config.cookieDefault = {\n        domain: this.cookieDomain,\n        path: this.cookiePath,\n      };\n    }\n    dataLayer.init(config);\n    dlContent.init();\n\n    if (this.cxenseSiteId) {\n      dataLayer.set(\"siteId\", this.cxenseSiteId);\n    }\n\n    pn.consent.__protected__.init();\n    if (\n      pn.util &&\n      pn.util.hasQueryParamByName &&\n      pn.util.hasQueryParamByName(\"xpdebug\")\n    ) {\n      pn.setDebug(true);\n    }\n    pn.util.setTpccCookies();\n\n    if (pn.util.isSafariOrIOsUiWebView() && !pn.user.isUserValid()) {\n      if (pn.util.getQueryParamByName(\"userToken\")) {\n        const cookieDomain = pn.util.getQueryParamByName(\"cookieDomain\");\n        const userToken = pn.util.getQueryParamByName(\"userToken\");\n        const tokenListValue = pn.util.getQueryParamByName(\"tokenListValue\");\n\n        pn.util.setAccessTokenListCookie(\n          { cookie_domain: cookieDomain, value: tokenListValue },\n          userToken\n        );\n\n        pn.util.removeQueryParamByName(\"userToken\");\n        pn.util.removeQueryParamByName(\"cookieDomain\");\n        pn.util.removeQueryParamByName(\"tokenListValue\");\n      }\n    }\n\n    if (!this.mainModuleInited) {\n      this.mainModuleInited = true;\n      this.initMainModuleAfterInitCbk();\n    }\n\n    pn.itp.init();\n\n    if (!this.aid) {\n      const aidError = new Error(\n        `Incorrect aid integration: ${tp.aid} url: ${window.location.href}`\n      );\n      this.tinypassErrorHandler.addError(aidError);\n    }\n\n    pn.logging.setTime(\"startInit\", Math.floor(window.pnInitPerformance));\n    pn.logging.setTime(\"completeInit\", Math.floor(performance.now() - window.pnInitPerformance));\n  }\n\n  // it fires only ones when ran an `init` callback\n  private initMainModuleAfterInitCbk() {\n    pn.user.providerInit();\n\n    if (this.appList.indexOf(this.aid) < 0) {\n      this.appList.push(this.aid);\n      pn.main.init();\n    }\n\n    while (this.initCallbacks.length) {\n      try {\n        this.initCallbacks.shift()!();\n      } catch (error) {\n        console.error(error);\n        pn.tinypassErrorHandler.addError(error);\n      }\n    }\n\n    pn.main.checkToRunWidgetImmediately();\n\n    if (this.events) {\n      for (let i = 0; i < this.events.length; i++) {\n        this.events[i]();\n      }\n      this.events = [];\n    }\n  }\n\n  setAid(aid: string) {\n    this.aid = aid;\n  }\n\n  enableSensitiveDataProtection(isEnabled: boolean) {\n    this.isSensitiveDataProtectionEnabled = isEnabled;\n  }\n\n  reload() {\n    location.href = pn.util.removeVoucherCodeFromUrl(location.href);\n  }\n\n  removeSharedAccountCodeFromUrl() {\n    location.href = pn.util.removeSharedAccountCodeFromUrl(location.href);\n  }\n\n  setGAClientId(clientId: string): void {\n    this.gaClientId = clientId;\n    this.gaService.recreateWithClientId(clientId);\n  }\n\n  getGAClientId(): string | void {\n    return this.gaClientId;\n  }\n\n  /*\n   * This method safely triggers 'setGAClientId'. Use it instead of direct use of 'setGAClientId'\n   * in integrations scripts.\n   * Right now publisher can trigger 'setGAClientId' by himself, but it requires a bit more\n   * work on publisher's side as they should get clientId from google first, and to do so they need\n   * to control the order of scripts (our integration script should go after ga script) or\n   * they need to modify their google analytics code and trigger tp.push('setGAClientId'... there\n   * but in that case they need to be sure tp is    initialized as well (present in global window scope)\n   * to reduce this amount of work they now can just trigger this method (enableGACrossDomainLinking)\n   * which will check presence of ga within one minute, and if it finds it,\n   * it will trigger 'setGAClientId'\n   */\n  enableGACrossDomainLinking(savedUA?: string): void {\n    this.gaCrossDomainLinking = true;\n\n    const interval = 500;\n    const intervalTimeout = 60000;\n    const startTime = Date.now();\n    const timeoutIDFunction = () => {\n      const ga = window.ga;\n\n      if (ga && typeof ga === \"function\") {\n        try {\n          ga((tracker: any) => {\n            if (\n              typeof tracker !== \"undefined\" &&\n              typeof savedUA === \"undefined\"\n            ) {\n              this.setGAClientId(tracker.get(\"clientId\"));\n            } else if (typeof savedUA !== \"undefined\") {\n              const trackers = ga.getAll();\n\n              for (let i = 0; i < trackers.length; i++) {\n                const tempTracker = trackers[i];\n                if (tempTracker.get(\"trackingId\") === savedUA) {\n                  this.setGAClientId(tempTracker.get(\"clientId\"));\n                  break;\n                }\n              }\n            }\n          });\n        } catch (e) {}\n      } else {\n        if (Date.now() - startTime < intervalTimeout) {\n          setTimeout(timeoutIDFunction, interval);\n        }\n      }\n    };\n\n    timeoutIDFunction();\n  }\n\n  setExcludedGAEvents(events: ExcludedEvents): void {\n    this.gaCollectingService.setExcludedEvents(events);\n  }\n\n  setGA4Config(config: Ga4Config): void {\n    this.ga4Service.setGa4Config(config);\n  }\n\n  setTags(tags: string[] | string): void {\n    if (tags instanceof Array) {\n      this.tags = tags.join(\",\");\n    } else {\n      this.tags = tags;\n    }\n  }\n\n  setCookieDomain(value: string): void {\n    if (value[0] !== \".\") {\n      value = \".\" + value;\n    }\n    this.cookieDomain = value;\n  }\n\n  setStaticDomain(value: string): void {\n    this.staticDomain = value;\n  }\n\n  setCookiePath(value: string): void {\n    this.cookiePath = value;\n  }\n\n  setDontScrollTopModal(val: boolean): void {\n    this.dontScrollTopModal = val;\n  }\n\n  setUseExperience(val: boolean): void {\n    this.useExperience = val;\n  }\n\n  // @deprecated in this version\n  setExperimentalIosModal(val: boolean): void {\n    this.experimentalIosModal = val;\n  }\n\n  setApplePayMerchantId(val: string): void {\n    this.applePayMerchantId = val;\n  }\n\n  setContentIsNative(val: boolean): void {\n    this.contentIsNative = val;\n  }\n\n  setComposerHost(val: string): void {\n    this.composerHost = val;\n  }\n\n  setEndpoint(val: string): void {\n    this.endpoint = val;\n  }\n\n  setAffiliateTokenName(affiliateTokenName: string) {\n    this.affiliateTokenName = affiliateTokenName;\n  }\n\n  setEspEndpoint(val: string): void {\n    this.espEndpoint = val;\n  }\n\n  setCxCdnUrl(val: string): void {\n    this.cxCdnUrl = val;\n  }\n\n  setC1XLoadCce(val: boolean): void {\n    this.c1XLoadCce = val;\n  }\n\n  setC1XIntegrationVersion(val: string): void {\n    this.c1XIntegrationVersion = val;\n  }\n\n  setDataLayerEnabled(val: boolean): void {\n    this.isDataLayerEnabled = val;\n  }\n\n  setCxenseSiteId(val: string): void {\n    this.cxenseSiteId = val;\n    dataLayer.set(\"siteId\", val);\n  }\n\n  setCxenseLibAwaitingTimeout(val: number): void {\n    this.cxenseLibAwaitingTimeout = val;\n  }\n\n  setCxenseLibAwaitingRetryCount(val: number): void {\n    this.cxenseLibAwaitingRetryCount = val;\n  }\n\n  setContentId(val: string): void {\n    this.contentId = val;\n  }\n\n  setTrackPages(val: boolean): void {\n    this.trackPages = val;\n  }\n\n  setDebug(val: boolean): void {\n    this.debug = val;\n  }\n\n  setUserRef(val: string): void {\n    this.userRef = val;\n  }\n\n  setUsePianoIdLiteUserProvider(val: boolean): void {\n    this.usePianoIdLiteUserProvider = val;\n  }\n\n  setExternalJWT(val: string): void {\n    this.externalJWT = val;\n  }\n\n  getExternalJWT(): string {\n    return this.externalJWT;\n  }\n\n  setUseTinypassAccounts(val: boolean): void {\n    this.useTinypassAccounts = val;\n  }\n\n  setUseCondeUserProvider(val: boolean): void {\n    this.useCondeUserProvider = val;\n  }\n\n  setUseGigyaUserProvider(val: boolean): void {\n    this.useGigyaUserProvider = val;\n  }\n\n  setUsePianoIdUserProvider(val: boolean): void {\n    this.usePianoIdUserProvider = val;\n  }\n\n  setPianoIdUrl(val: string): void {\n    this.pianoIdUrl = val;\n  }\n\n  setItemId(val: string): void {\n    this.itemId = val;\n  }\n\n  setUseAidSpecifiedCookies(val: boolean): void {\n    this.useAidSpecifiedCookies = val;\n  }\n\n  setSandbox(val: boolean): void {\n    this.sandbox = val;\n  }\n\n  setContentCreatedSelector(val: string): void {\n    this.contentCreatedSelector = val;\n  }\n\n  setContentCreated(val: string): void {\n    this.contentCreated = val;\n  }\n\n  setContentAuthor(val: string): void {\n    this.contentAuthor = val;\n  }\n\n  setContentSection(val: string): void {\n    this.contentSection = val;\n  }\n\n  setZone(val: string): void {\n    this.zone = val || \"\";\n  }\n\n  isNonProdEndpoint(): boolean {\n    var nonProdUrlRegex =\n      /^https?:\\/\\/(.*sandbox.*|\\d+\\.dev)\\.(tinypass\\.com|piano\\.io)/i;\n    if (this.endpoint === \"sandbox\") {\n      return true;\n    }\n    return nonProdUrlRegex.test(this.endpoint);\n  }\n\n  setZIndexes(val: ZIndexesInterface): void {\n    this.zIndexes = val;\n  }\n\n  setCustomPreCheck(handler: Function): void {\n    this.customPreChecks.push(handler);\n  }\n\n  setLinkedTermSelected(handler: ILinkedTermSelectedCallbackInterface): void {\n    if (typeof handler !== 'function') {\n      return;\n    }\n\n    this.linkedTermSelectedCallbacks.push(handler);\n  }\n\n  // for backward compatibility\n  setLinkTermSelected(handler: ILinkedTermSelectedCallbackInterface): void {\n    this.setLinkedTermSelected(handler);\n  }\n\n  setRequestUserAuthForLinkedTerm(val: boolean): void {\n    this.requestUserAuthForLinkedTerm = val;\n  }\n\n  setDisableLockConfig(val: boolean): void {\n    this.disableLockConfig = val;\n  }\n\n  setCustomParam(\n    name: string,\n    value: any,\n    scope?: string,\n    override?: boolean\n  ): void {\n    const availableScopes = [\"content\", \"user\", \"request\"];\n    if (!scope) scope = \"content\";\n    scope = scope.toLowerCase();\n    if (availableScopes.indexOf(scope) < 0) {\n      throw new Error(\n        \"Undefined scope \" +\n          scope +\n          \"\\nAvailable scopes: \" +\n          availableScopes.join(\", \")\n      );\n    }\n    if (this.customParams[scope] === undefined) {\n      this.customParams[scope] = {};\n    }\n    if (this.customParams[scope][name] === undefined || override) {\n      this.customParams[scope][name] = [];\n    }\n    var values = [].concat(value);\n    for (var i = 0; i < values.length; i++) {\n      if (typeof values[i] !== \"string\") {\n        throw new Error(\n          \"setCustomParam accept only string values or array of strings\"\n        );\n      }\n      this.customParams[scope][name].push(values[i]);\n    }\n  }\n\n  resetCustomParam(scope?: string): void {\n    if (!scope) {\n      scope = \"content\";\n    }\n    delete this.customParams[scope];\n  }\n\n  addExternalLibrary(libraries: string | string[], callback?: Function): void {\n    if (typeof libraries === \"string\") {\n      this.externalLibraries.push(libraries);\n    } else {\n      for (var i = 0; i < libraries.length; ++i) {\n        this.externalLibraries.push(libraries[i]);\n      }\n    }\n    if (callback) {\n      this.externalLibrariesCallbacks.push(callback);\n    }\n    if (this.isInitialized) {\n      this.realizeExternalLibraries();\n    }\n  }\n\n  setCustomVariable(name: string, value: any): void {\n    this.customVariables[name] = value;\n  }\n\n  saveCustomVariablesToLocalStorage(time: number): void {\n    function _getCurrentTimestamp(): number {\n      return Math.floor(new Date().getTime() / 1000);\n    }\n    const composerLSSetAsync = (key: string, value: string) => {\n      pn.consent.__protected__.async((products) =>\n        products.composer?.localStorage.set(key, value)\n      );\n    };\n\n    var keyName = \"__tp-customVariables\";\n    composerLSSetAsync(keyName, JSON.stringify(this.customVariables));\n    if (time) {\n      composerLSSetAsync(\n        keyName + \"-expiration\",\n        _getCurrentTimestamp() + time + \"\"\n      );\n    }\n  }\n\n  restoreCustomVariablesFromLocalstorage(): void {\n    if (\"localStorage\" in window && window[\"localStorage\"] !== null) {\n      var customVars =\n        tp.util.__protected__.getLocalStorageItem(\"customVariables\");\n      tp.util.__protected__.removeLocalStorageItem(\"customVariables\");\n      if (customVars) {\n        // @ts-ignore\n        for (var prop in customVars) {\n          // @ts-ignore\n          this.customVariables[prop] = customVars[prop];\n        }\n      }\n    }\n  }\n\n  private handler<T extends string>(event: T, callback: Function) {\n    const registerPrefixedEvents = this.registerPrefixedEvents;\n    return () => {\n      const modules = [\n        pn.offer,\n        pn.template,\n        pn.meter,\n        pn.experience,\n        pn.myaccount,\n        pn.pianoId,\n        pn.tinypassLogin,\n        pn.swg,\n        pn.user,\n        pn.credit,\n      ];\n      var result;\n\n      for (var i = 0; i < modules.length; i++) {\n        var module = modules[i];\n        if (!module) {\n          continue;\n        }\n        // todo add basic type\n        var res = module.registerCallback(event as any, callback);\n\n        if (res !== undefined) {\n          result = res;\n        }\n\n        res = registerPrefixedEvents(module, event, callback);\n\n        if (res !== undefined) {\n          result = res;\n        }\n      }\n\n      return result;\n    };\n  }\n\n  private registerPrefixedEvents(module: any, event: any, callback: Function) {\n    var prefixes = [\n      { module: \"offer\", prefix: \"checkout\" },\n      { module: \"pianoId\", prefix: \"pianoId\" },\n    ];\n    var moduleEvent, res, result;\n\n    for (var i = 0; i < prefixes.length; i++) {\n      var p = prefixes[i];\n\n      if (\n        module.name === p.module &&\n        event.substring(0, p.prefix.length) === p.prefix\n      ) {\n        moduleEvent =\n          event.substring(p.prefix.length, p.prefix.length + 1).toLowerCase() +\n          event.substring(p.prefix.length + 1, event.length);\n\n        res = module.registerCallback(moduleEvent, callback);\n\n        if (res !== undefined) {\n          result = res;\n        }\n      }\n    }\n\n    return result;\n  }\n\n  addHandler(handlerName: string, handler: Function): void {\n    var ev = this.handler(handlerName, handler);\n    if (this.isInitialized) {\n      ev();\n    } else {\n      this.events.push(ev);\n    }\n\n    this.listOfAddedHandlers.push(handlerName);\n  }\n\n  getListOfAddedHandlers(): string[] {\n    return this.listOfAddedHandlers;\n  }\n\n  setTrackPageview(val: boolean): void {\n    this.trackPageView = val;\n  }\n\n  setLocale(value: string): void {\n    this.locale = value;\n    this.utilService.__protected__.setCookie(\"LANG\", this.locale);\n\n    if (this.isInitialized) {\n      this.changeLocale(value);\n    } else {\n      this.initCallbacks.push(() => {\n        this.changeLocale(value);\n      });\n    }\n  }\n\n  setPageURL(val: string): void {\n    this.customPageUrl = val;\n  }\n\n  setAdblockerCookieName(val: string): void {\n    this.adblockerCookieName = val;\n  }\n\n  setMaxCookieExpirationInDays(val: number): void {\n    const maxCookieExpirationInDays =\n      typeof val === \"string\" ? parseInt(val, 10) : val;\n    if (isFinite(maxCookieExpirationInDays) && maxCookieExpirationInDays > 0) {\n      this.maxCookieExpirationInDays = maxCookieExpirationInDays;\n    } else {\n      throw new Error(\"maxCookieExpirationInDays must be a positive number\");\n    }\n  }\n\n  getMaxCookieExpirationInDays(): number {\n    return this.maxCookieExpirationInDays;\n  }\n\n  setFbPixelId(val: string): void {\n    this.fbPixelId = val;\n  }\n\n  getFbPixelId(): string {\n    return this.fbPixelId;\n  }\n\n  setRedirectToFbTimeout(val: number): void {\n    this.redirectToFbTimeout = val;\n  }\n\n  enableDoubleOptInCheckOnAccessCheck(): void {\n    this.isDoubleOptInCheckOnAccessCheckEnabled = true;\n  }\n\n  setCloudflareWorkerUrl(val: string): void {\n    this.cloudflareWorkerUrl = val;\n  }\n\n  private callbacks: Function[] = [];\n\n  private getEndpoint(url: string, attemptToReturnSecureUrl?: boolean): string {\n    // strip off trailing /\n    if (url.lastIndexOf(\"/\") === url.length - 1) {\n      url = url.substr(0, url.length - 1);\n    }\n    // get rid of \"/v3\" if it's there\n    if (url.match(/\\/v3$/)) {\n      url = url.substr(0, url.lastIndexOf(\"/v3\"));\n    }\n    // get rid of \"/api\" if it's there\n    if (url.match(/\\/api$/)) {\n      url = url.substr(0, url.lastIndexOf(\"/api\"));\n    }\n    // ensure that the endpoint starts with at least http[s]:// or //\n    if (!url.match(/^(http[s]?:)?\\/\\//)) {\n      // if they haven't specified that much, put protocol-agnostic start\n      url = \"//\" + url;\n    }\n    if (\n      typeof attemptToReturnSecureUrl !== \"undefined\" &&\n      attemptToReturnSecureUrl &&\n      !url.match(/^http[s]?:/)\n    ) {\n      // if it starts with http[s], we will respect that;\n      // if not, this prepends https in the case where attemptToReturnSecureUrl is true\n      url = \"https:\" + url;\n    }\n    return url;\n  }\n\n  private _getEndpointRoot(attemptToReturnSecureUrl?: boolean): string {\n    // start with production\n    var url = \"https://buy.tinypass.com\";\n    if (this.sandbox === true) {\n      this.endpoint = \"sandbox\";\n    }\n    if (this.endpoint) {\n      if (this.endpoint === \"sandbox\") {\n        url = \"https://sandbox.tinypass.com\";\n      } else if (this.endpoint !== \"prod\" && this.endpoint !== \"production\") {\n        url = this.endpoint;\n      }\n    }\n    return this.getEndpoint(url, attemptToReturnSecureUrl);\n  }\n\n  private _getApiEndpoint(): string {\n    return this._getEndpointRoot() + \"/api/v3\";\n  }\n\n  private _getTrackingEndpoint(sourceUrl: string = \"\"): string {\n    var url = sourceUrl || this.endpoint;\n    if (this.sandbox === true) {\n      url = \"https://sandbox.tinypass.com\";\n    } else if (\n      typeof this.endpoint === \"undefined\" ||\n      this.endpoint === null ||\n      this.endpoint === \"\" ||\n      this.endpoint === \"prod\" ||\n      this.endpoint === \"production\" ||\n      this.endpoint.match(/(buy|api|api-v3)\\.tinypass\\.com/)\n    ) {\n      url = sourceUrl || \"https://api-v3.tinypass.com\";\n    }\n    return this.getEndpoint(url, true);\n  }\n\n  private _getExperienceEndpoint(attemptToReturnSecureUrl?: boolean): string {\n    // start with production\n    var url = \"https://c2.piano.io\";\n    if (this.composerHost) {\n      url = this.composerHost;\n    } else {\n      if (this.sandbox === true) {\n        this.endpoint = \"sandbox\";\n      }\n      if (this.endpoint) {\n        if (this.endpoint === \"sandbox\") {\n          url = \"https://c2-sandbox.piano.io\";\n        } else if (this.endpoint !== \"prod\" && this.endpoint !== \"production\") {\n          url = this.endpoint;\n          //These hardcoded options are meant to force the experience endpoint to\n          //always go to experience.tinypass.com for our production\n          url = url.replace(\"//buy.tinypass.com\", \"//c2.piano.io\");\n          url = url.replace(\"//api.tinypass.com\", \"//c2.piano.io\");\n          url = url.replace(\"//buy-au.piano.io\", \"//c2-au.piano.io\");\n          url = url.replace(\"//api-au.piano.io\", \"//c2-au.piano.io\");\n          url = url.replace(\"//buy-ap.piano.io\", \"//c2-ap.piano.io\");\n          url = url.replace(\"//api-ap.piano.io\", \"//c2-ap.piano.io\");\n          url = url.replace(\"//buy-eu.piano.io\", \"//c2-eu.piano.io\");\n          url = url.replace(\"//api-eu.piano.io\", \"//c2-eu.piano.io\");\n          url = url.replace(\"//sandbox.tinypass.com\", \"//c2-sandbox.piano.io\");\n          url = url.replace(\"//sandbox.piano.io\", \"//c2-sandbox.piano.io\");\n          url = url.replace(\"//experience-au.piano.io\", \"//c2-au.piano.io\");\n          url = url.replace(\"//experience-eu.piano.io\", \"//c2-eu.piano.io\");\n          url = url.replace(\"//experience-ap.piano.io\", \"//c2-ap.piano.io\");\n          url = url.replace(\"//experience.tinypass.com\", \"//c2.piano.io\");\n          url = url.replace(\"//buy.piano.io\", \"//c2.piano.io\");\n          url = url.replace(\"//api.piano.io\", \"//c2.piano.io\");\n          url = url.replace(\"//experience.piano.io\", \"//c2.piano.io\");\n        }\n      }\n    }\n    return this.getEndpoint(url, attemptToReturnSecureUrl);\n  }\n\n  private _isSandbox(): boolean {\n    return (\n      this.sandbox ||\n      this.endpoint === \"sandbox\" ||\n      (!!this.endpoint &&\n        this.endpoint.indexOf(\"//sandbox.tinypass.com\") !== -1)\n    );\n  }\n\n  private changeLocale(value: string): void {\n    if (pn.pianoId.isConfigured()) {\n      pn.pianoId.updateLang(value);\n    }\n\n    pn.postmessage.broadcast(\"langChanged\", { lang: value });\n  }\n\n  pageTrack(url: string, tags: string[]): void {\n    pn.main.pageTrack(url, tags);\n  }\n\n  trackPage(url: string, tags: string[]): void {\n    pn.main.pageTrack(url, tags);\n  }\n\n  trackPageUnload(): void {\n    pn.main.trackPageUnload();\n  }\n\n  trackAds(ads: any[]): void {\n    pn.main.trackAds(ads);\n  }\n\n  trackAd(type: string, id: string, ad: any): void {\n    pn.main.trackAd(type, id, ad);\n  }\n\n  onLoad(callback: Function): void {\n    this.callbacks.push(callback);\n  }\n\n  getEndpointRoot(attemptToGetSecureUrl?: boolean): string {\n    return this._getEndpointRoot(attemptToGetSecureUrl);\n  }\n\n  getExperienceEndpoint(attemptToGetSecureUrl: boolean): string {\n    return this._getExperienceEndpoint(attemptToGetSecureUrl);\n  }\n\n  getApiEndpoint(): string {\n    return this._getApiEndpoint();\n  }\n\n  getTrackingEndpoint(sourceUrl = \"\"): string {\n    return this._getTrackingEndpoint(sourceUrl);\n  }\n\n  isSandbox(): boolean {\n    return this._isSandbox();\n  }\n\n  setCacheableShowTemplate(enabled: boolean): void {\n    this.cacheableShowTemplate = enabled;\n  }\n\n  getCacheableShowTemplate(): boolean {\n    return this.cacheableShowTemplate;\n  }\n\n  setSssAccessToken(token: string | undefined): void {\n    this.sssAccessToken = token;\n  }\n\n  setSssCallbackUrl(url: string): void {\n    this.sssCallbackUrl = url;\n  }\n\n  setSssMode(mode: string): void {\n    this.sssMode = mode;\n  }\n\n  setSssOriginUrl(url: string): void {\n    this.sssOriginUrl = url;\n  }\n\n  verifySignature(\n    payloadString: string,\n    signatureB64: string,\n    publicKeyB64: string\n  ): Promise<boolean> {\n    let publicKey = this.utilService.asUint8Array(window.atob(publicKeyB64));\n    let payload = this.utilService.asUint8Array(payloadString);\n    let signature = this.utilService.asUint8Array(window.atob(signatureB64));\n    const signatureAlgorithm = {\n      name: \"RSASSA-PKCS1-v1_5\",\n      modulusLength: 2048,\n      publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n      hash: { name: \"SHA-256\" },\n    };\n\n    return crypto.subtle\n      .importKey(\"spki\", publicKey, signatureAlgorithm, false, [\"verify\"])\n      .then(function (key) {\n        return crypto.subtle.verify(\n          signatureAlgorithm,\n          key,\n          signature,\n          payload\n        );\n      });\n  }\n}\n\npn.container.registerSingleton(\"tinypass\", Tinypass);\n\nconst tpInst = pn.container.resolve(\"tinypass\") as TinypassInterface;\n\npublicSDKModuleList.forEach((m: PublicSDKModuleDescInterface) => {\n  // heating cache\n  if (m.hM && !pn.container.isRegistered(m.n)) {\n    pn.container.resolve(m.n);\n  }\n});\n\nObject.assign(pn, tpInst);\nObject.setPrototypeOf(pn, Tinypass.prototype);\n\n// for (let keyField in tpInst) {\n//   // @ts-ignore\n//   pn[keyField] = tpInst[keyField];\n// }\n\nconst tp = (window.tp = pn);\n\npn.initTp();\n\nexport { tp as pn };\n", "export const postProcessing = 'postProcessing';\n"],
  "mappings": "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",
  "names": []
}
